# ============================================================================
# TON Audit Platform - Production Environment Template
# ============================================================================
# Copy this file to ".env" and replace placeholder values before deploying:
#   cp .env.production.example .env
#
# Used by:
# - docker-compose.prod.yml (web, worker, postgres, redis, minio, sandbox-runner, lsp-service)
# - apps/web and apps/worker runtime env validation
#
# IMPORTANT:
# - Do not commit real secrets.
# - Use long random values for secrets (>= 32 chars for BETTER_AUTH_SECRET).
# - Keep SANDBOX_RUNNER_IMAGE and SANDBOX_DOCKER_IMAGE aligned when overriding tags.

# ----------------------------------------------------------------------------
# Runtime mode
# ----------------------------------------------------------------------------
NODE_ENV=production

# ----------------------------------------------------------------------------
# Public URLs (browser-visible values)
# ----------------------------------------------------------------------------
# Public base URL for the web app (no trailing slash).
NEXT_PUBLIC_APP_URL=https://audit.example.com
# Public WebSocket URL that browsers can reach for Monaco LSP.
# Example:
# - dedicated host: wss://lsp.example.com
# - reverse-proxied path: wss://audit.example.com/lsp
NEXT_PUBLIC_TON_LSP_WS_URL=wss://lsp.example.com

# ----------------------------------------------------------------------------
# Datastores
# ----------------------------------------------------------------------------
# Canonical Postgres password source used by postgres and derived DATABASE_URL.
DB_PASSWORD=replace-with-strong-postgres-password
# Internal Postgres hostname used by services on the core network.
POSTGRES_HOST=tonaudit-db
# Optional explicit override for external/managed databases.
# If using docker-compose.prod.yml internal postgres service:
#   host=${POSTGRES_HOST}, port=5432
# DATABASE_URL=postgresql://ton:replace-with-strong-postgres-password@tonaudit-db:5432/ton_audit
# If using docker-compose.prod.yml internal redis service:
#   host=redis, port=6379
REDIS_URL=redis://redis:6379

# ----------------------------------------------------------------------------
# Object storage (MinIO/S3-compatible)
# ----------------------------------------------------------------------------
# For compose-internal MinIO service:
MINIO_ENDPOINT=http://minio:9000
MINIO_REGION=us-east-1
MINIO_BUCKET=ton-audit

# App credentials used by web/worker to access MINIO_BUCKET.
# Prefer a dedicated app user (recommended), not root credentials.
MINIO_ACCESS_KEY=replace-with-minio-app-access-key
MINIO_SECRET_KEY=replace-with-minio-app-secret-key

# MinIO root/admin credentials for the MinIO container and minio-init bootstrap.
MINIO_ROOT_USER=replace-with-minio-root-user
MINIO_ROOT_PASSWORD=replace-with-minio-root-password

# ----------------------------------------------------------------------------
# Authentication
# ----------------------------------------------------------------------------
# 32+ chars minimum; use a cryptographically random secret.
BETTER_AUTH_SECRET=replace-with-a-long-random-secret-at-least-32-chars
# GitHub OAuth App credentials.
# Ensure callback URL matches your app domain:
#   https://audit.example.com/api/auth/callback/github
GITHUB_CLIENT_ID=replace-with-github-oauth-client-id
GITHUB_CLIENT_SECRET=replace-with-github-oauth-client-secret

# ----------------------------------------------------------------------------
# AI providers / model policy
# ----------------------------------------------------------------------------
OPENROUTER_API_KEY=replace-with-openrouter-api-key
OPENROUTER_EMBEDDINGS_MODEL=openai/text-embedding-3-small
# Comma-separated allowlist for audit generation models.
# Duplicates are automatically deduplicated at runtime.
AUDIT_MODEL_ALLOWLIST=google/gemini-2.5-flash,openai/gpt-5-mini

# Optional: comma-separated admin emails for /api/admin/* endpoints.
# Leave blank to disable explicit admin allowlist.
ADMIN_EMAILS=security@example.com,ops@example.com

# ----------------------------------------------------------------------------
# Upload and retention controls
# ----------------------------------------------------------------------------
# 25 MB default
UPLOAD_MAX_BYTES=26214400
# Max files per upload
UPLOAD_MAX_FILES=300
# Data retention used by cleanup worker
RETENTION_DAYS=90

# ----------------------------------------------------------------------------
# Sandbox runner wiring and limits
# ----------------------------------------------------------------------------
# Worker -> sandbox-runner service URL (compose internal DNS).
SANDBOX_RUNNER_URL=http://sandbox-runner:3003
# Request payload cap accepted by sandbox-runner (bytes).
SANDBOX_MAX_REQUEST_BYTES=31457280
# Docker socket path mounted into sandbox-runner.
DOCKER_SOCK_PATH=/var/run/docker.sock
# Keep these two image tags aligned if overridden.
SANDBOX_RUNNER_IMAGE=ton-audit-sandbox-runner:latest
SANDBOX_DOCKER_IMAGE=ton-audit-sandbox-runner:latest

# ----------------------------------------------------------------------------
# Worker queue/stall tuning (BullMQ)
# ----------------------------------------------------------------------------
WORKER_JOB_HEARTBEAT_MS=15000
WORKER_LOCK_DURATION_MS=120000
WORKER_STALLED_INTERVAL_MS=60000
WORKER_MAX_STALLED_COUNT=3

# ----------------------------------------------------------------------------
# Compose infrastructure defaults (used by docker-compose.prod.yml)
# ----------------------------------------------------------------------------
POSTGRES_DB=ton_audit
POSTGRES_USER=ton

# External reverse-proxy network name (Dokploy/Traefik/etc).
PROXY_NETWORK=dokploy-network
