module.exports=[38618,a=>{"use strict";var b,c,d=a.i(89053),e=a.i(2733),f=a.i(41487),g=a.i(61644);function h({projectId:a,onUploaded:b}){let[c,h]=(0,e.useState)(null),[i,j]=(0,e.useState)(!1),[k,l]=(0,e.useState)(null);return(0,d.jsxs)("div",{className:"rounded-lg border border-white/10 bg-zinc-900/80 p-4",children:[(0,d.jsx)("div",{className:"mb-2 text-sm font-medium text-zinc-200",children:"Upload source or Blueprint ZIP"}),(0,d.jsx)("p",{className:"mb-3 text-xs text-zinc-400",children:"Upload one file or one zip per revision. ZIP is recommended for multi-file projects."}),(0,d.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,d.jsx)(g.Input,{type:"file",onChange:a=>h(a.target.files?.[0]??null),accept:".zip,.tolk,.fc,.func,.tact,.fift,.fif,.tlb,.ts,.js,.json,.md"}),(0,d.jsx)(f.Button,{disabled:!c||i,onClick:async()=>{if(c){l(null),j(!0);try{let d=c.name.toLowerCase().endsWith(".zip"),e=await fetch(`/api/projects/${a}/uploads/init`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:c.name,contentType:c.type||"application/octet-stream",sizeBytes:c.size,type:d?"zip":"file-set",parts:1})});if(!e.ok){let a=await e.json();throw Error(a.error??"Upload init failed")}let f=await e.json();if(!f.singleUrl)throw Error("Multipart upload not supported by this form");let g=await fetch(f.singleUrl,{method:"PUT",body:c,headers:{"Content-Type":c.type||"application/octet-stream"}});if(!g.ok)throw Error(`Upload failed with status ${g.status}`);let i=await fetch(`/api/projects/${a}/uploads/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uploadId:f.uploadId,eTags:[]})});if(!i.ok){let a=await i.json();throw Error(a.error??"Upload completion failed")}let j=await fetch(`/api/projects/${a}/revisions/from-upload`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uploadId:f.uploadId})});if(!j.ok){let a=await j.json();throw Error(a.error??"Failed to create revision")}let k=await j.json();b({revisionId:k.revision.id,jobId:k.jobId}),h(null)}catch(a){l(a instanceof Error?a.message:"Upload failed")}finally{j(!1)}}},children:i?"Uploading...":"Upload"})]}),k?(0,d.jsx)("p",{className:"mt-2 text-xs text-red-400",children:k}):null]})}function i(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function j(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function k(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?j(Object(c),!0).forEach(function(b){var d;d=c[b],b in a?Object.defineProperty(a,b,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[b]=d}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):j(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function l(a){return function b(){for(var c=this,d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];return e.length>=a.length?a.apply(this,e):function(){for(var a=arguments.length,d=Array(a),f=0;f<a;f++)d[f]=arguments[f];return b.apply(c,[].concat(e,d))}}}function m(a){return({}).toString.call(a).includes("Object")}function n(a){return"function"==typeof a}var o=l(function(a,b){throw Error(a[b]||a.default)})({initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"}),p=function(a,b){return m(b)||o("changeType"),Object.keys(b).some(function(b){return!Object.prototype.hasOwnProperty.call(a,b)})&&o("changeField"),b},q=function(a){n(a)||o("selectorType")},r=function(a){n(a)||m(a)||o("handlerType"),m(a)&&Object.values(a).some(function(a){return!n(a)})&&o("handlersType")},s=function(a){a||o("initialIsRequired"),m(a)||o("initialType"),Object.keys(a).length||o("initialContent")};function t(a,b){return n(b)?b(a.current):b}function u(a,b){return a.current=k(k({},a.current),b),b}function v(a,b,c){return n(b)?b(a.current):Object.keys(c).forEach(function(c){var d;return null==(d=b[c])?void 0:d.call(b,a.current[c])}),c}var w={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},x=(b=function(a,b){throw Error(a[b]||a.default)},function a(){for(var c=this,d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];return e.length>=b.length?b.apply(this,e):function(){for(var b=arguments.length,d=Array(b),f=0;f<b;f++)d[f]=arguments[f];return a.apply(c,[].concat(e,d))}})(w),y=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return function(a){return b.reduceRight(function(a,b){return b(a)},a)}},z={type:"cancelation",msg:"operation is manually canceled"};function A(a){var b=!1,c=new Promise(function(c,d){a.then(function(a){return b?d(z):c(a)}),a.catch(d)});return c.cancel=function(){return b=!0},c}var B=function(a){if(Array.isArray(a))return a}(c=({create:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s(a),r(b);var c={current:a},d=l(v)(c,b),e=l(u)(c),f=l(p)(a),g=l(t)(c);return[function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(a){return a};return q(a),a(c.current)},function(a){(function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return function(a){return b.reduceRight(function(a,b){return b(a)},a)}})(d,e,f,g)(a)}]}}).create({config:{paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.55.1/min/vs"}},isInitialized:!1,resolve:null,reject:null,monaco:null}))||function(a,b){var c=null==a?null:"u">typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f,g,h=[],i=!0,j=!1;try{f=(c=c.call(a)).next,!1;for(;!(i=(d=f.call(c)).done)&&(h.push(d.value),2!==h.length);i=!0);}catch(a){j=!0,e=a}finally{try{if(!i&&null!=c.return&&(g=c.return(),Object(g)!==g))return}finally{if(j)throw e}}return h}}(c,2)||function(a,b){if(a){if("string"==typeof a)return i(a,2);var c=({}).toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?i(a,2):void 0}}(c,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),C=B[0],D=B[1];function E(a){return document.body.appendChild(a)}function F(a){var b,c,d=C(function(a){return{config:a.config,reject:a.reject}}),e=(b="".concat(d.config.paths.vs,"/loader.js"),c=document.createElement("script"),b&&(c.src=b),c);return e.onload=function(){return a()},e.onerror=d.reject,e}function G(){var a=C(function(a){return{config:a.config,resolve:a.resolve,reject:a.reject}}),b=window.require;b.config(a.config),b(["vs/editor/editor.main"],function(b){var c=b.m||b;H(c),a.resolve(c)},function(b){a.reject(b)})}function H(a){C().monaco||D({monaco:a})}var I=new Promise(function(a,b){return D({resolve:a,reject:b})}),J=function(){var a=C(function(a){return{monaco:a.monaco,isInitialized:a.isInitialized,resolve:a.resolve}});if(!a.isInitialized){if(D({isInitialized:!0}),a.monaco)return a.resolve(a.monaco),A(I);if(window.monaco&&window.monaco.editor)return H(window.monaco),a.resolve(window.monaco),A(I);y(E,F)(G)}return A(I)},K={display:"flex",position:"relative",textAlign:"initial"},L={width:"100%"},M={display:"none"},N={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},O=function({children:a}){return e.default.createElement("div",{style:N},a)},P=(0,e.memo)(function({width:a,height:b,isEditorReady:c,loading:d,_ref:f,className:g,wrapperProps:h}){return e.default.createElement("section",{style:{...K,width:a,height:b},...h},!c&&e.default.createElement(O,null,d),e.default.createElement("div",{ref:f,style:{...L,...!c&&M},className:g}))}),Q=function(a){(0,e.useEffect)(a,[])},R=function(a,b,c=!0){let d=(0,e.useRef)(!0);(0,e.useEffect)(d.current||!c?()=>{d.current=!1}:a,b)};function S(){}function T(a,b,c,d){var e,f,g,h,i,j;return e=a,f=d,e.editor.getModel(U(e,f))||(g=a,h=b,i=c,j=d,g.editor.createModel(h,i,j?U(g,j):void 0))}function U(a,b){return a.Uri.parse(b)}(0,e.memo)(function({original:a,modified:b,language:c,originalLanguage:d,modifiedLanguage:f,originalModelPath:g,modifiedModelPath:h,keepCurrentOriginalModel:i=!1,keepCurrentModifiedModel:j=!1,theme:k="light",loading:l="Loading...",options:m={},height:n="100%",width:o="100%",className:p,wrapperProps:q={},beforeMount:r=S,onMount:s=S}){let[t,u]=(0,e.useState)(!1),[v,w]=(0,e.useState)(!0),x=(0,e.useRef)(null),y=(0,e.useRef)(null),z=(0,e.useRef)(null),A=(0,e.useRef)(s),B=(0,e.useRef)(r),C=(0,e.useRef)(!1);Q(()=>{let a=J();return a.then(a=>(y.current=a)&&w(!1)).catch(a=>a?.type!=="cancelation"&&console.error("Monaco initialization: error:",a)),()=>{let b;return x.current?(b=x.current?.getModel(),void(i||b?.original?.dispose(),j||b?.modified?.dispose(),x.current?.dispose())):a.cancel()}}),R(()=>{if(x.current&&y.current){let b=x.current.getOriginalEditor(),e=T(y.current,a||"",d||c||"text",g||"");e!==b.getModel()&&b.setModel(e)}},[g],t),R(()=>{if(x.current&&y.current){let a=x.current.getModifiedEditor(),d=T(y.current,b||"",f||c||"text",h||"");d!==a.getModel()&&a.setModel(d)}},[h],t),R(()=>{let a=x.current.getModifiedEditor();a.getOption(y.current.editor.EditorOption.readOnly)?a.setValue(b||""):b!==a.getValue()&&(a.executeEdits("",[{range:a.getModel().getFullModelRange(),text:b||"",forceMoveMarkers:!0}]),a.pushUndoStop())},[b],t),R(()=>{x.current?.getModel()?.original.setValue(a||"")},[a],t),R(()=>{let{original:a,modified:b}=x.current.getModel();y.current.editor.setModelLanguage(a,d||c||"text"),y.current.editor.setModelLanguage(b,f||c||"text")},[c,d,f],t),R(()=>{y.current?.editor.setTheme(k)},[k],t),R(()=>{x.current?.updateOptions(m)},[m],t);let D=(0,e.useCallback)(()=>{if(!y.current)return;B.current(y.current);let e=T(y.current,a||"",d||c||"text",g||""),i=T(y.current,b||"",f||c||"text",h||"");x.current?.setModel({original:e,modified:i})},[c,b,f,a,d,g,h]),E=(0,e.useCallback)(()=>{!C.current&&z.current&&(x.current=y.current.editor.createDiffEditor(z.current,{automaticLayout:!0,...m}),D(),y.current?.editor.setTheme(k),u(!0),C.current=!0)},[m,k,D]);return(0,e.useEffect)(()=>{t&&A.current(x.current,y.current)},[t]),(0,e.useEffect)(()=>{v||t||E()},[v,t,E]),e.default.createElement(P,{width:o,height:n,isEditorReady:t,loading:l,_ref:z,className:p,wrapperProps:q})});var V=function(a){let b=(0,e.useRef)();return(0,e.useEffect)(()=>{b.current=a},[a]),b.current},W=new Map,X=(0,e.memo)(function({defaultValue:a,defaultLanguage:b,defaultPath:c,value:d,language:f,path:g,theme:h="light",line:i,loading:j="Loading...",options:k={},overrideServices:l={},saveViewState:m=!0,keepCurrentModel:n=!1,width:o="100%",height:p="100%",className:q,wrapperProps:r={},beforeMount:s=S,onMount:t=S,onChange:u,onValidate:v=S}){let[w,x]=(0,e.useState)(!1),[y,z]=(0,e.useState)(!0),A=(0,e.useRef)(null),B=(0,e.useRef)(null),C=(0,e.useRef)(null),D=(0,e.useRef)(t),E=(0,e.useRef)(s),F=(0,e.useRef)(),G=(0,e.useRef)(d),H=V(g),I=(0,e.useRef)(!1),K=(0,e.useRef)(!1);Q(()=>{let a=J();return a.then(a=>(A.current=a)&&z(!1)).catch(a=>a?.type!=="cancelation"&&console.error("Monaco initialization: error:",a)),()=>B.current?void(F.current?.dispose(),n?m&&W.set(g,B.current.saveViewState()):B.current.getModel()?.dispose(),B.current.dispose()):a.cancel()}),R(()=>{let e=T(A.current,a||d||"",b||f||"",g||c||"");e!==B.current?.getModel()&&(m&&W.set(H,B.current?.saveViewState()),B.current?.setModel(e),m&&B.current?.restoreViewState(W.get(g)))},[g],w),R(()=>{B.current?.updateOptions(k)},[k],w),R(()=>{B.current&&void 0!==d&&(B.current.getOption(A.current.editor.EditorOption.readOnly)?B.current.setValue(d):d!==B.current.getValue()&&(K.current=!0,B.current.executeEdits("",[{range:B.current.getModel().getFullModelRange(),text:d,forceMoveMarkers:!0}]),B.current.pushUndoStop(),K.current=!1))},[d],w),R(()=>{let a=B.current?.getModel();a&&f&&A.current?.editor.setModelLanguage(a,f)},[f],w),R(()=>{void 0!==i&&B.current?.revealLine(i)},[i],w),R(()=>{A.current?.editor.setTheme(h)},[h],w);let L=(0,e.useCallback)(()=>{if(!(!C.current||!A.current)&&!I.current){E.current(A.current);let e=g||c,j=T(A.current,d||a||"",b||f||"",e||"");B.current=A.current?.editor.create(C.current,{model:j,automaticLayout:!0,...k},l),m&&B.current.restoreViewState(W.get(e)),A.current.editor.setTheme(h),void 0!==i&&B.current.revealLine(i),x(!0),I.current=!0}},[a,b,c,d,f,g,k,l,m,h,i]);return(0,e.useEffect)(()=>{w&&D.current(B.current,A.current)},[w]),(0,e.useEffect)(()=>{y||w||L()},[y,w,L]),G.current=d,(0,e.useEffect)(()=>{w&&u&&(F.current?.dispose(),F.current=B.current?.onDidChangeModelContent(a=>{K.current||u(B.current.getValue(),a)}))},[w,u]),(0,e.useEffect)(()=>{if(w){let a=A.current.editor.onDidChangeMarkers(a=>{let b=B.current.getModel()?.uri;if(b&&a.find(a=>a.path===b.path)){let a=A.current.editor.getModelMarkers({resource:b});v?.(a)}});return()=>{a?.dispose()}}return()=>{}},[w,v]),e.default.createElement(P,{width:o,height:p,isEditorReady:w,loading:j,_ref:C,className:q,wrapperProps:r})});let Y=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim(),Z=a=>{let b=a.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,b,c)=>c?c.toUpperCase():b.toLowerCase());return b.charAt(0).toUpperCase()+b.slice(1)};var $={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let _=(0,e.forwardRef)(({color:a="currentColor",size:b=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:f="",children:g,iconNode:h,...i},j)=>(0,e.createElement)("svg",{ref:j,...$,width:b,height:b,stroke:a,strokeWidth:d?24*Number(c)/Number(b):c,className:Y("lucide",f),...!g&&!(a=>{for(let b in a)if(b.startsWith("aria-")||"role"===b||"title"===b)return!0;return!1})(i)&&{"aria-hidden":"true"},...i},[...h.map(([a,b])=>(0,e.createElement)(a,b)),...Array.isArray(g)?g:[g]])),aa=(a,b)=>{let c=(0,e.forwardRef)(({className:c,...d},f)=>(0,e.createElement)(_,{ref:f,iconNode:b,className:Y(`lucide-${Z(a).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${a}`,c),...d}));return c.displayName=Z(a),c},ab=aa("file-code-corner",[["path",{d:"M4 12.15V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2h-3.35",key:"1wthlu"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m5 16-3 3 3 3",key:"331omg"}],["path",{d:"m9 22 3-3-3-3",key:"lsp7cz"}]]),ac=aa("folder-tree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]),ad=aa("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),ae=aa("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),af=aa("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),ag=aa("file-down",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);a.i(42837);var ah=a.i(72790),ai=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,b)=>{let c=(0,ah.createSlot)(`Primitive.${b}`),f=e.forwardRef((a,e)=>{let{asChild:f,...g}=a;return(0,d.jsx)(f?c:b,{...g,ref:e})});return f.displayName=`Primitive.${b}`,{...a,[b]:f}},{}),aj="horizontal",ak=["horizontal","vertical"],al=e.forwardRef((a,b)=>{var c;let{decorative:e,orientation:f=aj,...g}=a,h=(c=f,ak.includes(c))?f:aj;return(0,d.jsx)(ai.div,{"data-orientation":h,...e?{role:"none"}:{"aria-orientation":"vertical"===h?h:void 0,role:"separator"},...g,ref:b})});al.displayName="Separator",a.s(["Root",()=>al,"Separator",()=>al],57413);var am=a.i(57413),am=am,an=a.i(74192);function ao({className:a,orientation:b="horizontal",decorative:c=!0,...e}){return(0,d.jsx)(am.Root,{"data-slot":"separator",decorative:c,orientation:b,className:(0,an.cn)("bg-border shrink-0 data-horizontal:h-px data-horizontal:w-full data-vertical:w-px data-vertical:self-stretch",a),...e})}let ap={tolk:"typescript",func:"cpp",tact:"typescript",fift:"plaintext","tl-b":"plaintext",unknown:"plaintext"};function aq(a){let b=[];for(let c of a){if("file"===c.type){b.push(c.path);continue}b.push(...aq(c.children??[]))}return b}function ar(a){let{nodes:b,selectedPath:c,onSelect:e}=a;return(0,d.jsx)("ul",{className:"space-y-0.5 text-xs",children:b.map(a=>"directory"===a.type?(0,d.jsxs)("li",{children:[(0,d.jsxs)("div",{className:"flex items-center gap-1 text-zinc-400",children:[(0,d.jsx)(ac,{className:"size-3"}),(0,d.jsx)("span",{children:a.name})]}),(0,d.jsx)("div",{className:"ml-4",children:(0,d.jsx)(ar,{nodes:a.children??[],selectedPath:c,onSelect:e})})]},a.path):(0,d.jsx)("li",{children:(0,d.jsxs)("button",{type:"button",onClick:()=>e(a.path),className:`flex w-full items-center gap-1 rounded px-1 py-0.5 text-left ${c===a.path?"bg-sky-500/20 text-sky-200":"text-zinc-300 hover:bg-white/5"}`,children:[(0,d.jsx)(ab,{className:"size-3"}),(0,d.jsx)("span",{className:"truncate",children:a.name})]})},a.path))})}function as(a){let{projectId:b,initialRevisionId:c,initialAuditId:g,modelAllowlist:h}=a,i=(0,e.useRef)(null),[j,k]=(0,e.useState)(c),[l,m]=(0,e.useState)(g),[n,o]=(0,e.useState)(null),[p,q]=(0,e.useState)(!1),[r,s]=(0,e.useState)(!1),[t,u]=(0,e.useState)([]),[v,w]=(0,e.useState)(null),[x,y]=(0,e.useState)({}),[z,A]=(0,e.useState)([]),[B,C]=(0,e.useState)(h[0]??"openai/gpt-5"),[D,E]=(0,e.useState)(h[1]??h[0]??"openai/gpt-5-mini"),[F,G]=(0,e.useState)("idle"),[H,I]=(0,e.useState)(null),J=(0,e.useMemo)(()=>aq(t),[t]),K=v?x[v]:null,L=(0,e.useCallback)(async a=>{let c=await fetch(`/api/projects/${b}/revisions/${a}/tree`,{cache:"no-store"});if(!c.ok)throw Error("Failed to fetch file tree");let d=await c.json();u(d.tree);let e=aq(d.tree)[0]??null;w(a=>a??e)},[b]),M=(0,e.useCallback)(async a=>{if(!j||x[a])return;let c=new URLSearchParams({path:a}).toString(),d=await fetch(`/api/projects/${b}/revisions/${j}/file?${c}`,{cache:"no-store"});if(!d.ok)throw Error("Failed to fetch file");let e=await d.json();y(a=>({...a,[e.file.path]:{content:e.file.content,language:e.file.language}}))},[x,b,j]),N=(0,e.useCallback)(async a=>{let c=await fetch(`/api/projects/${b}/audits/${a}`,{cache:"no-store"});if(!c.ok)throw Error("Failed to fetch audit details");A((await c.json()).findings??[])},[b]);async function O(){if(j){if(!n){s(!0);try{let a=await fetch(`/api/projects/${b}/revisions/${j}/working-copy`,{method:"POST"});if(!a.ok)throw Error("Failed to create working copy");let c=await a.json();o(c.workingCopy.id)}finally{s(!1)}}q(!0)}}async function P(){if(n&&v&&K){s(!0),I(null);try{let a=await fetch(`/api/projects/${b}/working-copies/${n}/file`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:v,content:K.content})});if(!a.ok){let b=await a.json();throw Error(b.error??"Save failed")}}catch(a){I(a instanceof Error?a.message:"Save failed")}finally{s(!1)}}}async function Q(){if(n){s(!0),G("queuing"),I(null);try{v&&K&&await P();let a=await fetch(`/api/projects/${b}/working-copies/${n}/run-audit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({primaryModelId:B,fallbackModelId:D,includeDocsFallbackFetch:!0})});if(!a.ok){let b=await a.json();throw Error(b.error??"Run audit failed")}let c=await a.json();G(c.verifyJobId?`verify:${c.verifyJobId}`:"queued"),k(c.revision.id),m(c.auditRun.id),o(null),q(!1)}catch(a){I(a instanceof Error?a.message:"Run audit failed")}finally{s(!1)}}}async function R(){if(l){s(!0),I(null);try{if(!(await fetch(`/api/projects/${b}/audits/${l}/pdf`,{method:"POST"})).ok)throw Error("Failed to queue PDF");let a=null;for(let c=0;c<10;c+=1){await new Promise(a=>setTimeout(a,1500));let c=await fetch(`/api/projects/${b}/audits/${l}/pdf`,{cache:"no-store"}),d=await c.json();if(d.url){a=d.url;break}}if(!a)throw Error("PDF generation is still running");window.open(a,"_blank","noopener,noreferrer")}catch(a){I(a instanceof Error?a.message:"PDF export failed")}finally{s(!1)}}}return(0,e.useEffect)(()=>{j&&L(j).catch(a=>{I(a instanceof Error?a.message:"Unable to load revision tree")})},[j,L]),(0,e.useEffect)(()=>{v&&M(v).catch(a=>{I(a instanceof Error?a.message:"Unable to load file")})},[v,M]),(0,e.useEffect)(()=>{l&&N(l).catch(a=>{I(a instanceof Error?a.message:"Unable to load findings")})},[l,N]),(0,d.jsxs)("div",{className:"grid min-h-[78vh] grid-cols-[52px_260px_minmax(0,1fr)_320px] overflow-hidden rounded-xl border border-white/10 bg-[#0d1117] text-zinc-200",children:[(0,d.jsxs)("aside",{className:"flex flex-col items-center gap-3 border-r border-white/10 bg-[#0a0e14] px-2 py-3",children:[(0,d.jsx)("button",{type:"button",className:"rounded bg-white/10 p-2 text-sky-300",children:(0,d.jsx)(ac,{className:"size-4"})}),(0,d.jsx)("button",{type:"button",className:"rounded p-2 text-zinc-500",children:(0,d.jsx)(af,{className:"size-4"})})]}),(0,d.jsxs)("aside",{className:"border-r border-white/10 bg-[#11161e] p-3",children:[(0,d.jsx)("div",{className:"mb-2 text-[11px] uppercase tracking-wide text-zinc-400",children:"Explorer"}),(0,d.jsx)(ar,{nodes:t,selectedPath:v,onSelect:w})]}),(0,d.jsxs)("section",{className:"flex min-w-0 flex-col",children:[(0,d.jsxs)("header",{className:"flex flex-wrap items-center gap-2 border-b border-white/10 bg-[#11161e] px-3 py-2 text-xs",children:[(0,d.jsx)("span",{className:"rounded bg-white/5 px-2 py-1 text-zinc-300",children:v??"No file selected"}),(0,d.jsx)(ao,{orientation:"vertical",className:"h-4 bg-white/10"}),p?(0,d.jsx)(f.Button,{size:"sm",variant:"outline",disabled:r,onClick:P,children:"Save file"}):(0,d.jsx)(f.Button,{size:"sm",variant:"outline",disabled:r||!j,onClick:O,children:"Enable editing"}),(0,d.jsx)("select",{className:"h-8 rounded border border-white/10 bg-black/30 px-2 text-xs",value:B,onChange:a=>C(a.target.value),children:h.map(a=>(0,d.jsx)("option",{value:a,children:a},a))}),(0,d.jsx)("select",{className:"h-8 rounded border border-white/10 bg-black/30 px-2 text-xs",value:D,onChange:a=>E(a.target.value),children:h.map(a=>(0,d.jsx)("option",{value:a,children:a},a))}),(0,d.jsxs)(f.Button,{size:"sm",disabled:!p||r,onClick:Q,children:[(0,d.jsx)(ad,{className:"mr-1 size-3"}),"Run Audit"]}),(0,d.jsxs)(f.Button,{size:"sm",variant:"outline",disabled:!l||r,onClick:R,children:[(0,d.jsx)(ag,{className:"mr-1 size-3"}),"Export PDF"]}),(0,d.jsxs)(f.Button,{size:"sm",variant:"ghost",disabled:r||!j,onClick:()=>{j&&(y({}),L(j).catch(()=>void 0),l&&N(l).catch(()=>void 0))},children:[(0,d.jsx)(ae,{className:"mr-1 size-3"}),"Refresh"]}),(0,d.jsxs)("span",{className:"ml-auto text-zinc-500",children:[p?"working copy":"audited revision"," | ",F]})]}),(0,d.jsx)("div",{className:"min-h-0 flex-1",children:v?(0,d.jsx)(X,{path:v,value:K?.content??"",language:ap[K?.language??"unknown"]??"plaintext",theme:"vs-dark",options:{readOnly:!p,minimap:{enabled:!0},fontSize:13,lineNumbers:"on",automaticLayout:!0},onMount:a=>{i.current=a},onChange:a=>{v&&p&&y(b=>({...b,[v]:{content:a??"",language:b[v]?.language??"unknown"}}))}}):(0,d.jsx)("div",{className:"grid h-full place-items-center text-sm text-zinc-500",children:"Upload a revision and open a file to start."})})]}),(0,d.jsxs)("aside",{className:"border-l border-white/10 bg-[#0f131a] p-3",children:[(0,d.jsx)("div",{className:"mb-2 text-[11px] uppercase tracking-wide text-zinc-400",children:"Findings"}),(0,d.jsx)("div",{className:"space-y-2",children:0===z.length?(0,d.jsx)("p",{className:"text-xs text-zinc-500",children:"No findings on this audit revision."}):z.map(a=>(0,d.jsxs)("button",{type:"button",className:"w-full rounded border border-white/10 bg-white/[0.03] p-2 text-left text-xs hover:bg-white/[0.06]",onClick:()=>{let b=a.payloadJson?.evidence?.filePath;b&&w(b);let c=a.payloadJson?.evidence?.startLine;c&&i.current&&(i.current.revealLineInCenter(c),i.current.setPosition({lineNumber:c,column:1}))},children:[(0,d.jsx)("div",{className:`font-medium ${function(a){switch(a){case"critical":return"text-red-400";case"high":return"text-orange-400";case"medium":return"text-amber-300";case"low":return"text-yellow-200";default:return"text-sky-300"}}(a.payloadJson?.severity??a.severity)}`,children:a.payloadJson?.severity??a.severity}),(0,d.jsx)("div",{className:"mt-1 text-zinc-100",children:a.payloadJson?.title??"Untitled finding"}),(0,d.jsx)("div",{className:"mt-1 line-clamp-2 text-zinc-400",children:a.payloadJson?.summary})]},a.id))}),H?(0,d.jsx)("p",{className:"mt-3 text-xs text-red-400",children:H}):null,(0,d.jsxs)("p",{className:"mt-3 text-xs text-zinc-500",children:["Open files: ",J.length]})]})]})}function at({projectId:a,initialRevisionId:b,initialAuditId:c,modelAllowlist:f}){let[g,i]=(0,e.useState)(b),[j,k]=(0,e.useState)(c),[l,m]=(0,e.useState)(null);return(0,d.jsxs)("div",{className:"grid gap-4",children:[(0,d.jsx)(h,{projectId:a,onUploaded:({revisionId:a,jobId:b})=>{i(a),k(null),m(b)}}),l?(0,d.jsxs)("p",{className:"text-xs text-zinc-500",children:["Ingest job queued: ",(0,d.jsx)("span",{className:"font-mono text-zinc-300",children:l})]}):null,(0,d.jsx)(as,{projectId:a,initialRevisionId:g,initialAuditId:j,modelAllowlist:f},`${g??"none"}:${j??"none"}`)]})}a.s(["ProjectWorkspace",()=>at],38618)}];

//# sourceMappingURL=apps_web_components_projects_project-workspace_tsx_77b7a45e._.js.map