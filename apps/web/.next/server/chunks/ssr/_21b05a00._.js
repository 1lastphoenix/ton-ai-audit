module.exports=[10503,(a,b,c)=>{let{createClientModuleProxy:d}=a.r(23835);a.n(d("[project]/node_modules/.pnpm/next@16.1.6_@babel+core@7.2_4d12a90c26dc6df3da6e76e4da4695e2/node_modules/next/dist/client/app-dir/link.js <module evaluation>"))},25587,(a,b,c)=>{let{createClientModuleProxy:d}=a.r(23835);a.n(d("[project]/node_modules/.pnpm/next@16.1.6_@babel+core@7.2_4d12a90c26dc6df3da6e76e4da4695e2/node_modules/next/dist/client/app-dir/link.js"))},47095,a=>{"use strict";a.i(10503);var b=a.i(25587);a.n(b)},61774,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return i},useLinkStatus:function(){return h.useLinkStatus}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(54508),g=a.r(71157),h=f._(a.r(47095));function i(a){let b=a.legacyBehavior,c="string"==typeof a.children||"number"==typeof a.children||"string"==typeof a.children?.type,d=a.children?.type?.$$typeof===Symbol.for("react.client.reference");return!b||c||d||(a.children?.type?.$$typeof===Symbol.for("react.lazy")?console.error("Using a Lazy Component as a direct child of `<Link legacyBehavior>` from a Server Component is not supported. If you need legacyBehavior, wrap your Lazy Component in a Client Component that renders the Link's `<a>` tag."):console.error("Using a Server Component as a direct child of `<Link legacyBehavior>` is not supported. If you need legacyBehavior, wrap your Server Component in a Client Component that renders the Link's `<a>` tag.")),(0,g.jsx)(h.default,{...a})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},50036,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ReadonlyURLSearchParams",{enumerable:!0,get:function(){return e}});class d extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class e extends URLSearchParams{append(){throw new d}delete(){throw new d}set(){throw new d}sort(){throw new d}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},77681,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"RedirectStatusCode",{enumerable:!0,get:function(){return e}});var d,e=((d={})[d.SeeOther=303]="SeeOther",d[d.TemporaryRedirect=307]="TemporaryRedirect",d[d.PermanentRedirect=308]="PermanentRedirect",d);("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},35565,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e={REDIRECT_ERROR_CODE:function(){return h},RedirectType:function(){return i},isRedirectError:function(){return j}};for(var f in e)Object.defineProperty(c,f,{enumerable:!0,get:e[f]});let g=a.r(77681),h="NEXT_REDIRECT";var i=((d={}).push="push",d.replace="replace",d);function j(a){if("object"!=typeof a||null===a||!("digest"in a)||"string"!=typeof a.digest)return!1;let b=a.digest.split(";"),[c,d]=b,e=b.slice(2,-2).join(";"),f=Number(b.at(-2));return c===h&&("replace"===d||"push"===d)&&"string"==typeof e&&!isNaN(f)&&f in g.RedirectStatusCode}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},27810,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={getRedirectError:function(){return i},getRedirectStatusCodeFromError:function(){return n},getRedirectTypeFromError:function(){return m},getURLFromRedirectError:function(){return l},permanentRedirect:function(){return k},redirect:function(){return j}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(77681),g=a.r(35565),h=a.r(20635).actionAsyncStorage;function i(a,b,c=f.RedirectStatusCode.TemporaryRedirect){let d=Object.defineProperty(Error(g.REDIRECT_ERROR_CODE),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return d.digest=`${g.REDIRECT_ERROR_CODE};${b};${a};${c};`,d}function j(a,b){throw i(a,b??=h?.getStore()?.isAction?g.RedirectType.push:g.RedirectType.replace,f.RedirectStatusCode.TemporaryRedirect)}function k(a,b=g.RedirectType.replace){throw i(a,b,f.RedirectStatusCode.PermanentRedirect)}function l(a){return(0,g.isRedirectError)(a)?a.digest.split(";").slice(2,-2).join(";"):null}function m(a){if(!(0,g.isRedirectError)(a))throw Object.defineProperty(Error("Not a redirect error"),"__NEXT_ERROR_CODE",{value:"E260",enumerable:!1,configurable:!0});return a.digest.split(";",2)[1]}function n(a){if(!(0,g.isRedirectError)(a))throw Object.defineProperty(Error("Not a redirect error"),"__NEXT_ERROR_CODE",{value:"E260",enumerable:!1,configurable:!0});return Number(a.digest.split(";").at(-2))}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},31443,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={HTTPAccessErrorStatus:function(){return f},HTTP_ERROR_FALLBACK_ERROR_CODE:function(){return h},getAccessFallbackErrorTypeByStatus:function(){return k},getAccessFallbackHTTPStatus:function(){return j},isHTTPAccessFallbackError:function(){return i}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f={NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401},g=new Set(Object.values(f)),h="NEXT_HTTP_ERROR_FALLBACK";function i(a){if("object"!=typeof a||null===a||!("digest"in a)||"string"!=typeof a.digest)return!1;let[b,c]=a.digest.split(";");return b===h&&g.has(Number(c))}function j(a){return Number(a.digest.split(";")[1])}function k(a){switch(a){case 401:return"unauthorized";case 403:return"forbidden";case 404:return"not-found";default:return}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},60522,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"notFound",{enumerable:!0,get:function(){return f}});let d=a.r(31443),e=`${d.HTTP_ERROR_FALLBACK_ERROR_CODE};404`;function f(){let a=Object.defineProperty(Error(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});throw a.digest=e,a}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},78047,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"forbidden",{enumerable:!0,get:function(){return f}});let d=a.r(31443),e=`${d.HTTP_ERROR_FALLBACK_ERROR_CODE};403`;function f(){let a=Object.defineProperty(Error(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});throw a.digest=e,a}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},59651,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"unauthorized",{enumerable:!0,get:function(){return f}});let d=a.r(31443),e=`${d.HTTP_ERROR_FALLBACK_ERROR_CODE};401`;function f(){let a=Object.defineProperty(Error(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});throw a.digest=e,a}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},98922,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"isPostpone",{enumerable:!0,get:function(){return e}});let d=Symbol.for("react.postpone");function e(a){return"object"==typeof a&&null!==a&&a.$$typeof===d}},47738,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"isNextRouterError",{enumerable:!0,get:function(){return f}});let d=a.r(31443),e=a.r(35565);function f(a){return(0,e.isRedirectError)(a)||(0,d.isHTTPAccessFallbackError)(a)}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},7693,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"unstable_rethrow",{enumerable:!0,get:function(){return function a(b){if((0,g.isNextRouterError)(b)||(0,f.isBailoutToCSRError)(b)||(0,i.isDynamicServerError)(b)||(0,h.isDynamicPostpone)(b)||(0,e.isPostpone)(b)||(0,d.isHangingPromiseRejectionError)(b)||(0,h.isPrerenderInterruptedError)(b))throw b;b instanceof Error&&"cause"in b&&a(b.cause)}}});let d=a.r(96736),e=a.r(98922),f=a.r(66547),g=a.r(47738),h=a.r(85813),i=a.r(73482);("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},37237,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"unstable_rethrow",{enumerable:!0,get:function(){return d}});let d=a.r(7693).unstable_rethrow;("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},29319,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={ReadonlyURLSearchParams:function(){return f.ReadonlyURLSearchParams},RedirectType:function(){return h.RedirectType},forbidden:function(){return j.forbidden},notFound:function(){return i.notFound},permanentRedirect:function(){return g.permanentRedirect},redirect:function(){return g.redirect},unauthorized:function(){return k.unauthorized},unstable_isUnrecognizedActionError:function(){return m},unstable_rethrow:function(){return l.unstable_rethrow}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(50036),g=a.r(27810),h=a.r(35565),i=a.r(60522),j=a.r(78047),k=a.r(59651),l=a.r(37237);function m(){throw Object.defineProperty(Error("`unstable_isUnrecognizedActionError` can only be used on the client."),"__NEXT_ERROR_CODE",{value:"E776",enumerable:!1,configurable:!0})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},4049,a=>{"use strict";a.i(29319),a.s([])},10933,a=>{"use strict";let b=Symbol.for("drizzle:entityKind");function c(a,c){if(!a||"object"!=typeof a)return!1;if(a instanceof c)return!0;if(!Object.prototype.hasOwnProperty.call(c,b))throw Error(`Class "${c.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let d=Object.getPrototypeOf(a).constructor;if(d)for(;d;){if(b in d&&d[b]===c[b])return!0;d=Object.getPrototypeOf(d)}return!1}Symbol.for("drizzle:hasOwnEntityKind"),a.s(["entityKind",()=>b,"is",()=>c])},51179,58906,a=>{"use strict";var b=a.i(10933);class c{constructor(a,b){this.table=a,this.config=b,this.name=b.name,this.keyAsName=b.keyAsName,this.notNull=b.notNull,this.default=b.default,this.defaultFn=b.defaultFn,this.onUpdateFn=b.onUpdateFn,this.hasDefault=b.hasDefault,this.primary=b.primaryKey,this.isUnique=b.isUnique,this.uniqueName=b.uniqueName,this.uniqueType=b.uniqueType,this.dataType=b.dataType,this.columnType=b.columnType,this.generated=b.generated,this.generatedIdentity=b.generatedIdentity}static [b.entityKind]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(a){return a}mapToDriverValue(a){return a}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}a.s(["Column",()=>c],51179);let d=Symbol.for("drizzle:Name");a.s(["TableName",()=>d],58906)},38632,a=>{"use strict";var b=a.i(10933),c=a.i(58906);let d=Symbol.for("drizzle:Schema"),e=Symbol.for("drizzle:Columns"),f=Symbol.for("drizzle:ExtraConfigColumns"),g=Symbol.for("drizzle:OriginalName"),h=Symbol.for("drizzle:BaseName"),i=Symbol.for("drizzle:IsAlias"),j=Symbol.for("drizzle:ExtraConfigBuilder"),k=Symbol.for("drizzle:IsDrizzleTable");class l{static [b.entityKind]="Table";static Symbol={Name:c.TableName,Schema:d,OriginalName:g,Columns:e,ExtraConfigColumns:f,BaseName:h,IsAlias:i,ExtraConfigBuilder:j};[c.TableName];[g];[d];[e];[f];[h];[i]=!1;[k]=!0;[j]=void 0;constructor(a,b,e){this[c.TableName]=this[g]=a,this[d]=b,this[h]=e}}function m(a){return a[c.TableName]}function n(a){return`${a[d]??"public"}.${a[c.TableName]}`}a.s(["Columns",()=>e,"IsAlias",()=>i,"Schema",()=>d,"Table",()=>l,"getTableName",()=>m,"getTableUniqueName",()=>n])},15955,a=>{"use strict";var b=a.i(10933);class c{static [b.entityKind]="ColumnBuilder";config;constructor(a,b,c){this.config={name:a,keyAsName:""===a,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:b,columnType:c,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(a){return this.config.default=a,this.config.hasDefault=!0,this}$defaultFn(a){return this.config.defaultFn=a,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(a){return this.config.onUpdateFn=a,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(a){""===this.config.name&&(this.config.name=a)}}a.s(["ColumnBuilder",()=>c])},58178,89735,a=>{"use strict";let b,c;function d(a,...b){return a(...b)}a.s(["iife",()=>d],58178);let e={startActiveSpan:(a,e)=>b?(c||(c=b.trace.getTracer("drizzle-orm","0.45.1")),d((b,c)=>c.startActiveSpan(a,a=>{try{return e(a)}catch(c){throw a.setStatus({code:b.SpanStatusCode.ERROR,message:c instanceof Error?c.message:"Unknown error"}),c}finally{a.end()}}),b,c)):e()};a.s(["tracer",()=>e],89735)},12223,37002,69914,49840,38103,72980,a=>{"use strict";var b=a.i(10933),c=a.i(15955),d=a.i(51179),e=a.i(58906);class f{static [b.entityKind]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=void 0===a?"no action":a,this}onDelete(a){return this._onDelete=void 0===a?"no action":a,this}build(a){return new g(a,this)}}class g{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [b.entityKind]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),f=c.map(a=>a.name),g=[this.table[e.TableName],...d,c[0].table[e.TableName],...f];return a??`${g.join("_")}_fk`}}a.s(["ForeignKeyBuilder",()=>f],37002);var h=a.i(58178);function i(a){return new l(a)}function j(a,b){return`${a[e.TableName]}_${b.join("_")}_unique`}class k{constructor(a,b){this.name=b,this.columns=a}static [b.entityKind]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(a){return new m(a,this.columns,this.nullsNotDistinctConfig,this.name)}}class l{static [b.entityKind]="PgUniqueOnConstraintBuilder";name;constructor(a){this.name=a}on(...a){return new k(a,this.name)}}class m{constructor(a,b,c,d){this.table=a,this.columns=b,this.name=d??j(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=c}static [b.entityKind]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}}function n(a,b,c){for(let d=b;d<a.length;d++){let e=a[d];if("\\"===e){d++;continue}if('"'===e)return[a.slice(b,d).replace(/\\/g,""),d+1];if(!c&&(","===e||"}"===e))return[a.slice(b,d).replace(/\\/g,""),d]}return[a.slice(b).replace(/\\/g,""),a.length]}a.s(["UniqueConstraintBuilder",()=>k,"unique",()=>i,"uniqueKeyName",()=>j],69914);class o extends c.ColumnBuilder{foreignKeyConfigs=[];static [b.entityKind]="PgColumnBuilder";array(a){return new s(this.config.name,this,a)}references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a,b){return this.config.isUnique=!0,this.config.uniqueName=a,this.config.uniqueType=b?.nulls,this}generatedAlwaysAs(a){return this.config.generated={as:a,type:"always",mode:"stored"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>(0,h.iife)((c,d)=>{let e=new f(()=>({columns:[a],foreignColumns:[c()]}));return d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)},c,d))}buildExtraConfigColumn(a){return new q(a,this.config)}}class p extends d.Column{constructor(a,b){b.uniqueName||(b.uniqueName=j(a,[b.name])),super(a,b),this.table=a}static [b.entityKind]="PgColumn"}class q extends p{static [b.entityKind]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(a){return this.indexConfig.opClass=a,this}}class r{static [b.entityKind]="IndexedColumn";constructor(a,b,c,d){this.name=a,this.keyAsName=b,this.type=c,this.indexConfig=d}name;keyAsName;type;indexConfig}class s extends o{static [b.entityKind]="PgArrayBuilder";constructor(a,b,c){super(a,"array","PgArray"),this.config.baseBuilder=b,this.config.size=c}build(a){let b=this.config.baseBuilder.build(a);return new t(a,this.config,b)}}class t extends p{constructor(a,b,c,d){super(a,b),this.baseColumn=c,this.range=d,this.size=b.size}size;static [b.entityKind]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(a){return"string"==typeof a&&(a=function(a){let[b]=function a(b,c=0){let d=[],e=c,f=!1;for(;e<b.length;){let g=b[e];if(","===g){(f||e===c)&&d.push(""),f=!0,e++;continue}if(f=!1,"\\"===g){e+=2;continue}if('"'===g){let[a,c]=n(b,e+1,!0);d.push(a),e=c;continue}if("}"===g)return[d,e+1];if("{"===g){let[c,f]=a(b,e+1);d.push(c),e=f;continue}let[h,i]=n(b,e,!1);d.push(h),e=i}return[d,e]}(a,1);return b}(a)),a.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(a,c=!1){let d=a.map(a=>null===a?null:(0,b.is)(this.baseColumn,t)?this.baseColumn.mapToDriverValue(a,!0):this.baseColumn.mapToDriverValue(a));return c?d:function a(b){return`{${b.map(b=>Array.isArray(b)?a(b):"string"==typeof b?`"${b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${b}`).join(",")}}`}(d)}}a.s(["IndexedColumn",()=>r,"PgColumn",()=>p,"PgColumnBuilder",()=>o],49840);class u extends o{static [b.entityKind]="PgEnumObjectColumnBuilder";constructor(a,b){super(a,"string","PgEnumObjectColumn"),this.config.enum=b}build(a){return new v(a,this.config)}}class v extends p{static [b.entityKind]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}let w=Symbol.for("drizzle:isPgEnum");function x(a){return!!a&&"function"==typeof a&&w in a&&!0===a[w]}class y extends o{static [b.entityKind]="PgEnumColumnBuilder";constructor(a,b){super(a,"string","PgEnumColumn"),this.config.enum=b}build(a){return new z(a,this.config)}}class z extends p{static [b.entityKind]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}function A(a,b){var c;let d,e;return Array.isArray(b)?d=Object.assign(a=>new y(a??"",d),{enumName:a,enumValues:[...b],schema:void 0,[w]:!0}):(c=void 0,e=Object.assign(a=>new u(a??"",e),{enumName:a,enumValues:Object.values(b),schema:c,[w]:!0}))}a.s(["isPgEnum",()=>x,"pgEnum",()=>A],12223);class B{static [b.entityKind]="Subquery";constructor(a,b,c,d=!1,e=[]){this._={brand:"Subquery",sql:a,selectedFields:b,alias:c,isWith:d,usedTables:e}}}class C extends B{static [b.entityKind]="WithSubquery"}a.s(["Subquery",()=>B,"WithSubquery",()=>C],38103);let D=Symbol.for("drizzle:ViewBaseConfig");a.s(["ViewBaseConfig",()=>D],72980)},62181,a=>{"use strict";var b,c=a.i(10933),d=a.i(12223),e=a.i(38103),f=a.i(89735),g=a.i(72980),h=a.i(51179),i=a.i(38632);class j{static [c.entityKind]="FakePrimitiveParam"}function k(a){return null!=a&&"function"==typeof a.getSQL}class l{static [c.entityKind]="StringChunk";value;constructor(a){this.value=Array.isArray(a)?a:[a]}getSQL(){return new m([this])}}class m{constructor(a){for(const b of(this.queryChunks=a,a))if((0,c.is)(b,i.Table)){const a=b[i.Table.Symbol.Schema];this.usedTables.push(void 0===a?b[i.Table.Symbol.Name]:a+"."+b[i.Table.Symbol.Name])}}static [c.entityKind]="SQL";decoder=p;shouldInlineParams=!1;usedTables=[];append(a){return this.queryChunks.push(...a.queryChunks),this}toQuery(a){return f.tracer.startActiveSpan("drizzle.buildSQL",b=>{let c=this.buildQueryFromSourceParams(this.queryChunks,a);return b?.setAttributes({"drizzle.query.text":c.sql,"drizzle.query.params":JSON.stringify(c.params)}),c})}buildQueryFromSourceParams(a,b){let f=Object.assign({},b,{inlineParams:b.inlineParams||this.shouldInlineParams,paramStartIndex:b.paramStartIndex||{value:0}}),{casing:j,escapeName:o,escapeParam:p,prepareTyping:q,inlineParams:s,paramStartIndex:t}=f;var u=a.map(a=>{if((0,c.is)(a,l))return{sql:a.value.join(""),params:[]};if((0,c.is)(a,n))return{sql:o(a.value),params:[]};if(void 0===a)return{sql:"",params:[]};if(Array.isArray(a)){let b=[new l("(")];for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(new l(", "));return b.push(new l(")")),this.buildQueryFromSourceParams(b,f)}if((0,c.is)(a,m))return this.buildQueryFromSourceParams(a.queryChunks,{...f,inlineParams:s||a.shouldInlineParams});if((0,c.is)(a,i.Table)){let b=a[i.Table.Symbol.Schema],c=a[i.Table.Symbol.Name];return{sql:void 0===b||a[i.IsAlias]?o(c):o(b)+"."+o(c),params:[]}}if((0,c.is)(a,h.Column)){let c=j.getColumnCasing(a);if("indexes"===b.invokeSource)return{sql:o(c),params:[]};let d=a.table[i.Table.Symbol.Schema];return{sql:a.table[i.IsAlias]||void 0===d?o(a.table[i.Table.Symbol.Name])+"."+o(c):o(d)+"."+o(a.table[i.Table.Symbol.Name])+"."+o(c),params:[]}}if((0,c.is)(a,y)){let b=a[g.ViewBaseConfig].schema,c=a[g.ViewBaseConfig].name;return{sql:void 0===b||a[g.ViewBaseConfig].isAlias?o(c):o(b)+"."+o(c),params:[]}}if((0,c.is)(a,r)){if((0,c.is)(a.value,v))return{sql:p(t.value++,a),params:[a],typings:["none"]};let b=null===a.value?null:a.encoder.mapToDriverValue(a.value);if((0,c.is)(b,m))return this.buildQueryFromSourceParams([b],f);if(s)return{sql:this.mapInlineParam(b,f),params:[]};let d=["none"];return q&&(d=[q(a.encoder)]),{sql:p(t.value++,b),params:[b],typings:d}}return(0,c.is)(a,v)?{sql:p(t.value++,a),params:[a],typings:["none"]}:(0,c.is)(a,m.Aliased)&&void 0!==a.fieldAlias?{sql:o(a.fieldAlias),params:[]}:(0,c.is)(a,e.Subquery)?a._.isWith?{sql:o(a._.alias),params:[]}:this.buildQueryFromSourceParams([new l("("),a._.sql,new l(") "),new n(a._.alias)],f):(0,d.isPgEnum)(a)?a.schema?{sql:o(a.schema)+"."+o(a.enumName),params:[]}:{sql:o(a.enumName),params:[]}:k(a)?a.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([a.getSQL()],f):this.buildQueryFromSourceParams([new l("("),a.getSQL(),new l(")")],f):s?{sql:this.mapInlineParam(a,f),params:[]}:{sql:p(t.value++,a),params:[a],typings:["none"]}});let w={sql:"",params:[]};for(let a of u)w.sql+=a.sql,w.params.push(...a.params),a.typings?.length&&(w.typings||(w.typings=[]),w.typings.push(...a.typings));return w}mapInlineParam(a,{escapeString:b}){if(null===a)return"null";if("number"==typeof a||"boolean"==typeof a)return a.toString();if("string"==typeof a)return b(a);if("object"==typeof a){let c=a.toString();return"[object Object]"===c?b(JSON.stringify(a)):b(c)}throw Error("Unexpected param value: "+a)}getSQL(){return this}as(a){return void 0===a?this:new m.Aliased(this,a)}mapWith(a){return this.decoder="function"==typeof a?{mapFromDriverValue:a}:a,this}inlineParams(){return this.shouldInlineParams=!0,this}if(a){return a?this:void 0}}class n{constructor(a){this.value=a}static [c.entityKind]="Name";brand;getSQL(){return new m([this])}}function o(a){return"object"==typeof a&&null!==a&&"mapToDriverValue"in a&&"function"==typeof a.mapToDriverValue}let p={mapFromDriverValue:a=>a},q={mapToDriverValue:a=>a};({...p,...q});class r{constructor(a,b=q){this.value=a,this.encoder=b}static [c.entityKind]="Param";brand;getSQL(){return new m([this])}}function s(a,...b){let c=[];for(let[d,e]of((b.length>0||a.length>0&&""!==a[0])&&c.push(new l(a[0])),b.entries()))c.push(e,new l(a[d+1]));return new m(c)}(b=s||(s={})).empty=function(){return new m([])},b.fromList=function(a){return new m(a)},b.raw=function(a){return new m([new l(a)])},b.join=function(a,b){let c=[];for(let[d,e]of a.entries())d>0&&void 0!==b&&c.push(b),c.push(e);return new m(c)},b.identifier=function(a){return new n(a)},b.placeholder=function(a){return new v(a)},b.param=function(a,b){return new r(a,b)};var t=m||(m={});class u{constructor(a,b){this.sql=a,this.fieldAlias=b}static [c.entityKind]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new u(this.sql,this.fieldAlias)}}t.Aliased=u;class v{constructor(a){this.name=a}static [c.entityKind]="Placeholder";getSQL(){return new m([this])}}function w(a,b){return a.map(a=>{if((0,c.is)(a,v)){if(!(a.name in b))throw Error(`No value for placeholder "${a.name}" was provided`);return b[a.name]}if((0,c.is)(a,r)&&(0,c.is)(a.value,v)){if(!(a.value.name in b))throw Error(`No value for placeholder "${a.value.name}" was provided`);return a.encoder.mapToDriverValue(b[a.value.name])}return a})}let x=Symbol.for("drizzle:IsDrizzleView");class y{static [c.entityKind]="View";[g.ViewBaseConfig];[x]=!0;constructor({name:a,schema:b,selectedFields:c,query:d}){this[g.ViewBaseConfig]={name:a,originalName:a,schema:b,selectedFields:c,query:d,isExisting:!d,isAlias:!1}}getSQL(){return new m([this])}}h.Column.prototype.getSQL=function(){return new m([this])},i.Table.prototype.getSQL=function(){return new m([this])},e.Subquery.prototype.getSQL=function(){return new m([this])},a.s(["Param",()=>r,"Placeholder",()=>v,"SQL",()=>m,"StringChunk",()=>l,"View",()=>y,"fillPlaceholders",()=>w,"isDriverValueEncoder",()=>o,"isSQLWrapper",()=>k,"sql",()=>s])},50472,a=>{"use strict";var b=a.i(51179),c=a.i(10933),d=a.i(38632),e=a.i(62181);function f(a,f){return!(0,e.isDriverValueEncoder)(f)||(0,e.isSQLWrapper)(a)||(0,c.is)(a,e.Param)||(0,c.is)(a,e.Placeholder)||(0,c.is)(a,b.Column)||(0,c.is)(a,d.Table)||(0,c.is)(a,e.View)?a:new e.Param(a,f)}let g=(a,b)=>e.sql`${a} = ${f(b,a)}`,h=(a,b)=>e.sql`${a} <> ${f(b,a)}`;function i(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new e.SQL(1===b.length?b:[new e.StringChunk("("),e.sql.join(b,new e.StringChunk(" and ")),new e.StringChunk(")")])}function j(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new e.SQL(1===b.length?b:[new e.StringChunk("("),e.sql.join(b,new e.StringChunk(" or ")),new e.StringChunk(")")])}function k(a){return e.sql`not ${a}`}let l=(a,b)=>e.sql`${a} > ${f(b,a)}`,m=(a,b)=>e.sql`${a} >= ${f(b,a)}`,n=(a,b)=>e.sql`${a} < ${f(b,a)}`,o=(a,b)=>e.sql`${a} <= ${f(b,a)}`;function p(a,b){return Array.isArray(b)?0===b.length?e.sql`false`:e.sql`${a} in ${b.map(b=>f(b,a))}`:e.sql`${a} in ${f(b,a)}`}function q(a,b){return Array.isArray(b)?0===b.length?e.sql`true`:e.sql`${a} not in ${b.map(b=>f(b,a))}`:e.sql`${a} not in ${f(b,a)}`}function r(a){return e.sql`${a} is null`}function s(a){return e.sql`${a} is not null`}function t(a){return e.sql`exists ${a}`}function u(a){return e.sql`not exists ${a}`}function v(a,b,c){return e.sql`${a} between ${f(b,a)} and ${f(c,a)}`}function w(a,b,c){return e.sql`${a} not between ${f(b,a)} and ${f(c,a)}`}function x(a,b){return e.sql`${a} like ${b}`}function y(a,b){return e.sql`${a} not like ${b}`}function z(a,b){return e.sql`${a} ilike ${b}`}function A(a,b){return e.sql`${a} not ilike ${b}`}a.s(["and",()=>i,"between",()=>v,"eq",()=>g,"exists",()=>t,"gt",()=>l,"gte",()=>m,"ilike",()=>z,"inArray",()=>p,"isNotNull",()=>s,"isNull",()=>r,"like",()=>x,"lt",()=>n,"lte",()=>o,"ne",()=>h,"not",()=>k,"notBetween",()=>w,"notExists",()=>u,"notIlike",()=>A,"notInArray",()=>q,"notLike",()=>y,"or",()=>j])},97006,a=>{"use strict";var b=a.i(62181);function c(a){return b.sql`${a} asc`}function d(a){return b.sql`${a} desc`}a.s(["asc",()=>c,"desc",()=>d])},1467,61279,a=>{"use strict";a.i(4463);var b,c=a.i(39001);a.i(17519);var d=a.i(71001),e=a.i(21828),f=a.i(13616);let g={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};function h(a){f.config({customError:a})}function i(){return f.config().customError}b||(b={}),a.s(["ZodFirstPartyTypeKind",()=>b,"ZodIssueCode",0,g,"getErrorMap",()=>i,"setErrorMap",()=>h],96877);var j=a.i(62871),k=a.i(1639),l=a.i(73425),m=a.i(92175);a.s(["endsWith",()=>m._endsWith,"gt",()=>m._gt,"gte",()=>m._gte,"includes",()=>m._includes,"length",()=>m._length,"lowercase",()=>m._lowercase,"lt",()=>m._lt,"lte",()=>m._lte,"maxLength",()=>m._maxLength,"maxSize",()=>m._maxSize,"mime",()=>m._mime,"minLength",()=>m._minLength,"minSize",()=>m._minSize,"multipleOf",()=>m._multipleOf,"negative",()=>m._negative,"nonnegative",()=>m._nonnegative,"nonpositive",()=>m._nonpositive,"normalize",()=>m._normalize,"overwrite",()=>m._overwrite,"positive",()=>m._positive,"property",()=>m._property,"regex",()=>m._regex,"size",()=>m._size,"slugify",()=>m._slugify,"startsWith",()=>m._startsWith,"toLowerCase",()=>m._toLowerCase,"toUpperCase",()=>m._toUpperCase,"trim",()=>m._trim,"uppercase",()=>m._uppercase],55516);var n=a.i(55516),o=a.i(31306);let p={...c,...n,iso:o},q=new Set(["$schema","$ref","$defs","definitions","$id","id","$comment","$anchor","$vocabulary","$dynamicRef","$dynamicAnchor","type","enum","const","anyOf","oneOf","allOf","not","properties","required","additionalProperties","patternProperties","propertyNames","minProperties","maxProperties","items","prefixItems","additionalItems","minItems","maxItems","uniqueItems","contains","minContains","maxContains","minLength","maxLength","pattern","format","minimum","maximum","exclusiveMinimum","exclusiveMaximum","multipleOf","description","default","contentEncoding","contentMediaType","contentSchema","unevaluatedItems","unevaluatedProperties","if","then","else","dependentSchemas","dependentRequired","nullable","readOnly"]);function r(a,b){var c;let d;if("boolean"==typeof a)return a?p.any():p.never();let e={version:(c=b?.defaultTarget,"https://json-schema.org/draft/2020-12/schema"===(d=a.$schema)?"draft-2020-12":"http://json-schema.org/draft-07/schema#"===d?"draft-7":"http://json-schema.org/draft-04/schema#"===d?"draft-4":c??"draft-2020-12"),defs:a.$defs||a.definitions||{},refs:new Map,processing:new Set,rootSchema:a,registry:b?.registry??l.globalRegistry};return function a(b,c){if("boolean"==typeof b)return b?p.any():p.never();let d=function b(c,d){let e;if(void 0!==c.not){if("object"==typeof c.not&&0===Object.keys(c.not).length)return p.never();throw Error("not is not supported in Zod (except { not: {} } for never)")}if(void 0!==c.unevaluatedItems)throw Error("unevaluatedItems is not supported");if(void 0!==c.unevaluatedProperties)throw Error("unevaluatedProperties is not supported");if(void 0!==c.if||void 0!==c.then||void 0!==c.else)throw Error("Conditional schemas (if/then/else) are not supported");if(void 0!==c.dependentSchemas||void 0!==c.dependentRequired)throw Error("dependentSchemas and dependentRequired are not supported");if(c.$ref){let b=c.$ref;if(d.refs.has(b))return d.refs.get(b);if(d.processing.has(b))return p.lazy(()=>{if(!d.refs.has(b))throw Error(`Circular reference not resolved: ${b}`);return d.refs.get(b)});d.processing.add(b);let e=a(function(a,b){if(!a.startsWith("#"))throw Error("External $ref is not supported, only local refs (#/...) are allowed");let c=a.slice(1).split("/").filter(Boolean);if(0===c.length)return b.rootSchema;let d="draft-2020-12"===b.version?"$defs":"definitions";if(c[0]===d){let d=c[1];if(!d||!b.defs[d])throw Error(`Reference not found: ${a}`);return b.defs[d]}throw Error(`Reference not found: ${a}`)}(b,d),d);return d.refs.set(b,e),d.processing.delete(b),e}if(void 0!==c.enum){let a=c.enum;if("openapi-3.0"===d.version&&!0===c.nullable&&1===a.length&&null===a[0])return p.null();if(0===a.length)return p.never();if(1===a.length)return p.literal(a[0]);if(a.every(a=>"string"==typeof a))return p.enum(a);let b=a.map(a=>p.literal(a));return b.length<2?b[0]:p.union([b[0],b[1],...b.slice(2)])}if(void 0!==c.const)return p.literal(c.const);let f=c.type;if(Array.isArray(f)){let a=f.map(a=>b({...c,type:a},d));return 0===a.length?p.never():1===a.length?a[0]:p.union(a)}if(!f)return p.any();switch(f){case"string":{let a=p.string();if(c.format){let b=c.format;"email"===b?a=a.check(p.email()):"uri"===b||"uri-reference"===b?a=a.check(p.url()):"uuid"===b||"guid"===b?a=a.check(p.uuid()):"date-time"===b?a=a.check(p.iso.datetime()):"date"===b?a=a.check(p.iso.date()):"time"===b?a=a.check(p.iso.time()):"duration"===b?a=a.check(p.iso.duration()):"ipv4"===b?a=a.check(p.ipv4()):"ipv6"===b?a=a.check(p.ipv6()):"mac"===b?a=a.check(p.mac()):"cidr"===b?a=a.check(p.cidrv4()):"cidr-v6"===b?a=a.check(p.cidrv6()):"base64"===b?a=a.check(p.base64()):"base64url"===b?a=a.check(p.base64url()):"e164"===b?a=a.check(p.e164()):"jwt"===b?a=a.check(p.jwt()):"emoji"===b?a=a.check(p.emoji()):"nanoid"===b?a=a.check(p.nanoid()):"cuid"===b?a=a.check(p.cuid()):"cuid2"===b?a=a.check(p.cuid2()):"ulid"===b?a=a.check(p.ulid()):"xid"===b?a=a.check(p.xid()):"ksuid"===b&&(a=a.check(p.ksuid()))}"number"==typeof c.minLength&&(a=a.min(c.minLength)),"number"==typeof c.maxLength&&(a=a.max(c.maxLength)),c.pattern&&(a=a.regex(new RegExp(c.pattern))),e=a;break}case"number":case"integer":{let a="integer"===f?p.number().int():p.number();"number"==typeof c.minimum&&(a=a.min(c.minimum)),"number"==typeof c.maximum&&(a=a.max(c.maximum)),"number"==typeof c.exclusiveMinimum?a=a.gt(c.exclusiveMinimum):!0===c.exclusiveMinimum&&"number"==typeof c.minimum&&(a=a.gt(c.minimum)),"number"==typeof c.exclusiveMaximum?a=a.lt(c.exclusiveMaximum):!0===c.exclusiveMaximum&&"number"==typeof c.maximum&&(a=a.lt(c.maximum)),"number"==typeof c.multipleOf&&(a=a.multipleOf(c.multipleOf)),e=a;break}case"boolean":e=p.boolean();break;case"null":e=p.null();break;case"object":{let b={},f=c.properties||{},g=new Set(c.required||[]);for(let[c,e]of Object.entries(f)){let f=a(e,d);b[c]=g.has(c)?f:f.optional()}if(c.propertyNames){let f=a(c.propertyNames,d),g=c.additionalProperties&&"object"==typeof c.additionalProperties?a(c.additionalProperties,d):p.any();if(0===Object.keys(b).length){e=p.record(f,g);break}let h=p.object(b).passthrough(),i=p.looseRecord(f,g);e=p.intersection(h,i);break}if(c.patternProperties){let f=c.patternProperties,g=Object.keys(f),h=[];for(let b of g){let c=a(f[b],d),e=p.string().regex(new RegExp(b));h.push(p.looseRecord(e,c))}let i=[];if(Object.keys(b).length>0&&i.push(p.object(b).passthrough()),i.push(...h),0===i.length)e=p.object({}).passthrough();else if(1===i.length)e=i[0];else{let a=p.intersection(i[0],i[1]);for(let b=2;b<i.length;b++)a=p.intersection(a,i[b]);e=a}break}let h=p.object(b);e=!1===c.additionalProperties?h.strict():"object"==typeof c.additionalProperties?h.catchall(a(c.additionalProperties,d)):h.passthrough();break}case"array":{let b=c.prefixItems,f=c.items;if(b&&Array.isArray(b)){let g=b.map(b=>a(b,d)),h=f&&"object"==typeof f&&!Array.isArray(f)?a(f,d):void 0;e=h?p.tuple(g).rest(h):p.tuple(g),"number"==typeof c.minItems&&(e=e.check(p.minLength(c.minItems))),"number"==typeof c.maxItems&&(e=e.check(p.maxLength(c.maxItems)))}else if(Array.isArray(f)){let b=f.map(b=>a(b,d)),g=c.additionalItems&&"object"==typeof c.additionalItems?a(c.additionalItems,d):void 0;e=g?p.tuple(b).rest(g):p.tuple(b),"number"==typeof c.minItems&&(e=e.check(p.minLength(c.minItems))),"number"==typeof c.maxItems&&(e=e.check(p.maxLength(c.maxItems)))}else if(void 0!==f){let b=a(f,d),g=p.array(b);"number"==typeof c.minItems&&(g=g.min(c.minItems)),"number"==typeof c.maxItems&&(g=g.max(c.maxItems)),e=g}else e=p.array(p.any());break}default:throw Error(`Unsupported type: ${f}`)}return c.description&&(e=e.describe(c.description)),void 0!==c.default&&(e=e.default(c.default)),e}(b,c),e=b.type||void 0!==b.enum||void 0!==b.const;if(b.anyOf&&Array.isArray(b.anyOf)){let f=b.anyOf.map(b=>a(b,c)),g=p.union(f);d=e?p.intersection(d,g):g}if(b.oneOf&&Array.isArray(b.oneOf)){let f=b.oneOf.map(b=>a(b,c)),g=p.xor(f);d=e?p.intersection(d,g):g}if(b.allOf&&Array.isArray(b.allOf))if(0===b.allOf.length)d=e?d:p.any();else{let f=e?d:a(b.allOf[0],c),g=+!e;for(let d=g;d<b.allOf.length;d++)f=p.intersection(f,a(b.allOf[d],c));d=f}!0===b.nullable&&"openapi-3.0"===c.version&&(d=p.nullable(d)),!0===b.readOnly&&(d=p.readonly(d));let f={};for(let a of["$id","id","$comment","$anchor","$vocabulary","$dynamicRef","$dynamicAnchor"])a in b&&(f[a]=b[a]);for(let a of["contentEncoding","contentMediaType","contentSchema"])a in b&&(f[a]=b[a]);for(let a of Object.keys(b))q.has(a)||(f[a]=b[a]);return Object.keys(f).length>0&&c.registry.add(d,f),d}(a,e)}function s(a){return m._coercedString(c.ZodString,a)}function t(a){return m._coercedNumber(c.ZodNumber,a)}function u(a){return m._coercedBoolean(c.ZodBoolean,a)}function v(a){return m._coercedBigint(c.ZodBigInt,a)}function w(a){return m._coercedDate(c.ZodDate,a)}a.i(82876),a.s(["bigint",()=>v,"boolean",()=>u,"date",()=>w,"number",()=>t,"string",()=>s],95514),(0,f.config)((0,j.default)()),a.s([],61279),a.i(61279);var x=a.i(45156),y=a.i(79881),z=a.i(50381),A=a.i(59368),B=a.i(92916),C=a.i(29667),D=a.i(17368),E=a.i(85229),F=a.i(26915),G=a.i(57692),H=a.i(17786),I=a.i(89659),J=a.i(3515),K=a.i(97167),L=a.i(9283),M=a.i(71176),N=a.i(55224),O=a.i(51157),P=a.i(72618),Q=a.i(16535),R=a.i(47739),S=a.i(76444),T=a.i(36025),U=a.i(69836),V=a.i(23707),W=a.i(20803),X=a.i(36444),Y=a.i(48308),Z=a.i(31288),$=a.i(94429),_=a.i(34773),aa=a.i(20372),ab=a.i(31291),ac=a.i(49212),ad=a.i(10080),ae=a.i(92552),af=a.i(34680),ag=a.i(11619),ah=a.i(68849),ai=a.i(24514),aj=a.i(30980),ak=a.i(62016),al=a.i(4903),am=a.i(48723),an=a.i(38889),ao=a.i(62077),ap=a.i(15673),aq=a.i(92683),ar=a.i(33447),as=a.i(98046),at=a.i(44860),au=a.i(15901),av=a.i(15997),aw=a.i(61902),ax=a.i(57203);a.s(["ar",()=>E.default,"az",()=>F.default,"be",()=>G.default,"bg",()=>H.default,"ca",()=>I.default,"cs",()=>J.default,"da",()=>K.default,"de",()=>L.default,"en",()=>j.default,"eo",()=>M.default,"es",()=>N.default,"fa",()=>O.default,"fi",()=>P.default,"fr",()=>Q.default,"frCA",()=>R.default,"he",()=>S.default,"hu",()=>T.default,"hy",()=>U.default,"id",()=>V.default,"is",()=>W.default,"it",()=>X.default,"ja",()=>Y.default,"ka",()=>Z.default,"kh",()=>$.default,"km",()=>_.default,"ko",()=>aa.default,"lt",()=>ab.default,"mk",()=>ac.default,"ms",()=>ad.default,"nl",()=>ae.default,"no",()=>af.default,"ota",()=>ag.default,"pl",()=>ai.default,"ps",()=>ah.default,"pt",()=>aj.default,"ru",()=>ak.default,"sl",()=>al.default,"sv",()=>am.default,"ta",()=>an.default,"th",()=>ao.default,"tr",()=>ap.default,"ua",()=>aq.default,"uk",()=>ar.default,"ur",()=>as.default,"uz",()=>at.default,"vi",()=>au.default,"yo",()=>ax.default,"zhCN",()=>av.default,"zhTW",()=>aw.default],34706);var ay=a.i(34706),az=a.i(69214),aA=a.i(12892),aB=a.i(83054),aC=a.i(43181);a.s(["$ZodAny",()=>z.$ZodAny,"$ZodArray",()=>z.$ZodArray,"$ZodAsyncError",()=>f.$ZodAsyncError,"$ZodBase64",()=>z.$ZodBase64,"$ZodBase64URL",()=>z.$ZodBase64URL,"$ZodBigInt",()=>z.$ZodBigInt,"$ZodBigIntFormat",()=>z.$ZodBigIntFormat,"$ZodBoolean",()=>z.$ZodBoolean,"$ZodCIDRv4",()=>z.$ZodCIDRv4,"$ZodCIDRv6",()=>z.$ZodCIDRv6,"$ZodCUID",()=>z.$ZodCUID,"$ZodCUID2",()=>z.$ZodCUID2,"$ZodCatch",()=>z.$ZodCatch,"$ZodCheck",()=>A.$ZodCheck,"$ZodCheckBigIntFormat",()=>A.$ZodCheckBigIntFormat,"$ZodCheckEndsWith",()=>A.$ZodCheckEndsWith,"$ZodCheckGreaterThan",()=>A.$ZodCheckGreaterThan,"$ZodCheckIncludes",()=>A.$ZodCheckIncludes,"$ZodCheckLengthEquals",()=>A.$ZodCheckLengthEquals,"$ZodCheckLessThan",()=>A.$ZodCheckLessThan,"$ZodCheckLowerCase",()=>A.$ZodCheckLowerCase,"$ZodCheckMaxLength",()=>A.$ZodCheckMaxLength,"$ZodCheckMaxSize",()=>A.$ZodCheckMaxSize,"$ZodCheckMimeType",()=>A.$ZodCheckMimeType,"$ZodCheckMinLength",()=>A.$ZodCheckMinLength,"$ZodCheckMinSize",()=>A.$ZodCheckMinSize,"$ZodCheckMultipleOf",()=>A.$ZodCheckMultipleOf,"$ZodCheckNumberFormat",()=>A.$ZodCheckNumberFormat,"$ZodCheckOverwrite",()=>A.$ZodCheckOverwrite,"$ZodCheckProperty",()=>A.$ZodCheckProperty,"$ZodCheckRegex",()=>A.$ZodCheckRegex,"$ZodCheckSizeEquals",()=>A.$ZodCheckSizeEquals,"$ZodCheckStartsWith",()=>A.$ZodCheckStartsWith,"$ZodCheckStringFormat",()=>A.$ZodCheckStringFormat,"$ZodCheckUpperCase",()=>A.$ZodCheckUpperCase,"$ZodCodec",()=>z.$ZodCodec,"$ZodCustom",()=>z.$ZodCustom,"$ZodCustomStringFormat",()=>z.$ZodCustomStringFormat,"$ZodDate",()=>z.$ZodDate,"$ZodDefault",()=>z.$ZodDefault,"$ZodDiscriminatedUnion",()=>z.$ZodDiscriminatedUnion,"$ZodE164",()=>z.$ZodE164,"$ZodEmail",()=>z.$ZodEmail,"$ZodEmoji",()=>z.$ZodEmoji,"$ZodEncodeError",()=>f.$ZodEncodeError,"$ZodEnum",()=>z.$ZodEnum,"$ZodError",()=>y.$ZodError,"$ZodExactOptional",()=>z.$ZodExactOptional,"$ZodFile",()=>z.$ZodFile,"$ZodFunction",()=>z.$ZodFunction,"$ZodGUID",()=>z.$ZodGUID,"$ZodIPv4",()=>z.$ZodIPv4,"$ZodIPv6",()=>z.$ZodIPv6,"$ZodISODate",()=>z.$ZodISODate,"$ZodISODateTime",()=>z.$ZodISODateTime,"$ZodISODuration",()=>z.$ZodISODuration,"$ZodISOTime",()=>z.$ZodISOTime,"$ZodIntersection",()=>z.$ZodIntersection,"$ZodJWT",()=>z.$ZodJWT,"$ZodKSUID",()=>z.$ZodKSUID,"$ZodLazy",()=>z.$ZodLazy,"$ZodLiteral",()=>z.$ZodLiteral,"$ZodMAC",()=>z.$ZodMAC,"$ZodMap",()=>z.$ZodMap,"$ZodNaN",()=>z.$ZodNaN,"$ZodNanoID",()=>z.$ZodNanoID,"$ZodNever",()=>z.$ZodNever,"$ZodNonOptional",()=>z.$ZodNonOptional,"$ZodNull",()=>z.$ZodNull,"$ZodNullable",()=>z.$ZodNullable,"$ZodNumber",()=>z.$ZodNumber,"$ZodNumberFormat",()=>z.$ZodNumberFormat,"$ZodObject",()=>z.$ZodObject,"$ZodObjectJIT",()=>z.$ZodObjectJIT,"$ZodOptional",()=>z.$ZodOptional,"$ZodPipe",()=>z.$ZodPipe,"$ZodPrefault",()=>z.$ZodPrefault,"$ZodPromise",()=>z.$ZodPromise,"$ZodReadonly",()=>z.$ZodReadonly,"$ZodRealError",()=>y.$ZodRealError,"$ZodRecord",()=>z.$ZodRecord,"$ZodRegistry",()=>l.$ZodRegistry,"$ZodSet",()=>z.$ZodSet,"$ZodString",()=>z.$ZodString,"$ZodStringFormat",()=>z.$ZodStringFormat,"$ZodSuccess",()=>z.$ZodSuccess,"$ZodSymbol",()=>z.$ZodSymbol,"$ZodTemplateLiteral",()=>z.$ZodTemplateLiteral,"$ZodTransform",()=>z.$ZodTransform,"$ZodTuple",()=>z.$ZodTuple,"$ZodType",()=>z.$ZodType,"$ZodULID",()=>z.$ZodULID,"$ZodURL",()=>z.$ZodURL,"$ZodUUID",()=>z.$ZodUUID,"$ZodUndefined",()=>z.$ZodUndefined,"$ZodUnion",()=>z.$ZodUnion,"$ZodUnknown",()=>z.$ZodUnknown,"$ZodVoid",()=>z.$ZodVoid,"$ZodXID",()=>z.$ZodXID,"$ZodXor",()=>z.$ZodXor,"$brand",()=>f.$brand,"$constructor",()=>f.$constructor,"$input",()=>l.$input,"$output",()=>l.$output,"Doc",()=>az.Doc,"JSONSchema",0,aC,"JSONSchemaGenerator",()=>aB.JSONSchemaGenerator,"NEVER",()=>f.NEVER,"TimePrecision",()=>m.TimePrecision,"_any",()=>m._any,"_array",()=>m._array,"_base64",()=>m._base64,"_base64url",()=>m._base64url,"_bigint",()=>m._bigint,"_boolean",()=>m._boolean,"_catch",()=>m._catch,"_check",()=>m._check,"_cidrv4",()=>m._cidrv4,"_cidrv6",()=>m._cidrv6,"_coercedBigint",()=>m._coercedBigint,"_coercedBoolean",()=>m._coercedBoolean,"_coercedDate",()=>m._coercedDate,"_coercedNumber",()=>m._coercedNumber,"_coercedString",()=>m._coercedString,"_cuid",()=>m._cuid,"_cuid2",()=>m._cuid2,"_custom",()=>m._custom,"_date",()=>m._date,"_decode",()=>x._decode,"_decodeAsync",()=>x._decodeAsync,"_default",()=>m._default,"_discriminatedUnion",()=>m._discriminatedUnion,"_e164",()=>m._e164,"_email",()=>m._email,"_emoji",()=>m._emoji,"_encode",()=>x._encode,"_encodeAsync",()=>x._encodeAsync,"_endsWith",()=>m._endsWith,"_enum",()=>m._enum,"_file",()=>m._file,"_float32",()=>m._float32,"_float64",()=>m._float64,"_gt",()=>m._gt,"_gte",()=>m._gte,"_guid",()=>m._guid,"_includes",()=>m._includes,"_int",()=>m._int,"_int32",()=>m._int32,"_int64",()=>m._int64,"_intersection",()=>m._intersection,"_ipv4",()=>m._ipv4,"_ipv6",()=>m._ipv6,"_isoDate",()=>m._isoDate,"_isoDateTime",()=>m._isoDateTime,"_isoDuration",()=>m._isoDuration,"_isoTime",()=>m._isoTime,"_jwt",()=>m._jwt,"_ksuid",()=>m._ksuid,"_lazy",()=>m._lazy,"_length",()=>m._length,"_literal",()=>m._literal,"_lowercase",()=>m._lowercase,"_lt",()=>m._lt,"_lte",()=>m._lte,"_mac",()=>m._mac,"_map",()=>m._map,"_max",()=>m._max,"_maxLength",()=>m._maxLength,"_maxSize",()=>m._maxSize,"_mime",()=>m._mime,"_min",()=>m._min,"_minLength",()=>m._minLength,"_minSize",()=>m._minSize,"_multipleOf",()=>m._multipleOf,"_nan",()=>m._nan,"_nanoid",()=>m._nanoid,"_nativeEnum",()=>m._nativeEnum,"_negative",()=>m._negative,"_never",()=>m._never,"_nonnegative",()=>m._nonnegative,"_nonoptional",()=>m._nonoptional,"_nonpositive",()=>m._nonpositive,"_normalize",()=>m._normalize,"_null",()=>m._null,"_nullable",()=>m._nullable,"_number",()=>m._number,"_optional",()=>m._optional,"_overwrite",()=>m._overwrite,"_parse",()=>x._parse,"_parseAsync",()=>x._parseAsync,"_pipe",()=>m._pipe,"_positive",()=>m._positive,"_promise",()=>m._promise,"_property",()=>m._property,"_readonly",()=>m._readonly,"_record",()=>m._record,"_refine",()=>m._refine,"_regex",()=>m._regex,"_safeDecode",()=>x._safeDecode,"_safeDecodeAsync",()=>x._safeDecodeAsync,"_safeEncode",()=>x._safeEncode,"_safeEncodeAsync",()=>x._safeEncodeAsync,"_safeParse",()=>x._safeParse,"_safeParseAsync",()=>x._safeParseAsync,"_set",()=>m._set,"_size",()=>m._size,"_slugify",()=>m._slugify,"_startsWith",()=>m._startsWith,"_string",()=>m._string,"_stringFormat",()=>m._stringFormat,"_stringbool",()=>m._stringbool,"_success",()=>m._success,"_superRefine",()=>m._superRefine,"_symbol",()=>m._symbol,"_templateLiteral",()=>m._templateLiteral,"_toLowerCase",()=>m._toLowerCase,"_toUpperCase",()=>m._toUpperCase,"_transform",()=>m._transform,"_trim",()=>m._trim,"_tuple",()=>m._tuple,"_uint32",()=>m._uint32,"_uint64",()=>m._uint64,"_ulid",()=>m._ulid,"_undefined",()=>m._undefined,"_union",()=>m._union,"_unknown",()=>m._unknown,"_uppercase",()=>m._uppercase,"_url",()=>m._url,"_uuid",()=>m._uuid,"_uuidv4",()=>m._uuidv4,"_uuidv6",()=>m._uuidv6,"_uuidv7",()=>m._uuidv7,"_void",()=>m._void,"_xid",()=>m._xid,"_xor",()=>m._xor,"clone",()=>z.clone,"config",()=>f.config,"createStandardJSONSchemaMethod",()=>aA.createStandardJSONSchemaMethod,"createToJSONSchemaMethod",()=>aA.createToJSONSchemaMethod,"decode",()=>x.decode,"decodeAsync",()=>x.decodeAsync,"describe",()=>m.describe,"encode",()=>x.encode,"encodeAsync",()=>x.encodeAsync,"extractDefs",()=>aA.extractDefs,"finalize",()=>aA.finalize,"flattenError",()=>y.flattenError,"formatError",()=>y.formatError,"globalConfig",()=>f.globalConfig,"globalRegistry",()=>l.globalRegistry,"initializeContext",()=>aA.initializeContext,"isValidBase64",()=>z.isValidBase64,"isValidBase64URL",()=>z.isValidBase64URL,"isValidJWT",()=>z.isValidJWT,"locales",0,ay,"meta",()=>m.meta,"parse",()=>x.parse,"parseAsync",()=>x.parseAsync,"prettifyError",()=>y.prettifyError,"process",()=>aA.process,"regexes",0,D,"registry",()=>l.registry,"safeDecode",()=>x.safeDecode,"safeDecodeAsync",()=>x.safeDecodeAsync,"safeEncode",()=>x.safeEncode,"safeEncodeAsync",()=>x.safeEncodeAsync,"safeParse",()=>x.safeParse,"safeParseAsync",()=>x.safeParseAsync,"toDotPath",()=>y.toDotPath,"toJSONSchema",()=>k.toJSONSchema,"treeifyError",()=>y.treeifyError,"util",0,C,"version",()=>B.version],29627);var aD=a.i(29627);a.i(96877),a.s(["$brand",()=>f.$brand,"ZodFirstPartyTypeKind",()=>b,"ZodIssueCode",0,g,"config",()=>f.config,"getErrorMap",()=>i,"setErrorMap",()=>h],92294),a.i(92294);var aE=a.i(18005),aF=a.i(92175),aG=a.i(16145),aH=a.i(95514);a.s(["$brand",()=>f.$brand,"$input",()=>l.$input,"$output",()=>l.$output,"NEVER",()=>f.NEVER,"TimePrecision",()=>aF.TimePrecision,"ZodAny",()=>c.ZodAny,"ZodArray",()=>c.ZodArray,"ZodBase64",()=>c.ZodBase64,"ZodBase64URL",()=>c.ZodBase64URL,"ZodBigInt",()=>c.ZodBigInt,"ZodBigIntFormat",()=>c.ZodBigIntFormat,"ZodBoolean",()=>c.ZodBoolean,"ZodCIDRv4",()=>c.ZodCIDRv4,"ZodCIDRv6",()=>c.ZodCIDRv6,"ZodCUID",()=>c.ZodCUID,"ZodCUID2",()=>c.ZodCUID2,"ZodCatch",()=>c.ZodCatch,"ZodCodec",()=>c.ZodCodec,"ZodCustom",()=>c.ZodCustom,"ZodCustomStringFormat",()=>c.ZodCustomStringFormat,"ZodDate",()=>c.ZodDate,"ZodDefault",()=>c.ZodDefault,"ZodDiscriminatedUnion",()=>c.ZodDiscriminatedUnion,"ZodE164",()=>c.ZodE164,"ZodEmail",()=>c.ZodEmail,"ZodEmoji",()=>c.ZodEmoji,"ZodEnum",()=>c.ZodEnum,"ZodError",()=>d.ZodError,"ZodExactOptional",()=>c.ZodExactOptional,"ZodFile",()=>c.ZodFile,"ZodFirstPartyTypeKind",()=>b,"ZodFunction",()=>c.ZodFunction,"ZodGUID",()=>c.ZodGUID,"ZodIPv4",()=>c.ZodIPv4,"ZodIPv6",()=>c.ZodIPv6,"ZodISODate",()=>o.ZodISODate,"ZodISODateTime",()=>o.ZodISODateTime,"ZodISODuration",()=>o.ZodISODuration,"ZodISOTime",()=>o.ZodISOTime,"ZodIntersection",()=>c.ZodIntersection,"ZodIssueCode",0,g,"ZodJWT",()=>c.ZodJWT,"ZodKSUID",()=>c.ZodKSUID,"ZodLazy",()=>c.ZodLazy,"ZodLiteral",()=>c.ZodLiteral,"ZodMAC",()=>c.ZodMAC,"ZodMap",()=>c.ZodMap,"ZodNaN",()=>c.ZodNaN,"ZodNanoID",()=>c.ZodNanoID,"ZodNever",()=>c.ZodNever,"ZodNonOptional",()=>c.ZodNonOptional,"ZodNull",()=>c.ZodNull,"ZodNullable",()=>c.ZodNullable,"ZodNumber",()=>c.ZodNumber,"ZodNumberFormat",()=>c.ZodNumberFormat,"ZodObject",()=>c.ZodObject,"ZodOptional",()=>c.ZodOptional,"ZodPipe",()=>c.ZodPipe,"ZodPrefault",()=>c.ZodPrefault,"ZodPromise",()=>c.ZodPromise,"ZodReadonly",()=>c.ZodReadonly,"ZodRealError",()=>d.ZodRealError,"ZodRecord",()=>c.ZodRecord,"ZodSet",()=>c.ZodSet,"ZodString",()=>c.ZodString,"ZodStringFormat",()=>c.ZodStringFormat,"ZodSuccess",()=>c.ZodSuccess,"ZodSymbol",()=>c.ZodSymbol,"ZodTemplateLiteral",()=>c.ZodTemplateLiteral,"ZodTransform",()=>c.ZodTransform,"ZodTuple",()=>c.ZodTuple,"ZodType",()=>c.ZodType,"ZodULID",()=>c.ZodULID,"ZodURL",()=>c.ZodURL,"ZodUUID",()=>c.ZodUUID,"ZodUndefined",()=>c.ZodUndefined,"ZodUnion",()=>c.ZodUnion,"ZodUnknown",()=>c.ZodUnknown,"ZodVoid",()=>c.ZodVoid,"ZodXID",()=>c.ZodXID,"ZodXor",()=>c.ZodXor,"_ZodString",()=>c._ZodString,"_default",()=>c._default,"_function",()=>c._function,"any",()=>c.any,"array",()=>c.array,"base64",()=>c.base64,"base64url",()=>c.base64url,"bigint",()=>c.bigint,"boolean",()=>c.boolean,"catch",()=>c.catch,"check",()=>c.check,"cidrv4",()=>c.cidrv4,"cidrv6",()=>c.cidrv6,"clone",()=>z.clone,"codec",()=>c.codec,"coerce",0,aH,"config",()=>f.config,"core",0,aD,"cuid",()=>c.cuid,"cuid2",()=>c.cuid2,"custom",()=>c.custom,"date",()=>c.date,"decode",()=>e.decode,"decodeAsync",()=>e.decodeAsync,"describe",()=>c.describe,"discriminatedUnion",()=>c.discriminatedUnion,"e164",()=>c.e164,"email",()=>c.email,"emoji",()=>c.emoji,"encode",()=>e.encode,"encodeAsync",()=>e.encodeAsync,"endsWith",()=>m._endsWith,"enum",()=>c.enum,"exactOptional",()=>c.exactOptional,"file",()=>c.file,"flattenError",()=>y.flattenError,"float32",()=>c.float32,"float64",()=>c.float64,"formatError",()=>y.formatError,"fromJSONSchema",()=>r,"function",()=>c.function,"getErrorMap",()=>i,"globalRegistry",()=>l.globalRegistry,"gt",()=>m._gt,"gte",()=>m._gte,"guid",()=>c.guid,"hash",()=>c.hash,"hex",()=>c.hex,"hostname",()=>c.hostname,"httpUrl",()=>c.httpUrl,"includes",()=>m._includes,"instanceof",()=>c.instanceof,"int",()=>c.int,"int32",()=>c.int32,"int64",()=>c.int64,"intersection",()=>c.intersection,"ipv4",()=>c.ipv4,"ipv6",()=>c.ipv6,"iso",0,o,"json",()=>c.json,"jwt",()=>c.jwt,"keyof",()=>c.keyof,"ksuid",()=>c.ksuid,"lazy",()=>c.lazy,"length",()=>m._length,"literal",()=>c.literal,"locales",0,ay,"looseObject",()=>c.looseObject,"looseRecord",()=>c.looseRecord,"lowercase",()=>m._lowercase,"lt",()=>m._lt,"lte",()=>m._lte,"mac",()=>c.mac,"map",()=>c.map,"maxLength",()=>m._maxLength,"maxSize",()=>m._maxSize,"meta",()=>c.meta,"mime",()=>m._mime,"minLength",()=>m._minLength,"minSize",()=>m._minSize,"multipleOf",()=>m._multipleOf,"nan",()=>c.nan,"nanoid",()=>c.nanoid,"nativeEnum",()=>c.nativeEnum,"negative",()=>m._negative,"never",()=>c.never,"nonnegative",()=>m._nonnegative,"nonoptional",()=>c.nonoptional,"nonpositive",()=>m._nonpositive,"normalize",()=>m._normalize,"null",()=>c.null,"nullable",()=>c.nullable,"nullish",()=>c.nullish,"number",()=>c.number,"object",()=>c.object,"optional",()=>c.optional,"overwrite",()=>m._overwrite,"parse",()=>e.parse,"parseAsync",()=>e.parseAsync,"partialRecord",()=>c.partialRecord,"pipe",()=>c.pipe,"positive",()=>m._positive,"prefault",()=>c.prefault,"preprocess",()=>c.preprocess,"prettifyError",()=>y.prettifyError,"promise",()=>c.promise,"property",()=>m._property,"readonly",()=>c.readonly,"record",()=>c.record,"refine",()=>c.refine,"regex",()=>m._regex,"regexes",()=>aE.regexes,"registry",()=>l.registry,"safeDecode",()=>e.safeDecode,"safeDecodeAsync",()=>e.safeDecodeAsync,"safeEncode",()=>e.safeEncode,"safeEncodeAsync",()=>e.safeEncodeAsync,"safeParse",()=>e.safeParse,"safeParseAsync",()=>e.safeParseAsync,"set",()=>c.set,"setErrorMap",()=>h,"size",()=>m._size,"slugify",()=>m._slugify,"startsWith",()=>m._startsWith,"strictObject",()=>c.strictObject,"string",()=>c.string,"stringFormat",()=>c.stringFormat,"stringbool",()=>c.stringbool,"success",()=>c.success,"superRefine",()=>c.superRefine,"symbol",()=>c.symbol,"templateLiteral",()=>c.templateLiteral,"toJSONSchema",()=>k.toJSONSchema,"toLowerCase",()=>m._toLowerCase,"toUpperCase",()=>m._toUpperCase,"transform",()=>c.transform,"treeifyError",()=>y.treeifyError,"trim",()=>m._trim,"tuple",()=>c.tuple,"uint32",()=>c.uint32,"uint64",()=>c.uint64,"ulid",()=>c.ulid,"undefined",()=>c.undefined,"union",()=>c.union,"unknown",()=>c.unknown,"uppercase",()=>m._uppercase,"url",()=>c.url,"util",()=>aG.util,"uuid",()=>c.uuid,"uuidv4",()=>c.uuidv4,"uuidv6",()=>c.uuidv6,"uuidv7",()=>c.uuidv7,"void",()=>c.void,"xid",()=>c.xid,"xor",()=>c.xor],1467)},67387,a=>{"use strict";var b=a.i(51179),c=a.i(10933),d=a.i(62181),e=a.i(38103),f=a.i(38632),g=a.i(72980);function h(a,g,h){let i={},j=a.reduce((a,{path:j,field:k},l)=>{let m;m=(0,c.is)(k,b.Column)?k:(0,c.is)(k,d.SQL)?k.decoder:(0,c.is)(k,e.Subquery)?k._.sql.decoder:k.sql.decoder;let n=a;for(let[a,d]of j.entries())if(a<j.length-1)d in n||(n[d]={}),n=n[d];else{let a=g[l],e=n[d]=null===a?null:m.mapFromDriverValue(a);if(h&&(0,c.is)(k,b.Column)&&2===j.length){let a=j[0];a in i?"string"==typeof i[a]&&i[a]!==(0,f.getTableName)(k.table)&&(i[a]=!1):i[a]=null===e&&(0,f.getTableName)(k.table)}}return a},{});if(h&&Object.keys(i).length>0)for(let[a,b]of Object.entries(i))"string"!=typeof b||h[b]||(j[a]=null);return j}function i(a,b){let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(let[a,b]of c.entries())if(b!==d[a])return!1;return!0}function j(a,e){let g=Object.entries(e).filter(([,a])=>void 0!==a).map(([e,g])=>(0,c.is)(g,d.SQL)||(0,c.is)(g,b.Column)?[e,g]:[e,new d.Param(g,a[f.Table.Symbol.Columns][e])]);if(0===g.length)throw Error("No values to set");return Object.fromEntries(g)}function k(a,b){for(let c of b)for(let b of Object.getOwnPropertyNames(c.prototype))"constructor"!==b&&Object.defineProperty(a.prototype,b,Object.getOwnPropertyDescriptor(c.prototype,b)||Object.create(null))}function l(a){return a[f.Table.Symbol.Columns]}function m(a){return(0,c.is)(a,e.Subquery)?a._.alias:(0,c.is)(a,d.View)?a[g.ViewBaseConfig].name:(0,c.is)(a,d.SQL)?void 0:a[f.Table.Symbol.IsAlias]?a[f.Table.Symbol.Name]:a[f.Table.Symbol.BaseName]}function n(a,b){return{name:"string"==typeof a&&a.length>0?a:"",config:"object"==typeof a?a:b}}function o(a){if("object"!=typeof a||null===a||"Object"!==a.constructor.name)return!1;if("logger"in a){let b=typeof a.logger;return"boolean"===b||"object"===b&&"function"==typeof a.logger.logQuery||"undefined"===b}if("schema"in a){let b=typeof a.schema;return"object"===b||"undefined"===b}if("casing"in a){let b=typeof a.casing;return"string"===b||"undefined"===b}if("mode"in a)return"default"===a.mode&&"planetscale"===a.mode&&void 0===a.mode;if("connection"in a){let b=typeof a.connection;return"string"===b||"object"===b||"undefined"===b}if("client"in a){let b=typeof a.client;return"object"===b||"function"===b||"undefined"===b}return 0===Object.keys(a).length}"u"<typeof TextDecoder||new TextDecoder,a.s(["applyMixins",()=>k,"getColumnNameAndConfig",()=>n,"getTableColumns",()=>l,"getTableLikeName",()=>m,"haveSameKeys",()=>i,"isConfig",()=>o,"mapResultRow",()=>h,"mapUpdateSet",()=>j,"orderSelectedFields",()=>function a(g,h){return Object.entries(g).reduce((g,[i,j])=>{if("string"!=typeof i)return g;let k=h?[...h,i]:[i];return(0,c.is)(j,b.Column)||(0,c.is)(j,d.SQL)||(0,c.is)(j,d.SQL.Aliased)||(0,c.is)(j,e.Subquery)?g.push({path:k,field:j}):(0,c.is)(j,f.Table)?g.push(...a(j[f.Table.Symbol.Columns],k)):g.push(...a(j,k)),g},[])}])},17645,a=>{"use strict";var b=a.i(62181),c=a.i(10933),d=a.i(49840);class e{constructor(a,b){this.unique=a,this.name=b}static [c.entityKind]="PgIndexBuilderOn";on(...a){return new f(a.map(a=>{if((0,c.is)(a,b.SQL))return a;let e=new d.IndexedColumn(a.name,!!a.keyAsName,a.columnType,a.indexConfig);return a.indexConfig=JSON.parse(JSON.stringify(a.defaultConfig)),e}),this.unique,!1,this.name)}onOnly(...a){return new f(a.map(a=>{if((0,c.is)(a,b.SQL))return a;let e=new d.IndexedColumn(a.name,!!a.keyAsName,a.columnType,a.indexConfig);return a.indexConfig=a.defaultConfig,e}),this.unique,!0,this.name)}using(a,...e){return new f(e.map(a=>{if((0,c.is)(a,b.SQL))return a;let e=new d.IndexedColumn(a.name,!!a.keyAsName,a.columnType,a.indexConfig);return a.indexConfig=JSON.parse(JSON.stringify(a.defaultConfig)),e}),this.unique,!0,this.name,a)}}class f{static [c.entityKind]="PgIndexBuilder";config;constructor(a,b,c,d,e="btree"){this.config={name:d,columns:a,unique:b,only:c,method:e}}concurrently(){return this.config.concurrently=!0,this}with(a){return this.config.with=a,this}where(a){return this.config.where=a,this}build(a){return new g(this.config,a)}}class g{static [c.entityKind]="PgIndex";config;constructor(a,b){this.config={...a,table:b}}}function h(a){return new e(!1,a)}a.s(["IndexBuilder",()=>f,"index",()=>h])},94780,90358,33032,2915,83326,85564,43078,25128,42635,49322,86519,56611,49798,70177,a=>{"use strict";var b=a.i(10933),c=a.i(49840);class d extends c.PgColumnBuilder{static [b.entityKind]="PgBooleanBuilder";constructor(a){super(a,"boolean","PgBoolean")}build(a){return new e(a,this.config)}}class e extends c.PgColumn{static [b.entityKind]="PgBoolean";getSQLType(){return"boolean"}}function f(a){return new d(a??"")}a.s(["boolean",()=>f],94780);var g=a.i(67387),h=c;class i extends h.PgColumnBuilder{static [b.entityKind]="PgCustomColumnBuilder";constructor(a,b,c){super(a,"custom","PgCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new j(a,this.config)}}class j extends h.PgColumn{static [b.entityKind]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}function k(a){return(b,c)=>{let{name:d,config:e}=(0,g.getColumnNameAndConfig)(b,c);return new i(d,e,a)}}a.s(["customType",()=>k],90358);var l=c,m=c;class n extends m.PgColumnBuilder{static [b.entityKind]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"always",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"byDefault",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class o extends n{static [b.entityKind]="PgIntegerBuilder";constructor(a){super(a,"number","PgInteger")}build(a){return new p(a,this.config)}}class p extends l.PgColumn{static [b.entityKind]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(a){return"string"==typeof a?Number.parseInt(a):a}}function q(a){return new o(a??"")}a.s(["integer",()=>q],33032);var r=c;class s extends r.PgColumnBuilder{static [b.entityKind]="PgJsonbBuilder";constructor(a){super(a,"json","PgJsonb")}build(a){return new t(a,this.config)}}class t extends r.PgColumn{static [b.entityKind]="PgJsonb";constructor(a,b){super(a,b)}getSQLType(){return"jsonb"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}function u(a){return new s(a??"")}a.s(["PgJsonb",()=>t,"jsonb",()=>u],2915);var v=a.i(38632),w=c;class x extends n{static [b.entityKind]="PgBigInt53Builder";constructor(a){super(a,"number","PgBigInt53")}build(a){return new y(a,this.config)}}class y extends w.PgColumn{static [b.entityKind]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class z extends n{static [b.entityKind]="PgBigInt64Builder";constructor(a){super(a,"bigint","PgBigInt64")}build(a){return new A(a,this.config)}}class A extends w.PgColumn{static [b.entityKind]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(a){return BigInt(a)}}function B(a,b){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return"number"===d.mode?new x(c):new z(c)}var C=c;class D extends C.PgColumnBuilder{static [b.entityKind]="PgBigSerial53Builder";constructor(a){super(a,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new E(a,this.config)}}class E extends C.PgColumn{static [b.entityKind]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class F extends C.PgColumnBuilder{static [b.entityKind]="PgBigSerial64Builder";constructor(a){super(a,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(a){return new G(a,this.config)}}class G extends C.PgColumn{static [b.entityKind]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(a){return BigInt(a)}}function H(a,b){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return"number"===d.mode?new D(c):new F(c)}var I=c;class J extends I.PgColumnBuilder{static [b.entityKind]="PgCharBuilder";constructor(a,b){super(a,"string","PgChar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new K(a,this.config)}}class K extends I.PgColumn{static [b.entityKind]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}function L(a,b={}){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return new J(c,d)}var M=c;class N extends M.PgColumnBuilder{static [b.entityKind]="PgCidrBuilder";constructor(a){super(a,"string","PgCidr")}build(a){return new O(a,this.config)}}class O extends M.PgColumn{static [b.entityKind]="PgCidr";getSQLType(){return"cidr"}}function P(a){return new N(a??"")}var Q=c,R=a.i(62181),S=c;class T extends S.PgColumnBuilder{static [b.entityKind]="PgDateColumnBaseBuilder";defaultNow(){return this.default(R.sql`now()`)}}class U extends T{static [b.entityKind]="PgDateBuilder";constructor(a){super(a,"date","PgDate")}build(a){return new V(a,this.config)}}class V extends Q.PgColumn{static [b.entityKind]="PgDate";getSQLType(){return"date"}mapFromDriverValue(a){return"string"==typeof a?new Date(a):a}mapToDriverValue(a){return a.toISOString()}}class W extends T{static [b.entityKind]="PgDateStringBuilder";constructor(a){super(a,"string","PgDateString")}build(a){return new X(a,this.config)}}class X extends Q.PgColumn{static [b.entityKind]="PgDateString";getSQLType(){return"date"}mapFromDriverValue(a){return"string"==typeof a?a:a.toISOString().slice(0,-14)}}function Y(a,b){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return d?.mode==="date"?new U(c):new W(c)}a.s(["PgDate",()=>V,"PgDateString",()=>X,"date",()=>Y],83326);var Z=c;class $ extends Z.PgColumnBuilder{static [b.entityKind]="PgDoublePrecisionBuilder";constructor(a){super(a,"number","PgDoublePrecision")}build(a){return new _(a,this.config)}}class _ extends Z.PgColumn{static [b.entityKind]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(a){return"string"==typeof a?Number.parseFloat(a):a}}function aa(a){return new $(a??"")}var ab=c;class ac extends ab.PgColumnBuilder{static [b.entityKind]="PgInetBuilder";constructor(a){super(a,"string","PgInet")}build(a){return new ad(a,this.config)}}class ad extends ab.PgColumn{static [b.entityKind]="PgInet";getSQLType(){return"inet"}}function ae(a){return new ac(a??"")}var af=c;class ag extends af.PgColumnBuilder{static [b.entityKind]="PgIntervalBuilder";constructor(a,b){super(a,"string","PgInterval"),this.config.intervalConfig=b}build(a){return new ah(a,this.config)}}class ah extends af.PgColumn{static [b.entityKind]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let a=this.fields?` ${this.fields}`:"",b=this.precision?`(${this.precision})`:"";return`interval${a}${b}`}}function ai(a,b={}){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return new ag(c,d)}var aj=c;class ak extends aj.PgColumnBuilder{static [b.entityKind]="PgJsonBuilder";constructor(a){super(a,"json","PgJson")}build(a){return new al(a,this.config)}}class al extends aj.PgColumn{static [b.entityKind]="PgJson";constructor(a,b){super(a,b)}getSQLType(){return"json"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}function am(a){return new ak(a??"")}a.s(["PgJson",()=>al,"json",()=>am],85564);var an=c;class ao extends an.PgColumnBuilder{static [b.entityKind]="PgLineBuilder";constructor(a){super(a,"array","PgLine")}build(a){return new ap(a,this.config)}}class ap extends an.PgColumn{static [b.entityKind]="PgLine";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c),Number.parseFloat(d)]}mapToDriverValue(a){return`{${a[0]},${a[1]},${a[2]}}`}}class aq extends an.PgColumnBuilder{static [b.entityKind]="PgLineABCBuilder";constructor(a){super(a,"json","PgLineABC")}build(a){return new ar(a,this.config)}}class ar extends an.PgColumn{static [b.entityKind]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return{a:Number.parseFloat(b),b:Number.parseFloat(c),c:Number.parseFloat(d)}}mapToDriverValue(a){return`{${a.a},${a.b},${a.c}}`}}function as(a,b){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return d?.mode&&"tuple"!==d.mode?new aq(c):new ao(c)}var at=c;class au extends at.PgColumnBuilder{static [b.entityKind]="PgMacaddrBuilder";constructor(a){super(a,"string","PgMacaddr")}build(a){return new av(a,this.config)}}class av extends at.PgColumn{static [b.entityKind]="PgMacaddr";getSQLType(){return"macaddr"}}function aw(a){return new au(a??"")}var ax=c;class ay extends ax.PgColumnBuilder{static [b.entityKind]="PgMacaddr8Builder";constructor(a){super(a,"string","PgMacaddr8")}build(a){return new az(a,this.config)}}class az extends ax.PgColumn{static [b.entityKind]="PgMacaddr8";getSQLType(){return"macaddr8"}}function aA(a){return new ay(a??"")}var aB=c;class aC extends aB.PgColumnBuilder{static [b.entityKind]="PgNumericBuilder";constructor(a,b,c){super(a,"string","PgNumeric"),this.config.precision=b,this.config.scale=c}build(a){return new aD(a,this.config)}}class aD extends aB.PgColumn{static [b.entityKind]="PgNumeric";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"string"==typeof a?a:String(a)}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class aE extends aB.PgColumnBuilder{static [b.entityKind]="PgNumericNumberBuilder";constructor(a,b,c){super(a,"number","PgNumericNumber"),this.config.precision=b,this.config.scale=c}build(a){return new aF(a,this.config)}}class aF extends aB.PgColumn{static [b.entityKind]="PgNumericNumber";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class aG extends aB.PgColumnBuilder{static [b.entityKind]="PgNumericBigIntBuilder";constructor(a,b,c){super(a,"bigint","PgNumericBigInt"),this.config.precision=b,this.config.scale=c}build(a){return new aH(a,this.config)}}class aH extends aB.PgColumn{static [b.entityKind]="PgNumericBigInt";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}function aI(a,b){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b),e=d?.mode;return"number"===e?new aE(c,d?.precision,d?.scale):"bigint"===e?new aG(c,d?.precision,d?.scale):new aC(c,d?.precision,d?.scale)}a.s(["PgNumeric",()=>aD,"numeric",()=>aI],43078);var aJ=c;class aK extends aJ.PgColumnBuilder{static [b.entityKind]="PgPointTupleBuilder";constructor(a){super(a,"array","PgPointTuple")}build(a){return new aL(a,this.config)}}class aL extends aJ.PgColumn{static [b.entityKind]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c)]}return[a.x,a.y]}mapToDriverValue(a){return`(${a[0]},${a[1]})`}}class aM extends aJ.PgColumnBuilder{static [b.entityKind]="PgPointObjectBuilder";constructor(a){super(a,"json","PgPointObject")}build(a){return new aN(a,this.config)}}class aN extends aJ.PgColumn{static [b.entityKind]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return{x:Number.parseFloat(b),y:Number.parseFloat(c)}}return a}mapToDriverValue(a){return`(${a.x},${a.y})`}}function aO(a,b){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return d?.mode&&"tuple"!==d.mode?new aM(c):new aK(c)}var aP=c;function aQ(a,b){let c=new DataView(new ArrayBuffer(8));for(let d=0;d<8;d++)c.setUint8(d,a[b+d]);return c.getFloat64(0,!0)}function aR(a){let b=function(a){let b=[];for(let c=0;c<a.length;c+=2)b.push(Number.parseInt(a.slice(c,c+2),16));return new Uint8Array(b)}(a),c=0,d=b[0];c+=1;let e=new DataView(b.buffer),f=e.getUint32(c,1===d);if(c+=4,0x20000000&f&&(e.getUint32(c,1===d),c+=4),(65535&f)==1){let a=aQ(b,c),d=aQ(b,c+=8);return c+=8,[a,d]}throw Error("Unsupported geometry type")}class aS extends aP.PgColumnBuilder{static [b.entityKind]="PgGeometryBuilder";constructor(a){super(a,"array","PgGeometry")}build(a){return new aT(a,this.config)}}class aT extends aP.PgColumn{static [b.entityKind]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){return aR(a)}mapToDriverValue(a){return`point(${a[0]} ${a[1]})`}}class aU extends aP.PgColumnBuilder{static [b.entityKind]="PgGeometryObjectBuilder";constructor(a){super(a,"json","PgGeometryObject")}build(a){return new aV(a,this.config)}}class aV extends aP.PgColumn{static [b.entityKind]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){let b=aR(a);return{x:b[0],y:b[1]}}mapToDriverValue(a){return`point(${a.x} ${a.y})`}}function aW(a,b){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return d?.mode&&"tuple"!==d.mode?new aU(c):new aS(c)}var aX=c;class aY extends aX.PgColumnBuilder{static [b.entityKind]="PgRealBuilder";constructor(a,b){super(a,"number","PgReal"),this.config.length=b}build(a){return new aZ(a,this.config)}}class aZ extends aX.PgColumn{static [b.entityKind]="PgReal";constructor(a,b){super(a,b)}getSQLType(){return"real"}mapFromDriverValue=a=>"string"==typeof a?Number.parseFloat(a):a}function a$(a){return new aY(a??"")}var a_=c;class a0 extends a_.PgColumnBuilder{static [b.entityKind]="PgSerialBuilder";constructor(a){super(a,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new a1(a,this.config)}}class a1 extends a_.PgColumn{static [b.entityKind]="PgSerial";getSQLType(){return"serial"}}function a2(a){return new a0(a??"")}var a3=c;class a4 extends n{static [b.entityKind]="PgSmallIntBuilder";constructor(a){super(a,"number","PgSmallInt")}build(a){return new a5(a,this.config)}}class a5 extends a3.PgColumn{static [b.entityKind]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=a=>"string"==typeof a?Number(a):a}function a6(a){return new a4(a??"")}var a7=c;class a8 extends a7.PgColumnBuilder{static [b.entityKind]="PgSmallSerialBuilder";constructor(a){super(a,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new a9(a,this.config)}}class a9 extends a7.PgColumn{static [b.entityKind]="PgSmallSerial";getSQLType(){return"smallserial"}}function ba(a){return new a8(a??"")}var bb=c;class bc extends bb.PgColumnBuilder{static [b.entityKind]="PgTextBuilder";constructor(a,b){super(a,"string","PgText"),this.config.enumValues=b.enum}build(a){return new bd(a,this.config)}}class bd extends bb.PgColumn{static [b.entityKind]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function be(a,b={}){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return new bc(c,d)}a.s(["text",()=>be],25128);var bf=c;class bg extends T{constructor(a,b,c){super(a,"string","PgTime"),this.withTimezone=b,this.precision=c,this.config.withTimezone=b,this.config.precision=c}static [b.entityKind]="PgTimeBuilder";build(a){return new bh(a,this.config)}}class bh extends bf.PgColumn{static [b.entityKind]="PgTime";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`time${a}${this.withTimezone?" with time zone":""}`}}function bi(a,b={}){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return new bg(c,d.withTimezone??!1,d.precision)}a.s(["PgTime",()=>bh,"time",()=>bi],42635);var bj=c;class bk extends T{static [b.entityKind]="PgTimestampBuilder";constructor(a,b,c){super(a,"date","PgTimestamp"),this.config.withTimezone=b,this.config.precision=c}build(a){return new bl(a,this.config)}}class bl extends bj.PgColumn{static [b.entityKind]="PgTimestamp";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":` (${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(a){return"string"==typeof a?new Date(this.withTimezone?a:a+"+0000"):a}mapToDriverValue=a=>a.toISOString()}class bm extends T{static [b.entityKind]="PgTimestampStringBuilder";constructor(a,b,c){super(a,"string","PgTimestampString"),this.config.withTimezone=b,this.config.precision=c}build(a){return new bn(a,this.config)}}class bn extends bj.PgColumn{static [b.entityKind]="PgTimestampString";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(a){if("string"==typeof a)return a;let b=a.toISOString().slice(0,-1).replace("T"," ");if(this.withTimezone){let c=a.getTimezoneOffset();return`${b}${c<=0?"+":"-"}${Math.floor(Math.abs(c)/60).toString().padStart(2,"0")}`}return b}}function bo(a,b={}){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return d?.mode==="string"?new bm(c,d.withTimezone??!1,d.precision):new bk(c,d?.withTimezone??!1,d?.precision)}a.s(["PgTimestamp",()=>bl,"PgTimestampString",()=>bn,"timestamp",()=>bo],49322);var bp=c;class bq extends bp.PgColumnBuilder{static [b.entityKind]="PgUUIDBuilder";constructor(a){super(a,"string","PgUUID")}defaultRandom(){return this.default(R.sql`gen_random_uuid()`)}build(a){return new br(a,this.config)}}class br extends bp.PgColumn{static [b.entityKind]="PgUUID";getSQLType(){return"uuid"}}function bs(a){return new bq(a??"")}a.s(["PgUUID",()=>br,"uuid",()=>bs],86519);var bt=c;class bu extends bt.PgColumnBuilder{static [b.entityKind]="PgVarcharBuilder";constructor(a,b){super(a,"string","PgVarchar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new bv(a,this.config)}}class bv extends bt.PgColumn{static [b.entityKind]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}function bw(a,b={}){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return new bu(c,d)}a.s(["varchar",()=>bw],56611);var bx=c;class by extends bx.PgColumnBuilder{static [b.entityKind]="PgBinaryVectorBuilder";constructor(a,b){super(a,"string","PgBinaryVector"),this.config.dimensions=b.dimensions}build(a){return new bz(a,this.config)}}class bz extends bx.PgColumn{static [b.entityKind]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}function bA(a,b){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return new by(c,d)}var bB=c;class bC extends bB.PgColumnBuilder{static [b.entityKind]="PgHalfVectorBuilder";constructor(a,b){super(a,"array","PgHalfVector"),this.config.dimensions=b.dimensions}build(a){return new bD(a,this.config)}}class bD extends bB.PgColumn{static [b.entityKind]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function bE(a,b){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return new bC(c,d)}var bF=c;class bG extends bF.PgColumnBuilder{static [b.entityKind]="PgSparseVectorBuilder";constructor(a,b){super(a,"string","PgSparseVector"),this.config.dimensions=b.dimensions}build(a){return new bH(a,this.config)}}class bH extends bF.PgColumn{static [b.entityKind]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}function bI(a,b){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return new bG(c,d)}var bJ=c;class bK extends bJ.PgColumnBuilder{static [b.entityKind]="PgVectorBuilder";constructor(a,b){super(a,"array","PgVector"),this.config.dimensions=b.dimensions}build(a){return new bL(a,this.config)}}class bL extends bJ.PgColumn{static [b.entityKind]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function bM(a,b){let{name:c,config:d}=(0,g.getColumnNameAndConfig)(a,b);return new bK(c,d)}let bN=Symbol.for("drizzle:PgInlineForeignKeys"),bO=Symbol.for("drizzle:EnableRLS");class bP extends v.Table{static [b.entityKind]="PgTable";static Symbol=Object.assign({},v.Table.Symbol,{InlineForeignKeys:bN,EnableRLS:bO});[bN]=[];[bO]=!1;[v.Table.Symbol.ExtraConfigBuilder]=void 0;[v.Table.Symbol.ExtraConfigColumns]={}}let bQ=(a,b,c)=>(function(a,b,c,d,e=a){let g=new bP(a,d,e),h="function"==typeof b?b({bigint:B,bigserial:H,boolean:f,char:L,cidr:P,customType:k,date:Y,doublePrecision:aa,inet:ae,integer:q,interval:ai,json:am,jsonb:u,line:as,macaddr:aw,macaddr8:aA,numeric:aI,point:aO,geometry:aW,real:a$,serial:a2,smallint:a6,smallserial:ba,text:be,time:bi,timestamp:bo,uuid:bs,varchar:bw,bit:bA,halfvec:bE,sparsevec:bI,vector:bM}):b,i=Object.fromEntries(Object.entries(h).map(([a,b])=>{b.setName(a);let c=b.build(g);return g[bN].push(...b.buildForeignKeys(c,g)),[a,c]})),j=Object.fromEntries(Object.entries(h).map(([a,b])=>(b.setName(a),[a,b.buildExtraConfigColumn(g)]))),l=Object.assign(g,i);return l[v.Table.Symbol.Columns]=i,l[v.Table.Symbol.ExtraConfigColumns]=j,c&&(l[bP.Symbol.ExtraConfigBuilder]=c),Object.assign(l,{enableRLS:()=>(l[bP.Symbol.EnableRLS]=!0,l)})})(a,b,c,void 0);function bR(...a){return a[0].columns?new bS(a[0].columns,a[0].name):new bS(a)}a.s(["PgTable",()=>bP,"pgTable",()=>bQ],49798);class bS{static [b.entityKind]="PgPrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new bT(a,this.columns,this.name)}}class bT{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [b.entityKind]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[bP.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}a.s(["PrimaryKeyBuilder",()=>bS,"primaryKey",()=>bR],70177)},75681,5868,28528,a=>{"use strict";var b=a.i(1467);a.s(["z",0,b],75681);var b=b;let c=b.enum(["tolk","func","tact","fift","tl-b","unknown"]),d=b.enum(["critical","high","medium","low","informational"]),e=b.enum(["queued","running","completed","failed","cancelled"]),f=b.enum(["queued","running","completed","failed","skipped"]),g=b.enum(["file-set","zip"]),h=b.enum(["initialized","uploaded","processing","processed","failed"]),i=b.enum(["upload","working-copy"]),j=b.enum(["active","locked","discarded"]),k=b.enum(["opened","resolved","regressed","unchanged"]),l=b.enum(["queued","running","completed","failed"]);b.enum(["ingest","verify","audit","finding-lifecycle","pdf","docs-crawl","docs-index","cleanup"]),a.s(["auditRunStatusSchema",0,e,"findingTransitionSchema",0,k,"languageSchema",0,c,"pdfExportStatusSchema",0,l,"revisionSourceSchema",0,i,"severitySchema",0,d,"uploadStatusSchema",0,h,"uploadTypeSchema",0,g,"verificationStepStatusSchema",0,f,"workingCopyStatusSchema",0,j],5868);var m=a.i(94780),n=a.i(90358),o=a.i(17645),p=a.i(33032),q=a.i(2915),r=a.i(12223),s=a.i(49798),t=a.i(70177),u=a.i(25128),v=a.i(49322),w=a.i(69914),x=a.i(86519),y=a.i(56611);let z=(0,n.customType)({dataType(a){let b=a?.dimensions??1536;return`vector(${b})`},toDriver:a=>`[${a.join(",")}]`,fromDriver(a){if(Array.isArray(a))return a.map(a=>Number(a));let b=a.trim().replace(/^\[/,"").replace(/\]$/,"");return b?b.split(",").map(a=>Number(a)):[]}}),A=(0,n.customType)({dataType:()=>"tsvector"}),B=(0,r.pgEnum)("upload_type",g.options),C=(0,r.pgEnum)("upload_status",h.options),D=(0,r.pgEnum)("revision_source",i.options),E=(0,r.pgEnum)("working_copy_status",j.options),F=(0,r.pgEnum)("audit_run_status",e.options),G=(0,r.pgEnum)("verification_step_status",f.options),H=(0,r.pgEnum)("finding_transition",k.options),I=(0,r.pgEnum)("pdf_export_status",l.options),J=(0,r.pgEnum)("language",c.options),K=(0,s.pgTable)("users",{id:(0,u.text)("id").primaryKey(),name:(0,u.text)("name"),email:(0,u.text)("email").notNull(),emailVerified:(0,m.boolean)("email_verified").notNull().default(!1),image:(0,u.text)("image"),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({emailUnique:(0,w.unique)("users_email_unique").on(a.email),emailIdx:(0,o.index)("users_email_idx").on(a.email)})),L=(0,s.pgTable)("sessions",{id:(0,u.text)("id").primaryKey(),token:(0,u.text)("token").notNull(),userId:(0,u.text)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),expiresAt:(0,v.timestamp)("expires_at",{withTimezone:!0}).notNull(),ipAddress:(0,u.text)("ip_address"),userAgent:(0,u.text)("user_agent"),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({tokenUnique:(0,w.unique)("sessions_token_unique").on(a.token),userIdIdx:(0,o.index)("sessions_user_id_idx").on(a.userId)})),M=(0,s.pgTable)("accounts",{id:(0,u.text)("id").primaryKey(),accountId:(0,u.text)("account_id").notNull(),providerId:(0,u.text)("provider_id").notNull(),userId:(0,u.text)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),accessToken:(0,u.text)("access_token"),refreshToken:(0,u.text)("refresh_token"),idToken:(0,u.text)("id_token"),accessTokenExpiresAt:(0,v.timestamp)("access_token_expires_at",{withTimezone:!0}),refreshTokenExpiresAt:(0,v.timestamp)("refresh_token_expires_at",{withTimezone:!0}),scope:(0,u.text)("scope"),password:(0,u.text)("password"),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({providerAccountUnique:(0,w.unique)("accounts_provider_account_unique").on(a.providerId,a.accountId),userIdIdx:(0,o.index)("accounts_user_id_idx").on(a.userId)})),N=(0,s.pgTable)("verification_tokens",{id:(0,u.text)("id").primaryKey(),identifier:(0,u.text)("identifier").notNull(),value:(0,u.text)("value").notNull(),expiresAt:(0,v.timestamp)("expires_at",{withTimezone:!0}).notNull(),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({identifierIdx:(0,o.index)("verification_tokens_identifier_idx").on(a.identifier)})),O=(0,s.pgTable)("projects",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),ownerUserId:(0,u.text)("owner_user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),name:(0,y.varchar)("name",{length:120}).notNull(),slug:(0,y.varchar)("slug",{length:140}).notNull(),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({ownerIdx:(0,o.index)("projects_owner_idx").on(a.ownerUserId),slugUnique:(0,w.unique)("projects_owner_slug_unique").on(a.ownerUserId,a.slug)})),P=(0,s.pgTable)("project_members",{projectId:(0,x.uuid)("project_id").notNull().references(()=>O.id,{onDelete:"cascade"}),userId:(0,u.text)("user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),role:(0,y.varchar)("role",{length:32}).notNull().default("owner"),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>({pk:(0,t.primaryKey)({columns:[a.projectId,a.userId]}),roleIdx:(0,o.index)("project_members_role_idx").on(a.role)})),Q=(0,s.pgTable)("uploads",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),projectId:(0,x.uuid)("project_id").notNull().references(()=>O.id,{onDelete:"cascade"}),uploaderUserId:(0,u.text)("uploader_user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),type:B("type").notNull(),status:C("status").notNull().default("initialized"),s3Key:(0,u.text)("s3_key").notNull(),multipartUploadId:(0,u.text)("multipart_upload_id"),sizeBytes:(0,p.integer)("size_bytes").notNull(),contentType:(0,u.text)("content_type").notNull(),originalFilename:(0,u.text)("original_filename").notNull(),metadata:(0,q.jsonb)("metadata").$type().notNull().default({}),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({projectIdx:(0,o.index)("uploads_project_idx").on(a.projectId),statusIdx:(0,o.index)("uploads_status_idx").on(a.status)})),R=(0,s.pgTable)("revisions",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),projectId:(0,x.uuid)("project_id").notNull().references(()=>O.id,{onDelete:"cascade"}),parentRevisionId:(0,x.uuid)("parent_revision_id"),source:D("source").notNull(),createdByUserId:(0,u.text)("created_by_user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),isImmutable:(0,m.boolean)("is_immutable").notNull().default(!0),description:(0,u.text)("description"),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>({projectIdx:(0,o.index)("revisions_project_idx").on(a.projectId),parentIdx:(0,o.index)("revisions_parent_idx").on(a.parentRevisionId)})),S=(0,s.pgTable)("file_blobs",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),sha256:(0,y.varchar)("sha256",{length:64}).notNull(),sizeBytes:(0,p.integer)("size_bytes").notNull(),s3Key:(0,u.text)("s3_key").notNull(),contentType:(0,u.text)("content_type").notNull(),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>({shaIdx:(0,w.unique)("file_blobs_sha_unique").on(a.sha256)})),T=(0,s.pgTable)("revision_files",{revisionId:(0,x.uuid)("revision_id").notNull().references(()=>R.id,{onDelete:"cascade"}),path:(0,u.text)("path").notNull(),language:J("language").notNull().default("unknown"),blobId:(0,x.uuid)("blob_id").notNull().references(()=>S.id,{onDelete:"cascade"}),isTestFile:(0,m.boolean)("is_test_file").notNull().default(!1),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>({pk:(0,t.primaryKey)({columns:[a.revisionId,a.path]}),blobIdx:(0,o.index)("revision_files_blob_idx").on(a.blobId)})),U=(0,s.pgTable)("working_copies",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),projectId:(0,x.uuid)("project_id").notNull().references(()=>O.id,{onDelete:"cascade"}),baseRevisionId:(0,x.uuid)("base_revision_id").notNull().references(()=>R.id,{onDelete:"cascade"}),ownerUserId:(0,u.text)("owner_user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),status:E("status").notNull().default("active"),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({projectIdx:(0,o.index)("working_copies_project_idx").on(a.projectId),ownerIdx:(0,o.index)("working_copies_owner_idx").on(a.ownerUserId)})),V=(0,s.pgTable)("working_copy_files",{workingCopyId:(0,x.uuid)("working_copy_id").notNull().references(()=>U.id,{onDelete:"cascade"}),path:(0,u.text)("path").notNull(),language:J("language").notNull().default("unknown"),content:(0,u.text)("content").notNull(),isTestFile:(0,m.boolean)("is_test_file").notNull().default(!1),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({pk:(0,t.primaryKey)({columns:[a.workingCopyId,a.path]})})),W=(0,s.pgTable)("audit_runs",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),projectId:(0,x.uuid)("project_id").notNull().references(()=>O.id,{onDelete:"cascade"}),revisionId:(0,x.uuid)("revision_id").notNull().references(()=>R.id,{onDelete:"cascade"}),status:F("status").notNull().default("queued"),requestedByUserId:(0,u.text)("requested_by_user_id").notNull().references(()=>K.id,{onDelete:"cascade"}),primaryModelId:(0,u.text)("primary_model_id").notNull(),fallbackModelId:(0,u.text)("fallback_model_id").notNull(),reportJson:(0,q.jsonb)("report_json").$type(),startedAt:(0,v.timestamp)("started_at",{withTimezone:!0}),finishedAt:(0,v.timestamp)("finished_at",{withTimezone:!0}),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({revisionIdx:(0,o.index)("audit_runs_revision_idx").on(a.revisionId),statusIdx:(0,o.index)("audit_runs_status_idx").on(a.status)})),X=(0,s.pgTable)("verification_steps",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),auditRunId:(0,x.uuid)("audit_run_id").notNull().references(()=>W.id,{onDelete:"cascade"}),stepType:(0,u.text)("step_type").notNull(),toolchain:(0,u.text)("toolchain").notNull(),status:G("status").notNull().default("queued"),stdoutKey:(0,u.text)("stdout_key"),stderrKey:(0,u.text)("stderr_key"),summary:(0,u.text)("summary"),durationMs:(0,p.integer)("duration_ms"),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({auditRunIdx:(0,o.index)("verification_steps_audit_run_idx").on(a.auditRunId)})),Y=(0,s.pgTable)("findings",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),projectId:(0,x.uuid)("project_id").notNull().references(()=>O.id,{onDelete:"cascade"}),stableFingerprint:(0,y.varchar)("stable_fingerprint",{length:64}).notNull(),firstSeenRevisionId:(0,x.uuid)("first_seen_revision_id").notNull().references(()=>R.id,{onDelete:"cascade"}),lastSeenRevisionId:(0,x.uuid)("last_seen_revision_id").notNull().references(()=>R.id,{onDelete:"cascade"}),currentStatus:H("current_status").notNull().default("opened"),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({projectFingerprintUnique:(0,w.unique)("findings_project_fingerprint_unique").on(a.projectId,a.stableFingerprint)})),Z=(0,s.pgTable)("finding_instances",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),findingId:(0,x.uuid)("finding_id").notNull().references(()=>Y.id,{onDelete:"cascade"}),auditRunId:(0,x.uuid)("audit_run_id").notNull().references(()=>W.id,{onDelete:"cascade"}),revisionId:(0,x.uuid)("revision_id").notNull().references(()=>R.id,{onDelete:"cascade"}),severity:(0,u.text)("severity").notNull(),payloadJson:(0,q.jsonb)("payload_json").$type().notNull(),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>({findingAuditUnique:(0,w.unique)("finding_instances_finding_audit_unique").on(a.findingId,a.auditRunId),auditRunIdx:(0,o.index)("finding_instances_audit_run_idx").on(a.auditRunId)})),$=(0,s.pgTable)("finding_transitions",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),findingId:(0,x.uuid)("finding_id").notNull().references(()=>Y.id,{onDelete:"cascade"}),fromAuditRunId:(0,x.uuid)("from_audit_run_id").notNull().references(()=>W.id,{onDelete:"cascade"}),toAuditRunId:(0,x.uuid)("to_audit_run_id").notNull().references(()=>W.id,{onDelete:"cascade"}),transition:H("transition").notNull(),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>({uniqueTransition:(0,w.unique)("finding_transitions_unique").on(a.findingId,a.fromAuditRunId,a.toAuditRunId)})),_=(0,s.pgTable)("docs_sources",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),sourceUrl:(0,u.text)("source_url").notNull(),sourceType:(0,u.text)("source_type").notNull().default("web"),checksum:(0,y.varchar)("checksum",{length:64}).notNull(),title:(0,u.text)("title"),fetchedAt:(0,v.timestamp)("fetched_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({urlUnique:(0,w.unique)("docs_sources_url_unique").on(a.sourceUrl)})),aa=(0,s.pgTable)("docs_chunks",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),sourceId:(0,x.uuid)("source_id").notNull().references(()=>_.id,{onDelete:"cascade"}),chunkIndex:(0,p.integer)("chunk_index").notNull(),chunkText:(0,u.text)("chunk_text").notNull(),tokenCount:(0,p.integer)("token_count").notNull(),embedding:z("embedding",{dimensions:1536}).notNull(),lexemes:A("lexemes"),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>({sourceChunkUnique:(0,w.unique)("docs_chunks_source_chunk_unique").on(a.sourceId,a.chunkIndex),sourceIdx:(0,o.index)("docs_chunks_source_idx").on(a.sourceId)})),ab=(0,s.pgTable)("pdf_exports",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),auditRunId:(0,x.uuid)("audit_run_id").notNull().references(()=>W.id,{onDelete:"cascade"}),status:I("status").notNull().default("queued"),s3Key:(0,u.text)("s3_key"),generatedAt:(0,v.timestamp)("generated_at",{withTimezone:!0}),expiresAt:(0,v.timestamp)("expires_at",{withTimezone:!0}),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()},a=>({auditUnique:(0,w.unique)("pdf_exports_audit_run_unique").on(a.auditRunId)})),ac=(0,s.pgTable)("system_settings",{key:(0,u.text)("key").primaryKey(),value:(0,q.jsonb)("value").$type().notNull(),updatedAt:(0,v.timestamp)("updated_at",{withTimezone:!0}).notNull().defaultNow()}),ad=(0,s.pgTable)("job_events",{id:(0,x.uuid)("id").primaryKey().defaultRandom(),queue:(0,u.text)("queue").notNull(),jobId:(0,u.text)("job_id").notNull(),event:(0,u.text)("event").notNull(),payload:(0,q.jsonb)("payload").$type().notNull().default({}),createdAt:(0,v.timestamp)("created_at",{withTimezone:!0}).notNull().defaultNow()},a=>({jobIdx:(0,o.index)("job_events_job_idx").on(a.jobId)}));a.s(["auditRuns",0,W,"dbSchema",0,{users:K,sessions:L,accounts:M,verificationTokens:N,projects:O,projectMembers:P,uploads:Q,revisions:R,fileBlobs:S,revisionFiles:T,workingCopies:U,workingCopyFiles:V,auditRuns:W,verificationSteps:X,findings:Y,findingInstances:Z,findingTransitions:$,docsSources:_,docsChunks:aa,pdfExports:ab,systemSettings:ac,jobEvents:ad},"projectMembers",0,P,"projects",0,O,"revisions",0,R],28528)},46622,65719,a=>{"use strict";var b=a.i(75681),c=a.i(5868);let d=b.z.object({filePath:b.z.string().min(1),startLine:b.z.number().int().positive(),endLine:b.z.number().int().positive(),snippet:b.z.string().min(1)}),e=b.z.object({findingId:b.z.string().min(1),severity:c.severitySchema,title:b.z.string().min(1),summary:b.z.string().min(1),impact:b.z.string().min(1),likelihood:b.z.string().min(1),evidence:d,exploitPath:b.z.string().min(1),remediation:b.z.string().min(1),confidence:b.z.number().min(0).max(1),references:b.z.array(b.z.string().url()).default([]),language:c.languageSchema.optional()});b.z.object({name:b.z.string().min(1).max(120),slug:b.z.string().regex(/^[a-z0-9-]+$/)}),b.z.object({filename:b.z.string().min(1),contentType:b.z.string().min(1),sizeBytes:b.z.number().int().positive(),type:c.uploadTypeSchema,parts:b.z.number().int().positive().max(1e4).default(1)}),b.z.object({uploadId:b.z.string().uuid(),eTags:b.z.array(b.z.object({partNumber:b.z.number().int().positive(),eTag:b.z.string().min(1)}))}),b.z.object({uploadId:b.z.string().uuid(),explicitLanguageHints:b.z.record(b.z.string(),c.languageSchema).optional()}),b.z.object({path:b.z.string().min(1),content:b.z.string(),language:c.languageSchema.optional(),isTestFile:b.z.boolean().optional()}),b.z.object({primaryModelId:b.z.string().min(1),fallbackModelId:b.z.string().min(1),includeDocsFallbackFetch:b.z.boolean().default(!0)}),b.z.object({seedSitemapUrl:b.z.string().url(),allowPrefixes:b.z.array(b.z.string()).default(["/contract-dev/blueprint/","/contract-dev/testing/","/languages/tolk/","/languages/func/","/languages/tact/","/languages/fift/","/languages/tl-b/"])}),b.z.object({models:b.z.array(b.z.string().min(1)).min(1)});let f=b.z.object({NODE_ENV:b.z.enum(["development","test","production"]).default("development"),DATABASE_URL:b.z.string().min(1),REDIS_URL:b.z.string().min(1),MINIO_ENDPOINT:b.z.string().min(1),MINIO_REGION:b.z.string().default("us-east-1"),MINIO_ACCESS_KEY:b.z.string().min(1),MINIO_SECRET_KEY:b.z.string().min(1),MINIO_BUCKET:b.z.string().min(1),BETTER_AUTH_SECRET:b.z.string().min(1),GITHUB_CLIENT_ID:b.z.string().min(1),GITHUB_CLIENT_SECRET:b.z.string().min(1),OPENROUTER_API_KEY:b.z.string().min(1),OPENROUTER_EMBEDDINGS_MODEL:b.z.string().min(1),AUDIT_MODEL_ALLOWLIST:b.z.string().default("openai/gpt-5"),NEXT_PUBLIC_APP_URL:b.z.string().default("http://localhost:3000"),UPLOAD_MAX_BYTES:b.z.coerce.number().int().positive().default(0x1900000),UPLOAD_MAX_FILES:b.z.coerce.number().int().positive().default(300),RETENTION_DAYS:b.z.coerce.number().int().positive().default(90)});function g(a){return a.split(",").map(a=>a.trim()).filter(Boolean)}a.s(["auditFindingSchema",0,e,"envConfigSchema",0,f,"parseModelAllowlist",()=>g],65719),a.i(28528),b.z.object({projectId:b.z.string().uuid(),revisionId:b.z.string().uuid(),uploadId:b.z.string().uuid(),requestedByUserId:b.z.string().min(1)}),b.z.object({projectId:b.z.string().uuid(),revisionId:b.z.string().uuid(),auditRunId:b.z.string().uuid(),includeDocsFallbackFetch:b.z.boolean().default(!0)}),b.z.object({projectId:b.z.string().uuid(),revisionId:b.z.string().uuid(),auditRunId:b.z.string().uuid(),includeDocsFallbackFetch:b.z.boolean().default(!0)}),b.z.object({projectId:b.z.string().uuid(),auditRunId:b.z.string().uuid(),previousAuditRunId:b.z.string().uuid().nullable()}),b.z.object({projectId:b.z.string().uuid(),auditRunId:b.z.string().uuid(),requestedByUserId:b.z.string().min(1)}),b.z.object({seedSitemapUrl:b.z.string().url()}),b.z.object({sourceId:b.z.string().uuid()}),b.z.object({dryRun:b.z.boolean().optional()}),b.z.object({auditId:b.z.string().uuid(),projectId:b.z.string().uuid(),revisionId:b.z.string().uuid(),generatedAt:b.z.string(),model:b.z.object({primary:b.z.string().min(1),fallback:b.z.string().min(1)}),summary:b.z.object({overview:b.z.string().min(1),methodology:b.z.string().min(1),scope:b.z.array(b.z.string()).min(1),severityTotals:b.z.record(b.z.string(),b.z.number().int().nonnegative())}),findings:b.z.array(e),appendix:b.z.object({references:b.z.array(b.z.string().url()),verificationNotes:b.z.array(b.z.string())})}),a.i(66680),a.i(50227),a.s([],46622)},46089,a=>{"use strict";var b=a.i(10933);class c{static [b.entityKind]="ConsoleLogWriter";write(a){console.log(a)}}class d{static [b.entityKind]="DefaultLogger";writer;constructor(a){this.writer=a?.writer??new c}logQuery(a,b){let c=b.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),d=c.length?` -- params: [${c.join(", ")}]`:"";this.writer.write(`Query: ${a}${d}`)}}class e{static [b.entityKind]="NoopLogger";logQuery(){}}a.s(["DefaultLogger",()=>d,"NoopLogger",()=>e])},45087,a=>{"use strict";var b=a.i(38632),c=a.i(51179),d=a.i(10933),e=a.i(70177),f=a.i(50472),g=a.i(97006),h=a.i(62181);class i{constructor(a,c,d){this.sourceTable=a,this.referencedTable=c,this.relationName=d,this.referencedTableName=c[b.Table.Symbol.Name]}static [d.entityKind]="Relation";referencedTableName;fieldName}class j{constructor(a,b){this.table=a,this.config=b}static [d.entityKind]="Relations"}class k extends i{constructor(a,b,c,d){super(a,b,c?.relationName),this.config=c,this.isNullable=d}static [d.entityKind]="One";withFieldName(a){let b=new k(this.sourceTable,this.referencedTable,this.config,this.isNullable);return b.fieldName=a,b}}class l extends i{constructor(a,b,c){super(a,b,c?.relationName),this.config=c}static [d.entityKind]="Many";withFieldName(a){let b=new l(this.sourceTable,this.referencedTable,this.config);return b.fieldName=a,b}}function m(){return{and:f.and,between:f.between,eq:f.eq,exists:f.exists,gt:f.gt,gte:f.gte,ilike:f.ilike,inArray:f.inArray,isNull:f.isNull,isNotNull:f.isNotNull,like:f.like,lt:f.lt,lte:f.lte,ne:f.ne,not:f.not,notBetween:f.notBetween,notExists:f.notExists,notLike:f.notLike,notIlike:f.notIlike,notInArray:f.notInArray,or:f.or,sql:h.sql}}function n(){return{sql:h.sql,asc:g.asc,desc:g.desc}}function o(a,c){1===Object.keys(a).length&&"default"in a&&!(0,d.is)(a.default,b.Table)&&(a=a.default);let f={},g={},h={};for(let[i,k]of Object.entries(a))if((0,d.is)(k,b.Table)){let a=(0,b.getTableUniqueName)(k),c=g[a];for(let d of(f[a]=i,h[i]={tsName:i,dbName:k[b.Table.Symbol.Name],schema:k[b.Table.Symbol.Schema],columns:k[b.Table.Symbol.Columns],relations:c?.relations??{},primaryKey:c?.primaryKey??[]},Object.values(k[b.Table.Symbol.Columns])))d.primary&&h[i].primaryKey.push(d);let j=k[b.Table.Symbol.ExtraConfigBuilder]?.(k[b.Table.Symbol.ExtraConfigColumns]);if(j)for(let a of Object.values(j))(0,d.is)(a,e.PrimaryKeyBuilder)&&h[i].primaryKey.push(...a.columns)}else if((0,d.is)(k,j)){let a,d=(0,b.getTableUniqueName)(k.table),e=f[d];for(let[b,f]of Object.entries(k.config(c(k.table))))if(e){let c=h[e];c.relations[b]=f,a&&c.primaryKey.push(...a)}else d in g||(g[d]={relations:{},primaryKey:a}),g[d].relations[b]=f}return{tables:h,tableNamesMap:f}}function p(a,c,e){if((0,d.is)(e,k)&&e.config)return{fields:e.config.fields,references:e.config.references};let f=c[(0,b.getTableUniqueName)(e.referencedTable)];if(!f)throw Error(`Table "${e.referencedTable[b.Table.Symbol.Name]}" not found in schema`);let g=a[f];if(!g)throw Error(`Table "${f}" not found in schema`);let h=e.sourceTable,i=c[(0,b.getTableUniqueName)(h)];if(!i)throw Error(`Table "${h[b.Table.Symbol.Name]}" not found in schema`);let j=[];for(let a of Object.values(g.relations))(e.relationName&&e!==a&&a.relationName===e.relationName||!e.relationName&&a.referencedTable===e.sourceTable)&&j.push(a);if(j.length>1)throw e.relationName?Error(`There are multiple relations with name "${e.relationName}" in table "${f}"`):Error(`There are multiple relations between "${f}" and "${e.sourceTable[b.Table.Symbol.Name]}". Please specify relation name`);if(j[0]&&(0,d.is)(j[0],k)&&j[0].config)return{fields:j[0].config.references,references:j[0].config.fields};throw Error(`There is not enough information to infer relation "${i}.${e.fieldName}"`)}function q(a){return{one:function(b,c){return new k(a,b,c,c?.fields.reduce((a,b)=>a&&b.notNull,!0)??!1)},many:function(b,c){return new l(a,b,c)}}}a.s(["Many",()=>l,"One",()=>k,"createTableRelationsHelpers",()=>q,"extractTablesRelationalConfig",()=>o,"getOperators",()=>m,"getOrderByOperators",()=>n,"mapRelationalRow",()=>function a(b,e,f,g,i=a=>a){let j={};for(let[l,m]of g.entries())if(m.isJson){let c=e.relations[m.tsKey],g=f[l],h="string"==typeof g?JSON.parse(g):g;j[m.tsKey]=(0,d.is)(c,k)?h&&a(b,b[m.relationTableTsKey],h,m.selection,i):h.map(c=>a(b,b[m.relationTableTsKey],c,m.selection,i))}else{let a,b=i(f[l]),e=m.field;a=(0,d.is)(e,c.Column)?e:(0,d.is)(e,h.SQL)?e.decoder:e.sql.decoder,j[m.tsKey]=null===b?null:a.mapFromDriverValue(b)}return j},"normalizeRelation",()=>p])},49925,10060,59284,92747,a=>{"use strict";var b=a.i(51179),c=a.i(10933),d=a.i(62181),e=a.i(38632),f=a.i(72980);class g{constructor(a){this.table=a}static [c.entityKind]="ColumnAliasProxyHandler";get(a,b){return"table"===b?this.table:a[b]}}class h{constructor(a,b){this.alias=a,this.replaceOriginalName=b}static [c.entityKind]="TableAliasProxyHandler";get(a,d){if(d===e.Table.Symbol.IsAlias)return!0;if(d===e.Table.Symbol.Name||this.replaceOriginalName&&d===e.Table.Symbol.OriginalName)return this.alias;if(d===f.ViewBaseConfig)return{...a[f.ViewBaseConfig],name:this.alias,isAlias:!0};if(d===e.Table.Symbol.Columns){let b=a[e.Table.Symbol.Columns];if(!b)return b;let c={};return Object.keys(b).map(d=>{c[d]=new Proxy(b[d],new g(new Proxy(a,this)))}),c}let h=a[d];return(0,c.is)(h,b.Column)?new Proxy(h,new g(new Proxy(a,this))):h}}class i{constructor(a){this.alias=a}static [c.entityKind]="RelationTableAliasProxyHandler";get(a,b){return"sourceTable"===b?j(a.sourceTable,this.alias):a[b]}}function j(a,b){return new Proxy(a,new h(b,!1))}function k(a,b){return new Proxy(a,new g(new Proxy(a.table,new h(b,!1))))}function l(a,b){return new d.SQL.Aliased(m(a.sql,b),a.fieldAlias)}function m(a,e){return d.sql.join(a.queryChunks.map(a=>(0,c.is)(a,b.Column)?k(a,e):(0,c.is)(a,d.SQL)?m(a,e):(0,c.is)(a,d.SQL.Aliased)?l(a,e):a))}function n(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(a=>a.toLowerCase()).join("_")}function o(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((a,b,c)=>a+(0===c?b.toLowerCase():`${b[0].toUpperCase()}${b.slice(1)}`),"")}function p(a){return a}a.s(["ColumnAliasProxyHandler",()=>g,"TableAliasProxyHandler",()=>h,"aliasedTable",()=>j,"aliasedTableColumn",()=>k,"mapColumnsInAliasedSQLToAlias",()=>l,"mapColumnsInSQLToAlias",()=>m],49925);class q{static [c.entityKind]="CasingCache";cache={};cachedTables={};convert;constructor(a){this.convert="snake_case"===a?n:"camelCase"===a?o:p}getColumnCasing(a){if(!a.keyAsName)return a.name;let b=a.table[e.Table.Symbol.Schema]??"public",c=a.table[e.Table.Symbol.OriginalName],d=`${b}.${c}.${a.name}`;return this.cache[d]||this.cacheTable(a.table),this.cache[d]}cacheTable(a){let b=a[e.Table.Symbol.Schema]??"public",c=a[e.Table.Symbol.OriginalName],d=`${b}.${c}`;if(!this.cachedTables[d]){for(let b of Object.values(a[e.Table.Symbol.Columns])){let a=`${d}.${b.name}`;this.cache[a]=this.convert(b.name)}this.cachedTables[d]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class r extends Error{static [c.entityKind]="DrizzleError";constructor({message:a,cause:b}){super(a),this.name="DrizzleError",this.cause=b}}class s extends Error{constructor(a,b,c){super(`Failed query: ${a}
params: ${b}`),this.query=a,this.params=b,this.cause=c,Error.captureStackTrace(this,s),c&&(this.cause=c)}}class t extends r{static [c.entityKind]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}a.s(["DrizzleError",()=>r,"DrizzleQueryError",()=>s,"TransactionRollbackError",()=>t],10060);var u=a.i(49840),v=a.i(83326),w=a.i(85564),x=a.i(2915),y=a.i(43078),z=a.i(42635),A=a.i(49322),B=a.i(86519),C=a.i(49798),D=a.i(45087),E=a.i(50472),F=a.i(38103),G=a.i(67387),H=d;class I extends H.View{static [c.entityKind]="PgViewBase"}a.s(["PgViewBase",()=>I],59284);class J{static [c.entityKind]="PgDialect";casing;constructor(a){this.casing=new q(a?.casing)}async migrate(a,b,c){let e="string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",f="string"==typeof c?"drizzle":c.migrationsSchema??"drizzle",g=d.sql`
			CREATE TABLE IF NOT EXISTS ${d.sql.identifier(f)}.${d.sql.identifier(e)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await b.execute(d.sql`CREATE SCHEMA IF NOT EXISTS ${d.sql.identifier(f)}`),await b.execute(g);let h=(await b.all(d.sql`select id, hash, created_at from ${d.sql.identifier(f)}.${d.sql.identifier(e)} order by created_at desc limit 1`))[0];await b.transaction(async b=>{for await(let c of a)if(!h||Number(h.created_at)<c.folderMillis){for(let a of c.sql)await b.execute(d.sql.raw(a));await b.execute(d.sql`insert into ${d.sql.identifier(f)}.${d.sql.identifier(e)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(a){return`"${a}"`}escapeParam(a){return`$${a+1}`}escapeString(a){return`'${a.replace(/'/g,"''")}'`}buildWithCTE(a){if(!a?.length)return;let b=[d.sql`with `];for(let[c,e]of a.entries())b.push(d.sql`${d.sql.identifier(e._.alias)} as (${e._.sql})`),c<a.length-1&&b.push(d.sql`, `);return b.push(d.sql` `),d.sql.join(b)}buildDeleteQuery({table:a,where:b,returning:c,withList:e}){let f=this.buildWithCTE(e),g=c?d.sql` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,h=b?d.sql` where ${b}`:void 0;return d.sql`${f}delete from ${a}${h}${g}`}buildUpdateSet(a,b){let f=a[e.Table.Symbol.Columns],g=Object.keys(f).filter(a=>void 0!==b[a]||f[a]?.onUpdateFn!==void 0),h=g.length;return d.sql.join(g.flatMap((a,e)=>{let g=f[a],i=g.onUpdateFn?.(),j=b[a]??((0,c.is)(i,d.SQL)?i:d.sql.param(i,g)),k=d.sql`${d.sql.identifier(this.casing.getColumnCasing(g))} = ${j}`;return e<h-1?[k,d.sql.raw(", ")]:[k]}))}buildUpdateQuery({table:a,set:b,where:c,returning:e,withList:f,from:g,joins:h}){let i=this.buildWithCTE(f),j=a[C.PgTable.Symbol.Name],k=a[C.PgTable.Symbol.Schema],l=a[C.PgTable.Symbol.OriginalName],m=j===l?void 0:j,n=d.sql`${k?d.sql`${d.sql.identifier(k)}.`:void 0}${d.sql.identifier(l)}${m&&d.sql` ${d.sql.identifier(m)}`}`,o=this.buildUpdateSet(a,b),p=g&&d.sql.join([d.sql.raw(" from "),this.buildFromTable(g)]),q=this.buildJoins(h),r=e?d.sql` returning ${this.buildSelection(e,{isSingleTable:!g})}`:void 0,s=c?d.sql` where ${c}`:void 0;return d.sql`${i}update ${n} set ${o}${p}${q}${s}${r}`}buildSelection(a,{isSingleTable:e=!1}={}){let f=a.length,g=a.flatMap(({field:a},g)=>{let h=[];if((0,c.is)(a,d.SQL.Aliased)&&a.isSelectionField)h.push(d.sql.identifier(a.fieldAlias));else if((0,c.is)(a,d.SQL.Aliased)||(0,c.is)(a,d.SQL)){let b=(0,c.is)(a,d.SQL.Aliased)?a.sql:a;e?h.push(new d.SQL(b.queryChunks.map(a=>(0,c.is)(a,u.PgColumn)?d.sql.identifier(this.casing.getColumnCasing(a)):a))):h.push(b),(0,c.is)(a,d.SQL.Aliased)&&h.push(d.sql` as ${d.sql.identifier(a.fieldAlias)}`)}else if((0,c.is)(a,b.Column))e?h.push(d.sql.identifier(this.casing.getColumnCasing(a))):h.push(a);else if((0,c.is)(a,F.Subquery)){let e=Object.entries(a._.selectedFields);if(1===e.length){let f=e[0][1],g=(0,c.is)(f,d.SQL)?f.decoder:(0,c.is)(f,b.Column)?{mapFromDriverValue:a=>f.mapFromDriverValue(a)}:f.sql.decoder;g&&(a._.sql.decoder=g)}h.push(a)}return g<f-1&&h.push(d.sql`, `),h});return d.sql.join(g)}buildJoins(a){if(!a||0===a.length)return;let b=[];for(let[e,g]of a.entries()){0===e&&b.push(d.sql` `);let h=g.table,i=g.lateral?d.sql` lateral`:void 0,j=g.on?d.sql` on ${g.on}`:void 0;if((0,c.is)(h,C.PgTable)){let a=h[C.PgTable.Symbol.Name],c=h[C.PgTable.Symbol.Schema],e=h[C.PgTable.Symbol.OriginalName],f=a===e?void 0:g.alias;b.push(d.sql`${d.sql.raw(g.joinType)} join${i} ${c?d.sql`${d.sql.identifier(c)}.`:void 0}${d.sql.identifier(e)}${f&&d.sql` ${d.sql.identifier(f)}`}${j}`)}else if((0,c.is)(h,d.View)){let a=h[f.ViewBaseConfig].name,c=h[f.ViewBaseConfig].schema,e=h[f.ViewBaseConfig].originalName,k=a===e?void 0:g.alias;b.push(d.sql`${d.sql.raw(g.joinType)} join${i} ${c?d.sql`${d.sql.identifier(c)}.`:void 0}${d.sql.identifier(e)}${k&&d.sql` ${d.sql.identifier(k)}`}${j}`)}else b.push(d.sql`${d.sql.raw(g.joinType)} join${i} ${h}${j}`);e<a.length-1&&b.push(d.sql` `)}return d.sql.join(b)}buildFromTable(a){if((0,c.is)(a,e.Table)&&a[e.Table.Symbol.IsAlias]){let b=d.sql`${d.sql.identifier(a[e.Table.Symbol.OriginalName])}`;return a[e.Table.Symbol.Schema]&&(b=d.sql`${d.sql.identifier(a[e.Table.Symbol.Schema])}.${b}`),d.sql`${b} ${d.sql.identifier(a[e.Table.Symbol.Name])}`}return a}buildSelectQuery({withList:a,fields:g,fieldsFlat:h,where:i,having:j,table:k,joins:l,orderBy:m,groupBy:n,limit:o,offset:p,lockingClause:q,distinct:r,setOperators:s}){let t,u,v,w=h??(0,G.orderSelectedFields)(g);for(let a of w){let g;if((0,c.is)(a.field,b.Column)&&(0,e.getTableName)(a.field.table)!==((0,c.is)(k,F.Subquery)?k._.alias:(0,c.is)(k,I)?k[f.ViewBaseConfig].name:(0,c.is)(k,d.SQL)?void 0:(0,e.getTableName)(k))&&(g=a.field.table,!l?.some(({alias:a})=>a===(g[e.Table.Symbol.IsAlias]?(0,e.getTableName)(g):g[e.Table.Symbol.BaseName])))){let b=(0,e.getTableName)(a.field.table);throw Error(`Your "${a.path.join("->")}" field references a column "${b}"."${a.field.name}", but the table "${b}" is not part of the query! Did you forget to join it?`)}}let x=!l||0===l.length,y=this.buildWithCTE(a);r&&(t=!0===r?d.sql` distinct`:d.sql` distinct on (${d.sql.join(r.on,d.sql`, `)})`);let z=this.buildSelection(w,{isSingleTable:x}),A=this.buildFromTable(k),B=this.buildJoins(l),C=i?d.sql` where ${i}`:void 0,D=j?d.sql` having ${j}`:void 0;m&&m.length>0&&(u=d.sql` order by ${d.sql.join(m,d.sql`, `)}`),n&&n.length>0&&(v=d.sql` group by ${d.sql.join(n,d.sql`, `)}`);let E="object"==typeof o||"number"==typeof o&&o>=0?d.sql` limit ${o}`:void 0,H=p?d.sql` offset ${p}`:void 0,J=d.sql.empty();if(q){let a=d.sql` for ${d.sql.raw(q.strength)}`;q.config.of&&a.append(d.sql` of ${d.sql.join(Array.isArray(q.config.of)?q.config.of:[q.config.of],d.sql`, `)}`),q.config.noWait?a.append(d.sql` nowait`):q.config.skipLocked&&a.append(d.sql` skip locked`),J.append(a)}let K=d.sql`${y}select${t} ${z} from ${A}${B}${C}${v}${D}${u}${E}${H}${J}`;return s.length>0?this.buildSetOperations(K,s):K}buildSetOperations(a,b){let[c,...d]=b;if(!c)throw Error("Cannot pass undefined values to any set operator");return 0===d.length?this.buildSetOperationQuery({leftSelect:a,setOperator:c}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:a,setOperator:c}),d)}buildSetOperationQuery({leftSelect:a,setOperator:{type:b,isAll:e,rightSelect:f,limit:g,orderBy:h,offset:i}}){let j,k=d.sql`(${a.getSQL()}) `,l=d.sql`(${f.getSQL()})`;if(h&&h.length>0){let a=[];for(let b of h)if((0,c.is)(b,u.PgColumn))a.push(d.sql.identifier(b.name));else if((0,c.is)(b,d.SQL)){for(let a=0;a<b.queryChunks.length;a++){let e=b.queryChunks[a];(0,c.is)(e,u.PgColumn)&&(b.queryChunks[a]=d.sql.identifier(e.name))}a.push(d.sql`${b}`)}else a.push(d.sql`${b}`);j=d.sql` order by ${d.sql.join(a,d.sql`, `)} `}let m="object"==typeof g||"number"==typeof g&&g>=0?d.sql` limit ${g}`:void 0,n=d.sql.raw(`${b} ${e?"all ":""}`),o=i?d.sql` offset ${i}`:void 0;return d.sql`${k}${n}${l}${j}${m}${o}`}buildInsertQuery({table:a,values:b,onConflict:f,returning:g,withList:h,select:i,overridingSystemValue_:j}){let k=[],l=Object.entries(a[e.Table.Symbol.Columns]).filter(([a,b])=>!b.shouldDisableInsert()),m=l.map(([,a])=>d.sql.identifier(this.casing.getColumnCasing(a)));if(i)(0,c.is)(b,d.SQL)?k.push(b):k.push(b.getSQL());else for(let[a,e]of(k.push(d.sql.raw("values ")),b.entries())){let f=[];for(let[a,b]of l){let g=e[a];if(void 0===g||(0,c.is)(g,d.Param)&&void 0===g.value)if(void 0!==b.defaultFn){let a=b.defaultFn(),e=(0,c.is)(a,d.SQL)?a:d.sql.param(a,b);f.push(e)}else if(b.default||void 0===b.onUpdateFn)f.push(d.sql`default`);else{let a=b.onUpdateFn(),e=(0,c.is)(a,d.SQL)?a:d.sql.param(a,b);f.push(e)}else f.push(g)}k.push(f),a<b.length-1&&k.push(d.sql`, `)}let n=this.buildWithCTE(h),o=d.sql.join(k),p=g?d.sql` returning ${this.buildSelection(g,{isSingleTable:!0})}`:void 0,q=f?d.sql` on conflict ${f}`:void 0,r=!0===j?d.sql`overriding system value `:void 0;return d.sql`${n}insert into ${a} ${m} ${r}${o}${q}${p}`}buildRefreshMaterializedViewQuery({view:a,concurrently:b,withNoData:c}){let e=b?d.sql` concurrently`:void 0,f=c?d.sql` with no data`:void 0;return d.sql`refresh materialized view${e} ${a}${f}`}prepareTyping(a){if((0,c.is)(a,x.PgJsonb)||(0,c.is)(a,w.PgJson))return"json";if((0,c.is)(a,y.PgNumeric))return"decimal";if((0,c.is)(a,z.PgTime))return"time";if((0,c.is)(a,A.PgTimestamp)||(0,c.is)(a,A.PgTimestampString))return"timestamp";if((0,c.is)(a,v.PgDate)||(0,c.is)(a,v.PgDateString))return"date";else if((0,c.is)(a,B.PgUUID))return"uuid";else return"none"}sqlToQuery(a,b){return a.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:b})}buildRelationalQueryWithoutPK({fullSchema:a,schema:f,tableNamesMap:g,table:h,tableConfig:i,queryConfig:n,tableAlias:o,nestedQueryRelation:p,joinOn:q}){let s,t=[],u,v,w=[],x,y=[];if(!0===n)t=Object.entries(i.columns).map(([a,b])=>({dbKey:b.name,tsKey:a,field:k(b,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let h=Object.fromEntries(Object.entries(i.columns).map(([a,b])=>[a,k(b,o)]));if(n.where){let a="function"==typeof n.where?n.where(h,(0,D.getOperators)()):n.where;x=a&&m(a,o)}let j=[],p=[];if(n.columns){let a=!1;for(let[b,c]of Object.entries(n.columns))void 0!==c&&b in i.columns&&(a||!0!==c||(a=!0),p.push(b));p.length>0&&(p=a?p.filter(a=>n.columns?.[a]===!0):Object.keys(i.columns).filter(a=>!p.includes(a)))}else p=Object.keys(i.columns);for(let a of p){let b=i.columns[a];j.push({tsKey:a,value:b})}let q=[];if(n.with&&(q=Object.entries(n.with).filter(a=>!!a[1]).map(([a,b])=>({tsKey:a,queryConfig:b,relation:i.relations[a]}))),n.extras)for(let[a,b]of Object.entries("function"==typeof n.extras?n.extras(h,{sql:d.sql}):n.extras))j.push({tsKey:a,value:l(b,o)});for(let{tsKey:a,value:e}of j)t.push({dbKey:(0,c.is)(e,d.SQL.Aliased)?e.fieldAlias:i.columns[a].name,tsKey:a,field:(0,c.is)(e,b.Column)?k(e,o):e,relationTableTsKey:void 0,isJson:!1,selection:[]});let r="function"==typeof n.orderBy?n.orderBy(h,(0,D.getOrderByOperators)()):n.orderBy??[];for(let{tsKey:h,queryConfig:i,relation:j}of(Array.isArray(r)||(r=[r]),w=r.map(a=>(0,c.is)(a,b.Column)?k(a,o):m(a,o)),u=n.limit,v=n.offset,q)){let b=(0,D.normalizeRelation)(f,g,j),l=g[(0,e.getTableUniqueName)(j.referencedTable)],m=`${o}_${h}`,n=(0,E.and)(...b.fields.map((a,c)=>(0,E.eq)(k(b.references[c],m),k(a,o)))),p=this.buildRelationalQueryWithoutPK({fullSchema:a,schema:f,tableNamesMap:g,table:a[l],tableConfig:f[l],queryConfig:(0,c.is)(j,D.One)?!0===i?{limit:1}:{...i,limit:1}:i,tableAlias:m,joinOn:n,nestedQueryRelation:j}),q=d.sql`${d.sql.identifier(m)}.${d.sql.identifier("data")}`.as(h);y.push({on:d.sql`true`,table:new F.Subquery(p.sql,{},m),alias:m,joinType:"left",lateral:!0}),t.push({dbKey:h,tsKey:h,field:q,relationTableTsKey:l,isJson:!0,selection:p.selection})}}if(0===t.length)throw new r({message:`No fields selected for table "${i.tsName}" ("${o}")`});if(x=(0,E.and)(q,x),p){let a=d.sql`json_build_array(${d.sql.join(t.map(({field:a,tsKey:b,isJson:e})=>e?d.sql`${d.sql.identifier(`${o}_${b}`)}.${d.sql.identifier("data")}`:(0,c.is)(a,d.SQL.Aliased)?a.sql:a),d.sql`, `)})`;(0,c.is)(p,D.Many)&&(a=d.sql`coalesce(json_agg(${a}${w.length>0?d.sql` order by ${d.sql.join(w,d.sql`, `)}`:void 0}), '[]'::json)`);let e=[{dbKey:"data",tsKey:"data",field:a.as("data"),isJson:!0,relationTableTsKey:i.tsName,selection:t}];void 0!==u||void 0!==v||w.length>0?(s=this.buildSelectQuery({table:j(h,o),fields:{},fieldsFlat:[{path:[],field:d.sql.raw("*")}],where:x,limit:u,offset:v,orderBy:w,setOperators:[]}),x=void 0,u=void 0,v=void 0,w=[]):s=j(h,o),s=this.buildSelectQuery({table:(0,c.is)(s,C.PgTable)?s:new F.Subquery(s,{},o),fields:{},fieldsFlat:e.map(({field:a})=>({path:[],field:(0,c.is)(a,b.Column)?k(a,o):a})),joins:y,where:x,limit:u,offset:v,orderBy:w,setOperators:[]})}else s=this.buildSelectQuery({table:j(h,o),fields:{},fieldsFlat:t.map(({field:a})=>({path:[],field:(0,c.is)(a,b.Column)?k(a,o):a})),joins:y,where:x,limit:u,offset:v,orderBy:w,setOperators:[]});return{tableTsKey:i.tsName,sql:s,selection:t}}}a.s(["PgDialect",()=>J],92747)},4632,a=>{"use strict";var b=a.i(10933);class c{static [b.entityKind]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}then(a,b){return this.execute().then(a,b)}}var d=a.i(49925),e=a.i(51179),f=a.i(62181),g=a.i(38103),h=a.i(72980);class i{static [b.entityKind]="SelectionProxyHandler";config;constructor(a){this.config={...a}}get(a,c){if("_"===c)return{...a._,selectedFields:new Proxy(a._.selectedFields,this)};if(c===h.ViewBaseConfig)return{...a[h.ViewBaseConfig],selectedFields:new Proxy(a[h.ViewBaseConfig].selectedFields,this)};if("symbol"==typeof c)return a[c];let j=((0,b.is)(a,g.Subquery)?a._.selectedFields:(0,b.is)(a,f.View)?a[h.ViewBaseConfig].selectedFields:a)[c];if((0,b.is)(j,f.SQL.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!j.isSelectionField)return j.sql;let a=j.clone();return a.isSelectionField=!0,a}if((0,b.is)(j,f.SQL)){if("sql"===this.config.sqlBehavior)return j;throw Error(`You tried to reference "${c}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return(0,b.is)(j,e.Column)?this.config.alias?new Proxy(j,new d.ColumnAliasProxyHandler(new Proxy(j.table,new d.TableAliasProxyHandler(this.config.alias,this.config.replaceOriginalName??!1)))):j:"object"!=typeof j||null===j?j:new Proxy(j,new i(this.config))}}var j=a.i(38632),k=a.i(89735),l=a.i(67387),m=a.i(49798);class n{constructor(a,b){this.name=a,this.value=b}static [b.entityKind]="PgCheckBuilder";brand;build(a){return new o(a,this)}}class o{constructor(a,b){this.table=a,this.name=b.name,this.value=b.value}static [b.entityKind]="PgCheck";name;value}a.i(37002),a.i(17645);class p{constructor(a,b){this.name=a,b&&(this.as=b.as,this.for=b.for,this.to=b.to,this.using=b.using,this.withCheck=b.withCheck)}static [b.entityKind]="PgPolicy";as;for;to;using;withCheck;_linkedTable;link(a){return this._linkedTable=a,this}}a.i(70177),a.i(69914);let q=Symbol.for("drizzle:PgViewConfig");var r=a.i(92747),s=a.i(59284);class t{static [b.entityKind]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class u{static [b.entityKind]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(a){this.fields=a.fields,this.session=a.session,this.dialect=a.dialect,a.withList&&(this.withList=a.withList),this.distinct=a.distinct}authToken;setToken(a){return this.authToken=a,this}from(a){let c,d=!!this.fields;return c=this.fields?this.fields:(0,b.is)(a,g.Subquery)?Object.fromEntries(Object.keys(a._.selectedFields).map(b=>[b,a[b]])):(0,b.is)(a,s.PgViewBase)?a[h.ViewBaseConfig].selectedFields:(0,b.is)(a,f.SQL)?{}:(0,l.getTableColumns)(a),new w({table:a,fields:c,isPartialSelect:d,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}}class v extends t{static [b.entityKind]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:a,fields:b,isPartialSelect:c,session:d,dialect:e,withList:f,distinct:g}){for(const h of(super(),this.config={withList:f,table:a,fields:{...b},distinct:g,setOperators:[]},this.isPartialSelect=c,this.session=d,this.dialect=e,this._={selectedFields:b,config:this.config},this.tableName=(0,l.getTableLikeName)(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},Q(a)))this.usedTables.add(h)}getUsedTables(){return[...this.usedTables]}createJoin(a,c){return(d,e)=>{let k=this.tableName,m=(0,l.getTableLikeName)(d);for(let a of Q(d))this.usedTables.add(a);if("string"==typeof m&&this.config.joins?.some(a=>a.alias===m))throw Error(`Alias "${m}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof k&&(this.config.fields={[k]:this.config.fields}),"string"==typeof m&&!(0,b.is)(d,f.SQL))){let a=(0,b.is)(d,g.Subquery)?d._.selectedFields:(0,b.is)(d,f.View)?d[h.ViewBaseConfig].selectedFields:d[j.Table.Symbol.Columns];this.config.fields[m]=a}if("function"==typeof e&&(e=e(new Proxy(this.config.fields,new i({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:e,table:d,joinType:a,alias:m,lateral:c}),"string"==typeof m)switch(a){case"left":this.joinsNotNullableMap[m]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[m]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[m]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[m]=!1}return this}}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(a,b){return c=>{let d="function"==typeof c?c(y()):c;if(!(0,l.haveSameKeys)(this.getSelectedFields(),d.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:a,isAll:b,rightSelect:d}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(a){return this.config.setOperators.push(...a),this}where(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new i({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=a,this}having(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new i({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=a,this}groupBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new i({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(b)?b:[b]}else this.config.groupBy=a;return this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new i({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=c:this.config.orderBy=c}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=a:this.config.orderBy=a;return this}limit(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=a:this.config.limit=a,this}offset(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=a:this.config.offset=a,this}for(a,b={}){return this.config.lockingClause={strength:a,config:b},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}as(a){let b=[];if(b.push(...Q(this.config.table)),this.config.joins)for(let a of this.config.joins)b.push(...Q(a.table));return new Proxy(new g.Subquery(this.getSQL(),this.config.fields,a,!1,[...new Set(b)]),new i({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new i({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(a){return this.cacheConfig=void 0===a?{config:{},enable:!0,autoInvalidate:!0}:!1===a?{enable:!1}:{enable:!0,autoInvalidate:!0,...a},this}}class w extends v{static [b.entityKind]="PgSelect";_prepare(a){let{session:b,config:c,dialect:d,joinsNotNullableMap:e,authToken:f,cacheConfig:g,usedTables:h}=this;if(!b)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let{fields:i}=c;return k.tracer.startActiveSpan("drizzle.prepareQuery",()=>{let c=(0,l.orderSelectedFields)(i),j=b.prepareQuery(d.sqlToQuery(this.getSQL()),c,a,!0,void 0,{type:"select",tables:[...h]},g);return j.joinsNotNullableMap=e,j.setToken(f)})}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>k.tracer.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken))}function x(a,b){return(c,d,...e)=>{let f=[d,...e].map(c=>({type:a,isAll:b,rightSelect:c}));for(let a of f)if(!(0,l.haveSameKeys)(c.getSelectedFields(),a.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return c.addSetOperators(f)}}(0,l.applyMixins)(w,[c]);let y=()=>({union:z,unionAll:A,intersect:B,intersectAll:C,except:D,exceptAll:E}),z=x("union",!1),A=x("union",!0),B=x("intersect",!1),C=x("intersect",!0),D=x("except",!1),E=x("except",!0);class F{static [b.entityKind]="PgQueryBuilder";dialect;dialectConfig;constructor(a){this.dialect=(0,b.is)(a,r.PgDialect)?a:void 0,this.dialectConfig=(0,b.is)(a,r.PgDialect)?void 0:a}$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(c)),new Proxy(new g.WithSubquery(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new i({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...a){let b=this;return{select:function(c){return new u({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a})},selectDistinct:function(a){return new u({fields:a??void 0,session:void 0,dialect:b.getDialect(),distinct:!0})},selectDistinctOn:function(a,c){return new u({fields:c??void 0,session:void 0,dialect:b.getDialect(),distinct:{on:a}})}}}select(a){return new u({fields:a??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(a){return new u({fields:a??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(a,b){return new u({fields:b??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:a}})}getDialect(){return this.dialect||(this.dialect=new r.PgDialect(this.dialectConfig)),this.dialect}}var G=s;class H{constructor(a,b){this.name=a,this.schema=b}static [b.entityKind]="PgDefaultViewBuilderCore";config={};with(a){return this.config.with=a,this}}class I extends H{static [b.entityKind]="PgViewBuilder";as(a){"function"==typeof a&&(a=a(new F));let b=new i({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),c=new Proxy(a.getSelectedFields(),b);return new Proxy(new N({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:c,query:a.getSQL().inlineParams()}}),b)}}class J extends H{static [b.entityKind]="PgManualViewBuilder";columns;constructor(a,b,c){super(a,c),this.columns=(0,l.getTableColumns)((0,m.pgTable)(a,b))}existing(){return new Proxy(new N({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new i({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(a){return new Proxy(new N({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:a.inlineParams()}}),new i({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class K{constructor(a,b){this.name=a,this.schema=b}static [b.entityKind]="PgMaterializedViewBuilderCore";config={};using(a){return this.config.using=a,this}with(a){return this.config.with=a,this}tablespace(a){return this.config.tablespace=a,this}withNoData(){return this.config.withNoData=!0,this}}class L extends K{static [b.entityKind]="PgMaterializedViewBuilder";as(a){"function"==typeof a&&(a=a(new F));let b=new i({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),c=new Proxy(a.getSelectedFields(),b);return new Proxy(new P({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:c,query:a.getSQL().inlineParams()}}),b)}}class M extends K{static [b.entityKind]="PgManualMaterializedViewBuilder";columns;constructor(a,b,c){super(a,c),this.columns=(0,l.getTableColumns)((0,m.pgTable)(a,b))}existing(){return new Proxy(new P({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new i({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(a){return new Proxy(new P({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:a.inlineParams()}}),new i({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class N extends G.PgViewBase{static [b.entityKind]="PgView";[q];constructor({pgConfig:a,config:b}){super(b),a&&(this[q]={with:a.with})}}let O=Symbol.for("drizzle:PgMaterializedViewConfig");class P extends G.PgViewBase{static [b.entityKind]="PgMaterializedView";[O];constructor({pgConfig:a,config:b}){super(b),this[O]={with:a?.with,using:a?.using,tablespace:a?.tablespace,withNoData:a?.withNoData}}}function Q(a){return(0,b.is)(a,m.PgTable)?[a[j.Schema]?`${a[j.Schema]}.${a[j.Table.Symbol.BaseName]}`:a[j.Table.Symbol.BaseName]]:(0,b.is)(a,g.Subquery)?a._.usedTables??[]:(0,b.is)(a,f.SQL)?a.usedTables??[]:[]}class R extends c{constructor(a,b,c,d){super(),this.session=b,this.dialect=c,this.config={table:a,withList:d}}static [b.entityKind]="PgDelete";config;cacheConfig;where(a){return this.config.where=a,this}returning(a=this.config.table[j.Table.Symbol.Columns]){return this.config.returningFields=a,this.config.returning=(0,l.orderSelectedFields)(a),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return k.tracer.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"delete",tables:Q(this.config.table)},this.cacheConfig))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>k.tracer.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new i({alias:(0,j.getTableName)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class S{constructor(a,b,c,d,e){this.table=a,this.session=b,this.dialect=c,this.withList=d,this.overridingSystemValue_=e}static [b.entityKind]="PgInsertBuilder";authToken;setToken(a){return this.authToken=a,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(a){if(0===(a=Array.isArray(a)?a:[a]).length)throw Error("values() must be called with at least one value");let c=a.map(a=>{let c={},d=this.table[j.Table.Symbol.Columns];for(let e of Object.keys(a)){let g=a[e];c[e]=(0,b.is)(g,f.SQL)?g:new f.Param(g,d[e])}return c});return new T(this.table,c,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(a){let c="function"==typeof a?a(new F):a;if(!(0,b.is)(c,f.SQL)&&!(0,l.haveSameKeys)(this.table[j.Columns],c._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new T(this.table,c,this.session,this.dialect,this.withList,!0)}}class T extends c{constructor(a,b,c,d,e,f,g){super(),this.session=c,this.dialect=d,this.config={table:a,values:b,withList:e,select:f,overridingSystemValue_:g}}static [b.entityKind]="PgInsert";config;cacheConfig;returning(a=this.config.table[j.Table.Symbol.Columns]){return this.config.returningFields=a,this.config.returning=(0,l.orderSelectedFields)(a),this}onConflictDoNothing(a={}){if(void 0===a.target)this.config.onConflict=f.sql`do nothing`;else{let b="";b=Array.isArray(a.target)?a.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(a.target));let c=a.where?f.sql` where ${a.where}`:void 0;this.config.onConflict=f.sql`(${f.sql.raw(b)})${c} do nothing`}return this}onConflictDoUpdate(a){if(a.where&&(a.targetWhere||a.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let b=a.where?f.sql` where ${a.where}`:void 0,c=a.targetWhere?f.sql` where ${a.targetWhere}`:void 0,d=a.setWhere?f.sql` where ${a.setWhere}`:void 0,e=this.dialect.buildUpdateSet(this.config.table,(0,l.mapUpdateSet)(this.config.table,a.set)),g="";return g=Array.isArray(a.target)?a.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(a.target)),this.config.onConflict=f.sql`(${f.sql.raw(g)})${c} do update set ${e}${b}${d}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return k.tracer.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"insert",tables:Q(this.config.table)},this.cacheConfig))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>k.tracer.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new i({alias:(0,j.getTableName)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class U{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [b.entityKind]="PgUpdateBuilder";authToken;setToken(a){return this.authToken=a,this}set(a){return new V(this.table,(0,l.mapUpdateSet)(this.table,a),this.session,this.dialect,this.withList).setToken(this.authToken)}}class V extends c{constructor(a,b,c,d,e){super(),this.session=c,this.dialect=d,this.config={set:b,table:a,withList:e,joins:[]},this.tableName=(0,l.getTableLikeName)(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}static [b.entityKind]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(a){let b=(0,l.getTableLikeName)(a);return"string"==typeof b&&(this.joinsNotNullableMap[b]=!0),this.config.from=a,this}getTableLikeFields(a){return(0,b.is)(a,m.PgTable)?a[j.Table.Symbol.Columns]:(0,b.is)(a,g.Subquery)?a._.selectedFields:a[h.ViewBaseConfig].selectedFields}createJoin(a){return(c,d)=>{let e=(0,l.getTableLikeName)(c);if("string"==typeof e&&this.config.joins.some(a=>a.alias===e))throw Error(`Alias "${e}" is already used in this query`);if("function"==typeof d){let a=this.config.from&&!(0,b.is)(this.config.from,f.SQL)?this.getTableLikeFields(this.config.from):void 0;d=d(new Proxy(this.config.table[j.Table.Symbol.Columns],new i({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new i({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:d,table:c,joinType:a,alias:e}),"string"==typeof e)switch(a){case"left":this.joinsNotNullableMap[e]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[e]=!0;break;case"inner":this.joinsNotNullableMap[e]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[e]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(a){return this.config.where=a,this}returning(a){if(!a&&(a=Object.assign({},this.config.table[j.Table.Symbol.Columns]),this.config.from)){let c=(0,l.getTableLikeName)(this.config.from);if("string"==typeof c&&this.config.from&&!(0,b.is)(this.config.from,f.SQL)){let b=this.getTableLikeFields(this.config.from);a[c]=b}for(let c of this.config.joins){let d=(0,l.getTableLikeName)(c.table);if("string"==typeof d&&!(0,b.is)(c.table,f.SQL)){let b=this.getTableLikeFields(c.table);a[d]=b}}}return this.config.returningFields=a,this.config.returning=(0,l.orderSelectedFields)(a),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){let b=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"insert",tables:Q(this.config.table)},this.cacheConfig);return b.joinsNotNullableMap=this.joinsNotNullableMap,b}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>this._prepare().execute(a,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new i({alias:(0,j.getTableName)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}var W=f;class X extends W.SQL{constructor(a){super(X.buildEmbeddedCount(a.source,a.filters).queryChunks),this.params=a,this.mapWith(Number),this.session=a.session,this.sql=X.buildCount(a.source,a.filters)}sql;token;static [b.entityKind]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(a,b){return W.sql`(select count(*) from ${a}${W.sql.raw(" where ").if(b)}${b})`}static buildCount(a,b){return W.sql`select count(*) as count from ${a}${W.sql.raw(" where ").if(b)}${b};`}setToken(a){return this.token=a,this}then(a,b){return Promise.resolve(this.session.count(this.sql,this.token)).then(a,b)}catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}}var Y=a.i(45087);class Z{constructor(a,b,c,d,e,f,g){this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g}static [b.entityKind]="PgRelationalQueryBuilder";findMany(a){return new $(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many")}findFirst(a){return new $(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first")}}class $ extends c{constructor(a,b,c,d,e,f,g,h,i){super(),this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g,this.config=h,this.mode=i}static [b.entityKind]="PgRelationalQuery";_prepare(a){return k.tracer.startActiveSpan("drizzle.prepareQuery",()=>{let{query:b,builtQuery:c}=this._toSQL();return this.session.prepareQuery(c,void 0,a,!0,(a,c)=>{let d=a.map(a=>(0,Y.mapRelationalRow)(this.schema,this.tableConfig,a,b.selection,c));return"first"===this.mode?d[0]:d})})}prepare(a){return this._prepare(a)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let a=this._getQuery(),b=this.dialect.sqlToQuery(a.sql);return{query:a,builtQuery:b}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(a){return this.authToken=a,this}execute(){return k.tracer.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}}class _ extends c{constructor(a,b,c,d){super(),this.execute=a,this.sql=b,this.query=c,this.mapBatchResult=d}static [b.entityKind]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(a,b){return b?this.mapBatchResult(a):a}_prepare(){return this}isResponseInArrayMode(){return!1}}class aa extends c{constructor(a,b,c){super(),this.session=b,this.dialect=c,this.config={view:a}}static [b.entityKind]="PgRefreshMaterializedView";config;concurrently(){if(void 0!==this.config.withNoData)throw Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return k.tracer.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,a,!0))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>k.tracer.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken))}class ab{constructor(a,b,c){if(this.dialect=a,this.session=b,this._=c?{schema:c.schema,fullSchema:c.fullSchema,tableNamesMap:c.tableNamesMap,session:b}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:b},this.query={},this._.schema)for(const[d,e]of Object.entries(this._.schema))this.query[d]=new Z(c.fullSchema,this._.schema,this._.tableNamesMap,c.fullSchema[d],e,a,b);this.$cache={invalidate:async a=>{}}}static [b.entityKind]="PgDatabase";query;$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(new F(c.dialect))),new Proxy(new g.WithSubquery(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new i({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(a,b){return new X({source:a,filters:b,session:this.session})}$cache;with(...a){let b=this;return{select:function(c){return new u({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a})},selectDistinct:function(c){return new u({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:!0})},selectDistinctOn:function(c,d){return new u({fields:d??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:{on:c}})},update:function(c){return new U(c,b.session,b.dialect,a)},insert:function(c){return new S(c,b.session,b.dialect,a)},delete:function(c){return new R(c,b.session,b.dialect,a)}}}select(a){return new u({fields:a??void 0,session:this.session,dialect:this.dialect})}selectDistinct(a){return new u({fields:a??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(a,b){return new u({fields:b??void 0,session:this.session,dialect:this.dialect,distinct:{on:a}})}update(a){return new U(a,this.session,this.dialect)}insert(a){return new S(a,this.session,this.dialect)}delete(a){return new R(a,this.session,this.dialect)}refreshMaterializedView(a){return new aa(a,this.session,this.dialect)}authToken;execute(a){let b="string"==typeof a?f.sql.raw(a):a.getSQL(),c=this.dialect.sqlToQuery(b),d=this.session.prepareQuery(c,void 0,void 0,!1);return new _(()=>d.execute(void 0,this.authToken),b,c,a=>d.mapResult(a,!0))}transaction(a,b){return this.session.transaction(a,b)}}a.s(["PgDatabase",()=>ab],4632)},5919,a=>{"use strict";var b=a.i(10933);class c{static [b.entityKind]="Cache"}class d extends c{strategy(){return"all"}static [b.entityKind]="NoopCache";async get(a){}async put(a,b,c,d){}async onMutate(a){}}async function e(a,b){let c=`${a}-${JSON.stringify(b)}`,d=new TextEncoder().encode(c);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",d))].map(a=>a.toString(16).padStart(2,"0")).join("")}a.s(["NoopCache",()=>d,"hashQuery",()=>e])},69964,a=>{"use strict";var b=a.i(5919),c=a.i(10933),d=a.i(10060),e=a.i(62181),f=a.i(89735),g=a.i(4632);class h{constructor(a,b,c,d){this.query=a,this.cache=b,this.queryMetadata=c,this.cacheConfig=d,b&&"all"===b.strategy()&&void 0===d&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(a,b){return a}setToken(a){return this.authToken=a,this}static [c.entityKind]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(a,e,f){if(void 0===this.cache||(0,c.is)(this.cache,b.NoopCache)||void 0===this.queryMetadata||this.cacheConfig&&!this.cacheConfig.enable)try{return await f()}catch(b){throw new d.DrizzleQueryError(a,e,b)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[a]=await Promise.all([f(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return a}catch(b){throw new d.DrizzleQueryError(a,e,b)}if(!this.cacheConfig)try{return await f()}catch(b){throw new d.DrizzleQueryError(a,e,b)}if("select"===this.queryMetadata.type){let c=await this.cache.get(this.cacheConfig.tag??await (0,b.hashQuery)(a,e),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===c){let c;try{c=await f()}catch(b){throw new d.DrizzleQueryError(a,e,b)}return await this.cache.put(this.cacheConfig.tag??await (0,b.hashQuery)(a,e),c,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),c}return c}try{return await f()}catch(b){throw new d.DrizzleQueryError(a,e,b)}}}class i{constructor(a){this.dialect=a}static [c.entityKind]="PgSession";execute(a,b){return f.tracer.startActiveSpan("drizzle.operation",()=>f.tracer.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(a),void 0,void 0,!1)).setToken(b).execute(void 0,b))}all(a){return this.prepareQuery(this.dialect.sqlToQuery(a),void 0,void 0,!1).all()}async count(a,b){return Number((await this.execute(a,b))[0].count)}}class j extends g.PgDatabase{constructor(a,b,c,d=0){super(a,b,c),this.schema=c,this.nestedIndex=d}static [c.entityKind]="PgTransaction";rollback(){throw new d.TransactionRollbackError}getTransactionConfigSQL(a){let b=[];return a.isolationLevel&&b.push(`isolation level ${a.isolationLevel}`),a.accessMode&&b.push(a.accessMode),"boolean"==typeof a.deferrable&&b.push(a.deferrable?"deferrable":"not deferrable"),e.sql.raw(b.join(" "))}setTransaction(a){return this.session.execute(e.sql`set transaction ${this.getTransactionConfigSQL(a)}`)}}a.s(["PgPreparedQuery",()=>h,"PgSession",()=>i,"PgTransaction",()=>j])},62826,a=>a.a(async(b,c)=>{try{var d=a.i(41759),e=a.i(5919),f=a.i(10933),g=a.i(46089),h=a.i(69964),i=a.i(62181),j=a.i(89735),k=a.i(67387),l=b([d]);[d]=l.then?(await l)():l;let{Pool:m,types:n}=d.default;class o extends h.PgPreparedQuery{constructor(a,b,c,d,e,f,g,h,i,j,k){super({sql:b,params:c},e,f,g),this.client=a,this.queryString=b,this.params=c,this.logger=d,this.fields=h,this._isResponseInArrayMode=j,this.customResultMapper=k,this.rawQueryConfig={name:i,text:b,types:{getTypeParser:(a,b)=>a===n.builtins.TIMESTAMPTZ||a===n.builtins.TIMESTAMP||a===n.builtins.DATE||a===n.builtins.INTERVAL||1231===a||1115===a||1185===a||1187===a||1182===a?a=>a:n.getTypeParser(a,b)}},this.queryConfig={name:i,text:b,rowMode:"array",types:{getTypeParser:(a,b)=>a===n.builtins.TIMESTAMPTZ||a===n.builtins.TIMESTAMP||a===n.builtins.DATE||a===n.builtins.INTERVAL||1231===a||1115===a||1185===a||1187===a||1182===a?a=>a:n.getTypeParser(a,b)}}}static [f.entityKind]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(a={}){return j.tracer.startActiveSpan("drizzle.execute",async()=>{let b=(0,i.fillPlaceholders)(this.params,a);this.logger.logQuery(this.rawQueryConfig.text,b);let{fields:c,rawQueryConfig:d,client:e,queryConfig:f,joinsNotNullableMap:g,customResultMapper:h}=this;if(!c&&!h)return j.tracer.startActiveSpan("drizzle.driver.execute",async a=>(a?.setAttributes({"drizzle.query.name":d.name,"drizzle.query.text":d.text,"drizzle.query.params":JSON.stringify(b)}),this.queryWithCache(d.text,b,async()=>await e.query(d,b))));let l=await j.tracer.startActiveSpan("drizzle.driver.execute",a=>(a?.setAttributes({"drizzle.query.name":f.name,"drizzle.query.text":f.text,"drizzle.query.params":JSON.stringify(b)}),this.queryWithCache(f.text,b,async()=>await e.query(f,b))));return j.tracer.startActiveSpan("drizzle.mapResponse",()=>h?h(l.rows):l.rows.map(a=>(0,k.mapResultRow)(c,a,g)))})}all(a={}){return j.tracer.startActiveSpan("drizzle.execute",()=>{let b=(0,i.fillPlaceholders)(this.params,a);return this.logger.logQuery(this.rawQueryConfig.text,b),j.tracer.startActiveSpan("drizzle.driver.execute",a=>(a?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(b)}),this.queryWithCache(this.rawQueryConfig.text,b,async()=>this.client.query(this.rawQueryConfig,b)).then(a=>a.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}}class p extends h.PgSession{constructor(a,b,c,d={}){super(b),this.client=a,this.schema=c,this.options=d,this.logger=d.logger??new g.NoopLogger,this.cache=d.cache??new e.NoopCache}static [f.entityKind]="NodePgSession";logger;cache;prepareQuery(a,b,c,d,e,f,g){return new o(this.client,a.sql,a.params,this.logger,this.cache,f,g,b,c,d,e)}async transaction(a,b){let c=this.client instanceof m||Object.getPrototypeOf(this.client).constructor.name.includes("Pool"),d=c?new p(await this.client.connect(),this.dialect,this.schema,this.options):this,e=new q(this.dialect,d,this.schema);await e.execute(i.sql`begin${b?i.sql` ${e.getTransactionConfigSQL(b)}`:void 0}`);try{let b=await a(e);return await e.execute(i.sql`commit`),b}catch(a){throw await e.execute(i.sql`rollback`),a}finally{c&&d.client.release()}}async count(a){let b=await this.execute(a);return Number(b.rows[0].count)}}class q extends h.PgTransaction{static [f.entityKind]="NodePgTransaction";async transaction(a){let b=`sp${this.nestedIndex+1}`,c=new q(this.dialect,this.session,this.schema,this.nestedIndex+1);await c.execute(i.sql.raw(`savepoint ${b}`));try{let d=await a(c);return await c.execute(i.sql.raw(`release savepoint ${b}`)),d}catch(a){throw await c.execute(i.sql.raw(`rollback to savepoint ${b}`)),a}}}a.s(["NodePgSession",()=>p]),c()}catch(a){c(a)}},!1),75025,a=>a.a(async(b,c)=>{try{var d=a.i(41759),e=a.i(10933),f=a.i(46089),g=a.i(4632),h=a.i(92747),i=a.i(45087),j=a.i(67387),k=a.i(62826),l=b([d,k]);[d,k]=l.then?(await l)():l;class o{constructor(a,b,c={}){this.client=a,this.dialect=b,this.options=c}static [e.entityKind]="NodePgDriver";createSession(a){return new k.NodePgSession(this.client,this.dialect,a,{logger:this.options.logger,cache:this.options.cache})}}class p extends g.PgDatabase{static [e.entityKind]="NodePgDatabase"}function m(a,b={}){let c,d,e=new h.PgDialect({casing:b.casing});if(!0===b.logger?c=new f.DefaultLogger:!1!==b.logger&&(c=b.logger),b.schema){let a=(0,i.extractTablesRelationalConfig)(b.schema,i.createTableRelationsHelpers);d={fullSchema:b.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let g=new o(a,e,{logger:c,cache:b.cache}).createSession(d),j=new p(e,g,d);return j.$client=a,j.$cache=b.cache,j.$cache&&(j.$cache.invalidate=b.cache?.onMutate),j}function n(...a){if("string"==typeof a[0]){let b=new d.default.Pool({connectionString:a[0]});return m(b,a[1])}if((0,j.isConfig)(a[0])){let{connection:b,client:c,...e}=a[0];if(c)return m(c,e);let f=new d.default.Pool("string"==typeof b?{connectionString:b}:b);return m(f,e)}return m(a[0],a[1])}(n||(n={})).mock=function(a){return m({},a)},a.s(["drizzle",()=>n]),c()}catch(a){c(a)}},!1),3817,a=>{"use strict";a.i(46622);var b=a.i(65719);let c=b.envConfigSchema.safeParse(process.env);if(!c.success){let a=c.error.issues.map(a=>`${a.path.join(".")}: ${a.message}`).join("; ");throw Error(`Invalid environment configuration: ${a}`)}let d={...c.data,AUDIT_MODEL_ALLOWLIST:(0,b.parseModelAllowlist)(c.data.AUDIT_MODEL_ALLOWLIST)};a.s(["env",0,d])},97034,a=>a.a(async(b,c)=>{try{var d=a.i(75025),e=a.i(41759);a.i(46622);var f=a.i(28528),g=a.i(3817),h=b([d,e]);[d,e]=h.then?(await h)():h;let i=globalThis,j=i.pool??new e.Pool({connectionString:g.env.DATABASE_URL});"production"!==g.env.NODE_ENV&&(i.pool=j);let k=(0,d.drizzle)(j,{schema:f.dbSchema});a.s(["db",0,k]),c()}catch(a){c(a)}},!1),30778,31390,76340,35708,45199,14083,42420,81205,7116,55367,81549,19473,10203,54813,37207,95984,39461,53593,71324,58478,76221,39619,11675,14687,59393,18065,34084,23493,52060,32949,76230,18828,78799,46946,56967,46429,4551,62192,a=>{"use strict";let b,c,d,e,f=(0,a.i(60573).createRandomStringGenerator)("a-z","0-9","A-Z","-_");function g(a,b=""){if(!Number.isSafeInteger(a)||a<0){let c=b&&`"${b}" `;throw Error(`${c}expected integer >= 0, got ${a}`)}}function h(a,b,c=""){let d=a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name,e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function i(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash must wrapped by utils.createHasher");g(a.outputLen),g(a.blockLen)}function j(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function k(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function l(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function m(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function n(a,b){return a<<32-b|a>>>b}function o(a,b){return a<<b|a>>>32-b>>>0}a.s(["generateRandomString",()=>f],30778);let p=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]?a=>a:function(a){for(let c=0;c<a.length;c++){var b;a[c]=(b=a[c])<<24&0xff000000|b<<8&0xff0000|b>>>8&65280|b>>>24&255}return a},q="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex;function r(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}let s=async()=>{};async function t(a,b,c){let d=Date.now();for(let e=0;e<a;e++){c(e);let a=Date.now()-d;a>=0&&a<b||(await s(),d+=a)}}function u(a,b=""){if("string"==typeof a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}return h(a,void 0,b)}function v(a,b){if(void 0!==b&&"[object Object]"!==({}).toString.call(b))throw Error("options must be object or undefined");return Object.assign(a,b)}class w{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(a,b){if(i(a),h(b,void 0,"key"),this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const c=this.blockLen,d=new Uint8Array(c);d.set(b.length>c?a.create().update(b).digest():b);for(let a=0;a<d.length;a++)d[a]^=54;this.iHash.update(d),this.oHash=a.create();for(let a=0;a<d.length;a++)d[a]^=106;this.oHash.update(d),l(d)}update(a){return j(this),this.iHash.update(a),this}digestInto(a){j(this),h(a,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||=Object.create(Object.getPrototypeOf(this),{});let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let x=(a,b,c)=>new w(a,b).update(c).digest();x.create=(a,b)=>new w(a,b);let y=Uint8Array.of(0),z=Uint8Array.of(),A=(a,b,c,d,e)=>{var f;return function(a,b,c,d=32){i(a),g(d,"length");let e=a.outputLen;if(d>255*e)throw Error("Length must be <= 255*HashLen");let f=Math.ceil(d/e);void 0===c?c=z:h(c,void 0,"info");let j=new Uint8Array(f*e),k=x.create(a,b),m=k._cloneInto(),n=new Uint8Array(k.outputLen);for(let a=0;a<f;a++)y[0]=a+1,m.update(0===a?z:n).update(c).update(y).digestInto(n),j.set(n,e*a),k._cloneInto(m);return k.destroy(),m.destroy(),l(n,y),j.slice(0,d)}(a,(f=c,i(a),void 0===f&&(f=new Uint8Array(a.outputLen)),x(a,f,b)),d,e)};class B{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(a,b,c,d){this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=m(this.buffer)}update(a){j(this),h(a);let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=m(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){j(this);h(a,void 0,"digestInto() output");let b=this.outputLen;if(a.length<b)throw Error('"digestInto() output" expected to be of length >='+b);this.finished=!0;let{buffer:c,view:d,blockLen:e,isLE:f}=this,{pos:g}=this;c[g++]=128,l(this.buffer.subarray(g)),this.padOffset>e-g&&(this.process(d,0),g=0);for(let a=g;a<e;a++)c[a]=0;d.setBigUint64(e-8,BigInt(8*this.length),f),this.process(d,0);let i=m(a),k=this.outputLen;if(k%4)throw Error("_sha2: outputLen must be aligned to 32bit");let n=k/4,o=this.get();if(n>o.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<n;a++)i.setUint32(4*a,o[a],f)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){(a||=new this.constructor).set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let C=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),D=Uint32Array.from([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]),E=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),F=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),G=BigInt(0x100000000-1),H=BigInt(32),I=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),J=new Uint32Array(64);class K extends B{constructor(a){super(64,a,8,!1)}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)J[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=J[a-15],c=J[a-2],d=n(b,7)^n(b,18)^b>>>3,e=n(c,17)^n(c,19)^c>>>10;J[a]=e+J[a-7]+d+J[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,o;let b=j+(n(g,6)^n(g,11)^n(g,25))+((k=g)&h^~k&i)+I[a]+J[a]|0,p=(n(c,2)^n(c,13)^n(c,22))+((l=c)&(m=d)^l&(o=e)^m&o)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+p|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){l(J)}destroy(){this.set(0,0,0,0,0,0,0,0),l(this.buffer)}}class L extends K{A=0|C[0];B=0|C[1];C=0|C[2];D=0|C[3];E=0|C[4];F=0|C[5];G=0|C[6];H=0|C[7];constructor(){super(32)}}let M=function(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=function(a,b=!1){return b?{h:Number(a&G),l:Number(a>>H&G)}:{h:0|Number(a>>H&G),l:0|Number(a&G)}}(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),N=M[0],O=M[1],P=new Uint32Array(80),Q=new Uint32Array(80);let R=function(a,b={}){let c=(b,c)=>a(c).update(b).digest(),d=a(void 0);return c.outputLen=d.outputLen,c.blockLen=d.blockLen,c.create=b=>a(b),Object.assign(c,b),Object.freeze(c)}(()=>new L,{oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,1])}),S=new TextEncoder,T=new TextDecoder;function U(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;for(let d of a)b.set(d,c),c+=d.length;return b}function V(a,b,c){if(b<0||b>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${b}`);a.set([b>>>24,b>>>16,b>>>8,255&b],c)}function W(a){let b=Math.floor(a/0x100000000),c=new Uint8Array(8);return V(c,b,0),V(c,a%0x100000000,4),c}function X(a){let b=new Uint8Array(4);return V(b,a),b}function Y(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++){let d=a.charCodeAt(c);if(d>127)throw TypeError("non-ASCII string encountered in encode()");b[c]=d}return b}function Z(a){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof a?a:T.decode(a),{alphabet:"base64url"});let b=a;b instanceof Uint8Array&&(b=T.decode(b)),b=b.replace(/-/g,"+").replace(/_/g,"/");try{var c=b;if(Uint8Array.fromBase64)return Uint8Array.fromBase64(c);let a=atob(c),d=new Uint8Array(a.length);for(let b=0;b<a.length;b++)d[b]=a.charCodeAt(b);return d}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function $(a){let b=a;return("string"==typeof b&&(b=S.encode(b)),Uint8Array.prototype.toBase64)?b.toBase64({alphabet:"base64url",omitPadding:!0}):(function(a){if(Uint8Array.prototype.toBase64)return a.toBase64();let b=[];for(let c=0;c<a.length;c+=32768)b.push(String.fromCharCode.apply(null,a.subarray(c,c+32768)));return btoa(b.join(""))})(b).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}a.s(["concat",()=>U,"decoder",0,T,"encode",()=>Y,"encoder",0,S,"uint32be",()=>X,"uint64be",()=>W],31390),a.s(["decode",()=>Z,"encode",()=>$],76340);let _=Symbol();class aa extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(a,b){super(a,b),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class ab extends aa{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class ac extends aa{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class ad extends aa{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class ae extends aa{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class af extends aa{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(a="decryption operation failed",b){super(a,b)}}class ag extends aa{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class ah extends aa{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class ai extends aa{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class aj extends aa{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class ak extends aa{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class al extends aa{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(a="no applicable key found in the JSON Web Key Set",b){super(a,b)}}class am extends aa{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(a="multiple matching keys found in the JSON Web Key Set",b){super(a,b)}}class an extends aa{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(a="request timed out",b){super(a,b)}}class ao extends aa{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(a="signature verification failed",b){super(a,b)}}function ap(a){switch(a){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new ae(`Unsupported JWE Algorithm: ${a}`)}}function aq(a,b){if(b.length<<3!==ap(a))throw new ag("Invalid Initialization Vector length")}function ar(a,b){let c=a.byteLength<<3;if(c!==b)throw new ag(`Invalid Content Encryption Key length. Expected ${b} bits, got ${c} bits`)}a.s(["JOSEAlgNotAllowed",()=>ad,"JOSEError",()=>aa,"JOSENotSupported",()=>ae,"JWEDecryptionFailed",()=>af,"JWEInvalid",()=>ag,"JWKInvalid",()=>aj,"JWKSInvalid",()=>ak,"JWKSMultipleMatchingKeys",()=>am,"JWKSNoMatchingKey",()=>al,"JWKSTimeout",()=>an,"JWSInvalid",()=>ah,"JWSSignatureVerificationFailed",()=>ao,"JWTClaimValidationFailed",()=>ab,"JWTExpired",()=>ac,"JWTInvalid",()=>ai],35708);let as=(a,b="algorithm.name")=>TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`);function at(a){return parseInt(a.name.slice(4),10)}function au(a,b){if(b&&!a.usages.includes(b))throw TypeError(`CryptoKey does not support this operation, its usages must include ${b}.`)}function av(a,b,c){switch(b){case"A128GCM":case"A192GCM":case"A256GCM":{if("AES-GCM"!==a.algorithm.name)throw as("AES-GCM");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw as(c,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if("AES-KW"!==a.algorithm.name)throw as("AES-KW");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw as(c,"algorithm.length");break}case"ECDH":switch(a.algorithm.name){case"ECDH":case"X25519":break;default:throw as("ECDH or X25519")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if("PBKDF2"!==a.algorithm.name)throw as("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if("RSA-OAEP"!==a.algorithm.name)throw as("RSA-OAEP");let c=parseInt(b.slice(9),10)||1;if(at(a.algorithm.hash)!==c)throw as(`SHA-${c}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}au(a,c)}function aw(a,b,...c){if((c=c.filter(Boolean)).length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor?.name&&(a+=` Received an instance of ${b.constructor.name}`),a}let ax=(a,...b)=>aw("Key must be ",a,...b),ay=(a,b,...c)=>aw(`Key for the ${a} algorithm must be `,b,...c);function az(a){if(!aA(a))throw Error("CryptoKey instance expected")}let aA=a=>{if(a?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return a instanceof CryptoKey}catch{return!1}},aB=a=>a?.[Symbol.toStringTag]==="KeyObject",aC=a=>aA(a)||aB(a);async function aD(a,b,c,d,e){if(!(c instanceof Uint8Array))throw TypeError(ax(c,"Uint8Array"));let f=parseInt(a.slice(1,4),10),g=await crypto.subtle.importKey("raw",c.subarray(f>>3),"AES-CBC",!1,["encrypt"]),h=await crypto.subtle.importKey("raw",c.subarray(0,f>>3),{hash:`SHA-${f<<1}`,name:"HMAC"},!1,["sign"]),i=new Uint8Array(await crypto.subtle.encrypt({iv:d,name:"AES-CBC"},g,b)),j=U(e,d,i,W(e.length<<3));return{ciphertext:i,tag:new Uint8Array((await crypto.subtle.sign("HMAC",h,j)).slice(0,f>>3)),iv:d}}async function aE(a,b,c,d,e){let f;c instanceof Uint8Array?f=await crypto.subtle.importKey("raw",c,"AES-GCM",!1,["encrypt"]):(av(c,a,"encrypt"),f=c);let g=new Uint8Array(await crypto.subtle.encrypt({additionalData:e,iv:d,name:"AES-GCM",tagLength:128},f,b)),h=g.slice(-16);return{ciphertext:g.slice(0,-16),tag:h,iv:d}}async function aF(a,b,c,d,e){if(!aA(c)&&!(c instanceof Uint8Array))throw TypeError(ax(c,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(d)aq(a,d);else d=crypto.getRandomValues(new Uint8Array(ap(a)>>3));switch(a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return c instanceof Uint8Array&&ar(c,parseInt(a.slice(-3),10)),aD(a,b,c,d,e);case"A128GCM":case"A192GCM":case"A256GCM":return c instanceof Uint8Array&&ar(c,parseInt(a.slice(1,4),10)),aE(a,b,c,d,e);default:throw new ae("Unsupported JWE Content Encryption Algorithm")}}function aG(a,b){if(a.algorithm.length!==parseInt(b.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${b}`)}function aH(a,b,c){return a instanceof Uint8Array?crypto.subtle.importKey("raw",a,"AES-KW",!0,[c]):(av(a,b,c),a)}async function aI(a,b,c){let d=await aH(b,a,"wrapKey");aG(d,a);let e=await crypto.subtle.importKey("raw",c,{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.wrapKey("raw",e,d,"AES-KW"))}async function aJ(a,b,c){let d=await aH(b,a,"unwrapKey");aG(d,a);let e=await crypto.subtle.unwrapKey("raw",c,d,"AES-KW",{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.exportKey("raw",e))}async function aK(a,b){let c=`SHA-${a.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(c,b))}function aL(a){return U(X(a.length),a)}async function aM(a,b,c){let d=b>>3,e=Math.ceil(d/32),f=new Uint8Array(32*e);for(let b=1;b<=e;b++){let d=new Uint8Array(4+a.length+c.length);d.set(X(b),0),d.set(a,4),d.set(c,4+a.length);let e=await aK("sha256",d);f.set(e,(b-1)*32)}return f.slice(0,d)}async function aN(a,b,c,d,e=new Uint8Array,f=new Uint8Array){var g;av(a,"ECDH"),av(b,"ECDH","deriveBits");let h=U(aL(Y(c)),aL(e),aL(f),X(d),new Uint8Array);return aM(new Uint8Array(await crypto.subtle.deriveBits({name:a.algorithm.name,public:a},b,"X25519"===(g=a).algorithm.name?256:Math.ceil(parseInt(g.algorithm.namedCurve.slice(-3),10)/8)<<3)),d,h)}function aO(a){switch(a.algorithm.namedCurve){case"P-256":case"P-384":case"P-521":return!0;default:return"X25519"===a.algorithm.name}}async function aP(a,b,c,d){if(!(a instanceof Uint8Array)||a.length<8)throw new ag("PBES2 Salt Input must be 8 or more octets");let e=U(Y(b),Uint8Array.of(0),a),f=parseInt(b.slice(13,16),10),g={hash:`SHA-${b.slice(8,11)}`,iterations:c,name:"PBKDF2",salt:e},h=await (d instanceof Uint8Array?crypto.subtle.importKey("raw",d,"PBKDF2",!1,["deriveBits"]):(av(d,b,"deriveBits"),d));return new Uint8Array(await crypto.subtle.deriveBits(g,h,f))}async function aQ(a,b,c,d=2048,e=crypto.getRandomValues(new Uint8Array(16))){let f=await aP(e,a,d,b);return{encryptedKey:await aI(a.slice(-6),f,c),p2c:d,p2s:$(e)}}async function aR(a,b,c,d,e){let f=await aP(e,a,d,b);return aJ(a.slice(-6),f,c)}function aS(a,b){if(a.startsWith("RS")||a.startsWith("PS")){let{modulusLength:c}=b.algorithm;if("number"!=typeof c||c<2048)throw TypeError(`${a} requires key modulusLength to be 2048 bits or larger`)}}let aT=a=>{switch(a){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new ae(`alg ${a} is not supported either by JOSE or your javascript runtime`)}};async function aU(a,b,c){return av(b,a,"encrypt"),aS(a,b),new Uint8Array(await crypto.subtle.encrypt(aT(a),b,c))}async function aV(a,b,c){return av(b,a,"decrypt"),aS(a,b),new Uint8Array(await crypto.subtle.decrypt(aT(a),b,c))}function aW(a){if("object"!=typeof a||null===a||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}a.s(["isObject",()=>aW],45199);let aX=a=>aW(a)&&"string"==typeof a.kty;async function aY(a){if(!a.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:b,keyUsages:c}=function(a){let b,c;switch(a.kty){case"AKP":switch(a.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":b={name:a.alg},c=a.priv?["sign"]:["verify"];break;default:throw new ae('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(a.alg){case"PS256":case"PS384":case"PS512":b={name:"RSA-PSS",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":b={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":b={name:"RSA-OAEP",hash:`SHA-${parseInt(a.alg.slice(-3),10)||1}`},c=a.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new ae('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(a.alg){case"ES256":b={name:"ECDSA",namedCurve:"P-256"},c=a.d?["sign"]:["verify"];break;case"ES384":b={name:"ECDSA",namedCurve:"P-384"},c=a.d?["sign"]:["verify"];break;case"ES512":b={name:"ECDSA",namedCurve:"P-521"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:"ECDH",namedCurve:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new ae('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(a.alg){case"Ed25519":case"EdDSA":b={name:"Ed25519"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new ae('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new ae('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:b,keyUsages:c}}(a),d={...a};return"AKP"!==d.kty&&delete d.alg,delete d.use,crypto.subtle.importKey("jwk",d,b,a.ext??(!a.d&&!a.priv),a.key_ops??c)}let aZ=async(a,c,d,e=!1)=>{let f=(b||=new WeakMap).get(a);if(f?.[d])return f[d];let g=await aY({...c,alg:d});return e&&Object.freeze(a),f?f[d]=g:b.set(a,{[d]:g}),g};async function a$(a,c){if(a instanceof Uint8Array||aA(a))return a;if(aB(a)){if("secret"===a.type)return a.export();if("toCryptoKey"in a&&"function"==typeof a.toCryptoKey)try{return((a,c)=>{let d,e=(b||=new WeakMap).get(a);if(e?.[c])return e[c];let f="public"===a.type,g=!!f;if("x25519"===a.asymmetricKeyType){switch(c){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}d=a.toCryptoKey(a.asymmetricKeyType,g,f?[]:["deriveBits"])}if("ed25519"===a.asymmetricKeyType){if("EdDSA"!==c&&"Ed25519"!==c)throw TypeError("given KeyObject instance cannot be used for this algorithm");d=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}switch(a.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(c!==a.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");d=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}if("rsa"===a.asymmetricKeyType){let b;switch(c){case"RSA-OAEP":b="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":b="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":b="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":b="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(c.startsWith("RSA-OAEP"))return a.toCryptoKey({name:"RSA-OAEP",hash:b},g,f?["encrypt"]:["decrypt"]);d=a.toCryptoKey({name:c.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:b},g,[f?"verify":"sign"])}if("ec"===a.asymmetricKeyType){let b=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(a.asymmetricKeyDetails?.namedCurve);if(!b)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===c&&"P-256"===b&&(d=a.toCryptoKey({name:"ECDSA",namedCurve:b},g,[f?"verify":"sign"])),"ES384"===c&&"P-384"===b&&(d=a.toCryptoKey({name:"ECDSA",namedCurve:b},g,[f?"verify":"sign"])),"ES512"===c&&"P-521"===b&&(d=a.toCryptoKey({name:"ECDSA",namedCurve:b},g,[f?"verify":"sign"])),c.startsWith("ECDH-ES")&&(d=a.toCryptoKey({name:"ECDH",namedCurve:b},g,f?[]:["deriveBits"]))}if(!d)throw TypeError("given KeyObject instance cannot be used for this algorithm");return e?e[c]=d:b.set(a,{[c]:d}),d})(a,c)}catch(a){if(a instanceof TypeError)throw a}let d=a.export({format:"jwk"});return aZ(a,d,c)}if(aX(a))return a.k?Z(a.k):aZ(a,a,c,!0);throw Error("unreachable")}function a_(a){switch(a){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new ae(`Unsupported JWE Algorithm: ${a}`)}}let a0=a=>crypto.getRandomValues(new Uint8Array(a_(a)>>3));async function a1(a){if(aB(a))if("secret"!==a.type)return a.export({format:"jwk"});else a=a.export();if(a instanceof Uint8Array)return{kty:"oct",k:$(a)};if(!aA(a))throw TypeError(ax(a,"CryptoKey","KeyObject","Uint8Array"));if(!a.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:b,key_ops:c,alg:d,use:e,...f}=await crypto.subtle.exportKey("jwk",a);return"AKP"===f.kty&&(f.alg=d),f}async function a2(a){return a1(a)}async function a3(a,b){if(!(a instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(b instanceof Uint8Array))throw TypeError("Second argument must be a buffer");let c={name:"HMAC",hash:"SHA-256"},d=await crypto.subtle.generateKey(c,!1,["sign"]),e=new Uint8Array(await crypto.subtle.sign(c,d,a)),f=new Uint8Array(await crypto.subtle.sign(c,d,b)),g=0,h=-1;for(;++h<32;)g|=e[h]^f[h];return 0===g}async function a4(a,b,c,d,e,f){let g,h;if(!(b instanceof Uint8Array))throw TypeError(ax(b,"Uint8Array"));let i=parseInt(a.slice(1,4),10),j=await crypto.subtle.importKey("raw",b.subarray(i>>3),"AES-CBC",!1,["decrypt"]),k=await crypto.subtle.importKey("raw",b.subarray(0,i>>3),{hash:`SHA-${i<<1}`,name:"HMAC"},!1,["sign"]),l=U(f,d,c,W(f.length<<3)),m=new Uint8Array((await crypto.subtle.sign("HMAC",k,l)).slice(0,i>>3));try{g=await a3(e,m)}catch{}if(!g)throw new af;try{h=new Uint8Array(await crypto.subtle.decrypt({iv:d,name:"AES-CBC"},j,c))}catch{}if(!h)throw new af;return h}async function a5(a,b,c,d,e,f){let g;b instanceof Uint8Array?g=await crypto.subtle.importKey("raw",b,"AES-GCM",!1,["decrypt"]):(av(b,a,"decrypt"),g=b);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:f,iv:d,name:"AES-GCM",tagLength:128},g,U(c,e)))}catch{throw new af}}async function a6(a,b,c,d,e,f){if(!aA(b)&&!(b instanceof Uint8Array))throw TypeError(ax(b,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(!d)throw new ag("JWE Initialization Vector missing");if(!e)throw new ag("JWE Authentication Tag missing");switch(aq(a,d),a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return b instanceof Uint8Array&&ar(b,parseInt(a.slice(-3),10)),a4(a,b,c,d,e,f);case"A128GCM":case"A192GCM":case"A256GCM":return b instanceof Uint8Array&&ar(b,parseInt(a.slice(1,4),10)),a5(a,b,c,d,e,f);default:throw new ae("Unsupported JWE Content Encryption Algorithm")}}async function a7(a,b,c,d){let e=a.slice(0,7),f=await aF(e,c,b,d,new Uint8Array);return{encryptedKey:f.ciphertext,iv:$(f.iv),tag:$(f.tag)}}async function a8(a,b,c,d,e){return a6(a.slice(0,7),b,c,d,e,new Uint8Array)}async function a9(a,b,c,d,e={}){let f,g,h;switch(a){case"dir":h=c;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let i;if(az(c),!aO(c))throw new ae("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:j,apv:k}=e;i=e.epk?await a$(e.epk,a):(await crypto.subtle.generateKey(c.algorithm,!0,["deriveBits"])).privateKey;let{x:l,y:m,crv:n,kty:o}=await a2(i),p=await aN(c,i,"ECDH-ES"===a?b:a,"ECDH-ES"===a?a_(b):parseInt(a.slice(-5,-2),10),j,k);if(g={epk:{x:l,crv:n,kty:o}},"EC"===o&&(g.epk.y=m),j&&(g.apu=$(j)),k&&(g.apv=$(k)),"ECDH-ES"===a){h=p;break}h=d||a0(b);let q=a.slice(-6);f=await aI(q,p,h);break}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":h=d||a0(b),az(c),f=await aU(a,c,h);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{h=d||a0(b);let{p2c:i,p2s:j}=e;({encryptedKey:f,...g}=await aQ(a,c,h,i,j));break}case"A128KW":case"A192KW":case"A256KW":h=d||a0(b),f=await aI(a,c,h);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{h=d||a0(b);let{iv:i}=e;({encryptedKey:f,...g}=await a7(a,c,h,i));break}default:throw new ae('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:h,encryptedKey:f,parameters:g}}function ba(...a){let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0}function bb(a,b,c,d,e){let f;if(void 0!==e.crit&&d?.crit===void 0)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!d||void 0===d.crit)return new Set;if(!Array.isArray(d.crit)||0===d.crit.length||d.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let g of(f=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,d.crit)){if(!f.has(g))throw new ae(`Extension Header Parameter "${g}" is not recognized`);if(void 0===e[g])throw new a(`Extension Header Parameter "${g}" is missing`);if(f.get(g)&&void 0===d[g])throw new a(`Extension Header Parameter "${g}" MUST be integrity protected`)}return new Set(d.crit)}let bc=a=>a?.[Symbol.toStringTag],bd=(a,b,c)=>{if(void 0!==b.use){let a;switch(c){case"sign":case"verify":a="sig";break;case"encrypt":case"decrypt":a="enc"}if(b.use!==a)throw TypeError(`Invalid key for this operation, its "use" must be "${a}" when present`)}if(void 0!==b.alg&&b.alg!==a)throw TypeError(`Invalid key for this operation, its "alg" must be "${a}" when present`);if(Array.isArray(b.key_ops)){let d;switch(!0){case"sign"===c||"verify"===c:case"dir"===a:case a.includes("CBC-HS"):d=c;break;case a.startsWith("PBES2"):d="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(a):d=!a.includes("GCM")&&a.endsWith("KW")?"encrypt"===c?"wrapKey":"unwrapKey":c;break;case"encrypt"===c&&a.startsWith("RSA"):d="wrapKey";break;case"decrypt"===c:d=a.startsWith("RSA")?"unwrapKey":"deriveBits"}if(d&&b.key_ops?.includes?.(d)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${d}" when present`)}return!0};function be(a,b,c){switch(a.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((a,b,c)=>{if(!(b instanceof Uint8Array)){if(aX(b)){if("oct"===b.kty&&"string"==typeof b.k&&bd(a,b,c))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!aC(b))throw TypeError(ay(a,b,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==b.type)throw TypeError(`${bc(b)} instances for symmetric algorithms must be of type "secret"`)}})(a,b,c);break;default:((a,b,c)=>{if(aX(b))switch(c){case"decrypt":case"sign":if("oct"!==b.kty&&("AKP"===b.kty&&"string"==typeof b.priv||"string"==typeof b.d)&&bd(a,b,c))return;throw TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if("oct"!==b.kty&&void 0===b.d&&void 0===b.priv&&bd(a,b,c))return;throw TypeError("JSON Web Key for this operation must be a public JWK")}if(!aC(b))throw TypeError(ay(a,b,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===b.type)throw TypeError(`${bc(b)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===b.type)switch(c){case"sign":throw TypeError(`${bc(b)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${bc(b)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===b.type)switch(c){case"verify":throw TypeError(`${bc(b)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${bc(b)} instances for asymmetric algorithm encryption must be of type "public"`)}})(a,b,c)}}class bf{#a;#b;#c;#d;#e;#f;#g;#h;constructor(a){if(!(a instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this.#a=a}setKeyManagementParameters(a){if(this.#h)throw TypeError("setKeyManagementParameters can only be called once");return this.#h=a,this}setProtectedHeader(a){if(this.#b)throw TypeError("setProtectedHeader can only be called once");return this.#b=a,this}setSharedUnprotectedHeader(a){if(this.#c)throw TypeError("setSharedUnprotectedHeader can only be called once");return this.#c=a,this}setUnprotectedHeader(a){if(this.#d)throw TypeError("setUnprotectedHeader can only be called once");return this.#d=a,this}setAdditionalAuthenticatedData(a){return this.#e=a,this}setContentEncryptionKey(a){if(this.#f)throw TypeError("setContentEncryptionKey can only be called once");return this.#f=a,this}setInitializationVector(a){if(this.#g)throw TypeError("setInitializationVector can only be called once");return this.#g=a,this}async encrypt(a,b){let c,d,e,f,g,h;if(!this.#b&&!this.#d&&!this.#c)throw new ag("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!ba(this.#b,this.#d,this.#c))throw new ag("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let i={...this.#b,...this.#d,...this.#c};if(bb(ag,new Map,b?.crit,this.#b,i),void 0!==i.zip)throw new ae('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:j,enc:k}=i;if("string"!=typeof j||!j)throw new ag('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof k||!k)throw new ag('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this.#f&&("dir"===j||"ECDH-ES"===j))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${j}`);be("dir"===j?k:j,a,"encrypt");{let e,f=await a$(a,j);({cek:d,encryptedKey:c,parameters:e}=await a9(j,k,f,this.#f,this.#h)),e&&(b&&_ in b?this.#d?this.#d={...this.#d,...e}:this.setUnprotectedHeader(e):this.#b?this.#b={...this.#b,...e}:this.setProtectedHeader(e))}if(this.#b?g=Y(f=$(JSON.stringify(this.#b))):(f="",g=new Uint8Array),this.#e){let a=Y(h=$(this.#e));e=U(g,Y("."),a)}else e=g;let{ciphertext:l,tag:m,iv:n}=await aF(k,this.#a,d,this.#g,e),o={ciphertext:$(l)};return n&&(o.iv=$(n)),m&&(o.tag=$(m)),c&&(o.encrypted_key=$(c)),h&&(o.aad=h),this.#b&&(o.protected=f),this.#c&&(o.unprotected=this.#c),this.#d&&(o.header=this.#d),o}}class bg{#i;constructor(a){this.#i=new bf(a)}setContentEncryptionKey(a){return this.#i.setContentEncryptionKey(a),this}setInitializationVector(a){return this.#i.setInitializationVector(a),this}setProtectedHeader(a){return this.#i.setProtectedHeader(a),this}setKeyManagementParameters(a){return this.#i.setKeyManagementParameters(a),this}async encrypt(a,b){let c=await this.#i.encrypt(a,b);return[c.protected,c.encrypted_key,c.iv,c.ciphertext,c.tag].join(".")}}let bh=a=>Math.floor(a.getTime()/1e3),bi=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function bj(a){let b,c=bi.exec(a);if(!c||c[4]&&c[1])throw TypeError("Invalid time period format");let d=parseFloat(c[2]);switch(c[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":b=Math.round(d);break;case"minute":case"minutes":case"min":case"mins":case"m":b=Math.round(60*d);break;case"hour":case"hours":case"hr":case"hrs":case"h":b=Math.round(3600*d);break;case"day":case"days":case"d":b=Math.round(86400*d);break;case"week":case"weeks":case"w":b=Math.round(604800*d);break;default:b=Math.round(0x1e187e0*d)}return"-"===c[1]||"ago"===c[4]?-b:b}function bk(a,b){if(!Number.isFinite(b))throw TypeError(`Invalid ${a} input`);return b}let bl=a=>a.includes("/")?a.toLowerCase():`application/${a.toLowerCase()}`;function bm(a,b,c={}){var d,e;let f,g;try{f=JSON.parse(T.decode(b))}catch{}if(!aW(f))throw new ai("JWT Claims Set must be a top-level JSON object");let{typ:h}=c;if(h&&("string"!=typeof a.typ||bl(a.typ)!==bl(h)))throw new ab('unexpected "typ" JWT header value',f,"typ","check_failed");let{requiredClaims:i=[],issuer:j,subject:k,audience:l,maxTokenAge:m}=c,n=[...i];for(let a of(void 0!==m&&n.push("iat"),void 0!==l&&n.push("aud"),void 0!==k&&n.push("sub"),void 0!==j&&n.push("iss"),new Set(n.reverse())))if(!(a in f))throw new ab(`missing required "${a}" claim`,f,a,"missing");if(j&&!(Array.isArray(j)?j:[j]).includes(f.iss))throw new ab('unexpected "iss" claim value',f,"iss","check_failed");if(k&&f.sub!==k)throw new ab('unexpected "sub" claim value',f,"sub","check_failed");if(l&&(d=f.aud,e="string"==typeof l?[l]:l,"string"==typeof d?!e.includes(d):!(Array.isArray(d)&&e.some(Set.prototype.has.bind(new Set(d))))))throw new ab('unexpected "aud" claim value',f,"aud","check_failed");switch(typeof c.clockTolerance){case"string":g=bj(c.clockTolerance);break;case"number":g=c.clockTolerance;break;case"undefined":g=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:o}=c,p=bh(o||new Date);if((void 0!==f.iat||m)&&"number"!=typeof f.iat)throw new ab('"iat" claim must be a number',f,"iat","invalid");if(void 0!==f.nbf){if("number"!=typeof f.nbf)throw new ab('"nbf" claim must be a number',f,"nbf","invalid");if(f.nbf>p+g)throw new ab('"nbf" claim timestamp check failed',f,"nbf","check_failed")}if(void 0!==f.exp){if("number"!=typeof f.exp)throw new ab('"exp" claim must be a number',f,"exp","invalid");if(f.exp<=p-g)throw new ac('"exp" claim timestamp check failed',f,"exp","check_failed")}if(m){let a=p-f.iat;if(a-g>("number"==typeof m?m:bj(m)))throw new ac('"iat" claim timestamp check failed (too far in the past)',f,"iat","check_failed");if(a<0-g)throw new ab('"iat" claim timestamp check failed (it should be in the past)',f,"iat","check_failed")}return f}class bn{#j;constructor(a){if(!aW(a))throw TypeError("JWT Claims Set MUST be an object");this.#j=structuredClone(a)}data(){return S.encode(JSON.stringify(this.#j))}get iss(){return this.#j.iss}set iss(a){this.#j.iss=a}get sub(){return this.#j.sub}set sub(a){this.#j.sub=a}get aud(){return this.#j.aud}set aud(a){this.#j.aud=a}set jti(a){this.#j.jti=a}set nbf(a){"number"==typeof a?this.#j.nbf=bk("setNotBefore",a):a instanceof Date?this.#j.nbf=bk("setNotBefore",bh(a)):this.#j.nbf=bh(new Date)+bj(a)}set exp(a){"number"==typeof a?this.#j.exp=bk("setExpirationTime",a):a instanceof Date?this.#j.exp=bk("setExpirationTime",bh(a)):this.#j.exp=bh(new Date)+bj(a)}set iat(a){void 0===a?this.#j.iat=bh(new Date):a instanceof Date?this.#j.iat=bk("setIssuedAt",bh(a)):"string"==typeof a?this.#j.iat=bk("setIssuedAt",bh(new Date)+bj(a)):this.#j.iat=bk("setIssuedAt",a)}}a.s(["JWTClaimsBuilder",()=>bn,"validateClaimsSet",()=>bm],14083);class bo{#f;#g;#h;#b;#k;#l;#m;#n;constructor(a={}){this.#n=new bn(a)}setIssuer(a){return this.#n.iss=a,this}setSubject(a){return this.#n.sub=a,this}setAudience(a){return this.#n.aud=a,this}setJti(a){return this.#n.jti=a,this}setNotBefore(a){return this.#n.nbf=a,this}setExpirationTime(a){return this.#n.exp=a,this}setIssuedAt(a){return this.#n.iat=a,this}setProtectedHeader(a){if(this.#b)throw TypeError("setProtectedHeader can only be called once");return this.#b=a,this}setKeyManagementParameters(a){if(this.#h)throw TypeError("setKeyManagementParameters can only be called once");return this.#h=a,this}setContentEncryptionKey(a){if(this.#f)throw TypeError("setContentEncryptionKey can only be called once");return this.#f=a,this}setInitializationVector(a){if(this.#g)throw TypeError("setInitializationVector can only be called once");return this.#g=a,this}replicateIssuerAsHeader(){return this.#k=!0,this}replicateSubjectAsHeader(){return this.#l=!0,this}replicateAudienceAsHeader(){return this.#m=!0,this}async encrypt(a,b){let c=new bg(this.#n.data());return this.#b&&(this.#k||this.#l||this.#m)&&(this.#b={...this.#b,iss:this.#k?this.#n.iss:void 0,sub:this.#l?this.#n.sub:void 0,aud:this.#m?this.#n.aud:void 0}),c.setProtectedHeader(this.#b),this.#g&&c.setInitializationVector(this.#g),this.#f&&c.setContentEncryptionKey(this.#f),this.#h&&c.setKeyManagementParameters(this.#h),c.encrypt(a,b)}}function bp(a,b){let c=`SHA-${a.slice(-3)}`;switch(a){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:parseInt(a.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:b.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:a};default:throw new ae(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}async function bq(a,b,c){if(b instanceof Uint8Array){if(!a.startsWith("HS"))throw TypeError(ax(b,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",b,{hash:`SHA-${a.slice(-3)}`,name:"HMAC"},!1,[c])}return!function(a,b,c){switch(b){case"HS256":case"HS384":case"HS512":{if("HMAC"!==a.algorithm.name)throw as("HMAC");let c=parseInt(b.slice(2),10);if(at(a.algorithm.hash)!==c)throw as(`SHA-${c}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if("RSASSA-PKCS1-v1_5"!==a.algorithm.name)throw as("RSASSA-PKCS1-v1_5");let c=parseInt(b.slice(2),10);if(at(a.algorithm.hash)!==c)throw as(`SHA-${c}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if("RSA-PSS"!==a.algorithm.name)throw as("RSA-PSS");let c=parseInt(b.slice(2),10);if(at(a.algorithm.hash)!==c)throw as(`SHA-${c}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":if("Ed25519"!==a.algorithm.name)throw as("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":let d;if(d=a.algorithm,d.name!==b)throw as(b);break;case"ES256":case"ES384":case"ES512":{if("ECDSA"!==a.algorithm.name)throw as("ECDSA");let c=function(a){switch(a){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(b);if(a.algorithm.namedCurve!==c)throw as(c,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}au(a,c)}(b,a,c),b}async function br(a,b,c){let d=await bq(a,b,"sign");return aS(a,d),new Uint8Array(await crypto.subtle.sign(bp(a,d.algorithm),d,c))}class bs{#j;#b;#d;constructor(a){if(!(a instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this.#j=a}setProtectedHeader(a){if(this.#b)throw TypeError("setProtectedHeader can only be called once");return this.#b=a,this}setUnprotectedHeader(a){if(this.#d)throw TypeError("setUnprotectedHeader can only be called once");return this.#d=a,this}async sign(a,b){let c,d,e,f;if(!this.#b&&!this.#d)throw new ah("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!ba(this.#b,this.#d))throw new ah("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let g={...this.#b,...this.#d},h=bb(ah,new Map([["b64",!0]]),b?.crit,this.#b,g),i=!0;if(h.has("b64")&&"boolean"!=typeof(i=this.#b.b64))throw new ah('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:j}=g;if("string"!=typeof j||!j)throw new ah('JWS "alg" (Algorithm) Header Parameter missing or invalid');be(j,a,"sign"),i?d=Y(c=$(this.#j)):(d=this.#j,c=""),this.#b?f=Y(e=$(JSON.stringify(this.#b))):(e="",f=new Uint8Array);let k=U(f,Y("."),d),l=await a$(a,j),m={signature:$(await br(j,l,k)),payload:c};return this.#d&&(m.header=this.#d),this.#b&&(m.protected=e),m}}class bt{#i;constructor(a){this.#i=new bs(a)}setProtectedHeader(a){return this.#i.setProtectedHeader(a),this}async sign(a,b){let c=await this.#i.sign(a,b);if(void 0===c.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${c.protected}.${c.payload}.${c.signature}`}}class bu{#b;#n;constructor(a={}){this.#n=new bn(a)}setIssuer(a){return this.#n.iss=a,this}setSubject(a){return this.#n.sub=a,this}setAudience(a){return this.#n.aud=a,this}setJti(a){return this.#n.jti=a,this}setNotBefore(a){return this.#n.nbf=a,this}setExpirationTime(a){return this.#n.exp=a,this}setIssuedAt(a){return this.#n.iat=a,this}setProtectedHeader(a){return this.#b=a,this}async sign(a,b){let c=new bt(this.#n.data());if(c.setProtectedHeader(this.#b),Array.isArray(this.#b?.crit)&&this.#b.crit.includes("b64")&&!1===this.#b.b64)throw new ai("JWTs MUST NOT use unencoded payload");return c.sign(a,b)}}var bv,bw=a.i(76340),bw=bw;let bx=(a,b)=>{if("string"!=typeof a||!a)throw new aj(`${b} missing or invalid`)};async function by(a,b){let c,d;if(aX(a))c=a;else if(aC(a))c=await a2(a);else throw TypeError(ax(a,"CryptoKey","KeyObject","JSON Web Key"));if("sha256"!==(b??="sha256")&&"sha384"!==b&&"sha512"!==b)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(c.kty){case"AKP":bx(c.alg,'"alg" (Algorithm) Parameter'),bx(c.pub,'"pub" (Public key) Parameter'),d={alg:c.alg,kty:c.kty,pub:c.pub};break;case"EC":bx(c.crv,'"crv" (Curve) Parameter'),bx(c.x,'"x" (X Coordinate) Parameter'),bx(c.y,'"y" (Y Coordinate) Parameter'),d={crv:c.crv,kty:c.kty,x:c.x,y:c.y};break;case"OKP":bx(c.crv,'"crv" (Subtype of Key Pair) Parameter'),bx(c.x,'"x" (Public Key) Parameter'),d={crv:c.crv,kty:c.kty,x:c.x};break;case"RSA":bx(c.e,'"e" (Exponent) Parameter'),bx(c.n,'"n" (Modulus) Parameter'),d={e:c.e,kty:c.kty,n:c.n};break;case"oct":bx(c.k,'"k" (Key Value) Parameter'),d={k:c.k,kty:c.kty};break;default:throw new ae('"kty" (Key Type) Parameter missing or unsupported')}let e=Y(JSON.stringify(d));return $(await aK(b,e))}async function bz(a,b,c){let d;if(!aW(a))throw TypeError("JWK must be an object");switch(b??=a.alg,d??=c?.extractable??a.ext,a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw TypeError('missing "k" (Key Value) Parameter value');return Z(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new ae('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return aY({...a,alg:b,ext:d});case"AKP":if("string"!=typeof a.alg||!a.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==b&&b!==a.alg)throw TypeError("JWK alg and alg option value mismatch");return aY({...a,ext:d});case"EC":case"OKP":return aY({...a,alg:b,ext:d});default:throw new ae('Unsupported "kty" (Key Type) Parameter value')}}async function bA(a,b,c,d,e){switch(a){case"dir":if(void 0!==c)throw new ag("Encountered unexpected JWE Encrypted Key");return b;case"ECDH-ES":if(void 0!==c)throw new ag("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e,f;if(!aW(d.epk))throw new ag('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(az(b),!aO(b))throw new ae("ECDH with the provided key is not allowed or not supported by your javascript runtime");let g=await bz(d.epk,a);if(az(g),void 0!==d.apu){if("string"!=typeof d.apu)throw new ag('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{e=Z(d.apu)}catch{throw new ag("Failed to base64url decode the apu")}}if(void 0!==d.apv){if("string"!=typeof d.apv)throw new ag('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{f=Z(d.apv)}catch{throw new ag("Failed to base64url decode the apv")}}let h=await aN(g,b,"ECDH-ES"===a?d.enc:a,"ECDH-ES"===a?a_(d.enc):parseInt(a.slice(-5,-2),10),e,f);if("ECDH-ES"===a)return h;if(void 0===c)throw new ag("JWE Encrypted Key missing");return aJ(a.slice(-6),h,c)}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===c)throw new ag("JWE Encrypted Key missing");return az(b),aV(a,b,c);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let f;if(void 0===c)throw new ag("JWE Encrypted Key missing");if("number"!=typeof d.p2c)throw new ag('JOSE Header "p2c" (PBES2 Count) missing or invalid');let g=e?.maxPBES2Count||1e4;if(d.p2c>g)throw new ag('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof d.p2s)throw new ag('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{f=Z(d.p2s)}catch{throw new ag("Failed to base64url decode the p2s")}return aR(a,b,c,d.p2c,f)}case"A128KW":case"A192KW":case"A256KW":if(void 0===c)throw new ag("JWE Encrypted Key missing");return aJ(a,b,c);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let e,f;if(void 0===c)throw new ag("JWE Encrypted Key missing");if("string"!=typeof d.iv)throw new ag('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof d.tag)throw new ag('JOSE Header "tag" (Authentication Tag) missing or invalid');try{e=Z(d.iv)}catch{throw new ag("Failed to base64url decode the iv")}try{f=Z(d.tag)}catch{throw new ag("Failed to base64url decode the tag")}return a8(a,b,c,e,f)}default:throw new ae('Invalid or unsupported "alg" (JWE Algorithm) header value')}}function bB(a,b){if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)}async function bC(a,b,c){let d,e,f,g,h,i,j;if(!aW(a))throw new ag("Flattened JWE must be an object");if(void 0===a.protected&&void 0===a.header&&void 0===a.unprotected)throw new ag("JOSE Header missing");if(void 0!==a.iv&&"string"!=typeof a.iv)throw new ag("JWE Initialization Vector incorrect type");if("string"!=typeof a.ciphertext)throw new ag("JWE Ciphertext missing or incorrect type");if(void 0!==a.tag&&"string"!=typeof a.tag)throw new ag("JWE Authentication Tag incorrect type");if(void 0!==a.protected&&"string"!=typeof a.protected)throw new ag("JWE Protected Header incorrect type");if(void 0!==a.encrypted_key&&"string"!=typeof a.encrypted_key)throw new ag("JWE Encrypted Key incorrect type");if(void 0!==a.aad&&"string"!=typeof a.aad)throw new ag("JWE AAD incorrect type");if(void 0!==a.header&&!aW(a.header))throw new ag("JWE Shared Unprotected Header incorrect type");if(void 0!==a.unprotected&&!aW(a.unprotected))throw new ag("JWE Per-Recipient Unprotected Header incorrect type");if(a.protected)try{let b=Z(a.protected);d=JSON.parse(T.decode(b))}catch{throw new ag("JWE Protected Header is invalid")}if(!ba(d,a.header,a.unprotected))throw new ag("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let k={...d,...a.header,...a.unprotected};if(bb(ag,new Map,c?.crit,d,k),void 0!==k.zip)throw new ae('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:l,enc:m}=k;if("string"!=typeof l||!l)throw new ag("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof m||!m)throw new ag("missing JWE Encryption Algorithm (enc) in JWE Header");let n=c&&bB("keyManagementAlgorithms",c.keyManagementAlgorithms),o=c&&bB("contentEncryptionAlgorithms",c.contentEncryptionAlgorithms);if(n&&!n.has(l)||!n&&l.startsWith("PBES2"))throw new ad('"alg" (Algorithm) Header Parameter value not allowed');if(o&&!o.has(m))throw new ad('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==a.encrypted_key)try{e=Z(a.encrypted_key)}catch{throw new ag("Failed to base64url decode the encrypted_key")}let p=!1;"function"==typeof b&&(b=await b(d,a),p=!0),be("dir"===l?m:l,b,"decrypt");let q=await a$(b,l);try{f=await bA(l,q,e,k,c)}catch(a){if(a instanceof TypeError||a instanceof ag||a instanceof ae)throw a;f=a0(m)}if(void 0!==a.iv)try{g=Z(a.iv)}catch{throw new ag("Failed to base64url decode the iv")}if(void 0!==a.tag)try{h=Z(a.tag)}catch{throw new ag("Failed to base64url decode the tag")}let r=void 0!==a.protected?Y(a.protected):new Uint8Array;i=void 0!==a.aad?U(r,Y("."),Y(a.aad)):r;try{j=Z(a.ciphertext)}catch{throw new ag("Failed to base64url decode the ciphertext")}let s={plaintext:await a6(m,f,j,g,h,i)};if(void 0!==a.protected&&(s.protectedHeader=d),void 0!==a.aad)try{s.additionalAuthenticatedData=Z(a.aad)}catch{throw new ag("Failed to base64url decode the aad")}return(void 0!==a.unprotected&&(s.sharedUnprotectedHeader=a.unprotected),void 0!==a.header&&(s.unprotectedHeader=a.header),p)?{...s,key:q}:s}async function bD(a,b,c){if(a instanceof Uint8Array&&(a=T.decode(a)),"string"!=typeof a)throw new ag("Compact JWE must be a string or Uint8Array");let{0:d,1:e,2:f,3:g,4:h,length:i}=a.split(".");if(5!==i)throw new ag("Invalid Compact JWE");let j=await bC({ciphertext:g,iv:f||void 0,protected:d,tag:h||void 0,encrypted_key:e||void 0},b,c),k={plaintext:j.plaintext,protectedHeader:j.protectedHeader};return"function"==typeof b?{...k,key:j.key}:k}async function bE(a,b,c){let d=await bD(a,b,c),e=bm(d.protectedHeader,d.plaintext,c),{protectedHeader:f}=d;if(void 0!==f.iss&&f.iss!==e.iss)throw new ab('replicated "iss" claim header parameter mismatch',e,"iss","mismatch");if(void 0!==f.sub&&f.sub!==e.sub)throw new ab('replicated "sub" claim header parameter mismatch',e,"sub","mismatch");if(void 0!==f.aud&&JSON.stringify(f.aud)!==JSON.stringify(e.aud))throw new ab('replicated "aud" claim header parameter mismatch',e,"aud","mismatch");let g={payload:e,protectedHeader:f};return"function"==typeof b?{...g,key:d.key}:g}async function bF(a,b,c,d){let e=await bq(a,b,"verify");aS(a,e);let f=bp(a,e.algorithm);try{return await crypto.subtle.verify(f,e,c,d)}catch{return!1}}async function bG(a,b,c){let d,e;if(!aW(a))throw new ah("Flattened JWS must be an object");if(void 0===a.protected&&void 0===a.header)throw new ah('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==a.protected&&"string"!=typeof a.protected)throw new ah("JWS Protected Header incorrect type");if(void 0===a.payload)throw new ah("JWS Payload missing");if("string"!=typeof a.signature)throw new ah("JWS Signature missing or incorrect type");if(void 0!==a.header&&!aW(a.header))throw new ah("JWS Unprotected Header incorrect type");let f={};if(a.protected)try{let b=Z(a.protected);f=JSON.parse(T.decode(b))}catch{throw new ah("JWS Protected Header is invalid")}if(!ba(f,a.header))throw new ah("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let g={...f,...a.header},h=bb(ah,new Map([["b64",!0]]),c?.crit,f,g),i=!0;if(h.has("b64")&&"boolean"!=typeof(i=f.b64))throw new ah('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:j}=g;if("string"!=typeof j||!j)throw new ah('JWS "alg" (Algorithm) Header Parameter missing or invalid');let k=c&&bB("algorithms",c.algorithms);if(k&&!k.has(j))throw new ad('"alg" (Algorithm) Header Parameter value not allowed');if(i){if("string"!=typeof a.payload)throw new ah("JWS Payload must be a string")}else if("string"!=typeof a.payload&&!(a.payload instanceof Uint8Array))throw new ah("JWS Payload must be a string or an Uint8Array instance");let l=!1;"function"==typeof b&&(b=await b(f,a),l=!0),be(j,b,"verify");let m=U(void 0!==a.protected?Y(a.protected):new Uint8Array,Y("."),"string"==typeof a.payload?i?Y(a.payload):S.encode(a.payload):a.payload);try{d=Z(a.signature)}catch{throw new ah("Failed to base64url decode the signature")}let n=await a$(b,j);if(!await bF(j,n,d,m))throw new ao;if(i)try{e=Z(a.payload)}catch{throw new ah("Failed to base64url decode the payload")}else e="string"==typeof a.payload?S.encode(a.payload):a.payload;let o={payload:e};return(void 0!==a.protected&&(o.protectedHeader=f),void 0!==a.header&&(o.unprotectedHeader=a.header),l)?{...o,key:n}:o}async function bH(a,b,c){if(a instanceof Uint8Array&&(a=T.decode(a)),"string"!=typeof a)throw new ah("Compact JWS must be a string or Uint8Array");let{0:d,1:e,2:f,length:g}=a.split(".");if(3!==g)throw new ah("Invalid Compact JWS");let h=await bG({payload:e,protected:d,signature:f},b,c),i={payload:h.payload,protectedHeader:h.protectedHeader};return"function"==typeof b?{...i,key:h.key}:i}async function bI(a,b,c){let d=await bH(a,b,c);if(d.protectedHeader.crit?.includes("b64")&&!1===d.protectedHeader.b64)throw new ai("JWTs MUST NOT use unencoded payload");let e={payload:bm(d.protectedHeader,d.payload,c),protectedHeader:d.protectedHeader};return"function"==typeof b?{...e,key:d.key}:e}async function bJ(a,b,c=3600){return await new bu(a).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+c).sign(new TextEncoder().encode(b))}async function bK(a,b){try{return(await bI(a,new TextEncoder().encode(b))).payload}catch{return null}}a.s(["importJWK",()=>bz],42420),a.s(["jwtVerify",()=>bI],81205);let bL=new Uint8Array([66,101,116,116,101,114,65,117,116,104,46,106,115,32,71,101,110,101,114,97,116,101,100,32,69,110,99,114,121,112,116,105,111,110,32,75,101,121]),bM="A256CBC-HS512";async function bN(a,b,c,d=3600){let e=A(R,new TextEncoder().encode(b),new TextEncoder().encode(c),bL,64),f=await by({kty:"oct",k:bw.encode(e)},"sha256");return await new bo(a).setProtectedHeader({alg:"dir",enc:bM,kid:f}).setIssuedAt().setExpirationTime((Date.now()/1e3|0)+d).setJti(crypto.randomUUID()).encrypt(e)}async function bO(a,b,c){if(!a)return null;try{let{payload:d}=await bE(a,async({kid:a})=>{let d=A(R,new TextEncoder().encode(b),new TextEncoder().encode(c),bL,64);if(void 0===a||a===await by({kty:"oct",k:bw.encode(d)},"sha256"))return d;throw Error("no matching decryption secret")},{clockTolerance:15,keyManagementAlgorithms:["dir"],contentEncryptionAlgorithms:[bM,"A256GCM"]});return d}catch{return null}}a.s(["signJWT",()=>bJ,"symmetricDecodeJWT",()=>bO,"symmetricEncodeJWT",()=>bN,"verifyJWT",()=>bK],7116);var bP=a.i(61202);let bQ=a=>{if("string"==typeof a&&(a=new TextEncoder().encode(a)),0===a.byteLength)return"";let b=new Uint8Array(a),c="";for(let a of b)c+=a.toString(16).padStart(2,"0");return c};function bR(a,b,c,d){var e;let f,{c:h,dkLen:j,DK:k,PRF:n,PRFSalt:o}=function(a,b,c,d){i(a);let{c:e,dkLen:f,asyncTick:h}=v({dkLen:32,asyncTick:10},d);if(g(e,"c"),g(f,"dkLen"),g(h,"asyncTick"),e<1)throw Error("iterations (c) must be >= 1");let j=u(b,"password"),k=u(c,"salt"),l=new Uint8Array(f),m=x.create(a,j),n=m._cloneInto().update(k);return{c:e,dkLen:f,asyncTick:h,DK:l,PRF:m,PRFSalt:n}}(a,b,c,d),p=new Uint8Array(4),q=m(p),r=new Uint8Array(n.outputLen);for(let a=1,b=0;b<j;a++,b+=n.outputLen){let c=k.subarray(b,b+n.outputLen);q.setInt32(0,a,!1),(f=o._cloneInto(f)).update(p).digestInto(r),c.set(r.subarray(0,c.length));for(let a=1;a<h;a++){n._cloneInto(f).update(r).digestInto(r);for(let a=0;a<c.length;a++)c[a]^=r[a]}}return e=f,n.destroy(),o.destroy(),e&&e.destroy(),l(r),k}function bS(a,b,c,d,e,f){let g=a[b++]^c[d++],h=a[b++]^c[d++],i=a[b++]^c[d++],j=a[b++]^c[d++],k=a[b++]^c[d++],l=a[b++]^c[d++],m=a[b++]^c[d++],n=a[b++]^c[d++],p=a[b++]^c[d++],q=a[b++]^c[d++],r=a[b++]^c[d++],s=a[b++]^c[d++],t=a[b++]^c[d++],u=a[b++]^c[d++],v=a[b++]^c[d++],w=a[b++]^c[d++],x=g,y=h,z=i,A=j,B=k,C=l,D=m,E=n,F=p,G=q,H=r,I=s,J=t,K=u,L=v,M=w;for(let a=0;a<8;a+=2)B^=o(x+J|0,7),F^=o(B+x|0,9),J^=o(F+B|0,13),x^=o(J+F|0,18),G^=o(C+y|0,7),K^=o(G+C|0,9),y^=o(K+G|0,13),C^=o(y+K|0,18),L^=o(H+D|0,7),z^=o(L+H|0,9),D^=o(z+L|0,13),H^=o(D+z|0,18),A^=o(M+I|0,7),E^=o(A+M|0,9),I^=o(E+A|0,13),M^=o(I+E|0,18),y^=o(x+A|0,7),z^=o(y+x|0,9),A^=o(z+y|0,13),x^=o(A+z|0,18),D^=o(C+B|0,7),E^=o(D+C|0,9),B^=o(E+D|0,13),C^=o(B+E|0,18),I^=o(H+G|0,7),F^=o(I+H|0,9),G^=o(F+I|0,13),H^=o(G+F|0,18),J^=o(M+L|0,7),K^=o(J+M|0,9),L^=o(K+J|0,13),M^=o(L+K|0,18);e[f++]=g+x|0,e[f++]=h+y|0,e[f++]=i+z|0,e[f++]=j+A|0,e[f++]=k+B|0,e[f++]=l+C|0,e[f++]=m+D|0,e[f++]=n+E|0,e[f++]=p+F|0,e[f++]=q+G|0,e[f++]=r+H|0,e[f++]=s+I|0,e[f++]=t+J|0,e[f++]=u+K|0,e[f++]=v+L|0,e[f++]=w+M|0}function bT(a,b,c,d,e){let f=d+0,g=d+16*e;for(let d=0;d<16;d++)c[g+d]=a[b+(2*e-1)*16+d];for(let d=0;d<e;d++,f+=16,b+=16)bS(c,g,a,b,c,f),d>0&&(g+=16),bS(c,f,a,b+=16,c,g)}async function bU(a,b,c){let d,{N:e,r:f,p:h,dkLen:i,blockSize32:j,V:m,B32:n,B:o,tmp:q,blockMixCb:r,asyncTick:s}=function(a,b,c){let{N:d,r:e,p:f,dkLen:h,asyncTick:i,maxmem:j,onProgress:l}=v({dkLen:32,asyncTick:10,maxmem:0x40000400},c);if(g(d,"N"),g(e,"r"),g(f,"p"),g(h,"dkLen"),g(i,"asyncTick"),g(j,"maxmem"),void 0!==l&&"function"!=typeof l)throw Error("progressCb must be a function");let m=128*e,n=m/4;if(d<=1||(d&d-1)!=0||d>0x100000000)throw Error('"N" expected a power of 2, and 2^1 <= N <= 2^32');if(f<1||f>0x1fffffffe0/m)throw Error('"p" expected integer 1..((2^32 - 1) * 32) / (128 * r)');if(h<1||h>0x1fffffffe0)throw Error('"dkLen" expected integer 1..(2^32 - 1) * 32');if(m*(d+f)>j)throw Error('"maxmem" limit was hit, expected 128*r*(N+p) <= "maxmem"='+j);let o=bR(R,a,b,{c:1,dkLen:m*f}),p=k(o),q=k(new Uint8Array(m*d)),r=k(new Uint8Array(m)),s=()=>{};if(l){let a=2*d*f,b=Math.max(Math.floor(a/1e4),1),c=0;s=()=>{c++,l&&(!(c%b)||c===a)&&l(c/a)}}return{N:d,r:e,p:f,dkLen:h,blockSize32:n,V:q,B32:p,B:o,tmp:r,blockMixCb:s,asyncTick:i}}(a,b,c);p(n);for(let a=0;a<h;a++){let b=j*a;for(let a=0;a<j;a++)m[a]=n[b+a];let c=0;await t(e-1,s,()=>{bT(m,c,m,c+=j,f),r()}),bT(m,(e-1)*j,n,b,f),r(),await t(e,s,()=>{let a=(n[b+j-16]&e-1)>>>0;for(let c=0;c<j;c++)q[c]=n[b+c]^m[a*j+c];bT(q,0,n,b,f),r()})}return p(n),d=bR(R,a,o,{c:1,dkLen:i}),l(o,m,q),d}async function bV(a,b){return await bU(a.normalize("NFKC"),b,{N:16384,p:1,r:16,dkLen:64,maxmem:0x4000000})}let bW=async a=>{let b=bQ(crypto.getRandomValues(new Uint8Array(16))),c=await bV(a,b);return`${b}:${bQ(c)}`},bX=async({hash:a,password:b})=>{let[c,d]=a.split(":");if(!c||!d)throw new bP.BetterAuthError("Invalid password hash");return function(a,b){"string"==typeof a&&(a=new TextEncoder().encode(a)),"string"==typeof b&&(b=new TextEncoder().encode(b));let c=new Uint8Array(a),d=new Uint8Array(b),e=c.length^d.length,f=Math.max(c.length,d.length);for(let a=0;a<f;a++)e|=(a<c.length?c[a]:0)^(a<d.length?d[a]:0);return 0===e}(await bV(b,c),function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(q)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=r(a.charCodeAt(e)),f=r(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(d))};function bY(){let a="u">typeof globalThis&&globalThis.crypto;if(a&&"object"==typeof a.subtle&&null!=a.subtle)return a.subtle;throw Error("crypto.subtle must be defined")}function bZ(a){return a?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function b$(a,b,c){let d="",e=0,f=0;for(let c of a)for(e=e<<8|c,f+=8;f>=6;)f-=6,d+=b[e>>f&63];if(f>0&&(d+=b[e<<6-f&63]),c){let a=(4-d.length%4)%4;d+="=".repeat(a)}return d}function b_(a,b){let c=new Map;for(let a=0;a<b.length;a++)c.set(b[a],a);let d=[],e=0,f=0;for(let b of a){if("="===b)break;let a=c.get(b);if(void 0===a)throw Error(`Invalid Base64 character: ${b}`);e=e<<6|a,(f+=6)>=8&&(f-=8,d.push(e>>f&255))}return Uint8Array.from(d)}a.s(["hashPassword",()=>bW,"verifyPassword",()=>bX],55367);let b0={encode(a,b={}){let c=bZ(!1);return b$("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){"string"!=typeof a&&(a=new TextDecoder().decode(a));let b=bZ(a.includes("-")||a.includes("_"));return b_(a,b)}},b1={encode(a,b={}){let c=bZ(!0);return b$("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){let b=bZ(a.includes("-")||a.includes("_"));return b_(a,b)}};function b2(a,b){return{digest:async c=>{let d=new TextEncoder,e="string"==typeof c?d.encode(c):c,f=await bY().digest(a,e);return"hex"===b?Array.from(new Uint8Array(f)).map(a=>a.toString(16).padStart(2,"0")).join(""):"base64"===b||"base64url"===b||"base64urlnopad"===b?b.includes("url")?b1.encode(f,{padding:"base64urlnopad"!==b}):b0.encode(f):f}}}function b3(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function b4(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function b5(a,b,c=""){let d=a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name,e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function b6(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function b7(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function b8(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}a.s(["base64",()=>b0,"base64Url",()=>b1],81549),a.s(["createHash",()=>b2],19473);let b9=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],ca="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,cb=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function cc(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function cd(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error('"output" expected Uint8Array of length '+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function ce(a){return Uint8Array.from(a)}function cf(a=32){let b="object"==typeof globalThis?globalThis.crypto:null;if("function"!=typeof b?.getRandomValues)throw Error("crypto.getRandomValues must be defined");return b.getRandomValues(new Uint8Array(a))}function cg(a,b=cf){let{nonceLength:c}=a;b4(c);let d=(a,b)=>{let c=function(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];b5(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}(a,b);return b.fill(0),c};return(e,...f)=>({encrypt(g){b5(g);let h=b(c),i=a(e,h,...f).encrypt(g);return i instanceof Promise?i.then(a=>d(h,a)):d(h,i)},decrypt(b){b5(b);let d=b.subarray(0,c),g=b.subarray(c);return a(e,d,...f).decrypt(g)}})}let ch=a=>Uint8Array.from(a.split(""),a=>a.charCodeAt(0)),ci=ch("expand 16-byte k"),cj=ch("expand 32-byte k"),ck=b7(ci),cl=b7(cj);function cm(a,b){return a<<b|a>>>32-b}function cn(a){return a.byteOffset%4==0}let co=0x100000000-1,cp=Uint32Array.of();function cq(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return b4(e),b4(g),b3(f),b3(c),(b,h,i,j,k=0)=>{let l,m;b5(b,void 0,"key"),b5(h,void 0,"nonce"),b5(i,void 0,"data");let n=i.length;if(void 0===j&&(j=new Uint8Array(n)),b5(j,void 0,"output"),b4(k),k<0||k>=co)throw Error("arx: counter overflow");if(j.length<n)throw Error(`arx: output (${j.length}) is shorter than data (${n})`);let o=[],p=b.length;if(32===p)o.push(l=ce(b)),m=cl;else if(16===p&&c)(l=new Uint8Array(32)).set(b),l.set(b,16),m=ck,o.push(l);else throw b5(b,32,"arx key"),Error("invalid key size");cn(h)||o.push(h=ce(h));let q=b7(l);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(m,q,b7(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,o.push(h)}return!function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=b7(j),l=cn(e)&&cn(f),m=l?b7(e):cp,n=l?b7(f):cp;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=co)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,m,q,b7(h),i,j,k,g),b8(...o),j}}function cr(a,b){return 255&a[b++]|(255&a[b++])<<8}class cs{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(a){const b=cr(a=ce(b5(a,32,"key")),0),c=cr(a,2),d=cr(a,4),e=cr(a,6),f=cr(a,8),g=cr(a,10),h=cr(a,12),i=cr(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=cr(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=cr(a,b+0),q=cr(a,b+2),r=cr(a,b+4),s=cr(a,b+6),t=cr(a,b+8),u=cr(a,b+10),v=cr(a,b+12),w=cr(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;b8(c)}update(a){b6(this),b5(a);let{buffer:b,blockLen:c}=this,d=(a=ce(a)).length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){b8(this.h,this.r,this.buffer,this.pad)}digestInto(a){b6(this);b5(a,void 0,"output");let b=this.outputLen;if(a.length<b)throw Error("digestInto() expects output buffer of length at least "+b);this.finished=!0;let{buffer:c,h:d}=this,{pos:e}=this;if(e){for(c[e++]=1;e<16;e++)c[e]=0;this.process(c,0,!0)}this.finalize();let f=0;for(let b=0;b<8;b++)a[f++]=d[b]>>>0,a[f++]=d[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let ct=(bv=a=>new cs(a),(c=(a,b)=>bv(b).update(a).digest()).outputLen=(d=bv(new Uint8Array(32))).outputLen,c.blockLen=d.blockLen,c.create=a=>bv(a),c);function cu(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=cm(H^(v=v+z|0),16))|0,v=v+(z=cm(z^D,12))|0,D=D+(H=cm(H^v,8))|0,z=cm(z^D,7),E=E+(I=cm(I^(w=w+A|0),16))|0,w=w+(A=cm(A^E,12))|0,E=E+(I=cm(I^w,8))|0,A=cm(A^E,7),F=F+(J=cm(J^(x=x+B|0),16))|0,x=x+(B=cm(B^F,12))|0,F=F+(J=cm(J^x,8))|0,B=cm(B^F,7),G=G+(K=cm(K^(y=y+C|0),16))|0,y=y+(C=cm(C^G,12))|0,G=G+(K=cm(K^y,8))|0,C=cm(C^G,7),F=F+(K=cm(K^(v=v+A|0),16))|0,v=v+(A=cm(A^F,12))|0,F=F+(K=cm(K^v,8))|0,A=cm(A^F,7),G=G+(H=cm(H^(w=w+B|0),16))|0,w=w+(B=cm(B^G,12))|0,G=G+(H=cm(H^w,8))|0,B=cm(B^G,7),D=D+(I=cm(I^(x=x+C|0),16))|0,x=x+(C=cm(C^D,12))|0,D=D+(I=cm(I^x,8))|0,C=cm(C^D,7),E=E+(J=cm(J^(y=y+z|0),16))|0,y=y+(z=cm(z^E,12))|0,E=E+(J=cm(J^y,8))|0,z=cm(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0}let cv=cq(cu,{counterRight:!1,counterLength:4,allowShortKeys:!1}),cw=cq(cu,{counterRight:!1,counterLength:8,extendNonceFn:function(a,b,c,d){let e=a[0],f=a[1],g=a[2],h=a[3],i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=c[0],r=c[1],s=c[2],t=c[3];for(let a=0;a<20;a+=2)m=m+(q=cm(q^(e=e+i|0),16))|0,e=e+(i=cm(i^m,12))|0,m=m+(q=cm(q^e,8))|0,i=cm(i^m,7),n=n+(r=cm(r^(f=f+j|0),16))|0,f=f+(j=cm(j^n,12))|0,n=n+(r=cm(r^f,8))|0,j=cm(j^n,7),o=o+(s=cm(s^(g=g+k|0),16))|0,g=g+(k=cm(k^o,12))|0,o=o+(s=cm(s^g,8))|0,k=cm(k^o,7),p=p+(t=cm(t^(h=h+l|0),16))|0,h=h+(l=cm(l^p,12))|0,p=p+(t=cm(t^h,8))|0,l=cm(l^p,7),o=o+(t=cm(t^(e=e+j|0),16))|0,e=e+(j=cm(j^o,12))|0,o=o+(t=cm(t^e,8))|0,j=cm(j^o,7),p=p+(q=cm(q^(f=f+k|0),16))|0,f=f+(k=cm(k^p,12))|0,p=p+(q=cm(q^f,8))|0,k=cm(k^p,7),m=m+(r=cm(r^(g=g+l|0),16))|0,g=g+(l=cm(l^m,12))|0,m=m+(r=cm(r^g,8))|0,l=cm(l^m,7),n=n+(s=cm(s^(h=h+i|0),16))|0,h=h+(i=cm(i^n,12))|0,n=n+(s=cm(s^h,8))|0,i=cm(i^n,7);let u=0;d[u++]=e,d[u++]=f,d[u++]=g,d[u++]=h,d[u++]=q,d[u++]=r,d[u++]=s,d[u++]=t},allowShortKeys:!1}),cx=new Uint8Array(16),cy=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(cx.subarray(c))},cz=new Uint8Array(32);function cA(a,b,c,d,e){var f,g;let h,i;void 0!==e&&b5(e,void 0,"AAD");let j=a(b,c,cz),k=(f=d.length,g=e?e.length:0,b3(!0),(i=new DataView((h=new Uint8Array(16)).buffer,h.byteOffset,h.byteLength)).setBigUint64(0,BigInt(g),!0),i.setBigUint64(8,BigInt(f),!0),h),l=ct.create(j);e&&cy(l,e),cy(l,d),l.update(k);let m=l.digest();return b8(j,k),m}let cB=a=>(b,c,d)=>({encrypt(e,f){let g=e.length;(f=cd(g+16,f,!1)).set(e);let h=f.subarray(0,-16);a(b,c,h,h,1);let i=cA(a,b,c,h,d);return f.set(i,g),b8(i),f},decrypt(e,f){f=cd(e.length-16,f,!1);let g=e.subarray(0,-16),h=e.subarray(-16),i=cA(a,b,c,g,d);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(h,i))throw Error("invalid tag");return f.set(e.subarray(0,-16)),a(b,c,f,f,1),b8(i),f}});cB(cv);let cC=((a,b)=>{function c(d,...e){if(b5(d,void 0,"key"),!b9)throw Error("Non little-endian hardware is not yet supported");void 0!==a.nonceLength&&b5(e[0],a.varSizeNonce?void 0:a.nonceLength,"nonce");let f=a.tagLength;f&&void 0!==e[1]&&b5(e[1],void 0,"AAD");let g=b(d,...e),h=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");b5(b,void 0,"output")}},i=!1;return{encrypt(a,b){if(i)throw Error("cannot encrypt() twice with same key + nonce");return i=!0,b5(a),h(g.encrypt.length,b),g.encrypt(a,b)},decrypt(a,b){if(b5(a),f&&a.length<f)throw Error('"ciphertext" expected length bigger than tagLength='+f);return h(g.decrypt.length,b),g.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:24,tagLength:16},cB(cw)),cD=async({key:a,data:b})=>{let c=await b2("SHA-256").digest(a),d=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(b);var e=cg(cC)(new Uint8Array(c)).encrypt(d);if(b5(e),ca)return e.toHex();let f="";for(let a=0;a<e.length;a++)f+=cb[e[a]];return f},cE=async({key:a,data:b})=>{let c=await b2("SHA-256").digest(a),d=function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(ca)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=cc(a.charCodeAt(e)),f=cc(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(b),e=cg(cC)(new Uint8Array(c));return new TextDecoder().decode(e.decrypt(d))};a.s(["symmetricDecrypt",()=>cE,"symmetricEncrypt",()=>cD],10203);let cF=(a,b="ms")=>new Date(Date.now()+("sec"===b?1e3*a:a));a.s(["getDate",()=>cF],54813);var cG=a.i(51073),cH=a.i(39001);let cI=cH.object({id:cH.string(),createdAt:cH.date().default(()=>new Date),updatedAt:cH.date().default(()=>new Date)});a.s(["coreSchema",()=>cI],37207);var cJ=a.i(1467);let cK=cI.extend({providerId:cH.string(),accountId:cH.string(),userId:cJ.coerce.string(),accessToken:cH.string().nullish(),refreshToken:cH.string().nullish(),idToken:cH.string().nullish(),accessTokenExpiresAt:cH.date().nullish(),refreshTokenExpiresAt:cH.date().nullish(),scope:cH.string().nullish(),password:cH.string().nullish()});a.s(["accountSchema",()=>cK],95984);let cL=cH.object({key:cH.string(),count:cH.number(),lastRequest:cH.number()});a.s(["rateLimitSchema",()=>cL],39461);let cM=cI.extend({userId:cJ.coerce.string(),expiresAt:cH.date(),token:cH.string(),ipAddress:cH.string().nullish(),userAgent:cH.string().nullish()});a.s(["sessionSchema",()=>cM],53593);let cN=cI.extend({email:cH.string().transform(a=>a.toLowerCase()),emailVerified:cH.boolean().default(!1),name:cH.string(),image:cH.string().nullish()});a.s(["userSchema",()=>cN],71324);let cO=cI.extend({value:cH.string(),expiresAt:cH.date(),identifier:cH.string()});function cP(a){let b=a.split("\n    at ");return b.length<=1?a:(b.splice(1,1),b.join("\n    at "))}function cQ(a,b){class c extends a{#o;constructor(...a){if(function(){let a=Object.getOwnPropertyDescriptor(Error,"stackTraceLimit");return void 0===a?Object.isExtensible(Error):Object.prototype.hasOwnProperty.call(a,"writable")?a.writable:void 0!==a.set}()){const b=Error.stackTraceLimit;Error.stackTraceLimit=0,super(...a),Error.stackTraceLimit=b}else super(...a);const b=Error().stack;b&&(this.#o=cP(b.replace(/^Error/,this.name)))}get errorStack(){return this.#o}}return Object.defineProperty(c.prototype,"constructor",{get:()=>b,enumerable:!1,configurable:!0}),c}a.s(["verificationSchema",()=>cO],58478),a.s([],76221);let cR={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511};var cS=class extends Error{constructor(a="INTERNAL_SERVER_ERROR",b,c={},d="number"==typeof a?a:cR[a]){super(b?.message,b?.cause?{cause:b.cause}:void 0),this.status=a,this.body=b,this.headers=c,this.statusCode=d,this.name="APIError",this.status=a,this.headers=c,this.statusCode=d,this.body=b?{code:b?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...b}:void 0}},cT=class extends cS{constructor(a,b){super(400,{message:a,code:"VALIDATION_ERROR"}),this.message=a,this.issues=b,this.issues=b}},cU=class extends Error{constructor(a){super(a),this.name="BetterCallError"}};let cV=cQ(cS,Error);a.s(["APIError",()=>cV,"BetterCallError",()=>cU,"ValidationError",()=>cT,"hideInternalStackFrames",()=>cP,"makeErrorForHideStackFrame",()=>cQ,"statusCodes",()=>cR],39619);let cW=/^application\/([a-z0-9.+-]*\+)?json/i;async function cX(a,b){let c=a.headers.get("content-type")||"",d=c.toLowerCase();if(a.body){if(b&&b.length>0&&!b.some(a=>{let b=d.split(";")[0].trim(),c=a.toLowerCase().trim();return b===c||b.includes(c)})){if(!d)throw new cV(415,{message:`Content-Type is required. Allowed types: ${b.join(", ")}`,code:"UNSUPPORTED_MEDIA_TYPE"});throw new cV(415,{message:`Content-Type "${c}" is not allowed. Allowed types: ${b.join(", ")}`,code:"UNSUPPORTED_MEDIA_TYPE"})}if(cW.test(d))return await a.json();if(d.includes("application/x-www-form-urlencoded")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a.toString()}),c}if(d.includes("multipart/form-data")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a}),c}return d.includes("text/plain")?await a.text():d.includes("application/octet-stream")?await a.arrayBuffer():d.includes("application/pdf")||d.includes("image/")||d.includes("video/")?await a.blob():d.includes("application/stream")||a.body instanceof ReadableStream?a.body:await a.text()}}function cY(a){return a instanceof cV||a?.name==="APIError"}async function cZ(a){try{return{data:await a,error:null}}catch(a){return{data:null,error:a}}}function c$(a){return a instanceof Request||"[object Request]"===Object.prototype.toString.call(a)}function c_(a,b){if(a instanceof Response)return b?.headers instanceof Headers&&b.headers.forEach((b,c)=>{a.headers.set(c,b)}),a;if(a&&"object"==typeof a&&"_flag"in a&&"json"===a._flag){let c=a.body,d=a.routerResponse;if(d instanceof Response)return d;let e=new Headers;if(d?.headers){let a=new Headers(d.headers);for(let[b,c]of a.entries())a.set(b,c)}if(a.headers)for(let[b,c]of new Headers(a.headers).entries())e.set(b,c);if(b?.headers)for(let[a,c]of new Headers(b.headers).entries())e.set(a,c);return e.set("Content-Type","application/json"),new Response(JSON.stringify(c),{...d,headers:e,status:a.status??b?.status??d?.status,statusText:b?.statusText??d?.statusText})}if(cY(a))return c_(a.body,{status:b?.status??a.statusCode,statusText:a.status.toString(),headers:b?.headers||a.headers});let c=a,d=new Headers(b?.headers);if(a){if("string"==typeof a)c=a,d.set("Content-Type","text/plain");else if(a instanceof ArrayBuffer||ArrayBuffer.isView(a))c=a,d.set("Content-Type","application/octet-stream");else if(a instanceof Blob)c=a,d.set("Content-Type",a.type||"application/octet-stream");else if(a instanceof FormData)c=a;else if(a instanceof URLSearchParams)c=a,d.set("Content-Type","application/x-www-form-urlencoded");else if(a instanceof ReadableStream)c=a,d.set("Content-Type","application/octet-stream");else if(function(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}(a)){let b,e;b=0,e=new WeakMap,c=JSON.stringify(a,(a,c)=>{if("bigint"==typeof c)return c.toString();if("object"==typeof c&&null!==c){if(e.has(c))return`[Circular ref-${e.get(c)}]`;e.set(c,b++)}return c},void 0),d.set("Content-Type","application/json")}}else null===a&&(c=JSON.stringify(null)),d.set("content-type","application/json");return new Response(c,{...b,headers:d})}a.s(["toResponse",()=>c_],11675);let c0={name:"HMAC",hash:"SHA-256"},c1=async a=>{let b="string"==typeof a?new TextEncoder().encode(a):a;return await bY().importKey("raw",b,c0,!1,["sign","verify"])},c2=async(a,b,c)=>{try{let d=atob(a),e=new Uint8Array(d.length);for(let a=0,b=d.length;a<b;a++)e[a]=d.charCodeAt(a);return await bY().verify(c0,c,e,new TextEncoder().encode(b))}catch(a){return!1}},c3=async(a,b)=>{let c=await c1(b);return btoa(String.fromCharCode(...new Uint8Array(await bY().sign(c0.name,c,new TextEncoder().encode(a)))))},c4=async(a,b)=>{let c=await c3(a,b);return encodeURIComponent(a=`${a}.${c}`)},c5=(a,b)=>{let c=a;if(b)if("secure"===b)c="__Secure-"+a;else{if("host"!==b)return;c="__Host-"+a}return c},c6=(a,b,c={})=>{let d;if(d=c?.prefix==="secure"?`__Secure-${a}=${b}`:c?.prefix==="host"?`__Host-${a}=${b}`:`${a}=${b}`,a.startsWith("__Secure-")&&!c.secure&&(c.secure=!0),a.startsWith("__Host-")&&(c.secure||(c.secure=!0),"/"!==c.path&&(c.path="/"),c.domain&&(c.domain=void 0)),c&&"number"==typeof c.maxAge&&c.maxAge>=0){if(c.maxAge>3456e4)throw Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");d+=`; Max-Age=${Math.floor(c.maxAge)}`}if(c.domain&&"host"!==c.prefix&&(d+=`; Domain=${c.domain}`),c.path&&(d+=`; Path=${c.path}`),c.expires){if(c.expires.getTime()-Date.now()>3456e7)throw Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");d+=`; Expires=${c.expires.toUTCString()}`}return c.httpOnly&&(d+="; HttpOnly"),c.secure&&(d+="; Secure"),c.sameSite&&(d+=`; SameSite=${c.sameSite.charAt(0).toUpperCase()+c.sameSite.slice(1)}`),c.partitioned&&(c.secure||(c.secure=!0),d+="; Partitioned"),d},c7=async(a,b,c,d)=>c6(a,b=await c4(b,c),d);async function c8(a,b={}){let c={body:b.body,query:b.query};if(a.body){let d=await a.body["~standard"].validate(b.body);if(d.issues)return{data:null,error:c9(d.issues,"body")};c.body=d.value}if(a.query){let d=await a.query["~standard"].validate(b.query);if(d.issues)return{data:null,error:c9(d.issues,"query")};c.query=d.value}return a.requireHeaders&&!b.headers?{data:null,error:{message:"Headers is required",issues:[]}}:a.requireRequest&&!b.request?{data:null,error:{message:"Request is required",issues:[]}}:{data:c,error:null}}function c9(a,b){return{message:a.map(a=>`[${a.path?.length?`${b}.`+a.path.map(a=>"object"==typeof a?a.key:a).join("."):b}] ${a.message}`).join("; "),issues:a}}let da=async(a,{options:b,path:c})=>{let d,e=new Headers,{data:f,error:g}=await c8(b,a);if(g)throw new cT(g.message,g.issues);let h="headers"in a?a.headers instanceof Headers?a.headers:new Headers(a.headers):"request"in a&&c$(a.request)?a.request.headers:null,i=h?.get("cookie"),j=i?function(a){if("string"!=typeof a)throw TypeError("argument str must be a string");let b=new Map,c=0;for(;c<a.length;){let d=a.indexOf("=",c);if(-1===d)break;let e=a.indexOf(";",c);if(-1===e)e=a.length;else if(e<d){c=a.lastIndexOf(";",d-1)+1;continue}let f=a.slice(c,d).trim();if(!b.has(f)){let c=a.slice(d+1,e).trim();34===c.codePointAt(0)&&(c=c.slice(1,-1)),b.set(f,function(a){try{return a.includes("%")?decodeURIComponent(a):a}catch{return a}}(c))}c=e+1}return b}(i):void 0,k={...a,body:f.body,query:f.query,path:a.path||c||"virtual:",context:"context"in a&&a.context?a.context:{},returned:void 0,headers:a?.headers,request:a?.request,params:"params"in a?a.params:void 0,method:a.method??(Array.isArray(b.method)?b.method[0]:"*"===b.method?"GET":b.method),setHeader:(a,b)=>{e.set(a,b)},getHeader:a=>h?h.get(a):null,getCookie:(a,b)=>{let c=c5(a,b);return c&&j?.get(c)||null},getSignedCookie:async(a,b,c)=>{let d=c5(a,c);if(!d)return null;let e=j?.get(d);if(!e)return null;let f=e.lastIndexOf(".");if(f<1)return null;let g=e.substring(0,f),h=e.substring(f+1);return 44===h.length&&h.endsWith("=")?!!await c2(h,g,await c1(b))&&g:null},setCookie:(a,b,c)=>{var d;let f=c6(a,d=encodeURIComponent(d=b),c);return e.append("set-cookie",f),f},setSignedCookie:async(a,b,c,d)=>{let f=await c7(a,b,c,d);return e.append("set-cookie",f),f},redirect:a=>(e.set("location",a),new cV("FOUND",void 0,e)),error:(a,b,c)=>new cV(a,b,c),setStatus:a=>{d=a},json:(b,c)=>a.asResponse?{body:c?.body||b,routerResponse:c,_flag:"json"}:b,responseHeaders:e,get responseStatus(){return d}};for(let a of b.use||[]){let b=await a({...k,returnHeaders:!0,asResponse:!1});b.response&&Object.assign(k.context,b.response),b.headers&&b.headers.forEach((a,b)=>{k.responseHeaders.set(b,a)})}return k};function db(a,b,c){let d="string"==typeof a?a:void 0,e="object"==typeof b?b:a,f="function"==typeof b?b:c;if(("GET"===e.method||"HEAD"===e.method)&&e.body)throw new cU("Body is not allowed with GET or HEAD methods");if(d&&/\/{2,}/.test(d))throw new cU("Path cannot contain consecutive slashes");let g=async(...a)=>{let b=a[0]||{},{data:c,error:g}=await cZ(da(b,{options:e,path:d}));if(g){if(!(g instanceof cT))throw g;throw e.onValidationError&&await e.onValidationError({message:g.message,issues:g.issues}),new cV(400,{message:g.message,code:"VALIDATION_ERROR"})}let h=await f(c).catch(async a=>{if(cY(a)){let c=e.onAPIError;if(c&&await c(a),b.asResponse)return a}throw a}),i=c.responseHeaders,j=c.responseStatus;return b.asResponse?c_(h,{headers:i,status:j}):b.returnHeaders?b.returnStatus?{headers:i,response:h,status:j}:{headers:i,response:h}:b.returnStatus?{response:h,status:j}:h};return g.options=e,g.path=d,g}function dc(a,b){let c=async c=>{let d="function"==typeof a?a:b,e=await da(c,{options:"function"==typeof a?{}:a,path:"/"});if(!d)throw Error("handler must be defined");let f=await d(e),g=e.responseHeaders;return c.returnHeaders?{headers:g,response:f}:f};return c.options="function"==typeof a?{}:a,c}db.create=a=>(b,c,d)=>db(b,{...c,use:[...c?.use||[],...a?.use||[]]},d),dc.create=a=>function(b,c){if("function"==typeof b)return dc({use:a?.use},b);if(!c)throw Error("Middleware handler is required");return dc({...b,method:"*",use:[...a?.use||[],...b.use||[]]},c)};let dd={};function de(a){switch(a.constructor.name){case"ZodString":default:return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array"}}function df(a){let b=[];return a.metadata?.openapi?.parameters?b.push(...a.metadata.openapi.parameters):a.query instanceof cH.ZodObject&&Object.entries(a.query.shape).forEach(([a,c])=>{c instanceof cH.ZodObject&&b.push({name:a,in:"query",schema:{type:de(c),..."minLength"in c&&c.minLength?{minLength:c.minLength}:{},description:c.description}})}),b}function dg(a){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...a}}async function dh(a,b){return Object.entries(a).forEach(([a,b])=>{let c=b.options;if(!(!b.path||c.metadata?.SERVER_ONLY)&&("GET"===c.method&&(dd[b.path]={get:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:df(c),responses:dg(c.metadata?.openapi?.responses)}}),"POST"===c.method)){let a=function(a){if(a.metadata?.openapi?.requestBody)return a.metadata.openapi.requestBody;if(a.body&&(a.body instanceof cH.ZodObject||a.body instanceof cH.ZodOptional)){let b=a.body.shape;if(!b)return;let c={},d=[];return Object.entries(b).forEach(([a,b])=>{b instanceof cH.ZodObject&&(c[a]={type:de(b),description:b.description},b instanceof cH.ZodOptional||d.push(a))}),{required:!(a.body instanceof cH.ZodOptional)&&!!a.body,content:{"application/json":{schema:{type:"object",properties:c,required:d}}}}}}(c);dd[b.path]={post:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:df(c),...a?{requestBody:a}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:dg(c.metadata?.openapi?.responses)}}}}),{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:{schemas:{}},security:[{apiKeyCookie:[]}],servers:[{url:b?.url}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:dd}}let di=((e=function(){}).prototype=Object.create(null),Object.freeze(e.prototype),e);function dj(){return{root:{key:""},static:new di}}function dk(a){let[b,...c]=a.split("/");return""===c[c.length-1]?c.slice(0,-1):c}function dl(a,b){let c=new di;for(let[d,e]of b){let b=d<0?a.slice(-(d+1)).join("/"):a[d];if("string"==typeof e)c[e]=b;else{let a=b.match(e);if(a)for(let b in a.groups)c[b]=a.groups[b]}}return c}function dm(a,b="",c,d){b=b.toUpperCase(),47!==c.charCodeAt(0)&&(c=`/${c}`);let e=dk(c=c.replace(/\\:/g,"%3A")),f=a.root,g=0,h=[],i=[];for(let a=0;a<e.length;a++){let b=e[a];if(b.startsWith("**")){f.wildcard||(f.wildcard={key:"**"}),f=f.wildcard,h.push([-(a+1),b.split(":")[1]||"_",2===b.length]);break}if("*"===b||b.includes(":")){if(f.param||(f.param={key:"*"}),f=f.param,"*"===b)h.push([a,`_${g++}`,!0]);else if(b.includes(":",1)){let c=function(a){let b=a.replace(/:(\w+)/g,(a,b)=>`(?<${b}>[^/]+)`).replace(/\./g,"\\.");return RegExp(`^${b}$`)}(b);i[a]=c,f.hasRegexParam=!0,h.push([a,c,!1])}else h.push([a,b.slice(1),!1]);continue}"\\*"===b?b=e[a]="*":"\\*\\*"===b&&(b=e[a]="**");let c=f.static?.[b];if(c)f=c;else{let a={key:b};f.static||(f.static=new di),f.static[b]=a,f=a}}let j=h.length>0;f.methods||(f.methods=new di),f.methods[b]??=[],f.methods[b].push({data:d||null,paramsRegexp:i,paramsMap:j?h:void 0}),j||(a.static["/"+e.join("/")]=f)}let dn=(a,b)=>{if(!b?.openapi?.disabled){let c={path:"/api/reference",...b?.openapi};a.openapi=db(c.path,{method:"GET"},async b=>{let d,e;return new Response((d=await dh(a),e=c.scalar,`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(d)}
    </script>
	 <script>
      var configuration = {
	  	favicon: ${e?.logo?`data:image/svg+xml;utf8,${encodeURIComponent(e.logo)}`:void 0} ,
	   	theme: ${e?.theme||"saturn"},
        metaData: {
			title: ${e?.title||"Open API Reference"},
			description: ${e?.description||"Better Call Open API"},
		}
      }
      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    </script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>`),{headers:{"Content-Type":"text/html"}})})}let c=dj(),d=dj();for(let b of Object.values(a))if(!(!b.options||!b.path||b.options?.metadata?.SERVER_ONLY))for(let a of Array.isArray(b.options?.method)?b.options.method:[b.options?.method])dm(c,a,b.path,b);if(b?.routerMiddleware?.length)for(let{path:a,middleware:c}of b.routerMiddleware)dm(d,"*",a,c);let e=async a=>{let e=new URL(a.url),f=e.pathname,g=b?.basePath&&"/"!==b.basePath?f.split(b.basePath).reduce((a,c,d)=>(0!==d&&(d>1?a.push(`${b.basePath}${c}`):a.push(c)),a),[]).join(""):e.pathname;if(!g?.length||/\/{2,}/.test(g))return new Response(null,{status:404,statusText:"Not Found"});let h=function(a,b="",c,d){47===c.charCodeAt(c.length-1)&&(c=c.slice(0,-1));let e=a.static[c];if(e&&e.methods){let a=e.methods[b]||e.methods[""];if(void 0!==a)return a[0]}let f=dk(c),g=function a(b,c,d,e,f){if(f===e.length){if(c.methods){let a=c.methods[d]||c.methods[""];if(a)return a}if(c.param&&c.param.methods){let a=c.param.methods[d]||c.param.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}return}let g=e[f];if(c.static){let h=c.static[g];if(h){let c=a(b,h,d,e,f+1);if(c)return c}}if(c.param){let h=a(b,c.param,d,e,f+1);if(h){if(c.param.hasRegexParam){let a=h.find(a=>a.paramsRegexp[f]?.test(g))||h.find(a=>!a.paramsRegexp[f]);return a?[a]:void 0}return h}}if(c.wildcard&&c.wildcard.methods)return c.wildcard.methods[d]||c.wildcard.methods[""]}(a,a.root,b,f,0)?.[0];if(void 0!==g)return{data:g.data,params:g.paramsMap?dl(f,g.paramsMap):void 0}}(c,a.method,g);if(g.endsWith("/")!==h?.data?.path?.endsWith("/")&&!b?.skipTrailingSlashes||!h?.data)return new Response(null,{status:404,statusText:"Not Found"});let i={};e.searchParams.forEach((a,b)=>{b in i?Array.isArray(i[b])?i[b].push(a):i[b]=[i[b],a]:i[b]=a});let j=h.data;try{let c=j.options.metadata?.allowedMediaTypes||b?.allowedMediaTypes,e={path:g,method:a.method,headers:a.headers,params:h.params?JSON.parse(JSON.stringify(h.params)):{},request:a,body:j.options.disableBody?void 0:await cX(j.options.cloneRequest?a.clone():a,c),query:i,_flag:"router",asResponse:!0,context:b?.routerContext},f=function(a,b="",c,d){47===c.charCodeAt(c.length-1)&&(c=c.slice(0,-1));let e=dk(c);return(function a(b,c,d,e,f,g=[]){let h=e[f];if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];a&&g.push(...a)}if(c.param&&(a(b,c.param,d,e,f+1,g),f===e.length&&c.param.methods)){let a=c.param.methods[d]||c.param.methods[""];if(a){let b=a[0].paramsMap;b?.[b?.length-1]?.[2]&&g.push(...a)}}let i=c.static?.[h];if(i&&a(b,i,d,e,f+1,g),f===e.length&&c.methods){let a=c.methods[d]||c.methods[""];a&&g.push(...a)}return g})(a,a.root,b,e,0).map(a=>({data:a.data,params:a.paramsMap?dl(e,a.paramsMap):void 0}))}(d,"*",g);if(f?.length)for(let{data:a,params:b}of f){let c=await a({...e,params:b,asResponse:!1});if(c instanceof Response)return c}return await j(e)}catch(a){if(b?.onError)try{let c=await b.onError(a);if(c instanceof Response)return c_(c)}catch(a){if(cY(a))return c_(a);throw a}if(b?.throwError)throw a;if(cY(a))return c_(a);return console.error("# SERVER_ERROR: ",a),new Response(null,{status:500,statusText:"Internal Server Error"})}};return{handler:async a=>{let c=await b?.onRequest?.(a);if(c instanceof Response)return c;let d=await e(c$(c)?c:a),f=await b?.onResponse?.(d);return f instanceof Response?f:d},endpoints:a}};a.s(["createRouter",()=>dn],14687),a.s([],59393);let dp=new WeakMap;function dq(a,b){let c=b.fields,d={};for(let b in a){let e=c[b];if(!e){d[b]=a[b];continue}(!1!==e.returned||"id"===b)&&(d[b]=a[b])}return d}function dr(a,b,c){let d=`${b}:${c}`;dp.has(a)||dp.set(a,new Map);let e=dp.get(a);if(e.has(d))return e.get(d);let f="output"===c?(0,cG.getAuthTables)(a)[b]?.fields??{}:{},g="user"===b||"session"===b||"account"===b?a[b]?.additionalFields:void 0,h={...f,...g??{}};for(let c of a.plugins||[])c.schema&&c.schema[b]&&(h={...h,...c.schema[b].fields});return e.set(d,h),h}function ds(a,b){return dq(b,{fields:dr(a,"user","output")})}function dt(a,b){return dq(b,{fields:dr(a,"session","output")})}function du(a,b){let{accessToken:c,refreshToken:d,idToken:e,accessTokenExpiresAt:f,refreshTokenExpiresAt:g,password:h,...i}=dq(b,{fields:dr(a,"account","output")});return i}function dv(a,b){let c=b.action||"create",d=b.fields,e=Object.assign(Object.create(null),null);for(let b in d){if(b in a){if(!1===d[b].input){if(void 0!==d[b].defaultValue&&"update"!==c){e[b]=d[b].defaultValue;continue}if(a[b])throw new cV("BAD_REQUEST",{message:`${b} is not allowed to be set`});continue}if(d[b].validator?.input&&void 0!==a[b]){let c=d[b].validator.input["~standard"].validate(a[b]);if(c instanceof Promise)throw new cV("INTERNAL_SERVER_ERROR",{message:"Async validation is not supported for additional fields"});if("issues"in c&&c.issues)throw new cV("BAD_REQUEST",{message:c.issues[0]?.message||"Validation Error"});e[b]=c.value;continue}if(d[b].transform?.input&&void 0!==a[b]){e[b]=d[b].transform?.input(a[b]);continue}e[b]=a[b];continue}if(void 0!==d[b].defaultValue&&"create"===c){if("function"==typeof d[b].defaultValue){e[b]=d[b].defaultValue();continue}e[b]=d[b].defaultValue;continue}if(d[b].required&&"create"===c)throw new cV("BAD_REQUEST",{message:`${b} is required`})}return e}function dw(a,b={},c){return dv(b,{fields:dr(a,"user","input"),action:c})}function dx(a,b){return dv(b||{},{fields:dr(a,"user","input")})}function dy(a,b){return dv(b,{fields:dr(a,"account","input")})}function dz(a,b){return dv(b,{fields:dr(a,"session","input")})}function dA(a,b){if(!b)return a;for(let c in b){let d=b[c]?.modelName;for(let e in d&&(a[c].modelName=d),a[c].fields){let d=b[c]?.fields?.[e];d&&(a[c].fields[e].fieldName=d)}}return a}a.s(["mergeSchema",()=>dA,"parseAccountInput",()=>dy,"parseAccountOutput",()=>du,"parseAdditionalUserInput",()=>dx,"parseInputData",()=>dv,"parseSessionInput",()=>dz,"parseSessionOutput",()=>dt,"parseUserInput",()=>dw,"parseUserOutput",()=>ds],18065),a.i(80670);var dB=a.i(76634);function dC(a){let b=a.split("."),c=parseInt(b[b.length-1]||"0",10);return isNaN(c)?0:c}function dD(a,b){let c={};for(let d in a)c[d]={name:d,value:"",attributes:{...b,maxAge:0}};return c}let dE=a=>(b,c,d)=>{let e=function(a,b){let c={};for(let[d,e]of Object.entries(function(a){let b=a.headers?.get("cookie");if(!b)return{};let c={};for(let a of b.split("; ")){let[b,...d]=a.split("=");b&&d.length>0&&(c[b]=d.join("="))}return c}(b)))d.startsWith(a)&&(c[d]=e);return c}(b,d),f=d.context.logger;return{getValue:()=>Object.keys(e).sort((a,b)=>dC(a)-dC(b)).map(a=>e[a]).join(""),hasChunks:()=>Object.keys(e).length>0,chunk(d,g){let h=dD(e,c);for(let a in e)delete e[a];for(let i of function(a,b,c,d){let e=Math.ceil(b.value.length/3896);if(1===e)return c[b.name]=b.value,[b];let f=[];for(let a=0;a<e;a++){let d=`${b.name}.${a}`,e=3896*a,g=b.value.substring(e,e+3896);f.push({...b,name:d,value:g}),c[d]=g}return d.debug(`CHUNKING_${a.toUpperCase()}_COOKIE`,{message:`${a} cookie exceeds allowed 4096 bytes.`,emptyCookieSize:200,valueSize:b.value.length,chunkCount:e,chunks:f.map(a=>a.value.length+200)}),f}(a,{name:b,value:d,attributes:{...c,...g}},e,f))h[i.name]=i;return Object.values(h)},clean(){let a=dD(e,c);for(let a in e)delete e[a];return Object.values(a)},setCookies(a){for(let b of a)d.setCookie(b.name,b.value,b.attributes)}}},dF=dE("Session"),dG=dE("Account");function dH(a,b){let c=a.getCookie(b);if(c)return c;let d=[],e=a.headers?.get("cookie");if(!e)return null;let f={};for(let a of e.split("; ")){let[b,...c]=a.split("=");b&&c.length>0&&(f[b]=c.join("="))}for(let[a,c]of Object.entries(f))if(a.startsWith(b+".")){let b=parseInt(a.split(".").at(-1)||"0",10);isNaN(b)||d.push({index:b,value:c})}return d.length>0?(d.sort((a,b)=>a.index-b.index),d.map(a=>a.value).join("")):null}async function dI(a,b){let c=a.context.authCookies.accountData,d={maxAge:300,...c.attributes},e=await bN(b,a.context.secret,"better-auth-account",d.maxAge);if(e.length>4096){let b=dG(c.name,d,a),f=b.chunk(e,d);b.setCookies(f)}else{let b=dG(c.name,d,a);if(b.hasChunks()){let a=b.clean();b.setCookies(a)}a.setCookie(c.name,e,d)}}async function dJ(a){let b=dH(a,a.context.authCookies.accountData.name);if(b){let c=(0,dB.safeJSONParse)(await bO(b,a.context.secret,"better-auth-account"));if(c)return c}return null}let dK=cH.optional(cH.object({disableCookieCache:cJ.coerce.boolean().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:cJ.coerce.boolean().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()}));function dL(a){return!!a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then}a.s(["createAccountStore",()=>dG,"createSessionStore",()=>dF,"getAccountCookie",()=>dJ,"getChunkedCookie",()=>dH,"getSessionQuerySchema",()=>dK,"setAccountCookie",()=>dI],34084),a.s(["isPromise",()=>dL],23493);let dM=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)(?: (ago|from now))?$/i,dN="__Secure-",dO="__Host-";function dP(a){return a.startsWith(dN)?a.slice(9):a.startsWith(dO)?a.slice(7):a}function dQ(a){if(!a)return[];let b=[],c="",d=0;for(;d<a.length;){let e=a[d];if(","===e){let f=c.toLowerCase();if(f.includes("expires=")&&!f.includes("gmt"))c+=e,d++;else{let e=c.trim();e&&b.push(e),c="",++d<a.length&&" "===a[d]&&d++}continue}c+=e,d++}let e=c.trim();return e&&b.push(e),b}function dR(a){let b=new Map;return dQ(a).forEach(a=>{let[c,...d]=a.split(";").map(a=>a.trim()),[e,...f]=(c||"").split("="),g=f.join("=");if(!e||void 0===g)return;let h={value:g};d.forEach(a=>{let[b,...c]=a.split("="),d=c.join("="),e=b.trim().toLowerCase();switch(e){case"max-age":h["max-age"]=d?parseInt(d.trim(),10):void 0;break;case"expires":h.expires=d?new Date(d.trim()):void 0;break;case"domain":h.domain=d?d.trim():void 0;break;case"path":h.path=d?d.trim():void 0;break;case"secure":h.secure=!0;break;case"httponly":h.httponly=!0;break;case"samesite":h.samesite=d?d.trim().toLowerCase():void 0;break;default:h[e]=!d||d.trim()}}),b.set(e,h)}),b}function dS(a){return b=>{let c=b.response.headers.get("set-cookie");if(!c)return;let d=new Map;(a.get("cookie")||"").split(";").forEach(a=>{let[b,...c]=a.trim().split("=");b&&c.length>0&&d.set(b,c.join("="))}),dR(c).forEach((a,b)=>{d.set(b,a.value)});let e=Array.from(d.entries()).map(([a,b])=>`${a}=${b}`).join("; ");a.set("cookie",e)}}a.s(["HOST_COOKIE_PREFIX",()=>dO,"SECURE_COOKIE_PREFIX",()=>dN,"parseSetCookieHeader",()=>dR,"setCookieToHeader",()=>dS,"splitSetCookieHeader",()=>dQ,"stripSecureCookiePrefix",()=>dP],52060),a.i(62054);var dT=a.i(11592),dU=a.i(57085);let dV=new Map,dW={decode:(a,b="utf-8")=>(dV.has(b)||dV.set(b,new TextDecoder(b)),dV.get(b).decode(a)),encode:new TextEncoder().encode};a.s(["binary",()=>dW],32949);let dX=(a="SHA-256",b="none")=>{let c={importKey:async(b,c)=>bY().importKey("raw","string"==typeof b?new TextEncoder().encode(b):b,{name:"HMAC",hash:{name:a}},!1,[c]),sign:async(a,d)=>{"string"==typeof a&&(a=await c.importKey(a,"sign"));let e=await bY().sign("HMAC",a,"string"==typeof d?new TextEncoder().encode(d):d);return"hex"===b?bQ(e):"base64"===b||"base64url"===b||"base64urlnopad"===b?b1.encode(e,{padding:"base64urlnopad"!==b}):e},verify:async(a,d,e)=>("string"==typeof a&&(a=await c.importKey(a,"verify")),"hex"===b&&(e=(a=>{if(!a)return"";if("string"==typeof a){if(a.length%2!=0||!RegExp("^[0123456789abcdef]+$").test(a))throw Error("Invalid hexadecimal string");let b=new Uint8Array(a.length/2);for(let c=0;c<a.length;c+=2)b[c/2]=parseInt(a.slice(c,c+2),16);return new TextDecoder().decode(b)}return new TextDecoder().decode(a)})(e)),("base64"===b||"base64url"===b||"base64urlnopad"===b)&&(e=await b0.decode(e)),bY().verify("HMAC",a,"string"==typeof e?new TextEncoder().encode(e):e,"string"==typeof d?new TextEncoder().encode(d):d))};return c};function dY(a){let b=(a.advanced?.useSecureCookies!==void 0?a.advanced?.useSecureCookies:a.baseURL?!!a.baseURL.startsWith("https://"):dT.isProduction)?dN:"",c=!!a.advanced?.crossSubDomainCookies?.enabled,d=c?a.advanced?.crossSubDomainCookies?.domain||(a.baseURL?new URL(a.baseURL).hostname:void 0):void 0;if(c&&!d)throw new bP.BetterAuthError("baseURL is required when crossSubdomainCookies are enabled");return function(e,f={}){let g=a.advanced?.cookiePrefix||"better-auth",h=a.advanced?.cookies?.[e]?.name||`${g}.${e}`,i=a.advanced?.cookies?.[e]?.attributes;return{name:`${b}${h}`,attributes:{secure:!!b,sameSite:"lax",path:"/",httpOnly:!0,...c?{domain:d}:{},...a.advanced?.defaultCookieAttributes,...f,...i}}}}function dZ(a){let b=dY(a),c=b("session_token",{maxAge:a.session?.expiresIn||Math.round(function(a){let b,c=dM.exec("7d");if(!c||c[4]&&c[1])throw TypeError('Invalid time string format: "7d". Use formats like "7d", "30m", "1 hour", etc.');let d=parseFloat(c[2]),e=c[3].toLowerCase();switch(e){case"years":case"year":case"yrs":case"yr":case"y":b=315576e5*d;break;case"months":case"month":case"mo":b=2592e6*d;break;case"weeks":case"week":case"w":b=6048e5*d;break;case"days":case"day":case"d":b=864e5*d;break;case"hours":case"hour":case"hrs":case"hr":case"h":b=36e5*d;break;case"minutes":case"minute":case"mins":case"min":case"m":b=6e4*d;break;case"seconds":case"second":case"secs":case"sec":case"s":b=1e3*d;break;default:throw TypeError(`Unknown time unit: "${e}"`)}return"-"===c[1]||"ago"===c[4]?-b:b}("7d")/1e3)}),d=b("session_data",{maxAge:a.session?.cookieCache?.maxAge||300}),e=b("account_data",{maxAge:a.session?.cookieCache?.maxAge||300}),f=b("dont_remember");return{sessionToken:{name:c.name,attributes:c.attributes},sessionData:{name:d.name,attributes:d.attributes},dontRememberToken:{name:f.name,attributes:f.attributes},accountData:{name:e.name,attributes:e.attributes}}}async function d$(a,b,c){let d;if(!a.context.options.session?.cookieCache?.enabled)return;let e=(0,dU.filterOutputFields)(b.session,a.context.options.session?.additionalFields),f=ds(a.context.options,b.user),g=a.context.options.session?.cookieCache?.version,h="1";if(g){if("string"==typeof g)h=g;else if("function"==typeof g){let a=g(b.session,b.user);h=dL(a)?await a:a}}let i={session:e,user:f,updatedAt:Date.now(),version:h},j={...a.context.authCookies.sessionData.attributes,maxAge:c?void 0:a.context.authCookies.sessionData.attributes.maxAge},k=cF(j.maxAge||60,"sec").getTime(),l=a.context.options.session?.cookieCache?.strategy||"compact";if((d="jwe"===l?await bN(i,a.context.secret,"better-auth-session",j.maxAge||300):"jwt"===l?await bJ(i,a.context.secret,j.maxAge||300):b1.encode(JSON.stringify({session:i,expiresAt:k,signature:await dX("SHA-256","base64urlnopad").sign(a.context.secret,JSON.stringify({...i,expiresAt:k}))}),{padding:!1})).length>4093){let b=dF(a.context.authCookies.sessionData.name,j,a),c=b.chunk(d,j);b.setCookies(c)}else{let b=dF(a.context.authCookies.sessionData.name,j,a);if(b.hasChunks()){let a=b.clean();b.setCookies(a)}a.setCookie(a.context.authCookies.sessionData.name,d,j)}if(a.context.options.account?.storeAccountCookie){let b=await dJ(a);b&&await dI(a,b)}}async function d_(a,b,c,d){let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);c=void 0!==c?c:!!e;let f=a.context.authCookies.sessionToken.attributes,g=c?void 0:a.context.sessionConfig.expiresIn;await a.setSignedCookie(a.context.authCookies.sessionToken.name,b.session.token,a.context.secret,{...f,maxAge:g,...d}),c&&await a.setSignedCookie(a.context.authCookies.dontRememberToken.name,"true",a.context.secret,a.context.authCookies.dontRememberToken.attributes),await d$(a,b,c),a.context.setNewSession(b)}function d0(a,b){a.setCookie(b.name,"",{...b.attributes,maxAge:0})}function d1(a,b){if(d0(a,a.context.authCookies.sessionToken),d0(a,a.context.authCookies.sessionData),a.context.options.account?.storeAccountCookie){d0(a,a.context.authCookies.accountData);let b=dG(a.context.authCookies.accountData.name,a.context.authCookies.accountData.attributes,a),c=b.clean();b.setCookies(c)}"cookie"===a.context.oauthConfig.storeStateStrategy&&d0(a,a.context.createAuthCookie("oauth_state"));let c=dF(a.context.authCookies.sessionData.name,a.context.authCookies.sessionData.attributes,a),d=c.clean();c.setCookies(d),b||d0(a,a.context.authCookies.dontRememberToken)}a.s(["createHMAC",()=>dX],76230),a.s(["createCookieGetter",()=>dY,"deleteSessionCookie",()=>d1,"expireCookie",()=>d0,"getCookies",()=>dZ,"setCookieCache",()=>d$,"setSessionCookie",()=>d_],18828);let d2=Symbol.for("better-auth:global"),d3=null,d4={},d5="1.4.18";function d6(){return globalThis[d2]||(globalThis[d2]={version:d5,epoch:1,context:d4},d3=globalThis[d2]),(d3=globalThis[d2]).version!==d5&&(d3.version=d5,d3.epoch++),globalThis[d2]}function d7(){return d6().version}a.s(["__getBetterAuthGlobal",()=>d6,"getBetterAuthVersion",()=>d7],78799);let d8=import("node:async_hooks").then(a=>a.AsyncLocalStorage).catch(a=>{if("AsyncLocalStorage"in globalThis)return globalThis.AsyncLocalStorage;throw console.warn("[better-auth] Warning: AsyncLocalStorage is not available in this environment. Some features may not work as expected."),console.warn("[better-auth] Please read more about this warning at https://better-auth.com/docs/installation#mount-handler"),console.warn("[better-auth] If you are using Cloudflare Workers, please see: https://developers.cloudflare.com/workers/configuration/compatibility-flags/#nodejs-compatibility-flag"),a});async function d9(){let a=await d8;if(null!==a)return a;throw Error("getAsyncLocalStorage is only available in server code")}let ea=async()=>{let a=d6();if(!a.context.endpointContextAsyncStorage){let b=await d9();a.context.endpointContextAsyncStorage=new b}return a.context.endpointContextAsyncStorage};async function eb(){return ea()}async function ec(){let a=(await ea()).getStore();if(!a)throw Error("No auth context found. Please make sure you are calling this function within a `runWithEndpointContext` callback.");return a}async function ed(a,b){return(await ea()).run(a,b)}a.s(["getCurrentAuthContext",()=>ec,"getCurrentAuthContextAsyncLocalStorage",()=>eb,"runWithEndpointContext",()=>ed],46946);let ee=async()=>{let a=d6();if(!a.context.requestStateAsyncStorage){let b=await d9();a.context.requestStateAsyncStorage=new b}return a.context.requestStateAsyncStorage};async function ef(){return ee()}async function eg(){return void 0!==(await ee()).getStore()}async function eh(){let a=(await ee()).getStore();if(!a)throw Error("No request state found. Please make sure you are calling this function within a `runWithRequestState` callback.");return a}async function ei(a,b){return(await ee()).run(a,b)}function ej(a){let b=Object.freeze({});return{get ref(){return b},async get(){let c=await eh();if(!c.has(b)){let d=await a();return c.set(b,d),d}return c.get(b)},async set(a){(await eh()).set(b,a)}}}a.s(["defineRequestState",()=>ej,"getCurrentRequestState",()=>eh,"getRequestStateAsyncLocalStorage",()=>ef,"hasRequestState",()=>eg,"runWithRequestState",()=>ei],56967);let ek=async()=>{let a=d6();if(!a.context.adapterAsyncStorage){let b=await d9();a.context.adapterAsyncStorage=new b}return a.context.adapterAsyncStorage},el=async()=>ek(),em=async a=>ek().then(b=>b.getStore()||a).catch(()=>a),en=async(a,b)=>ek().then(c=>c.run(a,b)).catch(a=>{throw a}),eo=async(a,b)=>ek().then(c=>a.transaction(async a=>c.run(a,b))).catch(a=>{throw a});a.s(["getCurrentAdapter",()=>em,"getCurrentDBAdapterAsyncLocalStorage",()=>el,"runWithAdapter",()=>en,"runWithTransaction",()=>eo],46429),a.s([],4551);let ep=dc(async()=>({})),eq=dc.create({use:[ep,dc(async()=>({}))]}),er=[ep];function es(a,b,c){let d="string"==typeof a?a:void 0,e="object"==typeof b?b:a,f="function"==typeof b?b:c;return d?db(d,{...e,use:[...e?.use||[],...er]},async a=>ed(a,()=>f(a))):db({...e,use:[...e?.use||[],...er]},async a=>ed(a,()=>f(a)))}a.s(["createAuthEndpoint",()=>es,"createAuthMiddleware",()=>eq,"optionsMiddleware",()=>ep],62192)},26060,50635,59430,37324,78075,49907,83508,96116,a=>{"use strict";let b,c,d,e;var f,g,h=a.i(30778),i=a.i(10203),j=a.i(18828),k=a.i(61202),l=a.i(39001),m=a.i(1467);let n=l.looseObject({callbackURL:l.string(),codeVerifier:l.string(),errorURL:l.string().optional(),newUserURL:l.string().optional(),expiresAt:l.number(),link:l.object({email:l.string(),userId:m.coerce.string()}).optional(),requestSignUp:l.boolean().optional()});var o=class extends k.BetterAuthError{code;details;constructor(a,b){super(a,b),this.code=b.code,this.details=b.details}};async function p(a,b,c){let d=(0,h.generateRandomString)(32);if("cookie"===a.context.oauthConfig.storeStateStrategy){let e=await (0,i.symmetricEncrypt)({key:a.context.secret,data:JSON.stringify(b)}),f=a.context.createAuthCookie(c?.cookieName??"oauth_state",{maxAge:600});return a.setCookie(f.name,e,f.attributes),{state:d,codeVerifier:b.codeVerifier}}let e=a.context.createAuthCookie(c?.cookieName??"state",{maxAge:300});await a.setSignedCookie(e.name,d,a.context.secret,e.attributes);let f=new Date;f.setMinutes(f.getMinutes()+10);let g=await a.context.internalAdapter.createVerificationValue({value:JSON.stringify(b),identifier:d,expiresAt:f});if(!g)throw new o("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database",{code:"state_generation_error"});return{state:g.identifier,codeVerifier:b.codeVerifier}}async function q(a,b,c){let d;if("cookie"===a.context.oauthConfig.storeStateStrategy){let e=a.context.createAuthCookie(c?.cookieName??"oauth_state"),f=a.getCookie(e.name);if(!f)throw new o("State mismatch: auth state cookie not found",{code:"state_mismatch",details:{state:b}});try{let b=await (0,i.symmetricDecrypt)({key:a.context.secret,data:f});d=n.parse(JSON.parse(b))}catch(a){throw new o("State invalid: Failed to decrypt or parse auth state",{code:"state_invalid",details:{state:b},cause:a})}(0,j.expireCookie)(a,e)}else{let e=await a.context.internalAdapter.findVerificationValue(b);if(!e)throw new o("State mismatch: verification not found",{code:"state_mismatch",details:{state:b}});d=n.parse(JSON.parse(e.value));let f=a.context.createAuthCookie(c?.cookieName??"state"),g=await a.getSignedCookie(f.name,a.context.secret);if(!a.context.oauthConfig.skipStateCookieCheck&&(!g||g!==b))throw new o("State mismatch: State not persisted correctly",{code:"state_security_mismatch",details:{state:b}});(0,j.expireCookie)(a,f),await a.context.internalAdapter.deleteVerificationValue(e.id)}if(d.expiresAt<Date.now())throw new o("Invalid state: request expired",{code:"state_mismatch",details:{expiresAt:d.expiresAt}});return d}a.s(["StateError",()=>o,"generateGenericState",()=>p,"parseGenericState",()=>q],26060),a.i(4551);var r=a.i(56967);let{get:s,set:t}=(0,r.defineRequestState)(()=>null);a.i(59393);var u=a.i(39619);async function v(a,b,c){let d=a.body?.callbackURL||a.context.options.baseURL;if(!d)throw new u.APIError("BAD_REQUEST",{message:"callbackURL is required"});let e=(0,h.generateRandomString)(128),f={...c||{},callbackURL:d,codeVerifier:e,errorURL:a.body?.errorCallbackURL,newUserURL:a.body?.newUserCallbackURL,link:b,expiresAt:Date.now()+6e5,requestSignUp:a.body?.requestSignUp};await t(f);try{return p(a,f)}catch(b){throw a.context.logger.error("Failed to create verification",b),new u.APIError("INTERNAL_SERVER_ERROR",{message:"Unable to create verification",cause:b})}}async function w(a){let b,c=a.query.state||a.body.state,d=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;try{b=await q(a,c)}catch(b){if(a.context.logger.error("Failed to parse state",b),b instanceof o&&"state_security_mismatch"===b.code)throw a.redirect(`${d}?error=state_mismatch`);throw a.redirect(`${d}?error=please_restart_the_process`)}return b.errorURL||(b.errorURL=d),b&&await t(b),b}a.s(["generateState",()=>v,"parseState",()=>w],50635);let x={scope:"server"};a.s(["HIDE_METADATA",()=>x],59430),a.i(80670);var y=a.i(17648);a.s([],37324),a.s(["checkEndpointConflicts",()=>cn,"getEndpoints",()=>co,"router",()=>cp],49907),a.i(62054);var z=a.i(11592),A=a.i(33034);function B(a,b){if(b.advanced?.ipAddress?.disableIpTracking)return null;let c="headers"in a?a.headers:a;for(let a of b.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"]){let d="get"in c?c.get(a):c[a];if("string"==typeof d){let a=d.split(",")[0].trim();if((0,A.isValidIP)(a))return(0,A.normalizeIP)(a,{ipv6Subnet:b.advanced?.ipAddress?.ipv6Subnet})}}return(0,z.isTest)()||(0,z.isDevelopment)()?"127.0.0.1":null}function C(a,b="/api/auth"){try{let b=new URL(a);if("http:"!==b.protocol&&"https:"!==b.protocol)throw new k.BetterAuthError(`Invalid base URL: ${a}. URL must include 'http://' or 'https://'`)}catch(b){if(b instanceof k.BetterAuthError)throw b;throw new k.BetterAuthError(`Invalid base URL: ${a}. Please provide a valid base URL.`,{cause:b})}if(function(a){try{return"/"!==(new URL(a).pathname.replace(/\/+$/,"")||"/")}catch{throw new k.BetterAuthError(`Invalid base URL: ${a}. Please provide a valid base URL.`)}}(a))return a;let c=a.replace(/\/+$/,"");return b&&"/"!==b?(b=b.startsWith("/")?b:`/${b}`,`${c}${b}`):c}function D(a,b){return!!a&&""!==a.trim()&&("proto"===b?"http"===a||"https"===a:"host"===b&&![/\.\./,/\0/,/[\s]/,/^[.]/,/[<>'"]/,/javascript:/i,/file:/i,/data:/i].some(b=>b.test(a))&&(/^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*(:[0-9]{1,5})?$/.test(a)||/^(\d{1,3}\.){3}\d{1,3}(:[0-9]{1,5})?$/.test(a)||/^\[[0-9a-fA-F:]+\](:[0-9]{1,5})?$/.test(a)||/^localhost(:[0-9]{1,5})?$/i.test(a)))}function E(a,b,c,d,e){if(a)return C(a,b);if(!1!==d){let a=z.env.BETTER_AUTH_URL||z.env.NEXT_PUBLIC_BETTER_AUTH_URL||z.env.PUBLIC_BETTER_AUTH_URL||z.env.NUXT_PUBLIC_BETTER_AUTH_URL||z.env.NUXT_PUBLIC_AUTH_URL||("/"!==z.env.BASE_URL?z.env.BASE_URL:void 0);if(a)return C(a,b)}let f=c?.headers.get("x-forwarded-host"),g=c?.headers.get("x-forwarded-proto");if(f&&g&&e&&D(g,"proto")&&D(f,"host"))try{return C(`${g}://${f}`,b)}catch(a){}if(c){let a=F(c.url);if(!a)throw new k.BetterAuthError("Could not get origin from request. Please provide a valid base URL.");return C(a,b)}}function F(a){try{let b=new URL(a);return"null"===b.origin?null:b.origin}catch{return null}}function G(a){return"-"===a||"^"===a||"$"===a||"+"===a||"."===a||"("===a||")"===a||"|"===a||"["===a||"]"===a||"{"===a||"}"===a||"*"===a||"?"===a||"\\"===a?`\\${a}`:a}function H(a,b){if("string"!=typeof b)throw TypeError(`Sample must be a string, but ${typeof b} given`);return a.test(b)}function I(a,b){if("string"!=typeof a&&!Array.isArray(a))throw TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof a} given`);if(("string"==typeof b||"boolean"==typeof b)&&(b={separator:b}),2==arguments.length&&!(void 0===b||"object"==typeof b&&null!==b&&!Array.isArray(b)))throw TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof b} given`);if("\\"===(b=b||{}).separator)throw Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let c=function a(b,c=!0){if(Array.isArray(b))return`(?:${b.map(b=>`^${a(b,c)}$`).join("|")})`;let d="",e="",f=".";!0===c?(d="/",e="[/\\\\]",f="[^/\\\\]"):c&&((e=function(a){let b="";for(let c=0;c<a.length;c++)b+=G(a[c]);return b}(d=c)).length>1?(e=`(?:${e})`,f=`((?!${e}).)`):f=`[^${e}]`);let g=c?`${e}+?`:"",h=c?`${e}*?`:"",i=c?b.split(d):[b],j="";for(let a=0;a<i.length;a++){let b=i[a],d=i[a+1],e="";if(b||!(a>0)){if(c&&(e=a===i.length-1?h:"**"!==d?g:""),c&&"**"===b){e&&(j+=0===a?"":e,j+=`(?:${f}*?${e})*?`);continue}for(let a=0;a<b.length;a++){let c=b[a];"\\"===c?a<b.length-1&&(j+=G(b[a+1]),a++):"?"===c?j+=f:"*"===c?j+=`${f}*?`:j+=G(c)}j+=e}}return j}(a,b.separator),d=RegExp(`^${c}$`,b.flags),e=H.bind(null,d);return e.options=b,e.pattern=a,e.regexp=d,e}let J=(a,b,c)=>{if(a.startsWith("/"))return!!c?.allowRelativePaths&&a.startsWith("/")&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(a);if(b.includes("*")||b.includes("?")){if(b.includes("://"))return I(b)(F(a)||a);let c=function(a){try{return new URL(a).host}catch{return null}}(a);return!!c&&I(b)(c)}let d=function(a){try{return new URL(a).protocol}catch{return null}}(a);return"http:"!==d&&"https:"!==d&&d?a.startsWith(b):b===F(a)};var K=a.i(6580),L=a.i(14639),M=a.i(616),N=a.i(62192);function O(a){return!0===a.context.skipOriginCheck&&a.context.options.advanced?.disableCSRFCheck===void 0}let P=(0,L.deprecate)(function(){},"disableOriginCheck: true currently also disables CSRF checks. In a future version, disableOriginCheck will ONLY disable URL validation. To keep CSRF disabled, add disableCSRFCheck: true to your config."),Q=(0,N.createAuthMiddleware)(async a=>{if(a.request?.method==="GET"||a.request?.method==="OPTIONS"||a.request?.method==="HEAD"||!a.request||(await S(a),a.context.skipOriginCheck))return;let{body:b,query:c}=a,d=b?.callbackURL||c?.callbackURL,e=b?.redirectTo,f=b?.errorCallbackURL,g=b?.newUserCallbackURL,h=(b,c)=>{if(b&&!a.context.isTrustedOrigin(b,{allowRelativePaths:"origin"!==c}))throw a.context.logger.error(`Invalid ${c}: ${b}`),a.context.logger.info(`If it's a valid URL, please add ${b} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${a.context.trustedOrigins}`),new u.APIError("FORBIDDEN",{message:`Invalid ${c}`})};d&&h(d,"callbackURL"),e&&h(e,"redirectURL"),f&&h(f,"errorCallbackURL"),g&&h(g,"newUserCallbackURL")}),R=a=>(0,N.createAuthMiddleware)(async b=>{if(!b.request||b.context.skipOriginCheck)return;let c=a(b),d=(a,c)=>{if(a&&!b.context.isTrustedOrigin(a,{allowRelativePaths:"origin"!==c}))throw b.context.logger.error(`Invalid ${c}: ${a}`),b.context.logger.info(`If it's a valid URL, please add ${a} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${b.context.trustedOrigins}`),new u.APIError("FORBIDDEN",{message:`Invalid ${c}`})};for(let a of Array.isArray(c)?c:[c])d(a,"callbackURL")});async function S(a,b=!1){let c=a.request?.headers;if(!c||!a.request)return;let d=c.get("origin")||c.get("referer")||"",e=c.has("cookie");if(a.context.skipCSRFCheck)return;if(O(a)){a.context.options.advanced?.disableOriginCheck===!0&&P();return}let f=a.context.skipOriginCheck;if(Array.isArray(f))try{let b=new URL(a.context.baseURL).pathname,c=(0,M.normalizePathname)(a.request.url,b);if(f.some(a=>c.startsWith(a)))return}catch{}if(!(b||e))return;if(!d||"null"===d)throw new u.APIError("FORBIDDEN",{message:K.BASE_ERROR_CODES.MISSING_OR_NULL_ORIGIN});let g=Array.isArray(a.context.options.trustedOrigins)?a.context.trustedOrigins:[...a.context.trustedOrigins,...(await a.context.options.trustedOrigins?.(a.request))?.filter(a=>!!a)||[]];if(!g.some(a=>J(d,a)))throw a.context.logger.error(`Invalid origin: ${d}`),a.context.logger.info(`If it's a valid URL, please add ${d} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${g}`),new u.APIError("FORBIDDEN",{message:"Invalid origin"})}let T=(0,N.createAuthMiddleware)(async a=>{a.request&&await U(a)});async function U(a){let b=a.request;if(!b||a.context.skipCSRFCheck||O(a))return;let c=b.headers;if(c.has("cookie"))return await S(a);let d=c.get("Sec-Fetch-Site"),e=c.get("Sec-Fetch-Mode"),f=c.get("Sec-Fetch-Dest");if(d&&d.trim()||e&&e.trim()||f&&f.trim()){if("cross-site"===d&&"navigate"===e)throw a.context.logger.error("Blocked cross-site navigation login attempt (CSRF protection)",{secFetchSite:d,secFetchMode:e,secFetchDest:f}),new u.APIError("FORBIDDEN",{message:K.BASE_ERROR_CODES.CROSS_SITE_NAVIGATION_LOGIN_BLOCKED});return await S(a,!0)}}var V=a.i(76634);let W=new Map;async function X(a,b){if(!b.rateLimit.enabled)return;let c=new URL(b.baseURL).pathname,d=(0,M.normalizePathname)(a.url,c),e=b.rateLimit.window,f=b.rateLimit.max,g=B(a,b.options);if(!g)return;let h=(0,A.createRateLimitKey)(g,d),i=[{pathMatcher:a=>a.startsWith("/sign-in")||a.startsWith("/sign-up")||a.startsWith("/change-password")||a.startsWith("/change-email"),window:10,max:3}].find(a=>a.pathMatcher(d));for(let a of(i&&(e=i.window,f=i.max),b.options.plugins||[]))if(a.rateLimit){let b=a.rateLimit.find(a=>a.pathMatcher(d));if(b){e=b.window,f=b.max;break}}if(b.rateLimit.customRules){let c=Object.keys(b.rateLimit.customRules).find(a=>a.includes("*")?I(a)(d):a===d);if(c){let d=b.rateLimit.customRules[c],g="function"==typeof d?await d(a,{window:e,max:f}):d;if(g&&(e=g.window,f=g.max),!1===g)return}}let j=function(a,b){let c,d;if(a.options.rateLimit?.customStorage)return a.options.rateLimit.customStorage;let e=a.rateLimit.storage;return"secondary-storage"===e?{get:async b=>{let c=await a.options.secondaryStorage?.get(b);return c?(0,V.safeJSONParse)(c):null},set:async(c,d,e)=>{let f=b?.window??a.options.rateLimit?.window??10;await a.options.secondaryStorage?.set?.(c,JSON.stringify(d),f)}}:"memory"===e?{async get(a){let b=W.get(a);return b?Date.now()>=b.expiresAt?(W.delete(a),null):b.data:null},async set(c,d,e){let f=b?.window??a.options.rateLimit?.window??10,g=Date.now()+1e3*f;W.set(c,{data:d,expiresAt:g})}}:(c="rateLimit",d=a.adapter,{get:async a=>{let b=(await d.findMany({model:c,where:[{field:"key",value:a}]}))[0];return"bigint"==typeof b?.lastRequest&&(b.lastRequest=Number(b.lastRequest)),b},set:async(b,e,f)=>{try{f?await d.updateMany({model:c,where:[{field:"key",value:b}],update:{count:e.count,lastRequest:e.lastRequest}}):await d.create({model:c,data:{key:b,count:e.count,lastRequest:e.lastRequest}})}catch(b){a.logger.error("Error setting rate limit",b)}}})}(b,{window:e}),k=await j.get(h),l=Date.now();if(k){var m,n,o;let a=l-k.lastRequest;if(m=f,n=e,Date.now()-k.lastRequest<1e3*n&&k.count>=m)return o=Math.ceil((k.lastRequest+1e3*e-Date.now())/1e3),new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":o.toString()}});a>1e3*e?await j.set(h,{...k,count:1,lastRequest:l},!0):await j.set(h,{...k,count:k.count+1,lastRequest:l},!0)}else await j.set(h,{key:h,count:1,lastRequest:l})}var Y=a.i(54813),Z=a.i(18065),$=Object.defineProperty,_=Object.getOwnPropertyDescriptor,aa=Object.getOwnPropertyNames,ab=Object.prototype.hasOwnProperty,ac=(a,b,c,d)=>{if(b&&"object"==typeof b||"function"==typeof b)for(var e,f=aa(b),g=0,h=f.length;g<h;g++)e=f[g],ab.call(a,e)||e===c||$(a,e,{get:(a=>b[a]).bind(null,e),enumerable:!(d=_(b,e))||d.enumerable});return a};a.i(76221);var ad=a.i(51073),ae=a.i(14769);async function af(b,c){let d;if(b.database)d="function"==typeof b.database?b.database(b):await c(b);else{let c=Object.keys((0,ad.getAuthTables)(b)).reduce((a,b)=>(a[b]=[],a),{}),{memoryAdapter:e}=await a.A(73623);d=e(c)(b)}return d.transaction||(ae.logger.warn("Adapter does not correctly implement transaction function, patching it automatically. Please update your adapter implementation."),d.transaction=async a=>a(d)),d}async function ag(b){return af(b,async b=>{let{createKyselyAdapter:c}=await a.A(37667),{kysely:d,databaseType:e,transaction:f}=await c(b);if(!d)throw new k.BetterAuthError("Failed to initialize database adapter");let{kyselyAdapter:g}=await a.A(37667);return g(d,{type:e||"sqlite",debugLogs:!!b.database&&"debugLogs"in b.database&&b.database.debugLogs,transaction:f})(b)})}let ah=(a,b)=>({type:a,...b});function ai(a,b){let c=b.id?{id:b.id}:{};for(let d in a){let e=a[d],f=b[d];void 0!==f&&(c[e.fieldName||d]=f)}return c}function aj(a,b){if(!b)return null;let c={id:b.id};for(let[d,e]of Object.entries(a))c[d]=b[e.fieldName||d];return c}var ak=a.i(46429),al=a.i(46946);function am(a,b){let c=b.hooks;return{createWithHooks:async function(b,d,e){let f=await (0,al.getCurrentAuthContext)().catch(()=>null),g=b;for(let a of c||[]){let b=a[d]?.create?.before;if(b){let a=await b(g,f);if(!1===a)return null;"object"==typeof a&&"data"in a&&(g={...g,...a.data})}}let h=e?await e.fn(g):null,i=!e||e.executeMainFn?await (await (0,ak.getCurrentAdapter)(a)).create({model:d,data:g,forceAllowId:!0}):h;for(let a of c||[]){let b=a[d]?.create?.after;b&&await b(i,f)}return i},updateWithHooks:async function(b,d,e,f){let g=await (0,al.getCurrentAuthContext)().catch(()=>null),h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;"object"==typeof a&&"data"in a&&(h={...h,...a.data})}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await (await (0,ak.getCurrentAdapter)(a)).update({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j},updateManyWithHooks:async function(b,d,e,f){let g=await (0,al.getCurrentAuthContext)().catch(()=>null),h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;"object"==typeof a&&"data"in a&&(h={...h,...a.data})}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await (await (0,ak.getCurrentAdapter)(a)).updateMany({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j},deleteWithHooks:async function(b,d,e){let f=await (0,al.getCurrentAuthContext)().catch(()=>null),g=null;try{g=(await (await (0,ak.getCurrentAdapter)(a)).findMany({model:d,where:b,limit:1}))[0]||null}catch{}if(g)for(let a of c||[]){let b=a[d]?.delete?.before;if(b&&await b(g,f)===!1)return null}let h=e?await e.fn(b):null,i=!e||e.executeMainFn?await (await (0,ak.getCurrentAdapter)(a)).delete({model:d,where:b}):h;if(g)for(let a of c||[]){let b=a[d]?.delete?.after;b&&await b(g,f)}return i},deleteManyWithHooks:async function(b,d,e){let f=await (0,al.getCurrentAuthContext)().catch(()=>null),g=[];try{g=await (await (0,ak.getCurrentAdapter)(a)).findMany({model:d,where:b})}catch{}for(let a of g)for(let b of c||[]){let c=b[d]?.delete?.before;if(c&&await c(a,f)===!1)return null}let h=e?await e.fn(b):null,i=!e||e.executeMainFn?await (await (0,ak.getCurrentAdapter)(a)).deleteMany({model:d,where:b}):h;for(let a of g)for(let b of c||[]){let c=b[d]?.delete?.after;c&&await c(a,f)}return i}}}let an=(a,b)=>{let c=b.logger,d=b.options,e=d.secondaryStorage,f=d.session?.expiresIn||604800,{createWithHooks:g,updateWithHooks:h,updateManyWithHooks:i,deleteWithHooks:j,deleteManyWithHooks:k}=am(a,b);async function l(a){if(!e)return;let b=await e.get(`active-sessions-${a.id}`);if(!b)return;let c=Date.now(),d=((0,V.safeJSONParse)(b)||[]).filter(a=>a.expiresAt>c);await Promise.all(d.map(async({token:b})=>{let d=await e.get(b);if(!d)return;let f=(0,V.safeJSONParse)(d);if(!f)return;let g=Math.max(Math.floor(new Date(f.session.expiresAt).getTime()-c)/1e3,0);await e.set(b,JSON.stringify({session:f.session,user:a}),Math.floor(g))}))}return{createOAuthUser:async(b,c)=>(0,ak.runWithTransaction)(a,async()=>{let a=await g({createdAt:new Date,updatedAt:new Date,...b},"user",void 0);return{user:a,account:await g({...c,userId:a.id,createdAt:new Date,updatedAt:new Date},"account",void 0)}}),createUser:async a=>await g({createdAt:new Date,updatedAt:new Date,...a,email:a.email?.toLowerCase()},"user",void 0),createAccount:async a=>await g({createdAt:new Date,updatedAt:new Date,...a},"account",void 0),listSessions:async c=>{if(e){let a=await e.get(`active-sessions-${c}`);if(!a)return[];let d=(0,V.safeJSONParse)(a)||[],f=Date.now(),g=new Set,h=[];for(let{token:a,expiresAt:c}of d){if(c<=f||g.has(a))continue;g.add(a);let d=await e.get(a);if(d)try{let a="string"==typeof d?JSON.parse(d):d;if(!a?.session)continue;h.push((0,Z.parseSessionOutput)(b.options,{...a.session,expiresAt:new Date(a.session.expiresAt)}))}catch{continue}}return h}return await (await (0,ak.getCurrentAdapter)(a)).findMany({model:"session",where:[{field:"userId",value:c}]})},listUsers:async(b,c,d,e)=>await (await (0,ak.getCurrentAdapter)(a)).findMany({model:"user",limit:b,offset:c,sortBy:d,where:e}),countTotalUsers:async b=>{let c=await (await (0,ak.getCurrentAdapter)(a)).count({model:"user",where:b});return"string"==typeof c?parseInt(c):c},deleteUser:async a=>{(!e||d.session?.storeSessionInDatabase)&&await k([{field:"userId",value:a}],"session",void 0),await k([{field:"userId",value:a}],"account",void 0),await j([{field:"id",value:a}],"user",void 0)},createSession:async(b,c,h,i)=>{let j=await (0,al.getCurrentAuthContext)().catch(()=>null),k=j?.headers||j?.request?.headers,{id:l,...m}=h||{},n=(0,Z.parseSessionInput)(j?.context.options??d,{}),o={ipAddress:(j?.request||j?.headers)&&B(j?.request||j?.headers,j?.context.options)||"",userAgent:k?.get("user-agent")||"",...m,expiresAt:c?(0,Y.getDate)(86400,"sec"):(0,Y.getDate)(f,"sec"),userId:b,token:(0,y.generateId)(32),createdAt:new Date,updatedAt:new Date,...n,...i?m:{}};return await g(o,"session",e?{fn:async c=>{let d=await e.get(`active-sessions-${b}`),f=[],g=Date.now();d&&(f=(f=(0,V.safeJSONParse)(d)||[]).filter(a=>a.expiresAt>g&&a.token!==o.token));let h=[...f,{token:o.token,expiresAt:o.expiresAt.getTime()}].sort((a,b)=>a.expiresAt-b.expiresAt),i=Math.max(Math.floor(((h.at(-1)?.expiresAt??o.expiresAt.getTime())-g)/1e3),0);i>0&&await e.set(`active-sessions-${b}`,JSON.stringify(h),i);let j=await a.findOne({model:"user",where:[{field:"id",value:b}]}),k=Math.max(Math.floor((o.expiresAt.getTime()-g)/1e3),0);return k>0&&await e.set(o.token,JSON.stringify({session:c,user:j}),k),c},executeMainFn:d.session?.storeSessionInDatabase}:void 0)},findSession:async c=>{if(e){let a=await e.get(c);if(!a&&!d.session?.storeSessionInDatabase)return null;if(a){let c=(0,V.safeJSONParse)(a);return c?{session:(0,Z.parseSessionOutput)(b.options,{...c.session,expiresAt:new Date(c.session.expiresAt),createdAt:new Date(c.session.createdAt),updatedAt:new Date(c.session.updatedAt)}),user:(0,Z.parseUserOutput)(b.options,{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)})}:null}}let f=await (await (0,ak.getCurrentAdapter)(a)).findOne({model:"session",where:[{value:c,field:"token"}],join:{user:!0}});if(!f)return null;let{user:g,...h}=f;return g?{session:(0,Z.parseSessionOutput)(b.options,h),user:(0,Z.parseUserOutput)(b.options,g)}:null},findSessions:async b=>{if(e){let a=[];for(let c of b){let b=await e.get(c);if(b)try{let c="string"==typeof b?JSON.parse(b):b;if(!c?.session)continue;let d={session:{...c.session,expiresAt:new Date(c.session.expiresAt)},user:{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)}};a.push(d)}catch{continue}}return a}let c=await (await (0,ak.getCurrentAdapter)(a)).findMany({model:"session",where:[{field:"token",value:b,operator:"in"}],join:{user:!0}});return!c.length||c.some(a=>!a.user)?[]:c.map(a=>{let{user:b,...c}=a;return{session:c,user:b}})},updateSession:async(a,c)=>await h(c,[{field:"token",value:a}],"session",e?{async fn(c){let d=await e.get(a);if(!d)return null;let f=(0,V.safeJSONParse)(d);if(!f)return null;let g={...f.session,...c,expiresAt:new Date(c.expiresAt??f.session.expiresAt),createdAt:new Date(f.session.createdAt),updatedAt:new Date(c.updatedAt??f.session.updatedAt)},h=(0,Z.parseSessionOutput)(b.options,g),i=Date.now(),j=new Date(h.expiresAt).getTime(),k=Math.max(Math.floor((j-i)/1e3),0);if(k>0){await e.set(a,JSON.stringify({session:h,user:f.user}),k);let b=`active-sessions-${h.userId}`,c=await e.get(b),d=(c&&(0,V.safeJSONParse)(c)||[]).filter(b=>b.token!==a&&b.expiresAt>i).concat([{token:a,expiresAt:j}]).sort((a,b)=>a.expiresAt-b.expiresAt),g=d.at(-1)?.expiresAt;g&&g>i?await e.set(b,JSON.stringify(d),Math.floor((g-i)/1e3)):await e.delete(b)}return h},executeMainFn:d.session?.storeSessionInDatabase}:void 0),deleteSession:async a=>{if(e){let f=await e.get(a);if(f){let{session:b}=(0,V.safeJSONParse)(f)??{};if(!b)return void c.error("Session not found in secondary storage");let d=b.userId,g=await e.get(`active-sessions-${d}`);if(g){let b=(0,V.safeJSONParse)(g)||[],c=Date.now(),f=b.filter(b=>b.expiresAt>c&&b.token!==a),h=f.sort((a,b)=>a.expiresAt-b.expiresAt).at(-1)?.expiresAt;f.length>0&&h&&h>Date.now()?await e.set(`active-sessions-${d}`,JSON.stringify(f),Math.floor((h-c)/1e3)):await e.delete(`active-sessions-${d}`)}else c.error("Active sessions list not found in secondary storage")}if(await e.delete(a),!d.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await j([{field:"token",value:a}],"session",void 0)},deleteAccounts:async a=>{await k([{field:"userId",value:a}],"account",void 0)},deleteAccount:async a=>{await j([{field:"id",value:a}],"account",void 0)},deleteSessions:async a=>{if(e){if("string"==typeof a){let b=await e.get(`active-sessions-${a}`),c=b?(0,V.safeJSONParse)(b):[];if(!c)return;for(let a of c)await e.delete(a.token);await e.delete(`active-sessions-${a}`)}else for(let b of a)await e.get(b)&&await e.delete(b);if(!d.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await k([{field:Array.isArray(a)?"token":"userId",value:a,operator:Array.isArray(a)?"in":void 0}],"session",void 0)},findOAuthUser:async(b,c,d)=>{let e=await (await (0,ak.getCurrentAdapter)(a)).findOne({model:"account",where:[{value:c,field:"accountId"},{value:d,field:"providerId"}],join:{user:!0}});if(e)if(e.user)return{user:e.user,linkedAccount:e,accounts:[e]};else{let c=await (await (0,ak.getCurrentAdapter)(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,linkedAccount:e,accounts:[e]}:null}{let c=await (await (0,ak.getCurrentAdapter)(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,linkedAccount:null,accounts:await (await (0,ak.getCurrentAdapter)(a)).findMany({model:"account",where:[{value:c.id,field:"userId"}]})||[]}:null}},findUserByEmail:async(b,c)=>{let d=await (await (0,ak.getCurrentAdapter)(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}],join:{...c?.includeAccounts?{account:!0}:{}}});if(!d)return null;let{account:e,...f}=d;return{user:f,accounts:e??[]}},findUserById:async b=>b?await (await (0,ak.getCurrentAdapter)(a)).findOne({model:"user",where:[{field:"id",value:b}]}):null,linkAccount:async a=>await g({createdAt:new Date,updatedAt:new Date,...a},"account",void 0),updateUser:async(a,b)=>{let c=await h(b,[{field:"id",value:a}],"user",void 0);return await l(c),c},updateUserByEmail:async(a,b)=>{let c=await h(b,[{field:"email",value:a.toLowerCase()}],"user",void 0);return await l(c),c},updatePassword:async(a,b)=>{await i({password:b},[{field:"userId",value:a},{field:"providerId",value:"credential"}],"account",void 0)},findAccounts:async b=>await (await (0,ak.getCurrentAdapter)(a)).findMany({model:"account",where:[{field:"userId",value:b}]}),findAccount:async b=>await (await (0,ak.getCurrentAdapter)(a)).findOne({model:"account",where:[{field:"accountId",value:b}]}),findAccountByProviderId:async(b,c)=>await (await (0,ak.getCurrentAdapter)(a)).findOne({model:"account",where:[{field:"accountId",value:b},{field:"providerId",value:c}]}),findAccountByUserId:async b=>await (await (0,ak.getCurrentAdapter)(a)).findMany({model:"account",where:[{field:"userId",value:b}]}),updateAccount:async(a,b)=>await h(b,[{field:"id",value:a}],"account",void 0),createVerificationValue:async a=>await g({createdAt:new Date,updatedAt:new Date,...a},"verification",void 0),findVerificationValue:async b=>{let c=await (await (0,ak.getCurrentAdapter)(a)).findMany({model:"verification",where:[{field:"identifier",value:b}],sortBy:{field:"createdAt",direction:"desc"},limit:1});return d.verification?.disableCleanup||await k([{field:"expiresAt",value:new Date,operator:"lt"}],"verification",void 0),c[0]},deleteVerificationValue:async a=>{await j([{field:"id",value:a}],"verification",void 0)},deleteVerificationByIdentifier:async a=>{await j([{field:"identifier",value:a}],"verification",void 0)},updateVerificationValue:async(a,b)=>await h(b,[{field:"id",value:a}],"verification",void 0)}};a.i(61279),a.s(["default",0,m],57777),a.i(57777),a.s(["$brand",()=>m.$brand,"$input",()=>m.$input,"$output",()=>m.$output,"NEVER",()=>m.NEVER,"TimePrecision",()=>m.TimePrecision,"ZodAny",()=>m.ZodAny,"ZodArray",()=>m.ZodArray,"ZodBase64",()=>m.ZodBase64,"ZodBase64URL",()=>m.ZodBase64URL,"ZodBigInt",()=>m.ZodBigInt,"ZodBigIntFormat",()=>m.ZodBigIntFormat,"ZodBoolean",()=>m.ZodBoolean,"ZodCIDRv4",()=>m.ZodCIDRv4,"ZodCIDRv6",()=>m.ZodCIDRv6,"ZodCUID",()=>m.ZodCUID,"ZodCUID2",()=>m.ZodCUID2,"ZodCatch",()=>m.ZodCatch,"ZodCodec",()=>m.ZodCodec,"ZodCustom",()=>m.ZodCustom,"ZodCustomStringFormat",()=>m.ZodCustomStringFormat,"ZodDate",()=>m.ZodDate,"ZodDefault",()=>m.ZodDefault,"ZodDiscriminatedUnion",()=>m.ZodDiscriminatedUnion,"ZodE164",()=>m.ZodE164,"ZodEmail",()=>m.ZodEmail,"ZodEmoji",()=>m.ZodEmoji,"ZodEnum",()=>m.ZodEnum,"ZodError",()=>m.ZodError,"ZodExactOptional",()=>m.ZodExactOptional,"ZodFile",()=>m.ZodFile,"ZodFirstPartyTypeKind",()=>m.ZodFirstPartyTypeKind,"ZodFunction",()=>m.ZodFunction,"ZodGUID",()=>m.ZodGUID,"ZodIPv4",()=>m.ZodIPv4,"ZodIPv6",()=>m.ZodIPv6,"ZodISODate",()=>m.ZodISODate,"ZodISODateTime",()=>m.ZodISODateTime,"ZodISODuration",()=>m.ZodISODuration,"ZodISOTime",()=>m.ZodISOTime,"ZodIntersection",()=>m.ZodIntersection,"ZodIssueCode",()=>m.ZodIssueCode,"ZodJWT",()=>m.ZodJWT,"ZodKSUID",()=>m.ZodKSUID,"ZodLazy",()=>m.ZodLazy,"ZodLiteral",()=>m.ZodLiteral,"ZodMAC",()=>m.ZodMAC,"ZodMap",()=>m.ZodMap,"ZodNaN",()=>m.ZodNaN,"ZodNanoID",()=>m.ZodNanoID,"ZodNever",()=>m.ZodNever,"ZodNonOptional",()=>m.ZodNonOptional,"ZodNull",()=>m.ZodNull,"ZodNullable",()=>m.ZodNullable,"ZodNumber",()=>m.ZodNumber,"ZodNumberFormat",()=>m.ZodNumberFormat,"ZodObject",()=>m.ZodObject,"ZodOptional",()=>m.ZodOptional,"ZodPipe",()=>m.ZodPipe,"ZodPrefault",()=>m.ZodPrefault,"ZodPromise",()=>m.ZodPromise,"ZodReadonly",()=>m.ZodReadonly,"ZodRealError",()=>m.ZodRealError,"ZodRecord",()=>m.ZodRecord,"ZodSet",()=>m.ZodSet,"ZodString",()=>m.ZodString,"ZodStringFormat",()=>m.ZodStringFormat,"ZodSuccess",()=>m.ZodSuccess,"ZodSymbol",()=>m.ZodSymbol,"ZodTemplateLiteral",()=>m.ZodTemplateLiteral,"ZodTransform",()=>m.ZodTransform,"ZodTuple",()=>m.ZodTuple,"ZodType",()=>m.ZodType,"ZodULID",()=>m.ZodULID,"ZodURL",()=>m.ZodURL,"ZodUUID",()=>m.ZodUUID,"ZodUndefined",()=>m.ZodUndefined,"ZodUnion",()=>m.ZodUnion,"ZodUnknown",()=>m.ZodUnknown,"ZodVoid",()=>m.ZodVoid,"ZodXID",()=>m.ZodXID,"ZodXor",()=>m.ZodXor,"_ZodString",()=>m._ZodString,"_default",()=>m._default,"_function",()=>m._function,"any",()=>m.any,"array",()=>m.array,"base64",()=>m.base64,"base64url",()=>m.base64url,"bigint",()=>m.bigint,"boolean",()=>m.boolean,"catch",()=>m.catch,"check",()=>m.check,"cidrv4",()=>m.cidrv4,"cidrv6",()=>m.cidrv6,"clone",()=>m.clone,"codec",()=>m.codec,"coerce",()=>m.coerce,"config",()=>m.config,"core",()=>m.core,"cuid",()=>m.cuid,"cuid2",()=>m.cuid2,"custom",()=>m.custom,"date",()=>m.date,"decode",()=>m.decode,"decodeAsync",()=>m.decodeAsync,"default",0,m,"describe",()=>m.describe,"discriminatedUnion",()=>m.discriminatedUnion,"e164",()=>m.e164,"email",()=>m.email,"emoji",()=>m.emoji,"encode",()=>m.encode,"encodeAsync",()=>m.encodeAsync,"endsWith",()=>m.endsWith,"enum",()=>m.enum,"exactOptional",()=>m.exactOptional,"file",()=>m.file,"flattenError",()=>m.flattenError,"float32",()=>m.float32,"float64",()=>m.float64,"formatError",()=>m.formatError,"fromJSONSchema",()=>m.fromJSONSchema,"function",()=>m.function,"getErrorMap",()=>m.getErrorMap,"globalRegistry",()=>m.globalRegistry,"gt",()=>m.gt,"gte",()=>m.gte,"guid",()=>m.guid,"hash",()=>m.hash,"hex",()=>m.hex,"hostname",()=>m.hostname,"httpUrl",()=>m.httpUrl,"includes",()=>m.includes,"instanceof",()=>m.instanceof,"int",()=>m.int,"int32",()=>m.int32,"int64",()=>m.int64,"intersection",()=>m.intersection,"ipv4",()=>m.ipv4,"ipv6",()=>m.ipv6,"iso",()=>m.iso,"json",()=>m.json,"jwt",()=>m.jwt,"keyof",()=>m.keyof,"ksuid",()=>m.ksuid,"lazy",()=>m.lazy,"length",()=>m.length,"literal",()=>m.literal,"locales",()=>m.locales,"looseObject",()=>m.looseObject,"looseRecord",()=>m.looseRecord,"lowercase",()=>m.lowercase,"lt",()=>m.lt,"lte",()=>m.lte,"mac",()=>m.mac,"map",()=>m.map,"maxLength",()=>m.maxLength,"maxSize",()=>m.maxSize,"meta",()=>m.meta,"mime",()=>m.mime,"minLength",()=>m.minLength,"minSize",()=>m.minSize,"multipleOf",()=>m.multipleOf,"nan",()=>m.nan,"nanoid",()=>m.nanoid,"nativeEnum",()=>m.nativeEnum,"negative",()=>m.negative,"never",()=>m.never,"nonnegative",()=>m.nonnegative,"nonoptional",()=>m.nonoptional,"nonpositive",()=>m.nonpositive,"normalize",()=>m.normalize,"null",()=>m.null,"nullable",()=>m.nullable,"nullish",()=>m.nullish,"number",()=>m.number,"object",()=>m.object,"optional",()=>m.optional,"overwrite",()=>m.overwrite,"parse",()=>m.parse,"parseAsync",()=>m.parseAsync,"partialRecord",()=>m.partialRecord,"pipe",()=>m.pipe,"positive",()=>m.positive,"prefault",()=>m.prefault,"preprocess",()=>m.preprocess,"prettifyError",()=>m.prettifyError,"promise",()=>m.promise,"property",()=>m.property,"readonly",()=>m.readonly,"record",()=>m.record,"refine",()=>m.refine,"regex",()=>m.regex,"regexes",()=>m.regexes,"registry",()=>m.registry,"safeDecode",()=>m.safeDecode,"safeDecodeAsync",()=>m.safeDecodeAsync,"safeEncode",()=>m.safeEncode,"safeEncodeAsync",()=>m.safeEncodeAsync,"safeParse",()=>m.safeParse,"safeParseAsync",()=>m.safeParseAsync,"set",()=>m.set,"setErrorMap",()=>m.setErrorMap,"size",()=>m.size,"slugify",()=>m.slugify,"startsWith",()=>m.startsWith,"strictObject",()=>m.strictObject,"string",()=>m.string,"stringFormat",()=>m.stringFormat,"stringbool",()=>m.stringbool,"success",()=>m.success,"superRefine",()=>m.superRefine,"symbol",()=>m.symbol,"templateLiteral",()=>m.templateLiteral,"toJSONSchema",()=>m.toJSONSchema,"toLowerCase",()=>m.toLowerCase,"toUpperCase",()=>m.toUpperCase,"transform",()=>m.transform,"treeifyError",()=>m.treeifyError,"trim",()=>m.trim,"tuple",()=>m.tuple,"uint32",()=>m.uint32,"uint64",()=>m.uint64,"ulid",()=>m.ulid,"undefined",()=>m.undefined,"union",()=>m.union,"unknown",()=>m.unknown,"uppercase",()=>m.uppercase,"url",()=>m.url,"util",()=>m.util,"uuid",()=>m.uuid,"uuidv4",()=>m.uuidv4,"uuidv6",()=>m.uuidv6,"uuidv7",()=>m.uuidv7,"void",()=>m.void,"xid",()=>m.xid,"xor",()=>m.xor,"z",0,m],26560);var ao=a.i(26560);function ap({fields:a,isClientSide:b}){let c=Object.keys(a).reduce((c,d)=>{let e,f=a[d];return!f||b&&!1===f.input?c:(e="json"===f.type?ao.json?ao.json():ao.any():"string[]"===f.type||"number[]"===f.type?ao.array("string[]"===f.type?ao.string():ao.number()):Array.isArray(f.type)?ao.any():ao[f.type](),f?.required===!1&&(e=e.optional()),b||f?.returned!==!1)?{...c,[d]:e}:c},{});return ao.object(c)}function aq(a){let b=(0,aG.getAuthTables)(a),c={};for(let a in b){let d=b[a],e=d.fields,f={};if(Object.entries(e).forEach(([a,c])=>{if(f[c.fieldName||a]=c,c.references){let d=b[c.references.model];d&&(f[c.fieldName||a].references={...c.references,model:d.modelName,field:c.references.field})}}),c[d.modelName]){c[d.modelName].fields={...c[d.modelName].fields,...f};continue}c[d.modelName]={fields:f,order:d.order||1/0}}return c}var ar=a.i(62863),as=a.i(47850);a.i(66369);var at=a.i(33293),au=a.i(30453);let av={postgres:{string:["character varying","varchar","text","uuid"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamptz","timestamp","date"],json:["json","jsonb"]},mysql:{string:["varchar","text","uuid"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"],json:["json"]},sqlite:{string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"],json:["TEXT"]},mssql:{string:["varchar","nvarchar","uniqueidentifier"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime2","date","datetime"],json:["varchar","nvarchar"]}};function aw(a,b,c){if("string[]"===b||"number[]"===b)return a.toLowerCase().includes("json");let d=av[c];return(Array.isArray(b)?d.string.map(a=>a.toLowerCase()):d[b].map(a=>a.toLowerCase())).includes(a.toLowerCase().split("(")[0].trim())}async function ax(a){try{let b=await as.sql`SHOW search_path`.execute(a);if(b.rows[0]?.search_path)return b.rows[0].search_path.split(",").map(a=>a.trim()).map(a=>a.replace(/^["']|["']$/g,"")).filter(a=>!a.startsWith("$"))[0]||"public"}catch{}return"public"}async function ay(a){let b=aq(a),c=(0,ae.createLogger)(a.logger),{kysely:d,databaseType:e}=await (0,ar.createKyselyAdapter)(a);e||(c.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),e="sqlite"),d||(c.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),process.exit(1));let f="public";if("postgres"===e){f=await ax(d),c.debug(`PostgreSQL migration: Using schema '${f}' (from search_path)`);try{(await as.sql`
				SELECT schema_name 
				FROM information_schema.schemata 
				WHERE schema_name = ${f}
			`.execute(d)).rows[0]||c.warn(`Schema '${f}' does not exist. Tables will be inspected from available schemas. Consider creating the schema first or checking your database configuration.`)}catch(a){c.debug(`Could not verify schema existence: ${a instanceof Error?a.message:String(a)}`)}}let g=await d.introspection.getTables(),h=g;if("postgres"===e)try{let a=await as.sql`
				SELECT table_name 
				FROM information_schema.tables 
				WHERE table_schema = ${f}
				AND table_type = 'BASE TABLE'
			`.execute(d),b=new Set(a.rows.map(a=>a.table_name));h=g.filter(a=>a.schema===f&&b.has(a.name)),c.debug(`Found ${h.length} table(s) in schema '${f}': ${h.map(a=>a.name).join(", ")||"(none)"}`)}catch(a){c.warn(`Could not filter tables by schema. Using all discovered tables. Error: ${a instanceof Error?a.message:String(a)}`)}let i=[],j=[];for(let[a,d]of Object.entries(b)){let b=h.find(b=>b.name===a);if(!b){let b=i.findIndex(b=>b.table===a),c={table:a,fields:d.fields,order:d.order||1/0},e=i.findIndex(a=>(a.order||1/0)>c.order);-1===e?-1===b?i.push(c):i[b].fields={...i[b].fields,...d.fields}:i.splice(e,0,c);continue}let f={};for(let[g,h]of Object.entries(d.fields)){let d=b.columns.find(a=>a.name===g);if(!d){f[g]=h;continue}aw(d.dataType,h.type,e)||c.warn(`Field ${g} in table ${a} has a different type in the database. Expected ${h.type} but got ${d.dataType}.`)}Object.keys(f).length>0&&j.push({table:a,fields:f,order:d.order||1/0})}let k=[],l=a.advanced?.database?.generateId==="uuid",m=a.advanced?.database?.useNumberId||a.advanced?.database?.generateId==="serial";function n(a,b){let c=a.type,d=e||"sqlite",f={string:{sqlite:"text",postgres:"text",mysql:a.unique?"varchar(255)":a.references?"varchar(36)":a.sortable||a.index?"varchar(255)":"text",mssql:a.unique||a.sortable?"varchar(255)":a.references?"varchar(36)":"varchar(8000)"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:a.bigint?"bigint":"integer",postgres:a.bigint?"bigint":"integer",mysql:a.bigint?"bigint":"integer",mssql:a.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamptz",mysql:"timestamp(3)",mssql:as.sql`datetime2(3)`},json:{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"},id:{postgres:m?as.sql`integer GENERATED BY DEFAULT AS IDENTITY`:l?"uuid":"text",mysql:m?"integer":"varchar(36)",mssql:m?"integer":"varchar(36)",sqlite:m?"integer":"text"},foreignKeyId:{postgres:m?"integer":l?"uuid":"text",mysql:m?"integer":"varchar(36)",mssql:m?"integer":"varchar(36)",sqlite:m?"integer":"text"},"string[]":{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"},"number[]":{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"}};if("id"===b||a.references?.field==="id")return"id"===b?f.id[d]:f.foreignKeyId[d];if(Array.isArray(c))return"text";if(!(c in f))throw Error(`Unsupported field type '${String(c)}' for field '${b}'. Allowed types are: string, number, boolean, date, string[], number[]. If you need to store structured data, store it as a JSON string (type: "string") or split it into primitive fields. See https://better-auth.com/docs/advanced/schema#additional-fields`);return f[c][d]}let o=(0,au.initGetModelName)({schema:(0,ad.getAuthTables)(a),usePlural:!1}),p=(0,at.initGetFieldName)({schema:(0,ad.getAuthTables)(a),usePlural:!1});function q(a,b){try{return`${o(a)}.${p({model:a,field:b})}`}catch{return`${a}.${b}`}}if(j.length)for(let a of j)for(let[b,c]of Object.entries(a.fields)){let f=n(c,b),g=d.schema.alterTable(a.table);if(c.index){let c=d.schema.alterTable(a.table).addIndex(`${a.table}_${b}_idx`);k.push(c)}let h=g.addColumn(b,f,a=>(a=!1!==c.required?a.notNull():a,c.references&&(a=a.references(q(c.references.model,c.references.field)).onDelete(c.references.onDelete||"cascade")),c.unique&&(a=a.unique()),"date"===c.type&&"function"==typeof c.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a="mysql"===e?a.defaultTo(as.sql`CURRENT_TIMESTAMP(3)`):a.defaultTo(as.sql`CURRENT_TIMESTAMP`)),a));k.push(h)}let r=[];if(a.advanced?.database?.useNumberId&&c.warn("`useNumberId` is deprecated. Please use `generateId` with `serial` instead."),i.length)for(let a of i){let b=n({type:m?"number":"string"},"id"),c=d.schema.createTable(a.table).addColumn("id",b,a=>{if(m)return"postgres"===e?a.primaryKey().notNull():"sqlite"===e?a.primaryKey().notNull():"mssql"===e?a.identity().primaryKey().notNull():a.autoIncrement().primaryKey().notNull();return l&&"postgres"===e?a.primaryKey().defaultTo(as.sql`pg_catalog.gen_random_uuid()`).notNull():a.primaryKey().notNull()});for(let[b,f]of Object.entries(a.fields)){let g=n(f,b);if(c=c.addColumn(b,g,a=>(a=!1!==f.required?a.notNull():a,f.references&&(a=a.references(q(f.references.model,f.references.field)).onDelete(f.references.onDelete||"cascade")),f.unique&&(a=a.unique()),"date"===f.type&&"function"==typeof f.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a="mysql"===e?a.defaultTo(as.sql`CURRENT_TIMESTAMP(3)`):a.defaultTo(as.sql`CURRENT_TIMESTAMP`)),a)),f.index){let c=d.schema.createIndex(`${a.table}_${b}_${f.unique?"uidx":"idx"}`).on(a.table).columns([b]);r.push(f.unique?c.unique():c)}}k.push(c)}if(r.length)for(let a of r)k.push(a);return{toBeCreated:i,toBeAdded:j,runMigrations:async function(){for(let a of k)await a.execute()},compileMigrations:async function(){return k.map(a=>a.compile().sql).join(";\n\n")+";"}}}var az=a.i(37207),aA=a.i(95984),aB=a.i(39461),aC=a.i(53593),aD=a.i(71324),aE=a.i(58478);a.s(["accountSchema",()=>aA.accountSchema,"coreSchema",()=>az.coreSchema,"getAuthTables",()=>ad.getAuthTables,"rateLimitSchema",()=>aB.rateLimitSchema,"sessionSchema",()=>aC.sessionSchema,"userSchema",()=>aD.userSchema,"verificationSchema",()=>aE.verificationSchema],40548);var aF=a.i(40548),aG=((a,b)=>{let c={};for(var d in a)$(c,d,{get:a[d],enumerable:!0});return b&&$(c,Symbol.toStringTag,{value:"Module"}),c})({convertFromDB:()=>aj,convertToDB:()=>ai,createFieldAttribute:()=>ah,createInternalAdapter:()=>an,getAdapter:()=>ag,getBaseAdapter:()=>af,getMigrations:()=>ay,getSchema:()=>aq,getWithHooks:()=>am,matchType:()=>aw,mergeSchema:()=>Z.mergeSchema,parseAccountInput:()=>Z.parseAccountInput,parseAccountOutput:()=>Z.parseAccountOutput,parseAdditionalUserInput:()=>Z.parseAdditionalUserInput,parseInputData:()=>Z.parseInputData,parseSessionInput:()=>Z.parseSessionInput,parseSessionOutput:()=>Z.parseSessionOutput,parseUserInput:()=>Z.parseUserInput,parseUserOutput:()=>Z.parseUserOutput,toZodSchema:()=>ap});g&&($(aG,Symbol.toStringTag,{value:"Module"}),f&&$(f,Symbol.toStringTag,{value:"Module"})),ac(aG,aF,"default"),f&&ac(f,aF,"default");var aH=a.i(7116),aI=a.i(34084),aJ=a.i(81549),aK=a.i(32949),aL=a.i(76230);let aM=()=>(0,N.createAuthEndpoint)("/get-session",{method:"GET",operationId:"getSession",query:aI.getSessionQuerySchema,requireHeaders:!0,metadata:{openapi:{operationId:"getSession",description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",nullable:!0,properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async a=>{try{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)return null;let c=(0,aI.getChunkedCookie)(a,a.context.authCookies.sessionData.name),d=null;if(c){let b=a.context.options.session?.cookieCache?.strategy||"compact";if("jwe"===b){let b=await (0,aH.symmetricDecodeJWT)(c,a.context.secret,"better-auth-session");if(!b||!b.session||!b.user)return(0,j.expireCookie)(a,a.context.authCookies.sessionData),a.json(null);d={session:{session:b.session,user:b.user,updatedAt:b.updatedAt,version:b.version},expiresAt:b.exp?1e3*b.exp:Date.now()}}else if("jwt"===b){let b=await (0,aH.verifyJWT)(c,a.context.secret);if(!b||!b.session||!b.user)return(0,j.expireCookie)(a,a.context.authCookies.sessionData),a.json(null);d={session:{session:b.session,user:b.user,updatedAt:b.updatedAt,version:b.version},expiresAt:b.exp?1e3*b.exp:Date.now()}}else{let b=(0,V.safeJSONParse)(aK.binary.decode(aJ.base64Url.decode(c)));if(b)if(!await (0,aL.createHMAC)("SHA-256","base64urlnopad").verify(a.context.secret,JSON.stringify({...b.session,expiresAt:b.expiresAt}),b.signature))return(0,j.expireCookie)(a,a.context.authCookies.sessionData),a.json(null);else d=b}}let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);if(d?.session&&a.context.options.session?.cookieCache?.enabled&&!a.query?.disableCookieCache){let b=d.session,c=a.context.options.session?.cookieCache?.version,e="1";if(c){if("string"==typeof c)e=c;else if("function"==typeof c){let a=c(b.session,b.user);e=a instanceof Promise?await a:a}}if((b.version||"1")!==e)(0,j.expireCookie)(a,a.context.authCookies.sessionData);else{let c=new Date(b.session.expiresAt);if(d.expiresAt<Date.now()||c<new Date)(0,j.expireCookie)(a,a.context.authCookies.sessionData);else{let c=a.context.sessionConfig.cookieRefreshCache;if(!1===c){a.context.session=b;let c=(0,Z.parseSessionOutput)(a.context.options,{...b.session,expiresAt:new Date(b.session.expiresAt),createdAt:new Date(b.session.createdAt),updatedAt:new Date(b.session.updatedAt)}),d=(0,Z.parseUserOutput)(a.context.options,{...b.user,createdAt:new Date(b.user.createdAt),updatedAt:new Date(b.user.updatedAt)});return a.json({session:c,user:d})}if(d.expiresAt-Date.now()<1e3*c.updateAge){let c=(0,Y.getDate)(a.context.options.session?.cookieCache?.maxAge||300,"sec"),d={session:{...b.session,expiresAt:c},user:b.user,updatedAt:Date.now()};await (0,j.setCookieCache)(a,d,!1);let e=(0,Z.parseSessionOutput)(a.context.options,{...d.session,expiresAt:new Date(d.session.expiresAt),createdAt:new Date(d.session.createdAt),updatedAt:new Date(d.session.updatedAt)}),f=(0,Z.parseUserOutput)(a.context.options,{...d.user,createdAt:new Date(d.user.createdAt),updatedAt:new Date(d.user.updatedAt)});return a.context.session={session:e,user:f},a.json({session:e,user:f})}let e=(0,Z.parseSessionOutput)(a.context.options,{...b.session,expiresAt:new Date(b.session.expiresAt),createdAt:new Date(b.session.createdAt),updatedAt:new Date(b.session.updatedAt)}),f=(0,Z.parseUserOutput)(a.context.options,{...b.user,createdAt:new Date(b.user.createdAt),updatedAt:new Date(b.user.updatedAt)});return a.context.session={session:e,user:f},a.json({session:e,user:f})}}}let f=await a.context.internalAdapter.findSession(b);if(a.context.session=f,!f||f.session.expiresAt<new Date)return(0,j.deleteSessionCookie)(a),f&&await a.context.internalAdapter.deleteSession(f.session.token),a.json(null);if(e||a.query?.disableRefresh){let b=(0,Z.parseSessionOutput)(a.context.options,f.session),c=(0,Z.parseUserOutput)(a.context.options,f.user);return a.json({session:b,user:c})}let g=a.context.sessionConfig.expiresIn,h=a.context.sessionConfig.updateAge;if(f.session.expiresAt.valueOf()-1e3*g+1e3*h<=Date.now()&&(!a.query?.disableRefresh||!a.context.options.session?.disableSessionRefresh)){let b=await a.context.internalAdapter.updateSession(f.session.token,{expiresAt:(0,Y.getDate)(a.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!b)return(0,j.deleteSessionCookie)(a),a.json(null,{status:401});let c=(b.expiresAt.valueOf()-Date.now())/1e3;await (0,j.setSessionCookie)(a,{session:b,user:f.user},!1,{maxAge:c});let d=(0,Z.parseSessionOutput)(a.context.options,b),e=(0,Z.parseUserOutput)(a.context.options,f.user);return a.json({session:d,user:e})}await (0,j.setCookieCache)(a,f,!!e);let i=(0,Z.parseSessionOutput)(a.context.options,f.session),k=(0,Z.parseUserOutput)(a.context.options,f.user);return a.json({session:i,user:k})}catch(b){throw a.context.logger.error("INTERNAL_SERVER_ERROR",b),new u.APIError("INTERNAL_SERVER_ERROR",{message:K.BASE_ERROR_CODES.FAILED_TO_GET_SESSION})}}),aN=async(a,b)=>{if(a.context.session)return a.context.session;let c=await aM()({...a,asResponse:!1,headers:a.headers,returnHeaders:!1,returnStatus:!1,query:{...b,...a.query}}).catch(a=>null);return a.context.session=c,c},aO=(0,N.createAuthMiddleware)(async a=>{let b=await aN(a);if(!b?.session)throw new u.APIError("UNAUTHORIZED");return{session:b}}),aP=(0,N.createAuthMiddleware)(async a=>{let b=await aN(a,{disableCookieCache:!0});if(!b?.session)throw new u.APIError("UNAUTHORIZED");return{session:b}});(0,N.createAuthMiddleware)(async a=>{let b=await aN(a);if(!b?.session&&(a.request||a.headers))throw new u.APIError("UNAUTHORIZED");return{session:b}});let aQ=(0,N.createAuthMiddleware)(async a=>{let b=await aN(a);if(!b?.session)throw new u.APIError("UNAUTHORIZED");if(0===a.context.sessionConfig.freshAge)return{session:b};let c=a.context.sessionConfig.freshAge,d=new Date(b.session.updatedAt||b.session.createdAt).getTime();if(!(Date.now()-d<1e3*c))throw new u.APIError("FORBIDDEN",{message:"Session is not fresh"});return{session:b}}),aR=(0,N.createAuthEndpoint)("/revoke-session",{method:"POST",body:l.object({token:l.string().meta({description:"The token to revoke"})}),use:[aP],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.body.token;if((await a.context.internalAdapter.findSession(b))?.session.userId===a.context.session.user.id)try{await a.context.internalAdapter.deleteSession(b)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new u.APIError("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),aS=(0,N.createAuthEndpoint)("/revoke-sessions",{method:"POST",use:[aP],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{try{await a.context.internalAdapter.deleteSessions(a.context.session.user.id)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new u.APIError("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),aT=(0,N.createAuthEndpoint)("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[aP],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.context.session;if(!b.user)throw new u.APIError("UNAUTHORIZED");let c=(await a.context.internalAdapter.listSessions(b.user.id)).filter(a=>a.expiresAt>new Date).filter(b=>b.token!==a.context.session.session.token);return await Promise.all(c.map(b=>a.context.internalAdapter.deleteSession(b.token))),a.json({status:!0})});function aU(a,b){return a&&b.options.account?.encryptOAuthTokens?(0,i.symmetricDecrypt)({key:b.secret,data:a}):a}function aV(a,b){return b.options.account?.encryptOAuthTokens&&a?(0,i.symmetricEncrypt)({key:b.secret,data:a}):a}function aW(a){let b=a=>new Date(new Date().getTime()+1e3*a);return{tokenType:a.token_type,accessToken:a.access_token,refreshToken:a.refresh_token,accessTokenExpiresAt:a.expires_in?b(a.expires_in):void 0,refreshTokenExpiresAt:a.refresh_token_expires_in?b(a.refresh_token_expires_in):void 0,scopes:a?.scope?"string"==typeof a.scope?a.scope.split(" "):a.scope:[],idToken:a.id_token,raw:a}}async function aX(a){let b=new TextEncoder().encode(a),c=await crypto.subtle.digest("SHA-256",b);return aJ.base64Url.encode(new Uint8Array(c),{padding:!1})}async function aY({id:a,options:b,authorizationEndpoint:c,state:d,codeVerifier:e,scopes:f,claims:g,redirectURI:h,duration:i,prompt:j,accessType:k,responseType:l,display:m,loginHint:n,hd:o,responseMode:p,additionalParams:q,scopeJoiner:r}){let s=new URL(b.authorizationEndpoint||c);s.searchParams.set("response_type",l||"code");let t=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;if(s.searchParams.set("client_id",t),s.searchParams.set("state",d),f&&s.searchParams.set("scope",f.join(r||" ")),s.searchParams.set("redirect_uri",b.redirectURI||h),i&&s.searchParams.set("duration",i),m&&s.searchParams.set("display",m),n&&s.searchParams.set("login_hint",n),j&&s.searchParams.set("prompt",j),o&&s.searchParams.set("hd",o),k&&s.searchParams.set("access_type",k),p&&s.searchParams.set("response_mode",p),e){let a=await aX(e);s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("code_challenge",a)}if(g){let a=g.reduce((a,b)=>(a[b]=null,a),{});s.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...a}}))}return q&&Object.entries(q).forEach(([a,b])=>{s.searchParams.set(a,b)}),s}var aZ=Object.defineProperty,a$=Object.defineProperties,a_=Object.getOwnPropertyDescriptors,a0=Object.getOwnPropertySymbols,a1=Object.prototype.hasOwnProperty,a2=Object.prototype.propertyIsEnumerable,a3=(a,b,c)=>b in a?aZ(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,a4=(a,b)=>{for(var c in b||(b={}))a1.call(b,c)&&a3(a,c,b[c]);if(a0)for(var c of a0(b))a2.call(b,c)&&a3(a,c,b[c]);return a},a5=(a,b)=>a$(a,a_(b)),a6=class extends Error{constructor(a,b,c){super(b||a.toString(),{cause:c}),this.status=a,this.statusText=b,this.error=c,Error.captureStackTrace(this,this.constructor)}},a7=async(a,b)=>{var c,d,e,f,g,h;let i=b||{},j={onRequest:[null==b?void 0:b.onRequest],onResponse:[null==b?void 0:b.onResponse],onSuccess:[null==b?void 0:b.onSuccess],onError:[null==b?void 0:b.onError],onRetry:[null==b?void 0:b.onRetry]};if(!b||!(null==b?void 0:b.plugins))return{url:a,options:i,hooks:j};for(let k of(null==b?void 0:b.plugins)||[]){if(k.init){let d=await (null==(c=k.init)?void 0:c.call(k,a.toString(),b));i=d.options||i,a=d.url}j.onRequest.push(null==(d=k.hooks)?void 0:d.onRequest),j.onResponse.push(null==(e=k.hooks)?void 0:e.onResponse),j.onSuccess.push(null==(f=k.hooks)?void 0:f.onSuccess),j.onError.push(null==(g=k.hooks)?void 0:g.onError),j.onRetry.push(null==(h=k.hooks)?void 0:h.onRetry)}return{url:a,options:i,hooks:j}},a8=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(){return this.options.delay}},a9=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(a){return Math.min(this.options.maxDelay,this.options.baseDelay*2**a)}},ba=async a=>{let b={},c=async a=>"function"==typeof a?await a():a;if(null==a?void 0:a.auth){if("Bearer"===a.auth.type){let d=await c(a.auth.token);if(!d)return b;b.authorization=`Bearer ${d}`}else if("Basic"===a.auth.type){let[d,e]=await Promise.all([c(a.auth.username),c(a.auth.password)]);if(!d||!e)return b;b.authorization=`Basic ${btoa(`${d}:${e}`)}`}else if("Custom"===a.auth.type){let[d,e]=await Promise.all([c(a.auth.prefix),c(a.auth.value)]);if(!e)return b;b.authorization=`${null!=d?d:""} ${e}`}}return b},bb=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function bc(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}function bd(a){try{return JSON.parse(a)}catch(b){return a}}async function be(a){let b=new Headers(null==a?void 0:a.headers);for(let[c,d]of Object.entries(await ba(a)||{}))b.set(c,d);if(!b.has("content-type")){let c=bc(null==a?void 0:a.body)?"application/json":null;c&&b.set("content-type",c)}return b}var bf=class a extends Error{constructor(b,c){super(c||JSON.stringify(b,null,2)),this.issues=b,Object.setPrototypeOf(this,a.prototype)}};async function bg(a,b){let c=await a["~standard"].validate(b);if(c.issues)throw new bf(c.issues);return c.value}var bh=["get","post","put","patch","delete"],bi=async(a,b)=>{var c,d,e,f,g,h,i,j;let k,{hooks:l,url:m,options:n}=await a7(a,b),o=function(a){if(null==a?void 0:a.customFetchImpl)return a.customFetchImpl;if("u">typeof globalThis&&"function"==typeof globalThis.fetch)return globalThis.fetch;throw Error("No fetch implementation found")}(n),p=new AbortController,q=null!=(c=n.signal)?c:p.signal,r=function(a,b){let{baseURL:c,params:d,query:e}=b||{query:{},params:{},baseURL:""},f=a.startsWith("http")?a.split("/").slice(0,3).join("/"):c||"";if(a.startsWith("@")){let b=a.toString().split("@")[1].split("/")[0];bh.includes(b)&&(a=a.replace(`@${b}/`,"/"))}f.endsWith("/")||(f+="/");let[g,h]=a.replace(f,"").split("?"),i=new URLSearchParams(h);for(let[a,b]of Object.entries(e||{})){let c;if(null!=b){if("string"==typeof b)c=b;else if(Array.isArray(b)){for(let c of b)i.append(a,c);continue}else c=JSON.stringify(b);i.set(a,c)}}if(d)if(Array.isArray(d))for(let[a,b]of g.split("/").filter(a=>a.startsWith(":")).entries()){let c=d[a];g=g.replace(b,c)}else for(let[a,b]of Object.entries(d))g=g.replace(`:${a}`,String(b));(g=g.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(g=g.slice(1));let j=i.toString();return(j=j.length>0?`?${j}`.replace(/\+/g,"%20"):"",f.startsWith("http"))?new URL(`${g}${j}`,f):`${f}${g}${j}`}(m,n),s=function(a){if(!(null==a?void 0:a.body))return null;let b=new Headers(null==a?void 0:a.headers);if(bc(a.body)&&!b.has("content-type")){for(let[b,c]of Object.entries(null==a?void 0:a.body))c instanceof Date&&(a.body[b]=c.toISOString());return JSON.stringify(a.body)}return b.has("content-type")&&"application/x-www-form-urlencoded"===b.get("content-type")&&bc(a.body)?new URLSearchParams(a.body).toString():a.body}(n),t=await be(n),u=function(a,b){var c;if(null==b?void 0:b.method)return b.method.toUpperCase();if(a.startsWith("@")){let d=null==(c=a.split("@")[1])?void 0:c.split("/")[0];return bh.includes(d)?d.toUpperCase():(null==b?void 0:b.body)?"POST":"GET"}return(null==b?void 0:b.body)?"POST":"GET"}(m,n),v=a5(a4({},n),{url:r,headers:t,body:s,method:u,signal:q});for(let a of l.onRequest)if(a){let b=await a(v);"object"==typeof b&&null!==b&&(v=b)}("pipeTo"in v&&"function"==typeof v.pipeTo||"function"==typeof(null==(d=null==b?void 0:b.body)?void 0:d.pipe))&&!("duplex"in v)&&(v.duplex="half");let{clearTimeout:w}=(!(null==n?void 0:n.signal)&&(null==n?void 0:n.timeout)&&(k=setTimeout(()=>null==p?void 0:p.abort(),null==n?void 0:n.timeout)),{abortTimeout:k,clearTimeout:()=>{k&&clearTimeout(k)}}),x=await o(v.url,v);w();let y={response:x,request:v};for(let a of l.onResponse)if(a){let c=await a(a5(a4({},y),{response:(null==(e=null==b?void 0:b.hookOptions)?void 0:e.cloneResponse)?x.clone():x}));c instanceof Response?x=c:"object"==typeof c&&null!==c&&(x=c.response)}if(x.ok){if("HEAD"===v.method)return{data:"",error:null};let a=function(a){let b=a.headers.get("content-type"),c=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!b)return"json";let d=b.split(";").shift()||"";return bb.test(d)?"json":c.has(d)||d.startsWith("text/")?"text":"blob"}(x),c={data:null,response:x,request:v};if("json"===a||"text"===a){let a=await x.text(),b=null!=(f=v.jsonParser)?f:bd;c.data=await b(a)}else c.data=await x[a]();for(let a of((null==v?void 0:v.output)&&v.output&&!v.disableValidation&&(c.data=await bg(v.output,c.data)),l.onSuccess))a&&await a(a5(a4({},c),{response:(null==(g=null==b?void 0:b.hookOptions)?void 0:g.cloneResponse)?x.clone():x}));return(null==b?void 0:b.throw)?c.data:{data:c.data,error:null}}let z=null!=(h=null==b?void 0:b.jsonParser)?h:bd,A=await x.text(),B=function(a){try{return JSON.parse(a),!0}catch(a){return!1}}(A),C=B?await z(A):null,D={response:x,responseText:A,request:v,error:a5(a4({},C),{status:x.status,statusText:x.statusText})};for(let a of l.onError)a&&await a(a5(a4({},D),{response:(null==(i=null==b?void 0:b.hookOptions)?void 0:i.cloneResponse)?x.clone():x}));if(null==b?void 0:b.retry){let c=function(a){if("number"==typeof a)return new a8({type:"linear",attempts:a,delay:1e3});switch(a.type){case"linear":return new a8(a);case"exponential":return new a9(a);default:throw Error("Invalid retry strategy")}}(b.retry),d=null!=(j=b.retryAttempt)?j:0;if(await c.shouldAttemptRetry(d,x)){for(let a of l.onRetry)a&&await a(y);let e=c.getDelay(d);return await new Promise(a=>setTimeout(a,e)),await bi(a,a5(a4({},b),{retryAttempt:d+1}))}}if(null==b?void 0:b.throw)throw new a6(x.status,x.statusText,B?C:A);return{data:null,error:a5(a4({},C),{status:x.status,statusText:x.statusText})}};async function bj({refreshToken:a,options:b,tokenEndpoint:c,authentication:d,extraParams:e}){let{body:f,headers:g}=function({refreshToken:a,options:b,authentication:c,extraParams:d,resource:e}){let f=new URLSearchParams,g={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(f.set("grant_type","refresh_token"),f.set("refresh_token",a),"basic"===c){let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;a?g.authorization="Basic "+aJ.base64.encode(`${a}:${b.clientSecret??""}`):g.authorization="Basic "+aJ.base64.encode(`:${b.clientSecret??""}`)}else{let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;f.set("client_id",a),b.clientSecret&&f.set("client_secret",b.clientSecret)}if(e)if("string"==typeof e)f.append("resource",e);else for(let a of e)f.append("resource",a);if(d)for(let[a,b]of Object.entries(d))f.set(a,b);return{body:f,headers:g}}({refreshToken:a,options:b,authentication:d,extraParams:e}),{data:h,error:i}=await bi(c,{method:"POST",body:f,headers:g});if(i)throw i;let j={accessToken:h.access_token,refreshToken:h.refresh_token,tokenType:h.token_type,scopes:h.scope?.split(" "),idToken:h.id_token};return h.expires_in&&(j.accessTokenExpiresAt=new Date(new Date().getTime()+1e3*h.expires_in)),j}a.s([],78075);var bk=a.i(76340),bl=a.i(31390),bm=a.i(35708);a.i(14083);var bn=a.i(42420),bo=a.i(45199);function bp(a){return(0,bo.isObject)(a)}class bq{#p;#q=new WeakMap;constructor(a){if(!function(a){return a&&"object"==typeof a&&Array.isArray(a.keys)&&a.keys.every(bp)}(a))throw new bm.JWKSInvalid("JSON Web Key Set malformed");this.#p=structuredClone(a)}jwks(){return this.#p}async getKey(a,b){let{alg:c,kid:d}={...a,...b?.header},e=function(a){switch("string"==typeof a&&a.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new bm.JOSENotSupported('Unsupported "alg" value for a JSON Web Key Set')}}(c),f=this.#p.keys.filter(a=>{let b=e===a.kty;if(b&&"string"==typeof d&&(b=d===a.kid),b&&("string"==typeof a.alg||"AKP"===e)&&(b=c===a.alg),b&&"string"==typeof a.use&&(b="sig"===a.use),b&&Array.isArray(a.key_ops)&&(b=a.key_ops.includes("verify")),b)switch(c){case"ES256":b="P-256"===a.crv;break;case"ES384":b="P-384"===a.crv;break;case"ES512":b="P-521"===a.crv;break;case"Ed25519":case"EdDSA":b="Ed25519"===a.crv}return b}),{0:g,length:h}=f;if(0===h)throw new bm.JWKSNoMatchingKey;if(1!==h){let a=new bm.JWKSMultipleMatchingKeys,b=this.#q;throw a[Symbol.asyncIterator]=async function*(){for(let a of f)try{yield await br(b,a,c)}catch{}},a}return br(this.#q,g,c)}}async function br(a,b,c){let d=a.get(b)||a.set(b,{}).get(b);if(void 0===d[c]){let a=await (0,bn.importJWK)({...b,ext:!0},c);if(a instanceof Uint8Array||"public"!==a.type)throw new bm.JWKSInvalid("JSON Web Key Set members must be public keys");d[c]=a}return d[c]}function bs(a){let b=new bq(a),c=async(a,c)=>b.getKey(a,c);return Object.defineProperties(c,{jwks:{value:()=>structuredClone(b.jwks()),enumerable:!1,configurable:!1,writable:!1}}),c}function bt(a){let b;if("string"==typeof a){let c=a.split(".");(3===c.length||5===c.length)&&([b]=c)}else if("object"==typeof a&&a)if("protected"in a)b=a.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof b||!b)throw Error();let a=JSON.parse(bl.decoder.decode((0,bk.decode)(b)));if(!(0,bo.isObject)(a))throw Error();return a}catch{throw TypeError("Invalid Token or Protected Header formatting")}}var bu=a.i(81205);function bv({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:e,deviceId:f,headers:g,additionalParams:h={},resource:i}){let j=new URLSearchParams,k={"content-type":"application/x-www-form-urlencoded",accept:"application/json",...g};if(j.set("grant_type","authorization_code"),j.set("code",a),b&&j.set("code_verifier",b),d.clientKey&&j.set("client_key",d.clientKey),f&&j.set("device_id",f),j.set("redirect_uri",d.redirectURI||c),i)if("string"==typeof i)j.append("resource",i);else for(let a of i)j.append("resource",a);if("basic"===e){let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId;k.authorization=`Basic ${aJ.base64.encode(`${a}:${d.clientSecret??""}`)}`}else{let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId;j.set("client_id",a),d.clientSecret&&j.set("client_secret",d.clientSecret)}for(let[a,b]of Object.entries(h))j.has(a)||j.append(a,b);return{body:j,headers:k}}async function bw({code:a,codeVerifier:b,redirectURI:c,options:d,tokenEndpoint:e,authentication:f,deviceId:g,headers:h,additionalParams:i={},resource:j}){let{body:k,headers:l}=bv({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:f,deviceId:g,headers:h,additionalParams:i,resource:j}),{data:m,error:n}=await bi(e,{method:"POST",body:k,headers:l});if(n)throw n;return aW(m)}function bx(a){let b,c;if("string"!=typeof a)throw new bm.JWTInvalid("JWTs must use Compact JWS serialization, JWT must be a string");let{1:d,length:e}=a.split(".");if(5===e)throw new bm.JWTInvalid("Only JWTs using Compact JWS serialization can be decoded");if(3!==e)throw new bm.JWTInvalid("Invalid JWT");if(!d)throw new bm.JWTInvalid("JWTs must contain a payload");try{b=(0,bk.decode)(d)}catch{throw new bm.JWTInvalid("Failed to base64url decode the payload")}try{c=JSON.parse(bl.decoder.decode(b))}catch{throw new bm.JWTInvalid("Failed to parse the decoded payload as JSON")}if(!(0,bo.isObject)(c))throw new bm.JWTInvalid("Invalid JWT Claims Set");return c}let by=async a=>{let{data:b}=await bi("https://appleid.apple.com/auth/keys");if(!b?.keys)throw new u.APIError("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await (0,bn.importJWK)(c,c.alg)},bz=async(a,b,c)=>{let d=`https://cognito-idp.${b}.amazonaws.com/${c}/.well-known/jwks.json`;try{let{data:b}=await bi(d);if(!b?.keys)throw new u.APIError("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await (0,bn.importJWK)(c,c.alg)}catch(a){throw ae.logger.error("Failed to fetch Cognito public key:",a),a}};("u"<typeof navigator||!navigator.userAgent?.startsWith?.("Mozilla/5.0 "))&&(b="jose/v6.1.3");let bA=Symbol();async function bB(a,b,c,d=fetch){let e=await d(a,{method:"GET",signal:c,redirect:"manual",headers:b}).catch(a=>{if("TimeoutError"===a.name)throw new bm.JWKSTimeout;throw a});if(200!==e.status)throw new bm.JOSEError("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await e.json()}catch{throw new bm.JOSEError("Failed to parse the JSON Web Key Set HTTP response as JSON")}}let bC=Symbol();class bD{#r;#s;#t;#u;#v;#w;#x;#y;#z;#A;constructor(a,c){if(!(a instanceof URL))throw TypeError("url must be an instance of URL");this.#r=new URL(a.href),this.#s="number"==typeof c?.timeoutDuration?c?.timeoutDuration:5e3,this.#t="number"==typeof c?.cooldownDuration?c?.cooldownDuration:3e4,this.#u="number"==typeof c?.cacheMaxAge?c?.cacheMaxAge:6e5,this.#x=new Headers(c?.headers),b&&!this.#x.has("User-Agent")&&this.#x.set("User-Agent",b),this.#x.has("accept")||(this.#x.set("accept","application/json"),this.#x.append("accept","application/jwk-set+json")),this.#y=c?.[bA],c?.[bC]!==void 0&&(this.#A=c?.[bC],function(a,b){return!("object"!=typeof a||null===a||!("uat"in a)||"number"!=typeof a.uat||Date.now()-a.uat>=b)&&"jwks"in a&&!!(0,bo.isObject)(a.jwks)&&!!Array.isArray(a.jwks.keys)&&!!Array.prototype.every.call(a.jwks.keys,bo.isObject)}(c?.[bC],this.#u)&&(this.#v=this.#A.uat,this.#z=bs(this.#A.jwks)))}pendingFetch(){return!!this.#w}coolingDown(){return"number"==typeof this.#v&&Date.now()<this.#v+this.#t}fresh(){return"number"==typeof this.#v&&Date.now()<this.#v+this.#u}jwks(){return this.#z?.jwks()}async getKey(a,b){this.#z&&this.fresh()||await this.reload();try{return await this.#z(a,b)}catch(c){if(c instanceof bm.JWKSNoMatchingKey&&!1===this.coolingDown())return await this.reload(),this.#z(a,b);throw c}}async reload(){this.#w&&("u">typeof WebSocketPair||"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"u">typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this.#w=void 0),this.#w||=bB(this.#r.href,this.#x,AbortSignal.timeout(this.#s),this.#y).then(a=>{this.#z=bs(a),this.#A&&(this.#A.uat=Date.now(),this.#A.jwks=a),this.#v=Date.now(),this.#w=void 0}).catch(a=>{throw this.#w=void 0,a}),await this.#w}}let bE=(a="")=>a.split("://").map(a=>a.replace(/\/{2,}/g,"/")).join("://"),bF=async a=>{let{data:b}=await bi("https://www.googleapis.com/oauth2/v3/certs");if(!b?.keys)throw new u.APIError("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await (0,bn.importJWK)(c,c.alg)},bG={apple:a=>({id:"apple",name:"Apple",async createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["email","name"];return a.scope&&e.push(...a.scope),c&&e.push(...c),await aY({id:"apple",options:a,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:e,state:b,redirectURI:d,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>bw({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://appleid.apple.com/auth/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let{kid:d,alg:e}=bt(b);if(!d||!e)return!1;let{payload:f}=await (0,bu.jwtVerify)(b,await by(d),{algorithms:[e],issuer:"https://appleid.apple.com",audience:a.audience&&a.audience.length?a.audience:a.appBundleIdentifier?a.appBundleIdentifier:a.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(a=>{void 0!==f[a]&&(f[a]=!!f[a])}),(!c||f.nonce===c)&&!!f},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(b){let c;if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let d=bx(b.idToken);if(!d)return null;c=b.user?.name?`${b.user.name.firstName||""} ${b.user.name.lastName||""}`.trim()||" ":d.name||" ";let e="boolean"==typeof d.email_verified?d.email_verified:"true"===d.email_verified,f={...d,name:c},g=await a.mapProfileToUser?.(f);return{user:{id:d.sub,name:f.name,emailVerified:e,email:d.email,...g},data:f}},options:a}),atlassian:a=>({id:"atlassian",name:"Atlassian",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw ae.logger.error("Client Id and Secret are required for Atlassian"),new k.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new k.BetterAuthError("codeVerifier is required for Atlassian");let f=a.disableDefaultScope?[]:["read:jira-user","offline_access"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aY({id:"atlassian",options:a,authorizationEndpoint:"https://auth.atlassian.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e,additionalParams:{audience:"api.atlassian.com"},prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>bw({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;try{let{data:c}=await bi("https://api.atlassian.com/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name,email:c.email,image:c.picture,emailVerified:!1,...d},data:c}}catch(a){return ae.logger.error("Failed to fetch user info from Figma:",a),null}},options:a}),cognito:a=>{if(!a.domain||!a.region||!a.userPoolId)throw ae.logger.error("Domain, region and userPoolId are required for Amazon Cognito. Make sure to provide them in the options."),new k.BetterAuthError("DOMAIN_AND_REGION_REQUIRED");let b=a.domain.replace(/^https?:\/\//,""),c=`https://${b}/oauth2/authorize`,d=`https://${b}/oauth2/token`,e=`https://${b}/oauth2/userinfo`;return{id:"cognito",name:"Cognito",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId)throw ae.logger.error("ClientId is required for Amazon Cognito. Make sure to provide them in the options."),new k.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(a.requireClientSecret&&!a.clientSecret)throw ae.logger.error("Client Secret is required when requireClientSecret is true. Make sure to provide it in the options."),new k.BetterAuthError("CLIENT_SECRET_REQUIRED");let g=a.disableDefaultScope?[]:["openid","profile","email"];a.scope&&g.push(...a.scope),d&&g.push(...d);let h=await aY({id:"cognito",options:{...a},authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:f,prompt:a.prompt}),i=h.searchParams.get("scope");if(i){h.searchParams.delete("scope");let a=encodeURIComponent(i),b=h.toString(),c=b.includes("?")?"&":"?";return new URL(`${b}${c}scope=${a}`)}return h},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>bw({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{let{kid:d,alg:e}=bt(b);if(!d||!e)return!1;let f=await bz(d,a.region,a.userPoolId),g=`https://cognito-idp.${a.region}.amazonaws.com/${a.userPoolId}`,{payload:h}=await (0,bu.jwtVerify)(b,f,{algorithms:[e],issuer:g,audience:a.clientId,maxTokenAge:"1h"});if(c&&h.nonce!==c)return!1;return!0}catch(a){return ae.logger.error("Failed to verify ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken)try{let c=bx(b.idToken);if(!c)return null;let d=c.name||c.given_name||c.username||c.email,e={...c,name:d},f=await a.mapProfileToUser?.(e);return{user:{id:c.sub,name:e.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...f},data:e}}catch(a){ae.logger.error("Failed to decode ID token:",a)}if(b.accessToken)try{let{data:c}=await bi(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(c){let b=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.given_name||c.username,email:c.email,image:c.picture,emailVerified:c.email_verified,...b},data:c}}}catch(a){ae.logger.error("Failed to fetch user info from Cognito:",a)}return null},options:a}},discord:a=>({id:"discord",name:"Discord",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identify","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=e.includes("bot")&&void 0!==a.permissions?`&permissions=${a.permissions}`:"";return new URL(`https://discord.com/api/oauth2/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"none"}${f}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>bw({code:b,redirectURI:c,options:a,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;if(null===c.avatar)c.image_url=`https://cdn.discordapp.com/embed/avatars/${"0"===c.discriminator?Number(BigInt(c.id)>>BigInt(22))%6:parseInt(c.discriminator)%5}.png`;else{let a=c.avatar.startsWith("a_")?"gif":"png";c.image_url=`https://cdn.discordapp.com/avatars/${c.id}/${c.avatar}.${a}`}let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.global_name||c.username||"",email:c.email,emailVerified:c.verified,image:c.image_url,...e},data:c}},options:a}),facebook:a=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:b,scopes:c,redirectURI:d,loginHint:e}){let f=a.disableDefaultScope?[]:["email","public_profile"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await aY({id:"facebook",options:a,authorizationEndpoint:"https://www.facebook.com/v24.0/dialog/oauth",scopes:f,state:b,redirectURI:d,loginHint:e,additionalParams:a.configId?{config_id:a.configId}:{}})},validateAuthorizationCode:async({code:b,redirectURI:c})=>bw({code:b,redirectURI:c,options:a,tokenEndpoint:"https://graph.facebook.com/v24.0/oauth/access_token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);if(3===b.split(".").length)try{var d;let e,f,{payload:g}=await (0,bu.jwtVerify)(b,(d=new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/"),e=new bD(d,void 0),f=async(a,b)=>e.getKey(a,b),Object.defineProperties(f,{coolingDown:{get:()=>e.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>e.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>e.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>e.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>e.jwks(),enumerable:!0,configurable:!1,writable:!1}}),f),{algorithms:["RS256"],audience:a.clientId,issuer:"https://www.facebook.com"});if(c&&g.nonce!==c)return!1;return!!g}catch{return!1}return!0},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://graph.facebook.com/v24.0/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken&&3===b.idToken.split(".").length){let c=bx(b.idToken),d={id:c.sub,name:c.name,email:c.email,picture:{data:{url:c.picture,height:100,width:100,is_silhouette:!1}}},e=await a.mapProfileToUser?.({...d,email_verified:!1});return{user:{...d,emailVerified:!1,...e},data:c}}let{data:c,error:d}=await bi("https://graph.facebook.com/me?fields="+["id","name","email","picture",...a?.fields||[]].join(","),{auth:{type:"Bearer",token:b.accessToken}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.email,image:c.picture.data.url,emailVerified:c.email_verified,...e},data:c}},options:a}),figma:a=>({id:"figma",name:"Figma",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw ae.logger.error("Client Id and Client Secret are required for Figma. Make sure to provide them in the options."),new k.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new k.BetterAuthError("codeVerifier is required for Figma");let f=a.disableDefaultScope?[]:["current_user:read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await aY({id:"figma",options:a,authorizationEndpoint:"https://www.figma.com/oauth",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>bw({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.figma.com/v1/oauth/token",authentication:"basic"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.figma.com/v1/oauth/token",authentication:"basic"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await bi("https://api.figma.com/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return ae.logger.error("Failed to fetch user from Figma"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.handle,email:c.email,image:c.img_url,emailVerified:!1,...d},data:c}}catch(a){return ae.logger.error("Failed to fetch user info from Figma:",a),null}},options:a}),github:a=>({id:"github",name:"GitHub",createAuthorizationURL({state:b,scopes:c,loginHint:d,codeVerifier:e,redirectURI:f}){let g=a.disableDefaultScope?[]:["read:user","user:email"];return a.scope&&g.push(...a.scope),c&&g.push(...c),aY({id:"github",options:a,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:g,state:b,codeVerifier:e,redirectURI:f,loginHint:d,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>{let{body:e,headers:f}=bv({code:b,codeVerifier:c,redirectURI:d,options:a}),{data:g,error:h}=await bi("https://github.com/login/oauth/access_token",{method:"POST",body:e,headers:f});return h?(ae.logger.error("GitHub OAuth token exchange failed:",h),null):"error"in g?(ae.logger.error("GitHub OAuth token exchange failed:",g),null):aW(g)},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e}=await bi("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});!c.email&&e&&(c.email=(e.find(a=>a.primary)??e[0])?.email);let f=e?.find(a=>a.email===c.email)?.verified??!1,g=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name||c.login,email:c.email,image:c.avatar_url,emailVerified:f,...g},data:c}},options:a}),microsoft:a=>{let b=a.tenantId||"common",c=a.authority||"https://login.microsoftonline.com",d=`${c}/${b}/oauth2/v2.0/authorize`,e=`${c}/${b}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),aY({id:"microsoft",options:a,authorizationEndpoint:d,state:b.state,codeVerifier:b.codeVerifier,scopes:c,redirectURI:b.redirectURI,prompt:a.prompt,loginHint:b.loginHint})},validateAuthorizationCode:({code:b,codeVerifier:c,redirectURI:d})=>bw({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:e}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=bx(b.idToken),d=a.profilePhotoSize||48;await bi(`https://graph.microsoft.com/v1.0/me/photos/${d}x${d}/$value`,{headers:{Authorization:`Bearer ${b.accessToken}`},async onResponse(b){if(!a.disableProfilePhoto&&b.response.ok)try{let a=await b.response.clone().arrayBuffer();c.picture=`data:image/jpeg;base64, ${aJ.base64.encode(a)}`}catch(a){ae.logger.error(a&&"object"==typeof a&&"name"in a?a.name:"",a)}}});let e=await a.mapProfileToUser?.(c),f=void 0!==c.email_verified?c.email_verified:!!(c.email&&(c.verified_primary_email?.includes(c.email)||c.verified_secondary_email?.includes(c.email)));return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:f,...e},data:c}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),bj({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},extraParams:{scope:c.join(" ")},tokenEndpoint:e})},options:a}},google:a=>({id:"google",name:"Google",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f,display:g}){if(!a.clientId||!a.clientSecret)throw ae.logger.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new k.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new k.BetterAuthError("codeVerifier is required for Google");let h=a.disableDefaultScope?[]:["email","profile","openid"];return a.scope&&h.push(...a.scope),c&&h.push(...c),await aY({id:"google",options:a,authorizationEndpoint:"https://accounts.google.com/o/oauth2/v2/auth",scopes:h,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt,accessType:a.accessType,display:g||a.display,loginHint:f,hd:a.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>bw({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://oauth2.googleapis.com/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let{kid:d,alg:e}=bt(b);if(!d||!e)return!1;let{payload:f}=await (0,bu.jwtVerify)(b,await bF(d),{algorithms:[e],issuer:["https://accounts.google.com","accounts.google.com"],audience:a.clientId,maxTokenAge:"1h"});return!c||f.nonce===c},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=bx(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...d},data:c}},options:a}),huggingface:a=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aY({id:"huggingface",options:a,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>bw({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),slack:a=>({id:"slack",name:"Slack",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=new URL("https://slack.com/openid/connect/authorize");return f.searchParams.set("scope",e.join(" ")),f.searchParams.set("response_type","code"),f.searchParams.set("client_id",a.clientId),f.searchParams.set("redirect_uri",a.redirectURI||d),f.searchParams.set("state",b),f},validateAuthorizationCode:async({code:b,redirectURI:c})=>bw({code:b,redirectURI:c,options:a,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c["https://slack.com/user_id"],name:c.name||"",email:c.email,emailVerified:c.email_verified,image:c.picture||c["https://slack.com/user_image_512"],...e},data:c}},options:a}),spotify:a=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["user-read-email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aY({id:"spotify",options:a,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>bw({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,email:c.email,image:c.images[0]?.url,emailVerified:!1,...e},data:c}},options:a}),twitch:a=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user:read:email","openid"];return a.scope&&e.push(...a.scope),c&&e.push(...c),aY({id:"twitch",redirectURI:d,options:a,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:e,state:b,claims:a.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:b,redirectURI:c})=>bw({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=b.idToken;if(!c)return ae.logger.error("No idToken found in token"),null;let d=bx(c),e=await a.mapProfileToUser?.(d);return{user:{id:d.sub,name:d.preferred_username,email:d.email,image:d.picture,emailVerified:d.email_verified,...e},data:d}},options:a}),twitter:a=>({id:"twitter",name:"Twitter",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),aY({id:"twitter",options:a,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:c,state:b.state,codeVerifier:b.codeVerifier,redirectURI:b.redirectURI})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>bw({code:b,codeVerifier:c,authentication:"basic",redirectURI:d,options:a,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e,error:f}=await bi("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}}),g=!1;!f&&e?.data?.confirmed_email&&(c.data.email=e.data.confirmed_email,g=!0);let h=await a.mapProfileToUser?.(c);return{user:{id:c.data.id,name:c.data.name,email:c.data.email||c.data.username||null,image:c.data.profile_image_url,emailVerified:g,...h},data:c}},options:a}),dropbox:a=>({id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:b,scopes:c,codeVerifier:d,redirectURI:e})=>{let f=a.disableDefaultScope?[]:["account_info.read"];a.scope&&f.push(...a.scope),c&&f.push(...c);let g={};return a.accessType&&(g.token_access_type=a.accessType),await aY({id:"dropbox",options:a,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d,additionalParams:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>await bw({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.dropboxapi.com/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name?.display_name,email:c.email,emailVerified:c.email_verified||!1,image:c.profile_photo_url,...e},data:c}},options:a}),kick:a=>({id:"kick",name:"Kick",createAuthorizationURL({state:b,scopes:c,redirectURI:d,codeVerifier:e}){let f=a.disableDefaultScope?[]:["user:read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aY({id:"kick",redirectURI:d,options:a,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:f,codeVerifier:e,state:b})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:d})=>bw({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:"https://id.kick.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=c.data[0],f=await a.mapProfileToUser?.(e);return{user:{id:e.user_id,name:e.name,email:e.email,image:e.profile_picture,emailVerified:!1,...f},data:e}},options:a}),linear:a=>{let b="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aY({id:"linear",options:a,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>bw({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>bj({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(d||!c?.data?.viewer)return null;let e=c.data.viewer,f=await a.mapProfileToUser?.(e);return{user:{id:c.data.viewer.id,name:c.data.viewer.name,email:c.data.viewer.email,image:c.data.viewer.avatarUrl,emailVerified:!1,...f},data:e}},options:a}},linkedin:a=>{let b="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:b,scopes:c,redirectURI:d,loginHint:e})=>{let f=a.disableDefaultScope?[]:["profile","email","openid"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await aY({id:"linkedin",options:a,authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",scopes:f,state:b,loginHint:e,redirectURI:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>await bw({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>bj({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,emailVerified:c.email_verified||!1,image:c.picture,...e},data:c}},options:a}},gitlab:a=>{let b,{authorizationEndpoint:c,tokenEndpoint:d,userinfoEndpoint:e}=(b=a.issuer||"https://gitlab.com",{authorizationEndpoint:bE(`${b}/oauth/authorize`),tokenEndpoint:bE(`${b}/oauth/token`),userinfoEndpoint:bE(`${b}/api/v4/user`)}),f="gitlab";return{id:f,name:"Gitlab",createAuthorizationURL:async({state:b,scopes:d,codeVerifier:e,loginHint:g,redirectURI:h})=>{let i=a.disableDefaultScope?[]:["read_user"];return a.scope&&i.push(...a.scope),d&&i.push(...d),await aY({id:f,options:a,authorizationEndpoint:c,scopes:i,state:b,redirectURI:h,codeVerifier:e,loginHint:g})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:e})=>bw({code:b,redirectURI:c,options:a,codeVerifier:e,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi(e,{headers:{authorization:`Bearer ${b.accessToken}`}});if(d||"active"!==c.state||c.locked)return null;let f=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name??c.username,email:c.email,image:c.avatar_url,emailVerified:c.email_verified??!1,...f},data:c}},options:a}},tiktok:a=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user.info.profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${e.join(",")}&response_type=code&client_key=${a.clientKey}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>bw({code:b,redirectURI:a.redirectURI||c,options:{clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/",authentication:"post",extraParams:{client_key:a.clientKey}}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://open.tiktokapis.com/v2/user/info/?fields=open_id,avatar_large_url,display_name,username",{headers:{authorization:`Bearer ${b.accessToken}`}});return d?null:{user:{email:c.data.user.email||c.data.user.username,id:c.data.user.open_id,name:c.data.user.display_name||c.data.user.username,image:c.data.user.avatar_large_url,emailVerified:!1},data:c}},options:a}),reddit:a=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identity"];return a.scope&&e.push(...a.scope),c&&e.push(...c),aY({id:"reddit",options:a,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:e,state:b,redirectURI:d,duration:a.duration})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let d=new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:a.redirectURI||c}),{data:e,error:f}=await bi("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${aJ.base64.encode(`${a.clientId}:${a.clientSecret}`)}`},body:d.toString()});if(f)throw f;return aW(e)},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.oauth_client_id,emailVerified:c.has_verified_email,image:c.icon_img?.split("?")[0],...e},data:c}},options:a}),roblox:a=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"select_account consent"}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>bw({code:b,redirectURI:a.redirectURI||c,options:a,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.nickname||c.preferred_username||"",image:c.picture,email:c.preferred_username||null,emailVerified:!1,...e},data:{...c}}},options:a}),salesforce:a=>{let b=(a.environment??"production")==="sandbox",c=a.loginUrl?`https://${a.loginUrl}/services/oauth2/authorize`:b?"https://test.salesforce.com/services/oauth2/authorize":"https://login.salesforce.com/services/oauth2/authorize",d=a.loginUrl?`https://${a.loginUrl}/services/oauth2/token`:b?"https://test.salesforce.com/services/oauth2/token":"https://login.salesforce.com/services/oauth2/token",e=a.loginUrl?`https://${a.loginUrl}/services/oauth2/userinfo`:b?"https://test.salesforce.com/services/oauth2/userinfo":"https://login.salesforce.com/services/oauth2/userinfo";return{id:"salesforce",name:"Salesforce",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId||!a.clientSecret)throw ae.logger.error("Client Id and Client Secret are required for Salesforce. Make sure to provide them in the options."),new k.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(!e)throw new k.BetterAuthError("codeVerifier is required for Salesforce");let g=a.disableDefaultScope?[]:["openid","email","profile"];return a.scope&&g.push(...a.scope),d&&g.push(...d),aY({id:"salesforce",options:a,authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:a.redirectURI||f})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>bw({code:b,codeVerifier:c,redirectURI:a.redirectURI||e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await bi(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return ae.logger.error("Failed to fetch user info from Salesforce"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.user_id,name:c.name,email:c.email,image:c.photos?.picture||c.photos?.thumbnail,emailVerified:c.email_verified??!1,...d},data:c}}catch(a){return ae.logger.error("Failed to fetch user info from Salesforce:",a),null}},options:a}},vk:a=>({id:"vk",name:"VK",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["email","phone"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aY({id:"vk",options:a,authorizationEndpoint:"https://id.vk.com/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d,deviceId:e})=>bw({code:b,codeVerifier:c,redirectURI:a.redirectURI||d,options:a,deviceId:e,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;let c=new URLSearchParams({access_token:b.accessToken,client_id:a.clientId}).toString(),{data:d,error:e}=await bi("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c});if(e)return null;let f=await a.mapProfileToUser?.(d);return d.user.email||f?.email?{user:{id:d.user.user_id,first_name:d.user.first_name,last_name:d.user.last_name,email:d.user.email,image:d.user.avatar,emailVerified:!1,birthday:d.user.birthday,sex:d.user.sex,name:`${d.user.first_name} ${d.user.last_name}`,...f},data:d}:null},options:a}),zoom:a=>{let b={pkce:!0,...a};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:a,redirectURI:c,codeVerifier:d})=>{let e=new URLSearchParams({response_type:"code",redirect_uri:b.redirectURI?b.redirectURI:c,client_id:b.clientId,state:a});if(b.pkce){let a=await aX(d);e.set("code_challenge_method","S256"),e.set("code_challenge",a)}let f=new URL("https://zoom.us/oauth/authorize");return f.search=e.toString(),f},validateAuthorizationCode:async({code:a,redirectURI:c,codeVerifier:d})=>bw({code:a,redirectURI:b.redirectURI||c,codeVerifier:d,options:b,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),refreshAccessToken:b.refreshAccessToken?b.refreshAccessToken:async a=>bj({refreshToken:a,options:{clientId:b.clientId,clientKey:b.clientKey,clientSecret:b.clientSecret},tokenEndpoint:"https://zoom.us/oauth/token"}),async getUserInfo(a){if(b.getUserInfo)return b.getUserInfo(a);let{data:c,error:d}=await bi("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${a.accessToken}`}});if(d)return null;let e=await b.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,image:c.pic_url,email:c.email,emailVerified:!!c.verified,...e},data:{...c}}}}},notion:a=>{let b="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=(a.disableDefaultScope,[]);return a.scope&&f.push(...a.scope),c&&f.push(...c),aY({id:"notion",options:a,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:c,redirectURI:d})=>bw({code:c,redirectURI:d,options:a,tokenEndpoint:b,authentication:"basic"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>bj({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"Notion-Version":"2022-06-28"}});if(d||!c)return null;let e=c.bot?.owner?.user;if(!e)return null;let f=await a.mapProfileToUser?.(e);return{user:{id:e.id,name:e.name||"Notion User",email:e.person?.email||null,image:e.avatar_url,emailVerified:!1,...f},data:e}},options:a}},kakao:a=>({id:"kakao",name:"Kakao",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["account_email","profile_image","profile_nickname"];return a.scope&&e.push(...a.scope),c&&e.push(...c),aY({id:"kakao",options:a,authorizationEndpoint:"https://kauth.kakao.com/oauth/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>bw({code:b,redirectURI:c,options:a,tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://kapi.kakao.com/v2/user/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c)return null;let e=await a.mapProfileToUser?.(c),f=c.kakao_account||{},g=f.profile||{};return{user:{id:String(c.id),name:g.nickname||f.name||void 0,email:f.email,image:g.profile_image_url||g.thumbnail_image_url,emailVerified:!!f.is_email_valid&&!!f.is_email_verified,...e},data:c}},options:a}),naver:a=>({id:"naver",name:"Naver",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["profile","email"];return a.scope&&e.push(...a.scope),c&&e.push(...c),aY({id:"naver",options:a,authorizationEndpoint:"https://nid.naver.com/oauth2.0/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>bw({code:b,redirectURI:c,options:a,tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://openapi.naver.com/v1/nid/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c||"00"!==c.resultcode)return null;let e=await a.mapProfileToUser?.(c),f=c.response||{};return{user:{id:f.id,name:f.name||f.nickname,email:f.email,image:f.profile_image,emailVerified:!1,...e},data:c}},options:a}),line:a=>{let b="https://api.line.me/oauth2/v2.1/token";return{id:"line",name:"LINE",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f}){let g=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&g.push(...a.scope),c&&g.push(...c),await aY({id:"line",options:a,authorizationEndpoint:"https://access.line.me/oauth2/v2.1/authorize",scopes:g,state:b,codeVerifier:d,redirectURI:e,loginHint:f})},validateAuthorizationCode:async({code:c,codeVerifier:d,redirectURI:e})=>bw({code:c,codeVerifier:d,redirectURI:e,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>bj({refreshToken:c,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:b}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let d=new URLSearchParams;d.set("id_token",b),d.set("client_id",a.clientId),c&&d.set("nonce",c);let{data:e,error:f}=await bi("https://api.line.me/oauth2/v2.1/verify",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:d});return!f&&!!e&&e.aud===a.clientId&&(!e.nonce||e.nonce===c)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=null;if(b.idToken)try{c=bx(b.idToken)}catch{}if(!c){let{data:a}=await bi("https://api.line.me/oauth2/v2.1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});c=a||null}if(!c)return null;let d=await a.mapProfileToUser?.(c),e=c.sub||c.userId,f=c.name||c.displayName,g=c.picture||c.pictureUrl||void 0;return{user:{id:e,name:f,email:c.email,image:g,emailVerified:!1,...d},data:c}},options:a}},paybin:a=>{let b=a.issuer||"https://idp.paybin.io",c=`${b}/oauth2/authorize`,d=`${b}/oauth2/token`;return{id:"paybin",name:"Paybin",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f,loginHint:g}){if(!a.clientId||!a.clientSecret)throw ae.logger.error("Client Id and Client Secret is required for Paybin. Make sure to provide them in the options."),new k.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(!e)throw new k.BetterAuthError("codeVerifier is required for Paybin");let h=a.disableDefaultScope?[]:["openid","email","profile"];return a.scope&&h.push(...a.scope),d&&h.push(...d),await aY({id:"paybin",options:a,authorizationEndpoint:c,scopes:h,state:b,codeVerifier:e,redirectURI:f,prompt:a.prompt,loginHint:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>bw({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=bx(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username||(c.email?c.email.split("@")[0]:"User")||"User",email:c.email,image:c.picture,emailVerified:c.email_verified||!1,...d},data:c}},options:a}},paypal:a=>{let b="sandbox"===(a.environment||"sandbox"),c=b?"https://www.sandbox.paypal.com/signin/authorize":"https://www.paypal.com/signin/authorize",d=b?"https://api-m.sandbox.paypal.com/v1/oauth2/token":"https://api-m.paypal.com/v1/oauth2/token",e=b?"https://api-m.sandbox.paypal.com/v1/identity/oauth2/userinfo":"https://api-m.paypal.com/v1/identity/oauth2/userinfo";return{id:"paypal",name:"PayPal",async createAuthorizationURL({state:b,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw ae.logger.error("Client Id and Client Secret is required for PayPal. Make sure to provide them in the options."),new k.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");return await aY({id:"paypal",options:a,authorizationEndpoint:c,scopes:[],state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let e=aJ.base64.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await bi(d,{method:"POST",headers:{Authorization:`Basic ${e}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:c}).toString()});if(!a.data)throw new k.BetterAuthError("FAILED_TO_GET_ACCESS_TOKEN");let f=a.data;return{accessToken:f.access_token,refreshToken:f.refresh_token,accessTokenExpiresAt:f.expires_in?new Date(Date.now()+1e3*f.expires_in):void 0,idToken:f.id_token}}catch(a){throw ae.logger.error("PayPal token exchange failed:",a),new k.BetterAuthError("FAILED_TO_GET_ACCESS_TOKEN")}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=aJ.base64.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await bi(d,{method:"POST",headers:{Authorization:`Basic ${c}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:b}).toString()});if(!a.data)throw new k.BetterAuthError("FAILED_TO_REFRESH_ACCESS_TOKEN");let e=a.data;return{accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?new Date(Date.now()+1e3*e.expires_in):void 0}}catch(a){throw ae.logger.error("PayPal token refresh failed:",a),new k.BetterAuthError("FAILED_TO_REFRESH_ACCESS_TOKEN")}},async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{return!!bx(b).sub}catch(a){return ae.logger.error("Failed to verify PayPal ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return ae.logger.error("Access token is required to fetch PayPal user info"),null;try{let c=await bi(`${e}?schema=paypalv1.1`,{headers:{Authorization:`Bearer ${b.accessToken}`,Accept:"application/json"}});if(!c.data)return ae.logger.error("Failed to fetch user info from PayPal"),null;let d=c.data,f=await a.mapProfileToUser?.(d);return{user:{id:d.user_id,name:d.name,email:d.email,image:d.picture,emailVerified:d.email_verified,...f},data:d}}catch(a){return ae.logger.error("Failed to fetch user info from PayPal:",a),null}},options:a}},polar:a=>({id:"polar",name:"Polar",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aY({id:"polar",options:a,authorizationEndpoint:"https://polar.sh/oauth2/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>bw({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.polar.sh/v1/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bj({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.polar.sh/v1/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://api.polar.sh/v1/oauth2/userinfo",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.public_name||c.username,email:c.email,image:c.avatar_url,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),vercel:a=>({id:"vercel",name:"Vercel",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f;if(!d)throw new k.BetterAuthError("codeVerifier is required for Vercel");return(void 0!==a.scope||void 0!==c)&&(f=[],a.scope&&f.push(...a.scope),c&&f.push(...c)),aY({id:"vercel",options:a,authorizationEndpoint:"https://vercel.com/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>bw({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.vercel.com/login/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bi("https://api.vercel.com/login/oauth/userinfo",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name??c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a})},bH=Object.keys(bG),bI=l.enum(bH).or(l.string()),bJ=(0,N.createAuthEndpoint)("/list-accounts",{method:"GET",use:[aO],metadata:{openapi:{operationId:"listUserAccounts",description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},providerId:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"},accountId:{type:"string"},userId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","providerId","createdAt","updatedAt","accountId","userId","scopes"]}}}}}}}}},async a=>{let b=a.context.session,c=await a.context.internalAdapter.findAccounts(b.user.id);return a.json(c.map(b=>{let{scope:c,...d}=(0,Z.parseAccountOutput)(a.context.options,b);return{...d,scopes:c?.split(",")||[]}}))}),bK=(0,N.createAuthEndpoint)("/link-social",{method:"POST",requireHeaders:!0,body:l.object({callbackURL:l.string().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:bI,idToken:l.object({token:l.string(),nonce:l.string().optional(),accessToken:l.string().optional(),refreshToken:l.string().optional(),scopes:l.array(l.string()).optional()}).optional(),requestSignUp:l.boolean().optional(),scopes:l.array(l.string()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:l.string().meta({description:"The URL to redirect to if there is an error during the link process"}).optional(),disableRedirect:l.boolean().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),additionalData:l.record(l.string(),l.any()).optional()}),use:[aO],metadata:{openapi:{description:"Link a social account to the user",operationId:"linkSocialAccount",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async a=>{let b=a.context.session,c=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!c)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new u.APIError("NOT_FOUND",{message:K.BASE_ERROR_CODES.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!c.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new u.APIError("NOT_FOUND",{message:K.BASE_ERROR_CODES.ID_TOKEN_NOT_SUPPORTED});let{token:d,nonce:e}=a.body.idToken;if(!await c.verifyIdToken(d,e))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new u.APIError("UNAUTHORIZED",{message:K.BASE_ERROR_CODES.INVALID_TOKEN});let f=await c.getUserInfo({idToken:d,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!f||!f?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new u.APIError("UNAUTHORIZED",{message:K.BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO});let g=String(f.user.id);if(!f.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new u.APIError("UNAUTHORIZED",{message:K.BASE_ERROR_CODES.USER_EMAIL_NOT_FOUND});if((await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>a.providerId===c.id&&a.accountId===g))return a.json({url:"",status:!0,redirect:!1});if(!a.context.options.account?.accountLinking?.trustedProviders?.includes(c.id)&&!f.user.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)throw new u.APIError("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(f.user.email!==b.user.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new u.APIError("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await a.context.internalAdapter.createAccount({userId:b.user.id,providerId:c.id,accountId:g,accessToken:a.body.idToken.accessToken,idToken:d,refreshToken:a.body.idToken.refreshToken,scope:a.body.idToken.scopes?.join(",")})}catch{throw new u.APIError("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(a.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await a.context.internalAdapter.updateUser(b.user.id,{name:f.user?.name,image:f.user?.image})}catch(a){console.warn("Could not update user - "+a.toString())}return a.json({url:"",status:!0,redirect:!1})}let d=await v(a,{userId:b.user.id,email:b.user.email},a.body.additionalData),e=await c.createAuthorizationURL({state:d.state,codeVerifier:d.codeVerifier,redirectURI:`${a.context.baseURL}/callback/${c.id}`,scopes:a.body.scopes});return a.body.disableRedirect||a.setHeader("Location",e.toString()),a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),bL=(0,N.createAuthEndpoint)("/unlink-account",{method:"POST",body:l.object({providerId:l.string(),accountId:l.string().optional()}),use:[aQ],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let{providerId:b,accountId:c}=a.body,d=await a.context.internalAdapter.findAccounts(a.context.session.user.id);if(1===d.length&&!a.context.options.account?.accountLinking?.allowUnlinkingAll)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.FAILED_TO_UNLINK_LAST_ACCOUNT});let e=d.find(a=>c?a.accountId===c&&a.providerId===b:a.providerId===b);if(!e)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.ACCOUNT_NOT_FOUND});return await a.context.internalAdapter.deleteAccount(e.id),a.json({status:!0})}),bM=(0,N.createAuthEndpoint)("/get-access-token",{method:"POST",body:l.object({providerId:l.string().meta({description:"The provider ID for the OAuth provider"}),accountId:l.string().meta({description:"The account ID associated with the refresh token"}).optional(),userId:l.string().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let b,{providerId:c,accountId:d,userId:e}=a.body||{},f=a.request,g=await aN(a);if(f&&!g)throw a.error("UNAUTHORIZED");let h=g?.user?.id||e;if(!h)throw a.error("UNAUTHORIZED");if(!a.context.socialProviders.find(a=>a.id===c))throw new u.APIError("BAD_REQUEST",{message:`Provider ${c} is not supported.`});let i=await (0,aI.getAccountCookie)(a);if(!(b=i&&c===i.providerId&&(!d||i.id===d)?i:(await a.context.internalAdapter.findAccounts(h)).find(a=>d?a.id===d&&a.providerId===c:a.providerId===c)))throw new u.APIError("BAD_REQUEST",{message:"Account not found"});let j=a.context.socialProviders.find(a=>a.id===c);if(!j)throw new u.APIError("BAD_REQUEST",{message:`Provider ${c} not found.`});try{let c=null,d=b.accessTokenExpiresAt&&new Date(b.accessTokenExpiresAt).getTime()-Date.now()<5e3;if(b.refreshToken&&d&&j.refreshAccessToken){let d=await aU(b.refreshToken,a.context);c=await j.refreshAccessToken(d);let e={accessToken:await aV(c.accessToken,a.context),accessTokenExpiresAt:c.accessTokenExpiresAt,refreshToken:await aV(c.refreshToken,a.context),refreshTokenExpiresAt:c.refreshTokenExpiresAt},f=null;b.id&&(f=await a.context.internalAdapter.updateAccount(b.id,e)),a.context.options.account?.storeAccountCookie&&await (0,aI.setAccountCookie)(a,{...b,...f??e})}let e=c?.accessTokenExpiresAt?"string"==typeof c.accessTokenExpiresAt?new Date(c.accessTokenExpiresAt):c.accessTokenExpiresAt:b.accessTokenExpiresAt?"string"==typeof b.accessTokenExpiresAt?new Date(b.accessTokenExpiresAt):b.accessTokenExpiresAt:void 0,f={accessToken:c?.accessToken??await aU(b.accessToken??"",a.context),accessTokenExpiresAt:e,scopes:b.scope?.split(",")??[],idToken:c?.idToken??b.idToken??void 0};return a.json(f)}catch(a){throw new u.APIError("BAD_REQUEST",{message:"Failed to get a valid access token",cause:a})}}),bN=(0,N.createAuthEndpoint)("/refresh-token",{method:"POST",body:l.object({providerId:l.string().meta({description:"The provider ID for the OAuth provider"}),accountId:l.string().meta({description:"The account ID associated with the refresh token"}).optional(),userId:l.string().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let b,c,{providerId:d,accountId:e,userId:f}=a.body,g=a.request,h=await aN(a);if(g&&!h)throw a.error("UNAUTHORIZED");let i=h?.user?.id||f;if(!i)throw new u.APIError("BAD_REQUEST",{message:"Either userId or session is required"});let j=a.context.socialProviders.find(a=>a.id===d);if(!j)throw new u.APIError("BAD_REQUEST",{message:`Provider ${d} not found.`});if(!j.refreshAccessToken)throw new u.APIError("BAD_REQUEST",{message:`Provider ${d} does not support token refreshing.`});let k=await (0,aI.getAccountCookie)(a);if(!(b=k&&(!d||d===k?.providerId)?k:(await a.context.internalAdapter.findAccounts(i)).find(a=>e?a.id===e&&a.providerId===d:a.providerId===d)))throw new u.APIError("BAD_REQUEST",{message:"Account not found"});if(!(c=k&&d===k.providerId?k.refreshToken??void 0:b.refreshToken??void 0))throw new u.APIError("BAD_REQUEST",{message:"Refresh token not found"});try{let e=await aU(c,a.context),f=await j.refreshAccessToken(e);if(b.id){let c={...b||{},accessToken:await aV(f.accessToken,a.context),refreshToken:await aV(f.refreshToken,a.context),accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||b.scope,idToken:f.idToken||b.idToken};await a.context.internalAdapter.updateAccount(b.id,c)}return k&&d===k.providerId&&a.context.options.account?.storeAccountCookie&&await (0,aI.setAccountCookie)(a,{...k,accessToken:await aV(f.accessToken,a.context),refreshToken:await aV(f.refreshToken,a.context),accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||k.scope,idToken:f.idToken||k.idToken}),a.json({accessToken:f.accessToken,refreshToken:f.refreshToken,accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||b.scope,idToken:f.idToken||b.idToken,providerId:b.providerId,accountId:b.accountId})}catch(a){throw new u.APIError("BAD_REQUEST",{message:"Failed to refresh access token",cause:a})}}),bO=l.optional(l.object({accountId:l.string().meta({description:"The provider given account id for which to get the account info"}).optional()})),bP=(0,N.createAuthEndpoint)("/account-info",{method:"GET",use:[aO],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},query:bO},async a=>{let b,c=a.query?.accountId;if(c){let d=await a.context.internalAdapter.findAccount(c);d&&(b=d)}else if(a.context.options.account?.storeAccountCookie){let c=await (0,aI.getAccountCookie)(a);c&&(b=c)}if(!b||b.userId!==a.context.session.user.id)throw new u.APIError("BAD_REQUEST",{message:"Account not found"});let d=a.context.socialProviders.find(a=>a.id===b.providerId);if(!d)throw new u.APIError("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${b.providerId} but it is not configured`});let e=await bM({...a,method:"POST",body:{accountId:b.id,providerId:b.providerId},returnHeaders:!1,returnStatus:!1});if(!e.accessToken)throw new u.APIError("BAD_REQUEST",{message:"Access token not found"});let f=await d.getUserInfo({...e,accessToken:e.accessToken});return a.json(f)});async function bQ(a,b,c,d=3600,e){return await (0,aH.signJWT)({email:b.toLowerCase(),updateTo:c,...e},a,d)}async function bR(a,b){if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new u.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await bQ(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),d=a.body.callbackURL?encodeURIComponent(a.body.callbackURL):encodeURIComponent("/"),e=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${d}`;await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:b,url:e,token:c},a.request))}let bS=(0,N.createAuthEndpoint)("/send-verification-email",{method:"POST",operationId:"sendVerificationEmail",body:l.object({email:l.email().meta({description:"The email to send the verification email to"}),callbackURL:l.string().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{operationId:"sendVerificationEmail",description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async a=>{if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new u.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:b}=a.body,c=await aN(a);if(!c){let c=await a.context.internalAdapter.findUserByEmail(b);return c?await bR(a,c.user):await bQ(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn),a.json({status:!0})}if(c?.user.email!==b)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.EMAIL_MISMATCH});if(c?.user.emailVerified)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.EMAIL_ALREADY_VERIFIED});return await bR(a,c.user),a.json({status:!0})}),bT=(0,N.createAuthEndpoint)("/verify-email",{method:"GET",operationId:"verifyEmail",query:l.object({token:l.string().meta({description:"The token to verify the email"}),callbackURL:l.string().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[R(a=>a.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async a=>{let b;function c(b){if(a.query.callbackURL){if(a.query.callbackURL.includes("?"))throw a.redirect(`${a.query.callbackURL}&error=${b}`);throw a.redirect(`${a.query.callbackURL}?error=${b}`)}throw new u.APIError("UNAUTHORIZED",{message:b})}let{token:d}=a.query;try{b=await (0,bu.jwtVerify)(d,new TextEncoder().encode(a.context.secret),{algorithms:["HS256"]})}catch(a){if(a instanceof bm.JWTExpired)return c("token_expired");return c("invalid_token")}let e=l.object({email:l.email(),updateTo:l.string().optional(),requestType:l.string().optional()}).parse(b.payload),f=await a.context.internalAdapter.findUserByEmail(e.email);if(!f)return c("user_not_found");if(e.updateTo){let b=await aN(a);if(b&&b.user.email!==e.email)return c("unauthorized");switch(e.requestType){case"change-email-confirmation":{let b=await bQ(a.context.secret,e.email,e.updateTo,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-verification"}),c=a.query.callbackURL?encodeURIComponent(a.query.callbackURL):encodeURIComponent("/"),d=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${c}`;if(a.context.options.emailVerification?.sendVerificationEmail&&await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:{...f.user,email:e.updateTo},url:d,token:b},a.request)),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0})}case"change-email-verification":{let c=b;if(!c){let b=await a.context.internalAdapter.createSession(f.user.id);if(!b)throw new u.APIError("INTERNAL_SERVER_ERROR",{message:K.BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION});c={session:b,user:f.user}}a.context.options.emailVerification?.onEmailVerification&&await a.context.options.emailVerification.onEmailVerification(f.user,a.request);let d=await a.context.internalAdapter.updateUserByEmail(e.email,{email:e.updateTo,emailVerified:!0});if(a.context.options.emailVerification?.afterEmailVerification&&await a.context.options.emailVerification.afterEmailVerification(d,a.request),await (0,j.setSessionCookie)(a,{session:c.session,user:{...c.user,email:e.updateTo,emailVerified:!0}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:(0,Z.parseUserOutput)(a.context.options,d)})}default:{let c=b;if(!c){let b=await a.context.internalAdapter.createSession(f.user.id);if(!b)throw new u.APIError("INTERNAL_SERVER_ERROR",{message:K.BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION});c={session:b,user:f.user}}let d=await a.context.internalAdapter.updateUserByEmail(e.email,{email:e.updateTo,emailVerified:!1}),g=await bQ(a.context.secret,e.updateTo),h=a.query.callbackURL?encodeURIComponent(a.query.callbackURL):encodeURIComponent("/");if(a.context.options.emailVerification?.sendVerificationEmail&&await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:d,url:`${a.context.baseURL}/verify-email?token=${g}&callbackURL=${h}`,token:g},a.request)),await (0,j.setSessionCookie)(a,{session:c.session,user:{...c.user,email:e.updateTo,emailVerified:!1}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:(0,Z.parseUserOutput)(a.context.options,d)})}}}if(f.user.emailVerified){if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})}a.context.options.emailVerification?.beforeEmailVerification&&await a.context.options.emailVerification.beforeEmailVerification(f.user,a.request),a.context.options.emailVerification?.onEmailVerification&&await a.context.options.emailVerification.onEmailVerification(f.user,a.request);let g=await a.context.internalAdapter.updateUserByEmail(e.email,{emailVerified:!0});if(a.context.options.emailVerification?.afterEmailVerification&&await a.context.options.emailVerification.afterEmailVerification(g,a.request),a.context.options.emailVerification?.autoSignInAfterVerification){let b=await aN(a);if(b&&b.user.email===e.email)await (0,j.setSessionCookie)(a,{session:b.session,user:{...b.user,emailVerified:!0}});else{let b=await a.context.internalAdapter.createSession(f.user.id);if(!b)throw new u.APIError("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await (0,j.setSessionCookie)(a,{session:b,user:{...f.user,emailVerified:!0}})}}if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})});async function bU(a,b){let{userInfo:c,account:d,callbackURL:e,disableSignUp:f,overrideUserInfo:g}=b,h=await a.context.internalAdapter.findOAuthUser(c.email.toLowerCase(),d.accountId,d.providerId).catch(b=>{ae.logger.error("Better auth was unable to query your database.\nError: ",b);let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=internal_server_error`)}),i=h?.user,j=!i;if(h){let e=h.linkedAccount??h.accounts.find(a=>a.providerId===d.providerId&&a.accountId===d.accountId);if(e){let b=a.context.options.account?.updateAccountOnSignIn!==!1?Object.fromEntries(Object.entries({idToken:d.idToken,accessToken:await aV(d.accessToken,a.context),refreshToken:await aV(d.refreshToken,a.context),accessTokenExpiresAt:d.accessTokenExpiresAt,refreshTokenExpiresAt:d.refreshTokenExpiresAt,scope:d.scope}).filter(([a,b])=>void 0!==b)):{};a.context.options.account?.storeAccountCookie&&await (0,aI.setAccountCookie)(a,{...e,...b}),Object.keys(b).length>0&&await a.context.internalAdapter.updateAccount(e.id,b),c.emailVerified&&!h.user.emailVerified&&c.email.toLowerCase()===h.user.email&&await a.context.internalAdapter.updateUser(h.user.id,{emailVerified:!0})}else{let e=a.context.options.account?.accountLinking,f=a.context.options.account?.accountLinking?.trustedProviders;if(!(b.isTrustedProvider||f?.includes(d.providerId))&&!c.emailVerified||e?.enabled===!1||e?.disableImplicitLinking===!0)return(0,z.isDevelopment)()&&ae.logger.warn(`User already exist but account isn't linked to ${d.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await a.context.internalAdapter.linkAccount({providerId:d.providerId,accountId:c.id.toString(),userId:h.user.id,accessToken:await aV(d.accessToken,a.context),refreshToken:await aV(d.refreshToken,a.context),idToken:d.idToken,accessTokenExpiresAt:d.accessTokenExpiresAt,refreshTokenExpiresAt:d.refreshTokenExpiresAt,scope:d.scope})}catch(a){return ae.logger.error("Unable to link account",a),{error:"unable to link account",data:null}}c.emailVerified&&!h.user.emailVerified&&c.email.toLowerCase()===h.user.email&&await a.context.internalAdapter.updateUser(h.user.id,{emailVerified:!0})}if(g){let{id:b,...d}=c;i=await a.context.internalAdapter.updateUser(h.user.id,{...d,email:c.email.toLowerCase(),emailVerified:c.email.toLowerCase()===h.user.email&&h.user.emailVerified||c.emailVerified})}}else{if(f)return{error:"signup disabled",data:null,isRegister:!1};try{let{id:b,...f}=c,g={accessToken:await aV(d.accessToken,a.context),refreshToken:await aV(d.refreshToken,a.context),idToken:d.idToken,accessTokenExpiresAt:d.accessTokenExpiresAt,refreshTokenExpiresAt:d.refreshTokenExpiresAt,scope:d.scope,providerId:d.providerId,accountId:c.id.toString()},{user:h,account:j}=await a.context.internalAdapter.createOAuthUser({...f,email:c.email.toLowerCase()},g);if(i=h,a.context.options.account?.storeAccountCookie&&await (0,aI.setAccountCookie)(a,j),!c.emailVerified&&i&&a.context.options.emailVerification?.sendOnSignUp&&a.context.options.emailVerification?.sendVerificationEmail){let b=await bQ(a.context.secret,i.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${e}`;await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:i,url:c,token:b},a.request))}}catch(a){if(ae.logger.error(a),a instanceof u.APIError)return{error:a.message,data:null,isRegister:!1};return{error:"unable to create user",data:null,isRegister:!1}}}if(!i)return{error:"unable to create user",data:null,isRegister:!1};let k=await a.context.internalAdapter.createSession(i.id);return k?{data:{session:k,user:i},error:null,isRegister:j}:{error:"unable to create session",data:null,isRegister:!1}}let bV=l.object({code:l.string().optional(),error:l.string().optional(),device_id:l.string().optional(),error_description:l.string().optional(),state:l.string().optional(),user:l.string().optional()}),bW=(0,N.createAuthEndpoint)("/callback/:id",{method:["GET","POST"],operationId:"handleOAuthCallback",body:bV.optional(),query:bV.optional(),metadata:{...x,allowedMediaTypes:["application/x-www-form-urlencoded","application/json"]}},async a=>{let b,c,d,e=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;if("POST"===a.method){let b=a.body?bV.parse(a.body):{},c=a.query?bV.parse(a.query):{},d=bV.parse({...b,...c}),e=new URLSearchParams;for(let[a,b]of Object.entries(d))null!=b&&e.set(a,String(b));let f=`${a.context.baseURL}/callback/${a.params.id}?${e.toString()}`;throw a.redirect(f)}try{if("GET"===a.method)b=bV.parse(a.query);else if("POST"===a.method)b=bV.parse(a.body);else throw Error("Unsupported method")}catch(b){throw a.context.logger.error("INVALID_CALLBACK_REQUEST",b),a.redirect(`${e}?error=invalid_callback_request`)}let{code:f,error:g,state:h,error_description:i,device_id:k,user:l}=b;if(!h){a.context.logger.error("State not found",g);let b=`${e}${e.includes("?")?"&":"?"}state=state_not_found`;throw a.redirect(b)}let{codeVerifier:m,callbackURL:n,link:o,errorURL:p,newUserURL:q,requestSignUp:r}=await w(a);function s(b,c){let d=p??e,f=new URLSearchParams({error:b});c&&f.set("error_description",c);let g=`${d}${d.includes("?")?"&":"?"}${f.toString()}`;throw a.redirect(g)}if(g&&s(g,i),!f)throw a.context.logger.error("Code not found"),s("no_code");let t=a.context.socialProviders.find(b=>b.id===a.params.id);if(!t)throw a.context.logger.error("Oauth provider with id",a.params.id,"not found"),s("oauth_provider_not_found");try{c=await t.validateAuthorizationCode({code:f,codeVerifier:m,deviceId:k,redirectURI:`${a.context.baseURL}/callback/${t.id}`})}catch(b){throw a.context.logger.error("",b),s("invalid_code")}if(!c)throw s("invalid_code");let u=l?(0,V.safeJSONParse)(l):null,v=await t.getUserInfo({...c,user:u??void 0}).then(a=>a?.user);if(!v)return a.context.logger.error("Unable to get user info"),s("unable_to_get_user_info");if(!n)throw a.context.logger.error("No callback URL found"),s("no_callback_url");if(o){let b;if(!a.context.options.account?.accountLinking?.trustedProviders?.includes(t.id)&&!v.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return a.context.logger.error("Unable to link account - untrusted provider"),s("unable_to_link_account");if(v.email!==o.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)return s("email_doesn't_match");let d=await a.context.internalAdapter.findAccount(String(v.id));if(d){if(d.userId.toString()!==o.userId.toString())return s("account_already_linked_to_different_user");let b=Object.fromEntries(Object.entries({accessToken:await aV(c.accessToken,a.context),refreshToken:await aV(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scopes?.join(",")}).filter(([a,b])=>void 0!==b));await a.context.internalAdapter.updateAccount(d.id,b)}else if(!await a.context.internalAdapter.createAccount({userId:o.userId,providerId:t.id,accountId:String(v.id),...c,accessToken:await aV(c.accessToken,a.context),refreshToken:await aV(c.refreshToken,a.context),scope:c.scopes?.join(",")}))return s("unable_to_link_account");try{b=n.toString()}catch{b=n}throw a.redirect(b)}if(!v.email)return a.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),s("email_not_found");let x={providerId:t.id,accountId:String(v.id),...c,scope:c.scopes?.join(",")},y=await bU(a,{userInfo:{...v,id:String(v.id),email:v.email,name:v.name||v.email},account:x,callbackURL:n,disableSignUp:t.disableImplicitSignUp&&!r||t.options?.disableSignUp,overrideUserInfo:t.options?.overrideUserInfoOnSignIn});if(y.error)return a.context.logger.error(y.error.split(" ").join("_")),s(y.error.split(" ").join("_"));let{session:z,user:A}=y.data;await (0,j.setSessionCookie)(a,{session:z,user:A});try{d=(y.isRegister&&q||n).toString()}catch{d=y.isRegister&&q||n}throw a.redirect(d)});function bX(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/&(?!amp;|lt;|gt;|quot;|#39;|#x[0-9a-fA-F]+;|#[0-9]+;)/g,"&amp;")}let bY=(0,N.createAuthEndpoint)("/error",{method:"GET",metadata:{...x,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async a=>{let b=new URL(a.request?.url||""),c=b.searchParams.get("error")||"UNKNOWN",d=b.searchParams.get("error_description")||null,e=/^[\'A-Za-z0-9_-]+$/.test(c||"")?c:"UNKNOWN",f=d?bX(d):null,g=new URLSearchParams;g.set("error",e),d&&g.set("error_description",d);let h=a.context.options,i=h.onAPIError?.errorURL;return i?new Response(null,{status:302,headers:{Location:`${i}${i.includes("?")?"&":"?"}${g.toString()}`}}):z.isProduction&&!h.onAPIError?.customizeDefaultErrorPage?new Response(null,{status:302,headers:{Location:`/?${g.toString()}`}}):new Response(((a,b="Unknown",c=null)=>{let d=a.onAPIError?.customizeDefaultErrorPage;return`<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Error</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: ${d?.font?.defaultFamily||"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif"};
        background: ${d?.colors?.background||"var(--background)"};
        color: var(--foreground);
        margin: 0;
      }
      :root,
      :host {
        --spacing: 0.25rem;
        --container-md: 28rem;
        --text-sm: ${d?.size?.textSm||"0.875rem"};
        --text-sm--line-height: calc(1.25 / 0.875);
        --text-2xl: ${d?.size?.text2xl||"1.5rem"};
        --text-2xl--line-height: calc(2 / 1.5);
        --text-4xl: ${d?.size?.text4xl||"2.25rem"};
        --text-4xl--line-height: calc(2.5 / 2.25);
        --text-6xl: ${d?.size?.text6xl||"3rem"};
        --text-6xl--line-height: 1;
        --font-weight-medium: 500;
        --font-weight-semibold: 600;
        --font-weight-bold: 700;
        --default-transition-duration: 150ms;
        --default-transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        --radius: ${d?.size?.radiusSm||"0.625rem"};
        --default-mono-font-family: ${d?.font?.monoFamily||"var(--font-geist-mono)"};
        --primary: ${d?.colors?.primary||"black"};
        --primary-foreground: ${d?.colors?.primaryForeground||"white"};
        --background: ${d?.colors?.background||"white"};
        --foreground: ${d?.colors?.foreground||"oklch(0.271 0 0)"};
        --border: ${d?.colors?.border||"oklch(0.89 0 0)"};
        --destructive: ${d?.colors?.destructive||"oklch(0.55 0.15 25.723)"};
        --muted-foreground: ${d?.colors?.mutedForeground||"oklch(0.545 0 0)"};
        --corner-border: ${d?.colors?.cornerBorder||"#404040"};
      }

      button, .btn {
        cursor: pointer;
        background: none;
        border: none;
        color: inherit;
        font: inherit;
        transition: all var(--default-transition-duration)
          var(--default-transition-timing-function);
      }
      button:hover, .btn:hover {
        opacity: 0.8;
      }

      @media (prefers-color-scheme: dark) {
        :root,
        :host {
          --primary: ${d?.colors?.primary||"white"};
          --primary-foreground: ${d?.colors?.primaryForeground||"black"};
          --background: ${d?.colors?.background||"oklch(0.15 0 0)"};
          --foreground: ${d?.colors?.foreground||"oklch(0.98 0 0)"};
          --border: ${d?.colors?.border||"oklch(0.27 0 0)"};
          --destructive: ${d?.colors?.destructive||"oklch(0.65 0.15 25.723)"};
          --muted-foreground: ${d?.colors?.mutedForeground||"oklch(0.65 0 0)"};
          --corner-border: ${d?.colors?.cornerBorder||"#a0a0a0"};
        }
      }
      @media (max-width: 640px) {
        :root, :host {
          --text-6xl: 2.5rem;
          --text-2xl: 1.25rem;
          --text-sm: 0.8125rem;
        }
      }
      @media (max-width: 480px) {
        :root, :host {
          --text-6xl: 2rem;
          --text-2xl: 1.125rem;
        }
      }
    </style>
  </head>
  <body style="width: 100vw; min-height: 100vh; overflow-x: hidden; overflow-y: auto;">
    <div
        style="
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            position: relative;
            width: 100%;
            min-height: 100vh;
            padding: 1rem;
        "
        >
${d?.disableBackgroundGrid?"":`
      <div
        style="
          position: absolute;
          inset: 0;
          background-image: linear-gradient(to right, ${d?.colors?.gridColor||"var(--border)"} 1px, transparent 1px),
            linear-gradient(to bottom, ${d?.colors?.gridColor||"var(--border)"} 1px, transparent 1px);
          background-size: 40px 40px;
          opacity: 0.6;
          pointer-events: none;
          width: 100vw;
          height: 100vh;
        "
      ></div>
      <div
        style="
          position: absolute;
          inset: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          background: ${d?.colors?.background||"var(--background)"};
          mask-image: radial-gradient(ellipse at center, transparent 20%, black);
          -webkit-mask-image: radial-gradient(ellipse at center, transparent 20%, black);
          pointer-events: none;
        "
      ></div>
`}

<div
  style="
    position: relative;
    z-index: 10;
    border: 2px solid var(--border);
    background: ${d?.colors?.cardBackground||"var(--background)"};
    padding: 1.5rem;
    max-width: 42rem;
    width: 100%;
  "
>
    ${d?.disableCornerDecorations?"":`
        <!-- Corner decorations -->
        <div
          style="
            position: absolute;
            top: -2px;
            left: -2px;
            width: 2rem;
            height: 2rem;
            border-top: 4px solid var(--corner-border);
            border-left: 4px solid var(--corner-border);
          "
        ></div>
        <div
          style="
            position: absolute;
            top: -2px;
            right: -2px;
            width: 2rem;
            height: 2rem;
            border-top: 4px solid var(--corner-border);
            border-right: 4px solid var(--corner-border);
          "
        ></div>
  
        <div
          style="
            position: absolute;
            bottom: -2px;
            left: -2px;
            width: 2rem;
            height: 2rem;
            border-bottom: 4px solid var(--corner-border);
            border-left: 4px solid var(--corner-border);
          "
        ></div>
        <div
          style="
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 2rem;
            height: 2rem;
            border-bottom: 4px solid var(--corner-border);
            border-right: 4px solid var(--corner-border);
          "
        ></div>`}

        <div style="text-align: center; margin-bottom: 1.5rem;">
          <div style="margin-bottom: 1.5rem;">
            <div
              style="
                display: inline-block;
                border: 2px solid ${d?.disableTitleBorder?"transparent":d?.colors?.titleBorder||"var(--destructive)"};
                padding: 0.375rem 1rem;
              "
            >
              <h1
                style="
                  font-size: var(--text-6xl);
                  font-weight: var(--font-weight-semibold);
                  color: ${d?.colors?.titleColor||"var(--foreground)"};
                  letter-spacing: -0.02em;
                  margin: 0;
                "
              >
                ERROR
              </h1>
            </div>
            <div
              style="
                height: 2px;
                background-color: var(--border);
                width: calc(100% + 3rem);
                margin-left: -1.5rem;
                margin-top: 1.5rem;
              "
            ></div>
          </div>

          <h2
            style="
              font-size: var(--text-2xl);
              font-weight: var(--font-weight-semibold);
              color: var(--foreground);
              margin: 0 0 1rem;
            "
          >
            Something went wrong
          </h2>

          <div
            style="
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                border: 2px solid var(--border);
                background-color: var(--muted);
                padding: 0.375rem 0.75rem;
                margin: 0 0 1rem;
                flex-wrap: wrap;
                justify-content: center;
            "
            >
            <span
                style="
                font-size: 0.75rem;
                color: var(--muted-foreground);
                font-weight: var(--font-weight-semibold);
                "
            >
                CODE:
            </span>
            <span
                style="
                font-size: var(--text-sm);
                font-family: var(--default-mono-font-family, monospace);
                color: var(--foreground);
                word-break: break-all;
                "
            >
                ${bX(b)}
            </span>
            </div>

          <p
            style="
              color: var(--muted-foreground);
              max-width: 28rem;
              margin: 0 auto;
              font-size: var(--text-sm);
              line-height: 1.5;
              text-wrap: pretty;
            "
          >
            ${!c?`We encountered an unexpected error. Please try again or return to the home page. If you're a developer, you can find more information about the error <a href='https://better-auth.com/docs/reference/errors/${encodeURIComponent(b)}' target='_blank' rel="noopener noreferrer" style='color: var(--foreground); text-decoration: underline;'>here</a>.`:c}
          </p>
        </div>

        <div
          style="
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
          "
        >
          <a
            href="/"
            style="
              text-decoration: none;
            "
          >
            <div
              style="
                border: 2px solid var(--border);
                background: var(--primary);
                color: var(--primary-foreground);
                padding: 0.5rem 1rem;
                border-radius: 0;
                white-space: nowrap;
              "
              class="btn"
            >
              Go Home
            </div>
          </a>
          <a
            href="https://better-auth.com/docs/reference/errors/${encodeURIComponent(b)}?askai=${encodeURIComponent(`What does the error code ${b} mean?`)}"
            target="_blank"
            rel="noopener noreferrer"
            style="
              text-decoration: none;
            "
          >
            <div
              style="
                border: 2px solid var(--border);
                background: transparent;
                color: var(--foreground);
                padding: 0.5rem 1rem;
                border-radius: 0;
                white-space: nowrap;
              "
              class="btn"
            >
              Ask AI
            </div>
          </a>
        </div>
      </div>
    </div>
  </body>
</html>`})(a.context.options,e,f),{headers:{"Content-Type":"text/html"}})}),bZ=(0,N.createAuthEndpoint)("/ok",{method:"GET",metadata:{...x,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async a=>a.json({ok:!0}));async function b$(a,b){let c=(await a.context.internalAdapter.findAccounts(b.userId))?.find(a=>"credential"===a.providerId),d=c?.password;return!!c&&!!d&&await a.context.password.verify({hash:d,password:b.password})}async function b_(a,b){let c=(await b.context.internalAdapter.findAccounts(a))?.find(a=>"credential"===a.providerId),d=c?.password;if(!c||!d||!b.body.password)throw new u.APIError("BAD_REQUEST",{message:"No password credential found"});if(!await b.context.password.verify({hash:d,password:b.body.password}))throw new u.APIError("BAD_REQUEST",{message:"Invalid password"});return!0}function b0(a,b,c){let d=b?new URL(b,a.baseURL):new URL(`${a.baseURL}/error`);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}let b1=(0,N.createAuthEndpoint)("/request-password-reset",{method:"POST",body:l.object({email:l.email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:l.string().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{operationId:"requestPasswordReset",description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new u.APIError("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return(0,y.generateId)(24),await a.context.internalAdapter.findVerificationValue("dummy-verification-token"),a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=(0,Y.getDate)(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=(0,y.generateId)(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e});let g=c?encodeURIComponent(c):"",h=`${a.context.baseURL}/reset-password/${f}?callbackURL=${g}`;return await a.context.runInBackgroundOrAwait(a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:h,token:f},a.request)),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"})}),b2=(0,N.createAuthEndpoint)("/reset-password/:token",{method:"GET",operationId:"forgetPasswordCallback",query:l.object({callbackURL:l.string().meta({description:"The URL to redirect the user to reset their password"})}),use:[R(a=>a.query.callbackURL)],metadata:{openapi:{operationId:"resetPasswordCallback",description:"Redirects the user to the callback URL with the token",parameters:[{name:"token",in:"path",required:!0,description:"The token to reset the password",schema:{type:"string"}},{name:"callbackURL",in:"query",required:!0,description:"The URL to redirect the user to reset their password",schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async a=>{var b,c;let d,{token:e}=a.params,{callbackURL:f}=a.query;if(!e||!f)throw a.redirect(b0(a.context,f,{error:"INVALID_TOKEN"}));let g=await a.context.internalAdapter.findVerificationValue(`reset-password:${e}`);if(!g||g.expiresAt<new Date)throw a.redirect(b0(a.context,f,{error:"INVALID_TOKEN"}));throw a.redirect((b=a.context,c={token:e},d=new URL(f,b.baseURL),c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href))}),b3=(0,N.createAuthEndpoint)("/reset-password",{method:"POST",operationId:"resetPassword",query:l.object({token:l.string().optional()}).optional(),body:l.object({newPassword:l.string().meta({description:"The new password to set"}),token:l.string().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{operationId:"resetPassword",description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let b=a.body.token||a.query?.token;if(!b)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.INVALID_TOKEN});let{newPassword:c}=a.body,d=a.context.password?.config.minPasswordLength,e=a.context.password?.config.maxPasswordLength;if(c.length<d)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.PASSWORD_TOO_SHORT});if(c.length>e)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.PASSWORD_TOO_LONG});let f=`reset-password:${b}`,g=await a.context.internalAdapter.findVerificationValue(f);if(!g||g.expiresAt<new Date)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.INVALID_TOKEN});let h=g.value,i=await a.context.password.hash(c);if((await a.context.internalAdapter.findAccounts(h)).find(a=>"credential"===a.providerId)?await a.context.internalAdapter.updatePassword(h,i):await a.context.internalAdapter.createAccount({userId:h,providerId:"credential",password:i,accountId:h}),await a.context.internalAdapter.deleteVerificationValue(g.id),a.context.options.emailAndPassword?.onPasswordReset){let b=await a.context.internalAdapter.findUserById(h);b&&await a.context.options.emailAndPassword.onPasswordReset({user:b},a.request)}return a.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await a.context.internalAdapter.deleteSessions(h),a.json({status:!0})}),b4=(0,N.createAuthEndpoint)("/verify-password",{method:"POST",body:l.object({password:l.string().meta({description:"The password to verify"})}),metadata:{scope:"server",openapi:{operationId:"verifyPassword",description:"Verify the current user's password",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}},use:[aP]},async a=>{let{password:b}=a.body,c=a.context.session;if(!await b$(a,{password:b,userId:c.user.id}))throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.INVALID_PASSWORD});return a.json({status:!0})}),b5=l.object({callbackURL:l.string().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:l.string().optional(),errorCallbackURL:l.string().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:bI,disableRedirect:l.boolean().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:l.optional(l.object({token:l.string().meta({description:"ID token from the provider"}),nonce:l.string().meta({description:"Nonce used to generate the token"}).optional(),accessToken:l.string().meta({description:"Access token from the provider"}).optional(),refreshToken:l.string().meta({description:"Refresh token from the provider"}).optional(),expiresAt:l.number().meta({description:"Expiry date of the token"}).optional()})),scopes:l.array(l.string()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:l.boolean().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:l.string().meta({description:"The login hint to use for the authorization code request"}).optional(),additionalData:l.record(l.string(),l.any()).optional().meta({description:"Additional data to be passed through the OAuth flow"})}),b6=(0,N.createAuthEndpoint)("/sign-out",{method:"POST",operationId:"signOut",requireHeaders:!0,metadata:{openapi:{operationId:"signOut",description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async a=>{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(b)try{await a.context.internalAdapter.deleteSession(b)}catch(b){a.context.logger.error("Failed to delete session from database",b)}return(0,j.deleteSessionCookie)(a),a.json({success:!0})}),b7=l.object({name:l.string(),email:l.email(),password:l.string().nonempty(),image:l.string().optional(),callbackURL:l.string().optional(),rememberMe:l.boolean().optional()}).and(l.record(l.string(),l.any())),b8=l.record(l.string().meta({description:"Field name must be a string"}),l.any()),b9=(0,N.createAuthEndpoint)("/change-password",{method:"POST",operationId:"changePassword",body:l.object({newPassword:l.string().meta({description:"The new password to set"}),currentPassword:l.string().meta({description:"The current password is required"}),revokeOtherSessions:l.boolean().meta({description:"Must be a boolean value"}).optional()}),use:[aP],metadata:{openapi:{operationId:"changePassword",description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async a=>{let{newPassword:b,currentPassword:c,revokeOtherSessions:d}=a.body,e=a.context.session,f=a.context.password.config.minPasswordLength;if(b.length<f)throw a.context.logger.error("Password is too short"),new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.PASSWORD_TOO_SHORT});let g=a.context.password.config.maxPasswordLength;if(b.length>g)throw a.context.logger.error("Password is too long"),new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.PASSWORD_TOO_LONG});let h=(await a.context.internalAdapter.findAccounts(e.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!h||!h.password)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.CREDENTIAL_ACCOUNT_NOT_FOUND});let i=await a.context.password.hash(b);if(!await a.context.password.verify({hash:h.password,password:c}))throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.INVALID_PASSWORD});await a.context.internalAdapter.updateAccount(h.id,{password:i});let k=null;if(d){await a.context.internalAdapter.deleteSessions(e.user.id);let b=await a.context.internalAdapter.createSession(e.user.id);if(!b)throw new u.APIError("INTERNAL_SERVER_ERROR",{message:K.BASE_ERROR_CODES.FAILED_TO_GET_SESSION});await (0,j.setSessionCookie)(a,{session:b,user:e.user}),k=b.token}return a.json({token:k,user:(0,Z.parseUserOutput)(a.context.options,e.user)})}),ca=(0,N.createAuthEndpoint)({method:"POST",body:l.object({newPassword:l.string().meta({description:"The new password to set is required"})}),use:[aP]},async a=>{let{newPassword:b}=a.body,c=a.context.session,d=a.context.password.config.minPasswordLength;if(b.length<d)throw a.context.logger.error("Password is too short"),new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.PASSWORD_TOO_SHORT});let e=a.context.password.config.maxPasswordLength;if(b.length>e)throw a.context.logger.error("Password is too long"),new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.PASSWORD_TOO_LONG});let f=(await a.context.internalAdapter.findAccounts(c.user.id)).find(a=>"credential"===a.providerId&&a.password),g=await a.context.password.hash(b);if(!f)return await a.context.internalAdapter.linkAccount({userId:c.user.id,providerId:"credential",accountId:c.user.id,password:g}),a.json({status:!0});throw new u.APIError("BAD_REQUEST",{message:"user already has a password"})}),cb=(0,N.createAuthEndpoint)("/delete-user",{method:"POST",use:[aP],body:l.object({callbackURL:l.string().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:l.string().meta({description:"The password of the user is required to delete the user"}).optional(),token:l.string().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{operationId:"deleteUser",description:"Delete the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{callbackURL:{type:"string",description:"The callback URL to redirect to after the user is deleted"},password:{type:"string",description:"The user's password. Required if session is not fresh"},token:{type:"string",description:"The deletion verification token"}}}}}},responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new u.APIError("NOT_FOUND");let b=a.context.session;if(a.body.password){let c=(await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!c||!c.password)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await a.context.password.verify({hash:c.password,password:a.body.password}))throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.INVALID_PASSWORD})}if(a.body.token)return await cc({...a,query:{token:a.body.token}}),a.json({success:!0,message:"User deleted"});if(a.context.options.user.deleteUser?.sendDeleteAccountVerification){let c=(0,h.generateRandomString)(32,"0-9","a-z");await a.context.internalAdapter.createVerificationValue({value:b.user.id,identifier:`delete-account-${c}`,expiresAt:new Date(Date.now()+1e3*(a.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))});let d=`${a.context.baseURL}/delete-user/callback?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.runInBackgroundOrAwait(a.context.options.user.deleteUser.sendDeleteAccountVerification({user:b.user,url:d,token:c},a.request)),a.json({success:!0,message:"Verification email sent"})}if(!a.body.password&&0!==a.context.sessionConfig.freshAge){let c=new Date(b.session.createdAt).getTime(),d=1e3*a.context.sessionConfig.freshAge;if(Date.now()-c>1e3*d)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.SESSION_EXPIRED})}let c=a.context.options.user.deleteUser?.beforeDelete;c&&await c(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),(0,j.deleteSessionCookie)(a);let d=a.context.options.user.deleteUser?.afterDelete;return d&&await d(b.user,a.request),a.json({success:!0,message:"User deleted"})}),cc=(0,N.createAuthEndpoint)("/delete-user/callback",{method:"GET",query:l.object({token:l.string().meta({description:"The token to verify the deletion request"}),callbackURL:l.string().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[R(a=>a.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new u.APIError("NOT_FOUND");let b=await aN(a);if(!b)throw new u.APIError("NOT_FOUND",{message:K.BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO});let c=await a.context.internalAdapter.findVerificationValue(`delete-account-${a.query.token}`);if(!c||c.expiresAt<new Date||c.value!==b.user.id)throw new u.APIError("NOT_FOUND",{message:K.BASE_ERROR_CODES.INVALID_TOKEN});let d=a.context.options.user.deleteUser?.beforeDelete;d&&await d(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),await a.context.internalAdapter.deleteVerificationValue(c.id),(0,j.deleteSessionCookie)(a);let e=a.context.options.user.deleteUser?.afterDelete;if(e&&await e(b.user,a.request),a.query.callbackURL)throw a.redirect(a.query.callbackURL||"/");return a.json({success:!0,message:"User deleted"})}),cd=(0,N.createAuthEndpoint)("/change-email",{method:"POST",body:l.object({newEmail:l.email().meta({description:"The new email address to set must be a valid email address"}),callbackURL:l.string().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[aP],metadata:{openapi:{operationId:"changeEmail",responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"},status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}},422:{description:"Unprocessable Entity. Email already exists",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.user?.changeEmail?.enabled)throw a.context.logger.error("Change email is disabled."),new u.APIError("BAD_REQUEST",{message:"Change email is disabled"});let b=a.body.newEmail.toLowerCase();if(b===a.context.session.user.email)throw a.context.logger.error("Email is the same"),new u.APIError("BAD_REQUEST",{message:"Email is the same"});if(await a.context.internalAdapter.findUserByEmail(b))throw a.context.logger.error("Email already exists"),new u.APIError("UNPROCESSABLE_ENTITY",{message:K.BASE_ERROR_CODES.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});if(!0!==a.context.session.user.emailVerified&&a.context.options.user.changeEmail.updateEmailWithoutVerification){if(await a.context.internalAdapter.updateUserByEmail(a.context.session.user.email,{email:b}),await (0,j.setSessionCookie)(a,{session:a.context.session.session,user:{...a.context.session.user,email:b}}),a.context.options.emailVerification?.sendVerificationEmail){let c=await bQ(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request))}return a.json({status:!0})}if(a.context.session.user.emailVerified&&(a.context.options.user.changeEmail.sendChangeEmailConfirmation||a.context.options.user.changeEmail.sendChangeEmailVerification)){let c=await bQ(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-confirmation"}),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`,e=a.context.options.user.changeEmail.sendChangeEmailConfirmation||a.context.options.user.changeEmail.sendChangeEmailVerification;return e&&await a.context.runInBackgroundOrAwait(e({user:a.context.session.user,newEmail:b,url:d,token:c},a.request)),a.json({status:!0})}if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new u.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await bQ(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-verification"}),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request)),a.json({status:!0})});var ce=a.i(11675);function cf(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.iterator in a)&&(!(Symbol.toStringTag in a)||"[object Module]"===Object.prototype.toString.call(a))}function cg(a){return(...b)=>b.reduce((b,c)=>(function a(b,c,d=".",e){if(!cf(c))return a(b,{},d,e);let f=Object.assign({},c);for(let c in b){if("__proto__"===c||"constructor"===c)continue;let g=b[c];null!=g&&(e&&e(f,c,g,d)||(Array.isArray(g)&&Array.isArray(f[c])?f[c]=[...g,...f[c]]:cf(g)&&cf(f[c])?f[c]=a(g,f[c],(d?`${d}.`:"")+c.toString(),e):f[c]=g))}return f})(b,c,"",a),{})}let ch=cg();cg((a,b,c)=>{if(void 0!==a[b]&&"function"==typeof c)return a[b]=c(a[b]),!0}),cg((a,b,c)=>{if(Array.isArray(a[b])&&"function"==typeof c)return a[b]=c(a[b]),!0});let ci=cg((a,b,c)=>{if(Array.isArray(a[b])&&Array.isArray(c))return a[b]=c,!0}),cj=new WeakMap;async function ck(a,b){let c={};for(let d of b){let b=!1;try{b=d.matcher(a)}catch(c){let b=cj.get(d.handler)??"unknown";throw a.context.logger.error(`An error occurred during ${b} hook matcher execution:`,c),new u.APIError("INTERNAL_SERVER_ERROR",{message:"An error occurred during hook matcher execution. Check the logs for more details."})}if(b){let b=await d.handler({...a,returnHeaders:!1}).catch(b=>{throw b instanceof u.APIError&&(0,ae.shouldPublishLog)(a.context.logger.level,"debug")&&(b.stack=b.errorStack),b});if(b&&"object"==typeof b){if("context"in b&&"object"==typeof b.context){let{headers:a,...d}=b.context;a instanceof Headers&&(c.headers?a.forEach((a,b)=>{c.headers?.set(b,a)}):c.headers=a),c=ci(d,c);continue}return b}}}return{context:c}}async function cl(a,b){for(let c of b)if(c.matcher(a)){let b=await c.handler(a).catch(b=>{if(b instanceof u.APIError)return(0,ae.shouldPublishLog)(a.context.logger.level,"debug")&&(b.stack=b.errorStack),{response:b,headers:b.headers?new Headers(b.headers):null};throw b});b.headers&&b.headers.forEach((b,c)=>{a.context.responseHeaders?"set-cookie"===c.toLowerCase()?a.context.responseHeaders.append(c,b):a.context.responseHeaders.set(c,b):a.context.responseHeaders=new Headers({[c]:b})}),b.response&&(a.context.returned=b.response)}return{response:a.context.returned,headers:a.context.responseHeaders}}var cm=a.i(14687);function cn(a,b){let c=new Map;a.plugins?.forEach(a=>{if(a.endpoints){for(let[b,d]of Object.entries(a.endpoints))if(d&&"path"in d&&"string"==typeof d.path){let e=d.path,f=[];d.options&&"method"in d.options&&(Array.isArray(d.options.method)?f=d.options.method:"string"==typeof d.options.method&&(f=[d.options.method])),0===f.length&&(f=["*"]),c.has(e)||c.set(e,[]),c.get(e).push({pluginId:a.id,endpointKey:b,methods:f})}}});let d=[];for(let[a,b]of c.entries())if(b.length>1){let c=new Map,e=!1;for(let a of b)for(let d of a.methods)c.has(d)||c.set(d,[]),c.get(d).push(a.pluginId),c.get(d).length>1&&(e=!0),"*"===d&&b.length>1?e=!0:"*"!==d&&c.has("*")&&(e=!0);if(e){let e=[...new Set(b.map(a=>a.pluginId))],f=[];for(let[a,d]of c.entries())(d.length>1||"*"===a&&b.length>1||"*"!==a&&c.has("*"))&&f.push(a);d.push({path:a,plugins:e,conflictingMethods:f})}}if(d.length>0){let a=d.map(a=>`  - "${a.path}" [${a.conflictingMethods.join(", ")}] used by plugins: ${a.plugins.join(", ")}`).join("\n");b.error(`Endpoint path conflicts detected! Multiple plugins are trying to use the same endpoint paths with conflicting HTTP methods:
${a}

To resolve this, you can:
	1. Use only one of the conflicting plugins
	2. Configure the plugins to use different paths (if supported)
	3. Ensure plugins use different HTTP methods for the same path
`)}}function co(a,b){let c=b.plugins?.reduce((a,b)=>({...a,...b.endpoints}),{})??{},d=b.plugins?.map(b=>b.middlewares?.map(b=>{let c=async c=>{let d=await a;return b.middleware({...c,context:{...d,...c.context}})};return c.options=b.middleware.options,{path:b.path,middleware:c}})).filter(a=>void 0!==a).flat()||[];return{api:function(a,b){let c={};for(let[d,e]of Object.entries(a))c[d]=async a=>{let c=async()=>{let c=await b,d={...a,context:{...c,returned:void 0,responseHeaders:void 0,session:null},path:e.path,headers:a?.headers?new Headers(a?.headers):void 0};return(0,al.runWithEndpointContext)(d,async()=>{let{beforeHooks:b,afterHooks:f}=function(a){let b=a.options.plugins||[],c=[],d=[],e=a.options.hooks?.before;e&&(cj.set(e,"user"),c.push({matcher:()=>!0,handler:e}));let f=a.options.hooks?.after;f&&(cj.set(f,"user"),d.push({matcher:()=>!0,handler:f}));let g=b.filter(a=>a.hooks?.before).map(a=>a.hooks?.before).flat(),h=b.filter(a=>a.hooks?.after).map(a=>a.hooks?.after).flat();return g.length&&c.push(...g),h.length&&d.push(...h),{beforeHooks:c,afterHooks:d}}(c),g=await ck(d,b);if("context"in g&&g.context&&"object"==typeof g.context){let{headers:a,...b}=g.context;a&&a.forEach((a,b)=>{d.headers.set(b,a)}),d=ci(b,d)}else if(g)return a?.asResponse?(0,ce.toResponse)(g,{headers:a?.headers}):a?.returnHeaders?{headers:a?.headers,response:g}:g;d.asResponse=!1,d.returnHeaders=!0,d.returnStatus=!0;let h=await (0,al.runWithEndpointContext)(d,()=>e(d)).catch(a=>{if(a instanceof u.APIError)return{response:a,status:a.statusCode,headers:a.headers?new Headers(a.headers):null};throw a});if(h&&h instanceof Response)return h;d.context.returned=h.response,d.context.responseHeaders=h.headers;let i=await cl(d,f);if(i.response&&(h.response=i.response),h.response instanceof u.APIError&&(0,ae.shouldPublishLog)(c.logger.level,"debug")&&(h.response.stack=h.response.errorStack),h.response instanceof u.APIError&&!a?.asResponse)throw h.response;return a?.asResponse?(0,ce.toResponse)(h.response,{headers:h.headers,status:h.status}):a?.returnHeaders?a?.returnStatus?{headers:h.headers,response:h.response,status:h.status}:{headers:h.headers,response:h.response}:a?.returnStatus?{response:h.response,status:h.status}:h.response})};return await (0,r.hasRequestState)()?c():(0,r.runWithRequestState)(new WeakMap,c)},c[d].path=e.path,c[d].options=e.options;return c}({signInSocial:(0,N.createAuthEndpoint)("/sign-in/social",{method:"POST",operationId:"socialSignIn",body:b5,metadata:{$Infer:{body:{},returned:{}},openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{token:{type:"string"},user:{type:"object",$ref:"#/components/schemas/User"},url:{type:"string"},redirect:{type:"boolean",enum:[!1]}},required:["redirect","token","user"]}}}}}}}},async a=>{let b=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!b)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new u.APIError("NOT_FOUND",{message:K.BASE_ERROR_CODES.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!b.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new u.APIError("NOT_FOUND",{message:K.BASE_ERROR_CODES.ID_TOKEN_NOT_SUPPORTED});let{token:c,nonce:d}=a.body.idToken;if(!await b.verifyIdToken(c,d))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new u.APIError("UNAUTHORIZED",{message:K.BASE_ERROR_CODES.INVALID_TOKEN});let e=await b.getUserInfo({idToken:c,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!e||!e?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new u.APIError("UNAUTHORIZED",{message:K.BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO});if(!e.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new u.APIError("UNAUTHORIZED",{message:K.BASE_ERROR_CODES.USER_EMAIL_NOT_FOUND});let f=await bU(a,{userInfo:{...e.user,email:e.user.email,id:String(e.user.id),name:e.user.name||"",image:e.user.image,emailVerified:e.user.emailVerified||!1},account:{providerId:b.id,accountId:String(e.user.id),accessToken:a.body.idToken.accessToken},callbackURL:a.body.callbackURL,disableSignUp:b.disableImplicitSignUp&&!a.body.requestSignUp||b.disableSignUp});if(f.error)throw new u.APIError("UNAUTHORIZED",{message:f.error});return await (0,j.setSessionCookie)(a,f.data),a.json({redirect:!1,token:f.data.session.token,url:void 0,user:(0,Z.parseUserOutput)(a.context.options,f.data.user)})}let{codeVerifier:c,state:d}=await v(a,void 0,a.body.additionalData),e=await b.createAuthorizationURL({state:d,codeVerifier:c,redirectURI:`${a.context.baseURL}/callback/${b.id}`,scopes:a.body.scopes,loginHint:a.body.loginHint});return a.body.disableRedirect||a.setHeader("Location",e.toString()),a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),callbackOAuth:bW,getSession:aM(),signOut:b6,signUpEmail:(0,N.createAuthEndpoint)("/sign-up/email",{method:"POST",operationId:"signUpWithEmailAndPassword",use:[T],body:b7,metadata:{allowedMediaTypes:["application/x-www-form-urlencoded","application/json"],$Infer:{body:{},returned:{}},openapi:{operationId:"signUpWithEmailAndPassword",description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},image:{type:"string",description:"The profile image URL of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"},rememberMe:{type:"boolean",description:"If this is false, the session will not be remembered. Default is `true`."}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}},422:{description:"Unprocessable Entity. User already exists or failed to create user.",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>(0,ak.runWithTransaction)(a.context.adapter,async()=>{let b;if(!a.context.options.emailAndPassword?.enabled||a.context.options.emailAndPassword?.disableSignUp)throw new u.APIError("BAD_REQUEST",{message:"Email and password sign up is not enabled"});let c=a.body,{name:d,email:e,password:f,image:g,callbackURL:h,rememberMe:i,...k}=c;if(!l.email().safeParse(e).success)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.INVALID_EMAIL});if(!f||"string"!=typeof f)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.INVALID_PASSWORD});let m=a.context.password.config.minPasswordLength;if(f.length<m)throw a.context.logger.error("Password is too short"),new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.PASSWORD_TOO_SHORT});let n=a.context.password.config.maxPasswordLength;if(f.length>n)throw a.context.logger.error("Password is too long"),new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.PASSWORD_TOO_LONG});if((await a.context.internalAdapter.findUserByEmail(e))?.user)throw a.context.logger.info(`Sign-up attempt for existing email: ${e}`),new u.APIError("UNPROCESSABLE_ENTITY",{message:K.BASE_ERROR_CODES.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});let o=await a.context.password.hash(f);try{let c=(0,Z.parseUserInput)(a.context.options,k,"create");if(!(b=await a.context.internalAdapter.createUser({email:e.toLowerCase(),name:d,image:g,...c,emailVerified:!1})))throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.FAILED_TO_CREATE_USER})}catch(b){if((0,z.isDevelopment)()&&a.context.logger.error("Failed to create user",b),b instanceof u.APIError)throw b;throw a.context.logger?.error("Failed to create user",b),new u.APIError("UNPROCESSABLE_ENTITY",{message:K.BASE_ERROR_CODES.FAILED_TO_CREATE_USER})}if(!b)throw new u.APIError("UNPROCESSABLE_ENTITY",{message:K.BASE_ERROR_CODES.FAILED_TO_CREATE_USER});if(await a.context.internalAdapter.linkAccount({userId:b.id,providerId:"credential",accountId:b.id,password:o}),a.context.options.emailVerification?.sendOnSignUp??a.context.options.emailAndPassword.requireEmailVerification){let d=await bQ(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),e=c.callbackURL?encodeURIComponent(c.callbackURL):encodeURIComponent("/"),f=`${a.context.baseURL}/verify-email?token=${d}&callbackURL=${e}`;a.context.options.emailVerification?.sendVerificationEmail&&await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:b,url:f,token:d},a.request))}if(!1===a.context.options.emailAndPassword.autoSignIn||a.context.options.emailAndPassword.requireEmailVerification)return a.json({token:null,user:(0,Z.parseUserOutput)(a.context.options,b)});let p=await a.context.internalAdapter.createSession(b.id,!1===i);if(!p)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION});return await (0,j.setSessionCookie)(a,{session:p,user:b},!1===i),a.json({token:p.token,user:(0,Z.parseUserOutput)(a.context.options,b)})})),signInEmail:(0,N.createAuthEndpoint)("/sign-in/email",{method:"POST",operationId:"signInEmail",use:[T],body:l.object({email:l.string().meta({description:"Email of the user"}),password:l.string().meta({description:"Password of the user"}),callbackURL:l.string().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:l.boolean().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{allowedMediaTypes:["application/x-www-form-urlencoded","application/json"],$Infer:{body:{},returned:{}},openapi:{operationId:"signInEmail",description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"string",nullable:!0},user:{type:"object",$ref:"#/components/schemas/User"}},required:["redirect","token","user"]}}}}}}}},async a=>{if(!a.context.options?.emailAndPassword?.enabled)throw a.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new u.APIError("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:b,password:c}=a.body;if(!l.email().safeParse(b).success)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.INVALID_EMAIL});let d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)throw await a.context.password.hash(c),a.context.logger.error("User not found",{email:b}),new u.APIError("UNAUTHORIZED",{message:K.BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD});let e=d.accounts.find(a=>"credential"===a.providerId);if(!e)throw await a.context.password.hash(c),a.context.logger.error("Credential account not found",{email:b}),new u.APIError("UNAUTHORIZED",{message:K.BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD});let f=e?.password;if(!f)throw await a.context.password.hash(c),a.context.logger.error("Password not found",{email:b}),new u.APIError("UNAUTHORIZED",{message:K.BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD});if(!await a.context.password.verify({hash:f,password:c}))throw a.context.logger.error("Invalid password"),new u.APIError("UNAUTHORIZED",{message:K.BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD});if(a.context.options?.emailAndPassword?.requireEmailVerification&&!d.user.emailVerified){if(!a.context.options?.emailVerification?.sendVerificationEmail)throw new u.APIError("FORBIDDEN",{message:K.BASE_ERROR_CODES.EMAIL_NOT_VERIFIED});if(a.context.options?.emailVerification?.sendOnSignIn){let b=await bQ(a.context.secret,d.user.email,void 0,a.context.options.emailVerification?.expiresIn),c=a.body.callbackURL?encodeURIComponent(a.body.callbackURL):encodeURIComponent("/"),e=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${c}`;await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:d.user,url:e,token:b},a.request))}throw new u.APIError("FORBIDDEN",{message:K.BASE_ERROR_CODES.EMAIL_NOT_VERIFIED})}let g=await a.context.internalAdapter.createSession(d.user.id,!1===a.body.rememberMe);if(!g)throw a.context.logger.error("Failed to create session"),new u.APIError("UNAUTHORIZED",{message:K.BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION});return await (0,j.setSessionCookie)(a,{session:g,user:d.user},!1===a.body.rememberMe),a.body.callbackURL&&a.setHeader("Location",a.body.callbackURL),a.json({redirect:!!a.body.callbackURL,token:g.token,url:a.body.callbackURL,user:(0,Z.parseUserOutput)(a.context.options,d.user)})}),resetPassword:b3,verifyPassword:b4,verifyEmail:bT,sendVerificationEmail:bS,changeEmail:cd,changePassword:b9,setPassword:ca,updateUser:(0,N.createAuthEndpoint)("/update-user",{method:"POST",operationId:"updateUser",body:b8,use:[aO],metadata:{$Infer:{body:{}},openapi:{operationId:"updateUser",description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user",nullable:!0}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"}}}}}}}}}},async a=>{let b=a.body;if("object"!=typeof b||Array.isArray(b))throw new u.APIError("BAD_REQUEST",{message:"Body must be an object"});if(b.email)throw new u.APIError("BAD_REQUEST",{message:K.BASE_ERROR_CODES.EMAIL_CAN_NOT_BE_UPDATED});let{name:c,image:d,...e}=b,f=a.context.session,g=(0,Z.parseUserInput)(a.context.options,e,"update");if(void 0===d&&void 0===c&&0===Object.keys(g).length)throw new u.APIError("BAD_REQUEST",{message:"No fields to update"});let h=await a.context.internalAdapter.updateUser(f.user.id,{name:c,image:d,...g})??{...f.user,...void 0!==c&&{name:c},...void 0!==d&&{image:d},...g};return await (0,j.setSessionCookie)(a,{session:f.session,user:h}),a.json({status:!0})}),deleteUser:cb,requestPasswordReset:b1,requestPasswordResetCallback:b2,listSessions:(0,N.createAuthEndpoint)("/list-sessions",{method:"GET",operationId:"listUserSessions",use:[aO],requireHeaders:!0,metadata:{openapi:{operationId:"listUserSessions",description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async a=>{try{let b=(await a.context.internalAdapter.listSessions(a.context.session.user.id)).filter(a=>a.expiresAt>new Date);return a.json(b.map(b=>(0,Z.parseSessionOutput)(a.context.options,b)))}catch(b){throw a.context.logger.error(b),a.error("INTERNAL_SERVER_ERROR")}}),revokeSession:aR,revokeSessions:aS,revokeOtherSessions:aT,linkSocialAccount:bK,listUserAccounts:bJ,deleteUserCallback:cc,unlinkAccount:bL,refreshToken:bN,getAccessToken:bM,accountInfo:bP,...c,ok:bZ,error:bY},a),middlewares:d}}let cp=(a,b)=>{let{api:c,middlewares:d}=co(a,b),e=new URL(a.baseURL).pathname;return(0,cm.createRouter)(c,{routerContext:a,openapi:{disabled:!0},basePath:e,routerMiddleware:[{path:"/**",middleware:Q},...d],allowedMediaTypes:["application/json"],skipTrailingSlashes:b.advanced?.skipTrailingSlashes??!1,async onRequest(b){let c=a.options.disabledPaths||[],d=(0,M.normalizePathname)(b.url,e);if(c.includes(d))return new Response("Not Found",{status:404});let f=b;for(let b of a.options.plugins||[])if(b.onRequest){let c=await b.onRequest(f,a);if(c&&"response"in c)return c.response;c&&"request"in c&&(f=c.request)}let g=await X(f,a);return g||f},async onResponse(b){for(let c of a.options.plugins||[])if(c.onResponse){let d=await c.onResponse(b,a);if(d)return d.response}return b},onError(c){if(c instanceof u.APIError&&"FOUND"===c.status)return;if(b.onAPIError?.throw)throw c;if(b.onAPIError?.onError)return void b.onAPIError.onError(c,a);let d=b.logger?.level,e="error"===d||"warn"===d||"debug"===d?ae.logger:void 0;if(b.logger?.disabled!==!0){if(c&&"object"==typeof c&&"message"in c&&"string"==typeof c.message&&(c.message.includes("no column")||c.message.includes("column")||c.message.includes("relation")||c.message.includes("table")||c.message.includes("does not exist")))return void a.logger?.error(c.message);c instanceof u.APIError?("INTERNAL_SERVER_ERROR"===c.status&&a.logger.error(c.status,c),e?.error(c.message)):a.logger?.error(c&&"object"==typeof c&&"name"in c?c.name:"",c)}}})};var cq=a.i(55367),cr=a.i(23493);let cs="better-auth-secret-12345678901234567890";async function ct(a){let b=a.options,c=b.plugins||[],d=a,e=[];for(let a of c)if(a.init){let c,f=a.init(d);if("object"==typeof(c=(0,cr.isPromise)(f)?await f:f)){if(c.options){let{databaseHooks:a,...d}=c.options;a&&e.push(a),b=ch(b,d)}c.context&&(d={...d,...c.context})}}return e.push(b.databaseHooks),d.internalAdapter=an(d.adapter,{options:b,logger:d.logger,hooks:e.filter(a=>void 0!==a),generateId:d.generateId}),d.options=b,{context:d}}async function cu(a,b){let c=E(a.baseURL,a.basePath,b),d=c?[new URL(c).origin]:[];if(a.trustedOrigins&&(Array.isArray(a.trustedOrigins)&&d.push(...a.trustedOrigins),"function"==typeof a.trustedOrigins)){let c=await a.trustedOrigins(b);d.push(...c)}let e=z.env.BETTER_AUTH_TRUSTED_ORIGINS;return e&&d.push(...e.split(",")),d.filter(a=>!!a)}var cv=a.i(78799),cw=a.i(19473),cx=a.i(60573);function cy(a,b){return{database:b?.database,adapter:b?.adapter,emailVerification:{sendVerificationEmail:!!a.emailVerification?.sendVerificationEmail,sendOnSignUp:!!a.emailVerification?.sendOnSignUp,sendOnSignIn:!!a.emailVerification?.sendOnSignIn,autoSignInAfterVerification:!!a.emailVerification?.autoSignInAfterVerification,expiresIn:a.emailVerification?.expiresIn,onEmailVerification:!!a.emailVerification?.onEmailVerification,afterEmailVerification:!!a.emailVerification?.afterEmailVerification},emailAndPassword:{enabled:!!a.emailAndPassword?.enabled,disableSignUp:!!a.emailAndPassword?.disableSignUp,requireEmailVerification:!!a.emailAndPassword?.requireEmailVerification,maxPasswordLength:a.emailAndPassword?.maxPasswordLength,minPasswordLength:a.emailAndPassword?.minPasswordLength,sendResetPassword:!!a.emailAndPassword?.sendResetPassword,resetPasswordTokenExpiresIn:a.emailAndPassword?.resetPasswordTokenExpiresIn,onPasswordReset:!!a.emailAndPassword?.onPasswordReset,password:{hash:!!a.emailAndPassword?.password?.hash,verify:!!a.emailAndPassword?.password?.verify},autoSignIn:!!a.emailAndPassword?.autoSignIn,revokeSessionsOnPasswordReset:!!a.emailAndPassword?.revokeSessionsOnPasswordReset},socialProviders:Object.keys(a.socialProviders||{}).map(b=>{let c=a.socialProviders?.[b];return c?{id:b,mapProfileToUser:!!c.mapProfileToUser,disableDefaultScope:!!c.disableDefaultScope,disableIdTokenSignIn:!!c.disableIdTokenSignIn,disableImplicitSignUp:c.disableImplicitSignUp,disableSignUp:c.disableSignUp,getUserInfo:!!c.getUserInfo,overrideUserInfoOnSignIn:!!c.overrideUserInfoOnSignIn,prompt:c.prompt,verifyIdToken:!!c.verifyIdToken,scope:c.scope,refreshAccessToken:!!c.refreshAccessToken}:{}}),plugins:a.plugins?.map(a=>a.id.toString()),user:{modelName:a.user?.modelName,fields:a.user?.fields,additionalFields:a.user?.additionalFields,changeEmail:{enabled:a.user?.changeEmail?.enabled,sendChangeEmailVerification:!!a.user?.changeEmail?.sendChangeEmailVerification}},verification:{modelName:a.verification?.modelName,disableCleanup:a.verification?.disableCleanup,fields:a.verification?.fields},session:{modelName:a.session?.modelName,additionalFields:a.session?.additionalFields,cookieCache:{enabled:a.session?.cookieCache?.enabled,maxAge:a.session?.cookieCache?.maxAge,strategy:a.session?.cookieCache?.strategy},disableSessionRefresh:a.session?.disableSessionRefresh,expiresIn:a.session?.expiresIn,fields:a.session?.fields,freshAge:a.session?.freshAge,preserveSessionInDatabase:a.session?.preserveSessionInDatabase,storeSessionInDatabase:a.session?.storeSessionInDatabase,updateAge:a.session?.updateAge},account:{modelName:a.account?.modelName,fields:a.account?.fields,encryptOAuthTokens:a.account?.encryptOAuthTokens,updateAccountOnSignIn:a.account?.updateAccountOnSignIn,accountLinking:{enabled:a.account?.accountLinking?.enabled,trustedProviders:a.account?.accountLinking?.trustedProviders,updateUserInfoOnLink:a.account?.accountLinking?.updateUserInfoOnLink,allowUnlinkingAll:a.account?.accountLinking?.allowUnlinkingAll}},hooks:{after:!!a.hooks?.after,before:!!a.hooks?.before},secondaryStorage:!!a.secondaryStorage,advanced:{cookiePrefix:!!a.advanced?.cookiePrefix,cookies:!!a.advanced?.cookies,crossSubDomainCookies:{domain:!!a.advanced?.crossSubDomainCookies?.domain,enabled:a.advanced?.crossSubDomainCookies?.enabled,additionalCookies:a.advanced?.crossSubDomainCookies?.additionalCookies},database:{useNumberId:!!a.advanced?.database?.useNumberId||a.advanced?.database?.generateId==="serial",generateId:a.advanced?.database?.generateId,defaultFindManyLimit:a.advanced?.database?.defaultFindManyLimit},useSecureCookies:a.advanced?.useSecureCookies,ipAddress:{disableIpTracking:a.advanced?.ipAddress?.disableIpTracking,ipAddressHeaders:a.advanced?.ipAddress?.ipAddressHeaders},disableCSRFCheck:a.advanced?.disableCSRFCheck,cookieAttributes:{expires:a.advanced?.defaultCookieAttributes?.expires,secure:a.advanced?.defaultCookieAttributes?.secure,sameSite:a.advanced?.defaultCookieAttributes?.sameSite,domain:!!a.advanced?.defaultCookieAttributes?.domain,path:a.advanced?.defaultCookieAttributes?.path,httpOnly:a.advanced?.defaultCookieAttributes?.httpOnly}},trustedOrigins:a.trustedOrigins?.length,rateLimit:{storage:a.rateLimit?.storage,modelName:a.rateLimit?.modelName,window:a.rateLimit?.window,customStorage:!!a.rateLimit?.customStorage,enabled:a.rateLimit?.enabled,max:a.rateLimit?.max},onAPIError:{errorURL:a.onAPIError?.errorURL,onError:!!a.onAPIError?.onError,throw:a.onAPIError?.throw},logger:{disabled:a.logger?.disabled,level:a.logger?.level,log:!!a.logger?.log},databaseHooks:{user:{create:{after:!!a.databaseHooks?.user?.create?.after,before:!!a.databaseHooks?.user?.create?.before},update:{after:!!a.databaseHooks?.user?.update?.after,before:!!a.databaseHooks?.user?.update?.before}},session:{create:{after:!!a.databaseHooks?.session?.create?.after,before:!!a.databaseHooks?.session?.create?.before},update:{after:!!a.databaseHooks?.session?.update?.after,before:!!a.databaseHooks?.session?.update?.before}},account:{create:{after:!!a.databaseHooks?.account?.create?.after,before:!!a.databaseHooks?.account?.create?.before},update:{after:!!a.databaseHooks?.account?.update?.after,before:!!a.databaseHooks?.account?.update?.before}},verification:{create:{after:!!a.databaseHooks?.verification?.create?.after,before:!!a.databaseHooks?.verification?.create?.before},update:{after:!!a.databaseHooks?.verification?.update?.after,before:!!a.databaseHooks?.verification?.update?.before}}}}}async function cz(){if(c)return c;try{let a="u">typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!a)return;let[{default:b},{default:d}]=await Promise.all([Function("mm","return import(mm)")("fs/promises"),Function("mm","return import(mm)")("path")]),e=await b.readFile(d.join(a,"package.json"),"utf-8");return c=JSON.parse(e)}catch{}}async function cA(a){if(c)return c.dependencies?.[a]||c.devDependencies?.[a]||c.peerDependencies?.[a];try{let b="u">typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!b)throw Error("no-cwd");let[{default:c},{default:d}]=await Promise.all([Function("mm","return import(mm)")("fs/promises"),Function("mm","return import(mm)")("path")]),e=d.join(b,"node_modules",a,"package.json"),f=await c.readFile(e,"utf-8");return JSON.parse(f).version||await cB(a)||void 0}catch{}return await cB(a)}async function cB(a){let b=await cz();if(b)return({...b.dependencies,...b.devDependencies,...b.peerDependencies})[a]}async function cC(){return(await cz())?.name}let cD={pg:"postgresql",mysql:"mysql",mariadb:"mariadb",sqlite3:"sqlite","better-sqlite3":"sqlite","@prisma/client":"prisma",mongoose:"mongodb",mongodb:"mongodb","drizzle-orm":"drizzle"};async function cE(){for(let[a,b]of Object.entries(cD)){let c=await cA(a);if(c)return{name:b,version:c}}}let cF={next:"next",nuxt:"nuxt","@remix-run/server-runtime":"remix",astro:"astro","@sveltejs/kit":"sveltekit","solid-start":"solid-start","tanstack-start":"tanstack-start",hono:"hono",express:"express",elysia:"elysia",expo:"expo"};async function cG(){for(let[a,b]of Object.entries(cF)){let c=await cA(a);if(c)return{name:b,version:c}}}function cH(){let a=(...a)=>a.some(a=>!!z.env[a]);return a("CF_PAGES","CF_PAGES_URL","CF_ACCOUNT_ID")||"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent?"cloudflare":a("VERCEL","VERCEL_URL","VERCEL_ENV")?"vercel":a("NETLIFY","NETLIFY_URL")?"netlify":a("RENDER","RENDER_URL","RENDER_INTERNAL_HOSTNAME","RENDER_SERVICE_ID")?"render":a("AWS_LAMBDA_FUNCTION_NAME","AWS_EXECUTION_ENV","LAMBDA_TASK_ROOT")?"aws":a("GOOGLE_CLOUD_FUNCTION_NAME","GOOGLE_CLOUD_PROJECT","GCP_PROJECT","K_SERVICE")?"gcp":a("AZURE_FUNCTION_NAME","FUNCTIONS_WORKER_RUNTIME","WEBSITE_INSTANCE_ID","WEBSITE_SITE_NAME")?"azure":a("DENO_DEPLOYMENT_ID","DENO_REGION")?"deno-deploy":a("FLY_APP_NAME","FLY_REGION","FLY_ALLOC_ID")?"fly-io":a("RAILWAY_STATIC_URL","RAILWAY_ENVIRONMENT_NAME")?"railway":a("DYNO","HEROKU_APP_NAME")?"heroku":a("DO_DEPLOYMENT_ID","DO_APP_NAME","DIGITALOCEAN")?"digitalocean":a("KOYEB","KOYEB_DEPLOYMENT_ID","KOYEB_APP_NAME")?"koyeb":null}async function cI(){try{if("cloudflare"===cH())return"cloudflare";let a=await Function("mm","return import(mm)")("os"),b=a.cpus();return{deploymentVendor:cH(),systemPlatform:a.platform(),systemRelease:a.release(),systemArchitecture:a.arch(),cpuCount:b.length,cpuModel:b.length?b[0].model:null,cpuSpeed:b.length?b[0].speed:null,memory:a.totalmem(),isWSL:await cM(),isDocker:await cL(),isTTY:"u">typeof process&&process.stdout?process.stdout.isTTY:null}}catch{return{systemPlatform:null,systemRelease:null,systemArchitecture:null,cpuCount:null,cpuModel:null,cpuSpeed:null,memory:null,isWSL:null,isDocker:null,isTTY:null}}}async function cJ(){if("cloudflare"===cH())return!1;try{return(await Function("mm","return import(mm)")("fs")).statSync("/.dockerenv"),!0}catch{return!1}}async function cK(){if("cloudflare"===cH())return!1;try{return(await Function("mm","return import(mm)")("fs")).readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}async function cL(){return"cloudflare"!==cH()&&(void 0===d&&(d=await cJ()||await cK()),d)}async function cM(){try{if("cloudflare"===cH()||"u"<typeof process||process?.platform!=="linux")return!1;let a=await Function("mm","return import(mm)")("fs");if((await Function("mm","return import(mm)")("os")).release().toLowerCase().includes("microsoft")){if(await cO())return!1;return!0}return!!a.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")&&!await cO()}catch{return!1}}let cN=async()=>{if("cloudflare"===cH())return!1;try{return(await Function("mm","return import(mm)")("fs")).statSync("/run/.containerenv"),!0}catch{return!1}};async function cO(){return void 0===e&&(e=await cN()||await cL()),e}async function cP(a){let b=await (0,cw.createHash)("SHA-256").digest(a);return aJ.base64.encode(b)}let cQ=null;async function cR(a){if(cQ)return cQ;let b=await cC();return b?cQ=await cP(a?a+b:b):a?cQ=await cP(a):cQ=(0,cx.createRandomStringGenerator)("a-z","A-Z","0-9")(32)}let cS=async function(){};async function cT(a,b){let c,d=a.telemetry?.debug||(0,z.getBooleanEnvVar)("BETTER_AUTH_TELEMETRY_DEBUG",!1),e=z.ENV.BETTER_AUTH_TELEMETRY_ENDPOINT;if(!e&&!b?.customTrack)return{publish:cS};let f=async a=>{b?.customTrack?await b.customTrack(a).catch(ae.logger.error):e&&(d?ae.logger.info("telemetry event",JSON.stringify(a,null,2)):await bi(e,{method:"POST",body:a}).catch(ae.logger.error))},g=async()=>{let c=a.telemetry?.enabled!==void 0&&a.telemetry.enabled;return((0,z.getBooleanEnvVar)("BETTER_AUTH_TELEMETRY",!1)||c)&&(b?.skipTestCheck||!(0,z.isTest)())},h=await g();return h&&(c=await cR(a.baseURL),f({type:"init",payload:{config:cy(a,b),runtime:"u">typeof Deno?{name:"deno",version:Deno?.version?.deno??null}:"u">typeof Bun?{name:"bun",version:Bun?.version??null}:"u">typeof process&&process?.versions?.node?{name:"node",version:process.versions.node??null}:{name:"edge",version:null},database:await cE(),framework:await cG(),environment:"production"===(0,z.getEnvVar)("NODE_ENV")?"production":"false"!==z.env.CI&&("BUILD_ID"in z.env||"BUILD_NUMBER"in z.env||"CI"in z.env||"CI_APP_ID"in z.env||"CI_BUILD_ID"in z.env||"CI_BUILD_NUMBER"in z.env||"CI_NAME"in z.env||"CONTINUOUS_INTEGRATION"in z.env||"RUN_ID"in z.env)?"ci":(0,z.isTest)()?"test":"development",systemInfo:await cI(),packageManager:function(){let a=z.env.npm_config_user_agent;if(!a)return;let b=a.split(" ")[0],c=b.lastIndexOf("/"),d=b.substring(0,c);return{name:"npminstall"===d?"cnpm":d,version:b.substring(c+1)}}()},anonymousId:c})),{publish:async b=>{h&&(c||(c=await cR(a.baseURL)),await f({type:b.type,payload:b.payload,anonymousId:c}))}}}async function cU(a,b,c){var d;let e,f,g;b.database||(b=ch(b,{session:{cookieCache:{enabled:!0,strategy:"jwe",refreshCache:!0}},account:{storeStateStrategy:"cookie",storeAccountCookie:!0}}));let h=b.plugins||[],i=(d=b,d.advanced?.crossSubDomainCookies?.enabled,[]),l=(0,ae.createLogger)(b.logger),m=E(b.baseURL,b.basePath);m||l.warn("[better-auth] Base URL could not be determined. Please set a valid base URL using the baseURL config option or the BETTER_AUTH_BASE_URL environment variable. Without this, callbacks and redirects may not work correctly."),"memory"===a.id&&b.advanced?.database?.generateId===!1&&l.error(`[better-auth] Misconfiguration detected.
You are using the memory DB with generateId: false.
This will cause no id to be generated for any model.
Most of the features of Better Auth will not work correctly.`);let n=b.secret||z.env.BETTER_AUTH_SECRET||z.env.AUTH_SECRET||cs,o=n===cs;if(!(0,z.isTest)()){let a;if(o&&z.isProduction)throw new k.BetterAuthError("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config.");if(!n)throw new k.BetterAuthError("BETTER_AUTH_SECRET is missing. Set it in your environment or pass `secret` to betterAuth({ secret }).");n.length<32&&l.warn("[better-auth] Warning: your BETTER_AUTH_SECRET should be at least 32 characters long for adequate security. Generate one with `npx @better-auth/cli secret` or `openssl rand -base64 32`."),120>(0===(a=new Set(n).size)?0:Math.log2(Math.pow(a,n.length)))&&l.warn("[better-auth] Warning: your BETTER_AUTH_SECRET appears low-entropy. Use a randomly generated secret for production.")}cn(b={...b,secret:n,baseURL:m?new URL(m).origin:"",basePath:b.basePath||"/api/auth",plugins:h.concat(i)},l);let p=(0,j.getCookies)(b),q=(0,ad.getAuthTables)(b),r=Object.entries(b.socialProviders||{}).map(([a,b])=>{if(null==b||!1===b.enabled)return null;b.clientId||l.warn(`Social provider ${a} is missing clientId or clientSecret`);let c=bG[a](b);return c.disableImplicitSignUp=b.disableImplicitSignUp,c}).filter(a=>null!==a),s=({model:a,size:c})=>{if("function"==typeof b.advanced?.generateId)return b.advanced.generateId({model:a,size:c});let d=b?.advanced?.database?.generateId;return"function"==typeof d?d({model:a,size:c}):"uuid"===d?crypto.randomUUID():"serial"!==d&&!1!==d&&(0,y.generateId)(c)},{publish:t}=await cT(b,{adapter:a.id,database:"function"==typeof b.database?"adapter":c(b.database)}),u=await cu(b),v=ct({appName:b.appName||"Better Auth",baseURL:m||"",version:(0,cv.getBetterAuthVersion)(),socialProviders:r,options:b,oauthConfig:{storeStateStrategy:b.account?.storeStateStrategy||(b.database?"database":"cookie"),skipStateCookieCheck:!!b.account?.skipStateCookieCheck},tables:q,trustedOrigins:u,isTrustedOrigin(a,b){return this.trustedOrigins.some(c=>J(a,c,b))},sessionConfig:{updateAge:b.session?.updateAge!==void 0?b.session.updateAge:86400,expiresIn:b.session?.expiresIn||604800,freshAge:b.session?.freshAge===void 0?86400:b.session.freshAge,cookieRefreshCache:(f=b.session?.cookieCache?.refreshCache,g=b.session?.cookieCache?.maxAge||300,(b.database||b.secondaryStorage)&&f?(l.warn("[better-auth] `session.cookieCache.refreshCache` is enabled while `database` or `secondaryStorage` is configured. `refreshCache` is meant for stateless (DB-less) setups. Disabling `refreshCache`  remove it from your config to silence this warning."),!1):!1!==f&&void 0!==f&&(!0===f?{enabled:!0,updateAge:Math.floor(.2*g)}:{enabled:!0,updateAge:void 0!==f.updateAge?f.updateAge:Math.floor(.2*g)}))},secret:n,rateLimit:{...b.rateLimit,enabled:b.rateLimit?.enabled??z.isProduction,window:b.rateLimit?.window||10,max:b.rateLimit?.max||100,storage:b.rateLimit?.storage||(b.secondaryStorage?"secondary-storage":"memory")},authCookies:p,logger:l,generateId:s,session:null,secondaryStorage:b.secondaryStorage,password:{hash:b.emailAndPassword?.password?.hash||cq.hashPassword,verify:b.emailAndPassword?.password?.verify||cq.verifyPassword,config:{minPasswordLength:b.emailAndPassword?.minPasswordLength||8,maxPasswordLength:b.emailAndPassword?.maxPasswordLength||128},checkPassword:b_},setNewSession(a){this.newSession=a},newSession:null,adapter:a,internalAdapter:an(a,{options:b,logger:l,hooks:b.databaseHooks?[b.databaseHooks]:[],generateId:s}),createAuthCookie:(0,j.createCookieGetter)(b),async runMigrations(){throw new k.BetterAuthError("runMigrations will be set by the specific init implementation")},publishTelemetry:t,skipCSRFCheck:!!b.advanced?.disableCSRFCheck,skipOriginCheck:b.advanced?.disableOriginCheck!==void 0?b.advanced.disableOriginCheck:!!(0,z.isTest)(),runInBackground:b.advanced?.backgroundTasks?.handler??(a=>{a.catch(()=>{})}),async runInBackgroundOrAwait(a){try{b.advanced?.backgroundTasks?.handler?a instanceof Promise&&b.advanced.backgroundTasks.handler(a.catch(a=>{l.error("Failed to run background task:",a)})):await a}catch(a){l.error("Failed to run background task:",a)}},getPlugin:a=>b.plugins.find(b=>b.id===a)??null});return(0,cr.isPromise)(v)?{context:e}=await v:{context:e}=v,"function"==typeof e.options.emailVerification?.onEmailVerification&&(e.options.emailVerification.onEmailVerification=(0,L.deprecate)(e.options.emailVerification.onEmailVerification,"Use `afterEmailVerification` instead. This will be removed in 1.5",e.logger)),e}a.s(["createTelemetry",()=>cT,"getTelemetryAuthConfig",()=>cy],83508);let cV=async a=>{let b=await ag(a),c=await cU(b,a,a=>(0,ar.getKyselyDatabaseType)(a)||"unknown");return c.runMigrations=async function(){if(!a.database||"updateMany"in a.database)throw new k.BetterAuthError("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");let{runMigrations:b}=await ay(a);await b()},c},cW=a=>((a,b)=>{let c=b(a),{api:d}=co(c,a);return{handler:async b=>{let d=await c,e=d.options.basePath||"/api/auth";if(!d.options.baseURL){let a=E(void 0,e,b,void 0,d.options.advanced?.trustedProxyHeaders);if(a)d.baseURL=a,d.options.baseURL=F(d.baseURL)||void 0;else throw new k.BetterAuthError("Could not get base URL from request. Please provide a valid base URL.")}d.trustedOrigins=await cu(d.options,b);let{handler:f}=cp(d,a);return(0,ak.runWithAdapter)(d.adapter,()=>f(b))},api:d,options:a,$context:c,$ERROR_CODES:{...a.plugins?.reduce((a,b)=>b.$ERROR_CODES?{...a,...b.$ERROR_CODES}:a,{}),...K.BASE_ERROR_CODES}}})(a,cV);a.s(["betterAuth",()=>cW],96116)},6569,a=>{"use strict";a.i(26060),a.i(50635),a.i(59430),a.i(37324),a.i(17648),a.i(49907),a.i(39619),a.i(96116),a.i(4551),a.i(46429),a.i(83508),a.i(76221),a.i(62054),a.i(61202),a.i(78075),a.i(80670),a.s([],6569)},62344,a=>{"use strict";a.i(62054);var b=a.i(14769),c=a.i(61202);a.i(66369);var d=a.i(70803),e=a.i(50472),f=a.i(97006);a.i(51179),a.i(10933);var g=a.i(62181);let h=(a,h)=>{let i=null,j=a=>({getFieldName:d,options:i})=>{function j(b){let d=h.schema||a._.fullSchema;if(!d)throw new c.BetterAuthError("Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.");let e=d[b];if(!e)throw new c.BetterAuthError(`[# Drizzle Adapter]: The model "${b}" was not found in the schema object. Please pass the schema directly to the adapter options.`);return e}let k=async(b,d,i,k)=>{if("mysql"!==h.provider)return(await d.returning())[0];await d.execute();let m=j(b),n=d.config?.values;if(k?.length){let c=l(k.map(a=>void 0!==i[a.field]?{...a,value:i[a.field]}:a),b);return(await a.select().from(m).where(...c))[0]}if(n&&n[0]?.id?.value){let b=n[0]?.id?.value;return b||(b=(await a.select({id:g.sql`LAST_INSERT_ID()`}).from(m).orderBy((0,f.desc)(m.id)).limit(1))[0].id),(await a.select().from(m).where((0,e.eq)(m.id,b)).limit(1).execute())[0]}if(i.id)return(await a.select().from(m).where((0,e.eq)(m.id,i.id)).limit(1).execute())[0];if(!("id"in m))throw new c.BetterAuthError(`The model "${b}" does not have an "id" field. Please use the "id" field as your primary key.`);return(await a.select().from(m).orderBy((0,f.desc)(m.id)).limit(1).execute())[0]};function l(a,b){let f=j(b);if(!a)return[];if(1===a.length){let g=a[0];if(!g)return[];let h=d({model:b,field:g.field});if(!f[h])throw new c.BetterAuthError(`The field "${g.field}" does not exist in the schema for the model "${b}". Please update your schema.`);if("in"===g.operator){if(!Array.isArray(g.value))throw new c.BetterAuthError(`The value for the field "${g.field}" must be an array when using the "in" operator.`);return[(0,e.inArray)(f[h],g.value)]}if("not_in"===g.operator){if(!Array.isArray(g.value))throw new c.BetterAuthError(`The value for the field "${g.field}" must be an array when using the "not_in" operator.`);return[(0,e.notInArray)(f[h],g.value)]}return"contains"===g.operator?[(0,e.like)(f[h],`%${g.value}%`)]:"starts_with"===g.operator?[(0,e.like)(f[h],`${g.value}%`)]:"ends_with"===g.operator?[(0,e.like)(f[h],`%${g.value}`)]:"lt"===g.operator?[(0,e.lt)(f[h],g.value)]:"lte"===g.operator?[(0,e.lte)(f[h],g.value)]:"ne"===g.operator?[(0,e.ne)(f[h],g.value)]:"gt"===g.operator?[(0,e.gt)(f[h],g.value)]:"gte"===g.operator?[(0,e.gte)(f[h],g.value)]:[(0,e.eq)(f[h],g.value)]}let g=a.filter(a=>"AND"===a.connector||!a.connector),h=a.filter(a=>"OR"===a.connector),i=(0,e.and)(...g.map(a=>{let g=d({model:b,field:a.field});if("in"===a.operator){if(!Array.isArray(a.value))throw new c.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "in" operator.`);return(0,e.inArray)(f[g],a.value)}if("not_in"===a.operator){if(!Array.isArray(a.value))throw new c.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "not_in" operator.`);return(0,e.notInArray)(f[g],a.value)}return"contains"===a.operator?(0,e.like)(f[g],`%${a.value}%`):"starts_with"===a.operator?(0,e.like)(f[g],`${a.value}%`):"ends_with"===a.operator?(0,e.like)(f[g],`%${a.value}`):"lt"===a.operator?(0,e.lt)(f[g],a.value):"lte"===a.operator?(0,e.lte)(f[g],a.value):"gt"===a.operator?(0,e.gt)(f[g],a.value):"gte"===a.operator?(0,e.gte)(f[g],a.value):"ne"===a.operator?(0,e.ne)(f[g],a.value):(0,e.eq)(f[g],a.value)})),k=(0,e.or)(...h.map(a=>{let g=d({model:b,field:a.field});if("in"===a.operator){if(!Array.isArray(a.value))throw new c.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "in" operator.`);return(0,e.inArray)(f[g],a.value)}if("not_in"===a.operator){if(!Array.isArray(a.value))throw new c.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "not_in" operator.`);return(0,e.notInArray)(f[g],a.value)}return"contains"===a.operator?(0,e.like)(f[g],`%${a.value}%`):"starts_with"===a.operator?(0,e.like)(f[g],`${a.value}%`):"ends_with"===a.operator?(0,e.like)(f[g],`%${a.value}`):"lt"===a.operator?(0,e.lt)(f[g],a.value):"lte"===a.operator?(0,e.lte)(f[g],a.value):"gt"===a.operator?(0,e.gt)(f[g],a.value):"gte"===a.operator?(0,e.gte)(f[g],a.value):"ne"===a.operator?(0,e.ne)(f[g],a.value):(0,e.eq)(f[g],a.value)})),l=[];return g.length&&l.push(i),h.length&&l.push(k),l}return{async create({model:b,data:d}){let e=j(b);if(!e)throw new c.BetterAuthError("Drizzle adapter failed to initialize. Drizzle Schema not found. Please provide a schema object in the adapter options object.");for(let a in d)if(!e[a])throw new c.BetterAuthError(`The field "${a}" does not exist in the "${b}" Drizzle schema. Please update your drizzle schema or re-generate using "npx @better-auth/cli@latest generate".`);return await k(b,a.insert(e).values(d),d)},async findOne({model:c,where:d,join:e}){let f=j(c),g=l(d,c);if(i.experimental?.joins)if(a.query&&a.query[c]){let b,d=[];if(e)for(let[a,c]of(b={},Object.entries(e))){let e=c.limit??i.advanced?.database?.defaultFindManyLimit??100,f="one-to-one"===c.relation,g=f||h.usePlural?"":"s";b[`${a}${g}`]=!!f||{limit:e},f||d.push(`${a}${g}`)}let f=await a.query[c].findFirst({where:g[0],with:b});if(f)for(let a of d){let b=h.usePlural?a:a.slice(0,-1);f[b]=f[a],a!==b&&delete f[a]}return f}else b.logger.error(`[# Drizzle Adapter]: The model "${c}" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using "npx @better-auth/cli@latest generate".`),b.logger.info("Falling back to regular query");let k=await a.select().from(f).where(...g);return k.length?k[0]:null},async findMany({model:c,where:e,sortBy:g,limit:k,offset:m,join:n}){let o=j(c),p=e?l(e,c):[],q=g?.direction==="desc"?f.desc:f.asc;if(i.experimental?.joins)if(a.query[c]){let b,e,f=[];if(n)for(let[a,c]of(b={},Object.entries(n))){let d="one-to-one"===c.relation,e=c.limit??i.advanced?.database?.defaultFindManyLimit??100,g=d||h.usePlural?"":"s";b[`${a}${g}`]=!!d||{limit:e},d||f.push(`${a}${g}`)}g?.field&&(e=[q(o[d({model:c,field:g?.field})])]);let j=await a.query[c].findMany({where:p[0],with:b,limit:k??100,offset:m??0,orderBy:e});if(j)for(let a of j)for(let b of f){let c=h.usePlural?b:b.slice(0,-1);c!==b&&(a[c]=a[b],delete a[b])}return j}else b.logger.error(`[# Drizzle Adapter]: The model "${c}" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using "npx @better-auth/cli@latest generate".`),b.logger.info("Falling back to regular query");let r=a.select().from(o);return void 0!==k&&(r=r.limit(k)),void 0!==m&&(r=r.offset(m)),g?.field&&(r=r.orderBy(q(o[d({model:c,field:g?.field})]))),await r.where(...p)},async count({model:b,where:c}){let d=j(b),e=c?l(c,b):[];return(await a.select({count:g.sql`count(${g.sql.raw("*")})`.mapWith(Number)}).from(d).where(...e))[0].count},async update({model:b,where:c,update:d}){let e=j(b),f=l(c,b);return await k(b,a.update(e).set(d).where(...f),d,c)},async updateMany({model:b,where:c,update:d}){let e=j(b),f=l(c,b);return await a.update(e).set(d).where(...f)},async delete({model:b,where:c}){let d=j(b),e=l(c,b);return await a.delete(d).where(...e)},async deleteMany({model:c,where:d}){let e=j(c),f=l(d,c),g=await a.delete(e).where(...f),h=0;return g&&"rowCount"in g?h=g.rowCount:Array.isArray(g)?h=g.length:g&&("affectedRows"in g||"rowsAffected"in g||"changes"in g)&&(h=g.affectedRows??g.rowsAffected??g.changes),"number"!=typeof h&&b.logger.error("[Drizzle Adapter] The result of the deleteMany operation is not a number. This is likely a bug in the adapter. Please report this issue to the Better Auth team.",{res:g,model:c,where:d}),h},options:h}},k=null;k={config:{adapterId:"drizzle",adapterName:"Drizzle Adapter",usePlural:h.usePlural??!1,debugLogs:h.debugLogs??!1,supportsUUIDs:"pg"===h.provider,supportsJSON:"pg"===h.provider,supportsArrays:"pg"===h.provider,transaction:!!h.transaction&&(b=>a.transaction(a=>b((0,d.createAdapterFactory)({config:k.config,adapter:j(a)})(i))))},adapter:j(a)};let l=(0,d.createAdapterFactory)(k);return a=>(i=a,l(a))};a.s(["drizzleAdapter",()=>h],62344)},34309,a=>{"use strict";a.i(62344),a.s([])},21638,a=>{"use strict";var b=a.i(52060);a.i(18828);var c=a.i(62192);let d=()=>({id:"next-cookies",hooks:{after:[{matcher:a=>!0,handler:(0,c.createAuthMiddleware)(async c=>{let d=c.context.responseHeaders;if((!("_flag"in c)||"router"!==c._flag)&&d instanceof Headers){let c,e=d?.get("set-cookie");if(!e)return;let f=(0,b.parseSetCookieHeader)(e),{cookies:g}=await a.A(29517);try{c=await g()}catch(a){if(a instanceof Error&&a.message.startsWith("`cookies` was called outside a request scope."))return;throw a}f.forEach((a,b)=>{if(!b)return;let d={sameSite:a.samesite,secure:a.secure,maxAge:a["max-age"],httpOnly:a.httponly,domain:a.domain,path:a.path};try{c.set(b,decodeURIComponent(a.value),d)}catch{}});return}})}]}});a.s(["nextCookies",()=>d])},31716,a=>a.a(async(b,c)=>{try{a.i(6569);var d=a.i(96116);a.i(34309);var e=a.i(62344),f=a.i(21638);a.i(46622);var g=a.i(28528),h=a.i(97034),i=a.i(3817),j=b([h]);[h]=j.then?(await j)():j;let k=(0,d.betterAuth)({secret:i.env.BETTER_AUTH_SECRET,baseURL:i.env.NEXT_PUBLIC_APP_URL,basePath:"/api/auth",database:(0,e.drizzleAdapter)(h.db,{provider:"pg",schema:g.dbSchema,usePlural:!0,camelCase:!0}),socialProviders:{github:{clientId:i.env.GITHUB_CLIENT_ID,clientSecret:i.env.GITHUB_CLIENT_SECRET}},plugins:[(0,f.nextCookies)()],trustedOrigins:[i.env.NEXT_PUBLIC_APP_URL]});a.s(["auth",0,k]),c()}catch(a){c(a)}},!1),72637,a=>a.a(async(b,c)=>{try{var d=a.i(77806);a.i(4049);var e=a.i(29319),f=a.i(31716),g=b([f]);async function h(){return f.auth.api.getSession({headers:await (0,d.headers)()})}async function i(){let a=await h();return a?.user?.id||(0,e.redirect)("/"),a}[f]=g.then?(await g)():g,a.s(["getServerSession",()=>h,"requireServerSession",()=>i]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_21b05a00._.js.map