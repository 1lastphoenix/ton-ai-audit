(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,44673,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return n}});let n=e=>{}},24911,e=>{"use strict";var t=e.i(52740),r=e.i(52236);function n({className:e,type:n,...i}){return(0,t.jsx)("input",{type:n,"data-slot":"input",className:(0,r.cn)("dark:bg-input/30 border-input focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:aria-invalid:border-destructive/50 disabled:bg-input/50 dark:disabled:bg-input/80 h-8 rounded-lg border bg-transparent px-2.5 py-1 text-base transition-colors file:h-6 file:text-sm file:font-medium focus-visible:ring-3 aria-invalid:ring-3 md:text-sm file:text-foreground placeholder:text-muted-foreground w-full min-w-0 outline-none file:inline-flex file:border-0 file:bg-transparent disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50",e),...i})}e.s(["Input",()=>n])},39618,e=>{"use strict";var t,r,n=e.i(52740),i=e.i(61174),a=e.i(66691),o=e.i(24911);function l({projectId:e,onUploaded:t}){let[r,l]=(0,i.useState)(null),[s,c]=(0,i.useState)(!1),[u,d]=(0,i.useState)(null);return(0,n.jsxs)("div",{className:"rounded-lg border border-white/10 bg-zinc-900/80 p-4",children:[(0,n.jsx)("div",{className:"mb-2 text-sm font-medium text-zinc-200",children:"Upload source or Blueprint ZIP"}),(0,n.jsx)("p",{className:"mb-3 text-xs text-zinc-400",children:"Upload one file or one zip per revision. ZIP is recommended for multi-file projects."}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,n.jsx)(o.Input,{type:"file",onChange:e=>l(e.target.files?.[0]??null),accept:".zip,.tolk,.fc,.func,.tact,.fift,.fif,.tlb,.ts,.js,.json,.md"}),(0,n.jsx)(a.Button,{disabled:!r||s,onClick:async()=>{if(r){d(null),c(!0);try{let n=r.name.toLowerCase().endsWith(".zip"),i=await fetch(`/api/projects/${e}/uploads/init`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:r.name,contentType:r.type||"application/octet-stream",sizeBytes:r.size,type:n?"zip":"file-set",parts:1})});if(!i.ok){let e=await i.json();throw Error(e.error??"Upload init failed")}let a=await i.json();if(!a.singleUrl)throw Error("Multipart upload not supported by this form");let o=await fetch(a.singleUrl,{method:"PUT",body:r,headers:{"Content-Type":r.type||"application/octet-stream"}});if(!o.ok)throw Error(`Upload failed with status ${o.status}`);let s=await fetch(`/api/projects/${e}/uploads/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uploadId:a.uploadId,eTags:[]})});if(!s.ok){let e=await s.json();throw Error(e.error??"Upload completion failed")}let c=await fetch(`/api/projects/${e}/revisions/from-upload`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uploadId:a.uploadId})});if(!c.ok){let e=await c.json();throw Error(e.error??"Failed to create revision")}let u=await c.json();t({revisionId:u.revision.id,jobId:u.jobId}),l(null)}catch(e){d(e instanceof Error?e.message:"Upload failed")}finally{c(!1)}}},children:s?"Uploading...":"Upload"})]}),u?(0,n.jsx)("p",{className:"mt-2 text-xs text-red-400",children:u}):null]})}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e){return function t(){for(var r=this,n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.length>=e.length?e.apply(this,i):function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return t.apply(r,[].concat(i,n))}}}function f(e){return({}).toString.call(e).includes("Object")}function p(e){return"function"==typeof e}var h=d(function(e,t){throw Error(e[t]||e.default)})({initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"}),m=function(e,t){return f(t)||h("changeType"),Object.keys(t).some(function(t){return!Object.prototype.hasOwnProperty.call(e,t)})&&h("changeField"),t},g=function(e){p(e)||h("selectorType")},y=function(e){p(e)||f(e)||h("handlerType"),f(e)&&Object.values(e).some(function(e){return!p(e)})&&h("handlersType")},v=function(e){e||h("initialIsRequired"),f(e)||h("initialType"),Object.keys(e).length||h("initialContent")};function x(e,t){return p(t)?t(e.current):t}function b(e,t){return e.current=u(u({},e.current),t),t}function w(e,t,r){return p(t)?t(e.current):Object.keys(r).forEach(function(r){var n;return null==(n=t[r])?void 0:n.call(t,e.current[r])}),r}var j={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},k=(t=function(e,t){throw Error(e[t]||e.default)},function e(){for(var r=this,n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.length>=t.length?t.apply(this,i):function(){for(var t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];return e.apply(r,[].concat(i,n))}})(j),N=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return t.reduceRight(function(e,t){return t(e)},e)}},M={type:"cancelation",msg:"operation is manually canceled"};function E(e){var t=!1,r=new Promise(function(r,n){e.then(function(e){return t?n(M):r(e)}),e.catch(n)});return r.cancel=function(){return t=!0},r}var S=function(e){if(Array.isArray(e))return e}(r=({create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v(e),y(t);var r={current:e},n=d(w)(r,t),i=d(b)(r),a=d(m)(e),o=d(x)(r);return[function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return g(e),e(r.current)},function(e){(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return t.reduceRight(function(e,t){return t(e)},e)}})(n,i,a,o)(e)}]}}).create({config:{paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.55.1/min/vs"}},isInitialized:!1,resolve:null,reject:null,monaco:null}))||function(e,t){var r=null==e?null:"u">typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a,o,l=[],s=!0,c=!1;try{a=(r=r.call(e)).next,!1;for(;!(s=(n=a.call(r)).done)&&(l.push(n.value),2!==l.length);s=!0);}catch(e){c=!0,i=e}finally{try{if(!s&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw i}}return l}}(r,2)||function(e,t){if(e){if("string"==typeof e)return s(e,2);var r=({}).toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,2):void 0}}(r,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),z=S[0],O=S[1];function C(e){return document.body.appendChild(e)}function P(e){var t,r,n=z(function(e){return{config:e.config,reject:e.reject}}),i=(t="".concat(n.config.paths.vs,"/loader.js"),r=document.createElement("script"),t&&(r.src=t),r);return i.onload=function(){return e()},i.onerror=n.reject,i}function R(){var e=z(function(e){return{config:e.config,resolve:e.resolve,reject:e.reject}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(t){var r=t.m||t;T(r),e.resolve(r)},function(t){e.reject(t)})}function T(e){z().monaco||O({monaco:e})}var I=new Promise(function(e,t){return O({resolve:e,reject:t})}),$=function(){var e=z(function(e){return{monaco:e.monaco,isInitialized:e.isInitialized,resolve:e.resolve}});if(!e.isInitialized){if(O({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),E(I);if(window.monaco&&window.monaco.editor)return T(window.monaco),e.resolve(window.monaco),E(I);N(C,P)(R)}return E(I)},A={display:"flex",position:"relative",textAlign:"initial"},U={width:"100%"},L={display:"none"},F={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},V=function({children:e}){return i.default.createElement("div",{style:F},e)},D=(0,i.memo)(function({width:e,height:t,isEditorReady:r,loading:n,_ref:a,className:o,wrapperProps:l}){return i.default.createElement("section",{style:{...A,width:e,height:t},...l},!r&&i.default.createElement(V,null,n),i.default.createElement("div",{ref:a,style:{...U,...!r&&L},className:o}))}),J=function(e){(0,i.useEffect)(e,[])},B=function(e,t,r=!0){let n=(0,i.useRef)(!0);(0,i.useEffect)(n.current||!r?()=>{n.current=!1}:e,t)};function q(){}function _(e,t,r,n){var i,a,o,l,s,c;return i=e,a=n,i.editor.getModel(Z(i,a))||(o=e,l=t,s=r,c=n,o.editor.createModel(l,s,c?Z(o,c):void 0))}function Z(e,t){return e.Uri.parse(t)}(0,i.memo)(function({original:e,modified:t,language:r,originalLanguage:n,modifiedLanguage:a,originalModelPath:o,modifiedModelPath:l,keepCurrentOriginalModel:s=!1,keepCurrentModifiedModel:c=!1,theme:u="light",loading:d="Loading...",options:f={},height:p="100%",width:h="100%",className:m,wrapperProps:g={},beforeMount:y=q,onMount:v=q}){let[x,b]=(0,i.useState)(!1),[w,j]=(0,i.useState)(!0),k=(0,i.useRef)(null),N=(0,i.useRef)(null),M=(0,i.useRef)(null),E=(0,i.useRef)(v),S=(0,i.useRef)(y),z=(0,i.useRef)(!1);J(()=>{let e=$();return e.then(e=>(N.current=e)&&j(!1)).catch(e=>e?.type!=="cancelation"&&console.error("Monaco initialization: error:",e)),()=>{let t;return k.current?(t=k.current?.getModel(),void(s||t?.original?.dispose(),c||t?.modified?.dispose(),k.current?.dispose())):e.cancel()}}),B(()=>{if(k.current&&N.current){let t=k.current.getOriginalEditor(),i=_(N.current,e||"",n||r||"text",o||"");i!==t.getModel()&&t.setModel(i)}},[o],x),B(()=>{if(k.current&&N.current){let e=k.current.getModifiedEditor(),n=_(N.current,t||"",a||r||"text",l||"");n!==e.getModel()&&e.setModel(n)}},[l],x),B(()=>{let e=k.current.getModifiedEditor();e.getOption(N.current.editor.EditorOption.readOnly)?e.setValue(t||""):t!==e.getValue()&&(e.executeEdits("",[{range:e.getModel().getFullModelRange(),text:t||"",forceMoveMarkers:!0}]),e.pushUndoStop())},[t],x),B(()=>{k.current?.getModel()?.original.setValue(e||"")},[e],x),B(()=>{let{original:e,modified:t}=k.current.getModel();N.current.editor.setModelLanguage(e,n||r||"text"),N.current.editor.setModelLanguage(t,a||r||"text")},[r,n,a],x),B(()=>{N.current?.editor.setTheme(u)},[u],x),B(()=>{k.current?.updateOptions(f)},[f],x);let O=(0,i.useCallback)(()=>{if(!N.current)return;S.current(N.current);let i=_(N.current,e||"",n||r||"text",o||""),s=_(N.current,t||"",a||r||"text",l||"");k.current?.setModel({original:i,modified:s})},[r,t,a,e,n,o,l]),C=(0,i.useCallback)(()=>{!z.current&&M.current&&(k.current=N.current.editor.createDiffEditor(M.current,{automaticLayout:!0,...f}),O(),N.current?.editor.setTheme(u),b(!0),z.current=!0)},[f,u,O]);return(0,i.useEffect)(()=>{x&&E.current(k.current,N.current)},[x]),(0,i.useEffect)(()=>{w||x||C()},[w,x,C]),i.default.createElement(D,{width:h,height:p,isEditorReady:x,loading:d,_ref:M,className:m,wrapperProps:g})});var W=function(e){let t=(0,i.useRef)();return(0,i.useEffect)(()=>{t.current=e},[e]),t.current},H=new Map,K=(0,i.memo)(function({defaultValue:e,defaultLanguage:t,defaultPath:r,value:n,language:a,path:o,theme:l="light",line:s,loading:c="Loading...",options:u={},overrideServices:d={},saveViewState:f=!0,keepCurrentModel:p=!1,width:h="100%",height:m="100%",className:g,wrapperProps:y={},beforeMount:v=q,onMount:x=q,onChange:b,onValidate:w=q}){let[j,k]=(0,i.useState)(!1),[N,M]=(0,i.useState)(!0),E=(0,i.useRef)(null),S=(0,i.useRef)(null),z=(0,i.useRef)(null),O=(0,i.useRef)(x),C=(0,i.useRef)(v),P=(0,i.useRef)(),R=(0,i.useRef)(n),T=W(o),I=(0,i.useRef)(!1),A=(0,i.useRef)(!1);J(()=>{let e=$();return e.then(e=>(E.current=e)&&M(!1)).catch(e=>e?.type!=="cancelation"&&console.error("Monaco initialization: error:",e)),()=>S.current?void(P.current?.dispose(),p?f&&H.set(o,S.current.saveViewState()):S.current.getModel()?.dispose(),S.current.dispose()):e.cancel()}),B(()=>{let i=_(E.current,e||n||"",t||a||"",o||r||"");i!==S.current?.getModel()&&(f&&H.set(T,S.current?.saveViewState()),S.current?.setModel(i),f&&S.current?.restoreViewState(H.get(o)))},[o],j),B(()=>{S.current?.updateOptions(u)},[u],j),B(()=>{S.current&&void 0!==n&&(S.current.getOption(E.current.editor.EditorOption.readOnly)?S.current.setValue(n):n!==S.current.getValue()&&(A.current=!0,S.current.executeEdits("",[{range:S.current.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),S.current.pushUndoStop(),A.current=!1))},[n],j),B(()=>{let e=S.current?.getModel();e&&a&&E.current?.editor.setModelLanguage(e,a)},[a],j),B(()=>{void 0!==s&&S.current?.revealLine(s)},[s],j),B(()=>{E.current?.editor.setTheme(l)},[l],j);let U=(0,i.useCallback)(()=>{if(!(!z.current||!E.current)&&!I.current){C.current(E.current);let i=o||r,c=_(E.current,n||e||"",t||a||"",i||"");S.current=E.current?.editor.create(z.current,{model:c,automaticLayout:!0,...u},d),f&&S.current.restoreViewState(H.get(i)),E.current.editor.setTheme(l),void 0!==s&&S.current.revealLine(s),k(!0),I.current=!0}},[e,t,r,n,a,o,u,d,f,l,s]);return(0,i.useEffect)(()=>{j&&O.current(S.current,E.current)},[j]),(0,i.useEffect)(()=>{N||j||U()},[N,j,U]),R.current=n,(0,i.useEffect)(()=>{j&&b&&(P.current?.dispose(),P.current=S.current?.onDidChangeModelContent(e=>{A.current||b(S.current.getValue(),e)}))},[j,b]),(0,i.useEffect)(()=>{if(j){let e=E.current.editor.onDidChangeMarkers(e=>{let t=S.current.getModel()?.uri;if(t&&e.find(e=>e.path===t.path)){let e=E.current.editor.getModelMarkers({resource:t});w?.(e)}});return()=>{e?.dispose()}}return()=>{}},[j,w]),i.default.createElement(D,{width:h,height:m,isEditorReady:j,loading:c,_ref:z,className:g,wrapperProps:y})});let Y=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),G=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)};var Q={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let X=(0,i.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:a="",children:o,iconNode:l,...s},c)=>(0,i.createElement)("svg",{ref:c,...Q,width:t,height:t,stroke:e,strokeWidth:n?24*Number(r)/Number(t):r,className:Y("lucide",a),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;return!1})(s)&&{"aria-hidden":"true"},...s},[...l.map(([e,t])=>(0,i.createElement)(e,t)),...Array.isArray(o)?o:[o]])),ee=(e,t)=>{let r=(0,i.forwardRef)(({className:r,...n},a)=>(0,i.createElement)(X,{ref:a,iconNode:t,className:Y(`lucide-${G(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...n}));return r.displayName=G(e),r},et=ee("file-code-corner",[["path",{d:"M4 12.15V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2h-3.35",key:"1wthlu"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m5 16-3 3 3 3",key:"331omg"}],["path",{d:"m9 22 3-3-3-3",key:"lsp7cz"}]]),er=ee("folder-tree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]),en=ee("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),ei=ee("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),ea=ee("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),eo=ee("file-down",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);e.i(16380);var el=e.i(97245),es=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=(0,el.createSlot)(`Primitive.${t}`),a=i.forwardRef((e,i)=>{let{asChild:a,...o}=e;return"u">typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(a?r:t,{...o,ref:i})});return a.displayName=`Primitive.${t}`,{...e,[t]:a}},{}),ec="horizontal",eu=["horizontal","vertical"],ed=i.forwardRef((e,t)=>{var r;let{decorative:i,orientation:a=ec,...o}=e,l=(r=a,eu.includes(r))?a:ec;return(0,n.jsx)(es.div,{"data-orientation":l,...i?{role:"none"}:{"aria-orientation":"vertical"===l?l:void 0,role:"separator"},...o,ref:t})});ed.displayName="Separator",e.s(["Root",()=>ed,"Separator",()=>ed],92778);var ef=e.i(92778),ef=ef,ep=e.i(52236);function eh({className:e,orientation:t="horizontal",decorative:r=!0,...i}){return(0,n.jsx)(ef.Root,{"data-slot":"separator",decorative:r,orientation:t,className:(0,ep.cn)("bg-border shrink-0 data-horizontal:h-px data-horizontal:w-full data-vertical:w-px data-vertical:self-stretch",e),...i})}let em={tolk:"typescript",func:"cpp",tact:"typescript",fift:"plaintext","tl-b":"plaintext",unknown:"plaintext"};function eg(e){let t=[];for(let r of e){if("file"===r.type){t.push(r.path);continue}t.push(...eg(r.children??[]))}return t}function ey(e){let{nodes:t,selectedPath:r,onSelect:i}=e;return(0,n.jsx)("ul",{className:"space-y-0.5 text-xs",children:t.map(e=>"directory"===e.type?(0,n.jsxs)("li",{children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 text-zinc-400",children:[(0,n.jsx)(er,{className:"size-3"}),(0,n.jsx)("span",{children:e.name})]}),(0,n.jsx)("div",{className:"ml-4",children:(0,n.jsx)(ey,{nodes:e.children??[],selectedPath:r,onSelect:i})})]},e.path):(0,n.jsx)("li",{children:(0,n.jsxs)("button",{type:"button",onClick:()=>i(e.path),className:`flex w-full items-center gap-1 rounded px-1 py-0.5 text-left ${r===e.path?"bg-sky-500/20 text-sky-200":"text-zinc-300 hover:bg-white/5"}`,children:[(0,n.jsx)(et,{className:"size-3"}),(0,n.jsx)("span",{className:"truncate",children:e.name})]})},e.path))})}function ev(e){let{projectId:t,initialRevisionId:r,initialAuditId:o,modelAllowlist:l}=e,s=(0,i.useRef)(null),[c,u]=(0,i.useState)(r),[d,f]=(0,i.useState)(o),[p,h]=(0,i.useState)(null),[m,g]=(0,i.useState)(!1),[y,v]=(0,i.useState)(!1),[x,b]=(0,i.useState)([]),[w,j]=(0,i.useState)(null),[k,N]=(0,i.useState)({}),[M,E]=(0,i.useState)([]),[S,z]=(0,i.useState)(l[0]??"openai/gpt-5"),[O,C]=(0,i.useState)(l[1]??l[0]??"openai/gpt-5-mini"),[P,R]=(0,i.useState)("idle"),[T,I]=(0,i.useState)(null),$=(0,i.useMemo)(()=>eg(x),[x]),A=w?k[w]:null,U=(0,i.useCallback)(async e=>{let r=await fetch(`/api/projects/${t}/revisions/${e}/tree`,{cache:"no-store"});if(!r.ok)throw Error("Failed to fetch file tree");let n=await r.json();b(n.tree);let i=eg(n.tree)[0]??null;j(e=>e??i)},[t]),L=(0,i.useCallback)(async e=>{if(!c||k[e])return;let r=new URLSearchParams({path:e}).toString(),n=await fetch(`/api/projects/${t}/revisions/${c}/file?${r}`,{cache:"no-store"});if(!n.ok)throw Error("Failed to fetch file");let i=await n.json();N(e=>({...e,[i.file.path]:{content:i.file.content,language:i.file.language}}))},[k,t,c]),F=(0,i.useCallback)(async e=>{let r=await fetch(`/api/projects/${t}/audits/${e}`,{cache:"no-store"});if(!r.ok)throw Error("Failed to fetch audit details");E((await r.json()).findings??[])},[t]);async function V(){if(c){if(!p){v(!0);try{let e=await fetch(`/api/projects/${t}/revisions/${c}/working-copy`,{method:"POST"});if(!e.ok)throw Error("Failed to create working copy");let r=await e.json();h(r.workingCopy.id)}finally{v(!1)}}g(!0)}}async function D(){if(p&&w&&A){v(!0),I(null);try{let e=await fetch(`/api/projects/${t}/working-copies/${p}/file`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:w,content:A.content})});if(!e.ok){let t=await e.json();throw Error(t.error??"Save failed")}}catch(e){I(e instanceof Error?e.message:"Save failed")}finally{v(!1)}}}async function J(){if(p){v(!0),R("queuing"),I(null);try{w&&A&&await D();let e=await fetch(`/api/projects/${t}/working-copies/${p}/run-audit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({primaryModelId:S,fallbackModelId:O,includeDocsFallbackFetch:!0})});if(!e.ok){let t=await e.json();throw Error(t.error??"Run audit failed")}let r=await e.json();R(r.verifyJobId?`verify:${r.verifyJobId}`:"queued"),u(r.revision.id),f(r.auditRun.id),h(null),g(!1)}catch(e){I(e instanceof Error?e.message:"Run audit failed")}finally{v(!1)}}}async function B(){if(d){v(!0),I(null);try{if(!(await fetch(`/api/projects/${t}/audits/${d}/pdf`,{method:"POST"})).ok)throw Error("Failed to queue PDF");let e=null;for(let r=0;r<10;r+=1){await new Promise(e=>setTimeout(e,1500));let r=await fetch(`/api/projects/${t}/audits/${d}/pdf`,{cache:"no-store"}),n=await r.json();if(n.url){e=n.url;break}}if(!e)throw Error("PDF generation is still running");window.open(e,"_blank","noopener,noreferrer")}catch(e){I(e instanceof Error?e.message:"PDF export failed")}finally{v(!1)}}}return(0,i.useEffect)(()=>{c&&U(c).catch(e=>{I(e instanceof Error?e.message:"Unable to load revision tree")})},[c,U]),(0,i.useEffect)(()=>{w&&L(w).catch(e=>{I(e instanceof Error?e.message:"Unable to load file")})},[w,L]),(0,i.useEffect)(()=>{d&&F(d).catch(e=>{I(e instanceof Error?e.message:"Unable to load findings")})},[d,F]),(0,n.jsxs)("div",{className:"grid min-h-[78vh] grid-cols-[52px_260px_minmax(0,1fr)_320px] overflow-hidden rounded-xl border border-white/10 bg-[#0d1117] text-zinc-200",children:[(0,n.jsxs)("aside",{className:"flex flex-col items-center gap-3 border-r border-white/10 bg-[#0a0e14] px-2 py-3",children:[(0,n.jsx)("button",{type:"button",className:"rounded bg-white/10 p-2 text-sky-300",children:(0,n.jsx)(er,{className:"size-4"})}),(0,n.jsx)("button",{type:"button",className:"rounded p-2 text-zinc-500",children:(0,n.jsx)(ea,{className:"size-4"})})]}),(0,n.jsxs)("aside",{className:"border-r border-white/10 bg-[#11161e] p-3",children:[(0,n.jsx)("div",{className:"mb-2 text-[11px] uppercase tracking-wide text-zinc-400",children:"Explorer"}),(0,n.jsx)(ey,{nodes:x,selectedPath:w,onSelect:j})]}),(0,n.jsxs)("section",{className:"flex min-w-0 flex-col",children:[(0,n.jsxs)("header",{className:"flex flex-wrap items-center gap-2 border-b border-white/10 bg-[#11161e] px-3 py-2 text-xs",children:[(0,n.jsx)("span",{className:"rounded bg-white/5 px-2 py-1 text-zinc-300",children:w??"No file selected"}),(0,n.jsx)(eh,{orientation:"vertical",className:"h-4 bg-white/10"}),m?(0,n.jsx)(a.Button,{size:"sm",variant:"outline",disabled:y,onClick:D,children:"Save file"}):(0,n.jsx)(a.Button,{size:"sm",variant:"outline",disabled:y||!c,onClick:V,children:"Enable editing"}),(0,n.jsx)("select",{className:"h-8 rounded border border-white/10 bg-black/30 px-2 text-xs",value:S,onChange:e=>z(e.target.value),children:l.map(e=>(0,n.jsx)("option",{value:e,children:e},e))}),(0,n.jsx)("select",{className:"h-8 rounded border border-white/10 bg-black/30 px-2 text-xs",value:O,onChange:e=>C(e.target.value),children:l.map(e=>(0,n.jsx)("option",{value:e,children:e},e))}),(0,n.jsxs)(a.Button,{size:"sm",disabled:!m||y,onClick:J,children:[(0,n.jsx)(en,{className:"mr-1 size-3"}),"Run Audit"]}),(0,n.jsxs)(a.Button,{size:"sm",variant:"outline",disabled:!d||y,onClick:B,children:[(0,n.jsx)(eo,{className:"mr-1 size-3"}),"Export PDF"]}),(0,n.jsxs)(a.Button,{size:"sm",variant:"ghost",disabled:y||!c,onClick:()=>{c&&(N({}),U(c).catch(()=>void 0),d&&F(d).catch(()=>void 0))},children:[(0,n.jsx)(ei,{className:"mr-1 size-3"}),"Refresh"]}),(0,n.jsxs)("span",{className:"ml-auto text-zinc-500",children:[m?"working copy":"audited revision"," | ",P]})]}),(0,n.jsx)("div",{className:"min-h-0 flex-1",children:w?(0,n.jsx)(K,{path:w,value:A?.content??"",language:em[A?.language??"unknown"]??"plaintext",theme:"vs-dark",options:{readOnly:!m,minimap:{enabled:!0},fontSize:13,lineNumbers:"on",automaticLayout:!0},onMount:e=>{s.current=e},onChange:e=>{w&&m&&N(t=>({...t,[w]:{content:e??"",language:t[w]?.language??"unknown"}}))}}):(0,n.jsx)("div",{className:"grid h-full place-items-center text-sm text-zinc-500",children:"Upload a revision and open a file to start."})})]}),(0,n.jsxs)("aside",{className:"border-l border-white/10 bg-[#0f131a] p-3",children:[(0,n.jsx)("div",{className:"mb-2 text-[11px] uppercase tracking-wide text-zinc-400",children:"Findings"}),(0,n.jsx)("div",{className:"space-y-2",children:0===M.length?(0,n.jsx)("p",{className:"text-xs text-zinc-500",children:"No findings on this audit revision."}):M.map(e=>(0,n.jsxs)("button",{type:"button",className:"w-full rounded border border-white/10 bg-white/[0.03] p-2 text-left text-xs hover:bg-white/[0.06]",onClick:()=>{let t=e.payloadJson?.evidence?.filePath;t&&j(t);let r=e.payloadJson?.evidence?.startLine;r&&s.current&&(s.current.revealLineInCenter(r),s.current.setPosition({lineNumber:r,column:1}))},children:[(0,n.jsx)("div",{className:`font-medium ${function(e){switch(e){case"critical":return"text-red-400";case"high":return"text-orange-400";case"medium":return"text-amber-300";case"low":return"text-yellow-200";default:return"text-sky-300"}}(e.payloadJson?.severity??e.severity)}`,children:e.payloadJson?.severity??e.severity}),(0,n.jsx)("div",{className:"mt-1 text-zinc-100",children:e.payloadJson?.title??"Untitled finding"}),(0,n.jsx)("div",{className:"mt-1 line-clamp-2 text-zinc-400",children:e.payloadJson?.summary})]},e.id))}),T?(0,n.jsx)("p",{className:"mt-3 text-xs text-red-400",children:T}):null,(0,n.jsxs)("p",{className:"mt-3 text-xs text-zinc-500",children:["Open files: ",$.length]})]})]})}function ex({projectId:e,initialRevisionId:t,initialAuditId:r,modelAllowlist:a}){let[o,s]=(0,i.useState)(t),[c,u]=(0,i.useState)(r),[d,f]=(0,i.useState)(null);return(0,n.jsxs)("div",{className:"grid gap-4",children:[(0,n.jsx)(l,{projectId:e,onUploaded:({revisionId:e,jobId:t})=>{s(e),u(null),f(t)}}),d?(0,n.jsxs)("p",{className:"text-xs text-zinc-500",children:["Ingest job queued: ",(0,n.jsx)("span",{className:"font-mono text-zinc-300",children:d})]}):null,(0,n.jsx)(ev,{projectId:e,initialRevisionId:o,initialAuditId:c,modelAllowlist:a},`${o??"none"}:${c??"none"}`)]})}e.s(["ProjectWorkspace",()=>ex],39618)}]);